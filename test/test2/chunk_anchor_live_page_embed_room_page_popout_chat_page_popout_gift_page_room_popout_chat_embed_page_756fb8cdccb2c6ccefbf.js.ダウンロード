(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{3:function(t,e){},4:function(t,e){},"8RJ8":function(t,e,s){"use strict";function i(t,e,s){try{if(t){for(var i=t.buffered,n=[],a=0;a<i.length;a+=1)n.push({start:i.start(a),end:i.end(a)});return function(t,e,s){var i,n,a,r,o,l=[];for(t.sort(function(t,e){var s=t.start-e.start;return s||e.end-t.end}),o=0;o<t.length;o+=1){var h,u=l.length;u?(h=l[u-1].end,t[o].start-h<s?t[o].end>h&&(l[u-1].end=t[o].end):l.push(t[o])):l.push(t[o])}for(i=o=0,n=a=e;o<l.length;o+=1){var d=l[o].start,c=l[o].end;if(d<=e+s&&e<c)n=d,i=(a=c)-e;else if(e+s<d){r=d;break}}return{len:i,start:n,end:a,nextStart:r}}(n,e,s)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}}s.d(e,"a",function(){return i})},NrfG:function(t,e,s){"use strict";s.d(e,"a",function(){return n});var i=s("4r7h"),n=function(){var t=Object(i.c)("configure",null),e=(null===(s=null==t?void 0:t.body)||void 0===s?void 0:s.web_hls_upgrade_switch)||0;if(window.location.pathname.split("playback")[1])return!0;if(!e)return!1;var s=Number(window.location.pathname.split("/")[1]);return!(-1<(null===(t=null===(t=null==t?void 0:t.body)||void 0===t?void 0:t.web_hls_upgrade_blacklist)||void 0===t?void 0:t.indexOf(s)))&&(null!==localStorage.getItem("hls_upgrade_config")&&Object(i.b)("hls_abTestPercent")===e||(localStorage.setItem("hls_abTestPercent",String(e)),localStorage.setItem("hls_upgrade_config",String(Math.random()<Object(i.b)("hls_abTestPercent")?1:0))),!!Number(localStorage.getItem("hls_upgrade_config")))}},qQiZ:function(t,e,s){"use strict";var i=s("lwsE"),n=s.n(i),i=s("W8MJ"),a=s.n(i),i=function(){function t(){n()(this,t),this.trace=[]}return a()(t,[{key:"append",value:function(t){1e3<=this.trace.length&&this.trace.splice(0,500),this.trace.push(t)}},{key:"clear",value:function(){this.trace=[]}}]),t}();e.a=new i},yPHP:function(t,e,s){"use strict";s.d(e,"a",function(){return m}),s.d(e,"b",function(){return g}),s.d(e,"c",function(){return V});var e=s("lwsE"),i=s.n(e),e=s("W8MJ"),n=s.n(e),e=s("JeXc"),r=s.n(e),e=s("4GFC"),o=s.n(e),a=s("4Qmz"),l=s("qQiZ"),e=("undefined"==typeof window&&self,{trace:u,debug:u,log:u,warn:u,info:u,error:u}),h=e;function u(){}function d(t,e){return e=(new Date).toISOString()+" | ["+t+"] > "+e}function c(i){var n=a.a[i];return n?function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];e[0]=d(i,e[0]),l.a.append(e[0]),"true"===window.localStorage.hls_debug&&(e[0]=d(i,e[0]),n.apply(a.a,e))}:u}var f={trace:c("log"),debug:c("log"),log:c("log"),warn:c("warn"),info:c("log"),error:c("error")};!function(e){for(var t=arguments.length,s=new Array(1<t?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];s.forEach(function(t){h[t]=e[t]?e[t].bind(e):c(t)})}(f,"trace","debug","log","info","warn","error");try{h.log()}catch(t){h=e}function v(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return i()(this,v),new(e?P.isSupported()?P:O:A)(t)}var m,g,L=s("YZk2"),y=s("iOfq"),E=s("6GNy"),S=s("9omm"),p=s("0lTn"),T="http",e=window,_=e.performance,R=e.XMLHttpRequest,b=null,A=function(){function e(t){i()(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup),S.a.on(E.I,this.onStreamServerHotReload),S.a.on(E.k,this.onClearStreamServerHotReloadCache)}return n()(e,[{key:"destroy",value:function(){this.abort(),this.loader=null,S.a.off(E.I,this.onStreamServerHotReload),S.a.off(E.k,this.onClearStreamServerHotReloadCache)}},{key:"abort",value:function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"onStreamServerHotReload",value:function(t){b=t}},{key:"onClearStreamServerHotReloadCache",value:function(){b=null}},{key:"load",value:function(t,e,s){-1!==(this.context=t).url.indexOf("?")&&(t.url=t.url.slice(0,t.url.indexOf("?"))),b&&b.prev&&b.next&&(t.url=t.url.replace(b.prev,b.next));var i={};"quic/tcp"===T&&(i.use_quic=1),t.url+=L.a.convertParamToQuery(Object.assign({},L.a.getHttpCommonParams(),{streamReqId:y.a.generateUUID(),is_lhls:p.a("is_lhls_mode")?1:0},i)),this.config=e,this.callbacks=s,this.stats={trequest:_.now(),retry:0,protocol:"http"},this.retryDelay=e.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e=this.context,s=this.loader=new R,t=this.stats;t.tfirst=0,t.loaded=0,t.chunks=0;var i=this.xhrSetup;try{if(i)try{i(s,e.url)}catch(t){s.open("GET",e.url,!0),i(s,e.url)}s.readyState||s.open("GET",e.url,!0)}catch(t){return void this.callbacks.onError({code:s.status,text:t.message},e,s)}e.rangeEnd&&s.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),s.onreadystatechange=this.readystatechange.bind(this),s.onprogress=this.loadprogress.bind(this),s.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),s.send()}},{key:"getHeaders",value:function(t){var t=t.getAllResponseHeaders().trim().split(/[\r\n]+/),s={};return t.forEach(function(t){var e=t.split(": "),t=e.shift(),e=e.join(": ");s[t]=e}),s}},{key:"readystatechange",value:function(t){var e,s=t.currentTarget,i=s.readyState,n=this.stats,a=this.context,r=this.config;n.aborted||2<=i&&(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=Math.max(_.now(),n.trequest)),4===i?200<=(t=s.status)&&t<300?(n.tload=Math.max(n.tfirst,_.now()),i="arraybuffer"===a.responseType?(e=s.response).byteLength:(e=s.responseText).length,n.loaded=n.total=i,n.chunks++,i={url:s.responseURL,data:e},e=this.getHeaders(s),T="1"===e["x-use-quic"]?n.protocol="quic/tcp":n.protocol="http",n["x-via"]=e["x-via"]||"",this.callbacks.onSuccess(i,n,a,s)):n.retry>=r.maxRetry||400<=t&&t<499?(h.error("".concat(t," while loading ").concat(a.url)),this.callbacks.onError({code:t,text:s.statusText},a,s)):(h.warn("".concat(t," while loading ").concat(a.url,", retrying in ").concat(this.retryDelay,"...")),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,r.maxRetryDelay),n.retry++):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),r.timeout))}},{key:"loadtimeout",value:function(){h.warn("timeout while loading ".concat(this.context.url)),this.callbacks.onTimeout(this.stats,this.context,null)}},{key:"loadprogress",value:function(t){var e=t.currentTarget,s=this.stats;s.loaded=t.loaded,t.lengthComputable&&(s.total=t.total);t=this.callbacks.onProgress;t&&t(s,this.context,null,e)}}]),e}(),e=window,w=e.performance,F=e.Headers,D=e.fetch,H=e.Request,k=null,P=function(){function e(t){i()(this,e),this.fetchSetup=t.fetchSetup,this.firstChunkSize=0,S.a.on(E.I,this.onStreamServerHotReload),S.a.on(E.k,this.onClearStreamServerHotReloadCache)}return n()(e,null,[{key:"isSupported",value:function(){try{return window.fetch&&window.ReadableStream}catch(t){return!1}}}]),n()(e,[{key:"destroy",value:function(){S.a.off(E.I,this.onStreamServerHotReload),S.a.off(E.k,this.onClearStreamServerHotReloadCache)}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"firstChunkSizeOfFirstFragment",value:function(){return this.firstChunkSize}},{key:"onStreamServerHotReload",value:function(t){k=t}},{key:"onClearStreamServerHotReloadCache",value:function(){k=null}},{key:"load",value:function(i,t,n){window.addEventListener("offline",function(){function t(){n.onError({text:"network disconnect"},i),window.removeEventListener("online",t)}window.addEventListener("online",t)});var a=this.stats={trequest:w.now(),retry:0,loaded:0,chunks:0},e={method:"GET",mode:"cors",credentials:"same-origin"};-1!==(this.context=i).url.indexOf("?")&&(i.url=i.url.slice(0,i.url.indexOf("?"))),k&&k.prev&&k.next&&(i.url=i.url.replace(k.prev,k.next)),i.url+=L.a.convertParamToQuery(Object.assign({},L.a.getHttpCommonParams(),{streamReqId:y.a.generateUUID()})),this.callbacks=n,this.targetURL=i.url;var s={};i.rangeEnd&&(s.Range="bytes="+i.rangeStart+"-"+(i.rangeEnd-1)),e.headers=new F(s),s=this.fetchSetup?this.fetchSetup(i,e):new H(i.url,e);e=D(s,e).then(function(t){if(!this._requestAbort&&t.ok){var e=t.headers.get("X-FFL"),s=t.headers.get("Content-Length");if(this.firstChunkSize=null==e?s:e,h.log("["+t.url+"][CL:"+s+"][X-FFL:"+e+"]"),a.tfirst=Math.max(a.trequest,w.now()),this.targetURL=t.url,!i.progressData||!n.onProgress)return"arraybuffer"===i.responseType?t.arrayBuffer():t.text();this._pump(t.body.getReader())}else this._requestAbort||n.onError({text:"fetch, bad network response ".concat(t.statusText)},i)}.bind(this)).catch(function(t){n.onError({text:t.message},i)});!this._requestAbort&&e&&e.then(function(t){var e;t&&!this._requestAbort&&(a.tload=Math.max(a.tfirst,w.now()),e="string"==typeof t?t.length:t.byteLength,a.loaded=a.total=e,a.chunks++,t={url:this.targetURL,data:t},n.onSuccess(t,a,i))}.bind(this))}},{key:"_pump",value:function(a){var r=this;this._requestAbort||a.read().then(function(t){var e=t.value,s=t.done,i=r.callbacks,n=r.stats,t=r.context;if(!s)return n.loaded+=e.length,n.chunks++,i.onProgress(n,r.context,e.buffer),r._pump(a);n.total=n.loaded,n.tload=Math.max(n.tfirst,w.now()),i.onSuccess({url:r.targetURL},n,t)})}}]),e}(),e=s("lJCZ"),M=s.n(e),N=null,O=function(){function t(){i()(this,t),this.firstChunkSize=0,S.a.on(E.I,this.onStreamServerHotReload),S.a.on(E.k,this.onClearStreamServerHotReloadCache)}return n()(t,[{key:"destroy",value:function(){S.a.off(E.I,this.onStreamServerHotReload),S.a.off(E.k,this.onClearStreamServerHotReloadCache)}},{key:"abort",value:function(){var t=this.req;t&&t.abort()}},{key:"onStreamServerHotReload",value:function(t){N=t}},{key:"onClearStreamServerHotReloadCache",value:function(){N=null}},{key:"firstChunkSizeOfFirstFragment",value:function(){return this.firstChunkSize}},{key:"load",value:function(i,t,n){var a=this,r=this.stats={trequest:window.performance.now(),retry:0,loaded:0,chunks:0,tfirst:0};i.rangeEnd&&(i.rangeStart,i.rangeEnd),-1!==i.url.indexOf("?")&&(i.url=i.url.slice(0,i.url.indexOf("?"))),N&&N.prev&&N.next&&(i.url=i.url.replace(N.prev,N.next)),i.url+=L.a.convertParamToQuery(Object.assign({},L.a.getHttpCommonParams(),{streamReqId:y.a.generateUUID()})),this.req=M.a.get({path:i.url,mode:"allow-wrong-content-type",timeout:t.timeout},function(t){var e=t.headers["x-ffl"],s=t.headers["content-length"];a.firstChunkSize=null==e?Number(s):Number(e),h.log("["+t.url+"][CL:"+s+"][X-FFL:"+e+"]"),t.on("end",function(){r.total=r.loaded,r.tload=Math.max(r.tfirst,window.performance.now()),n.onSuccess({url:i.url},r,i)}),t.on("data",function(t){0===r.tfirst&&(r.tfirst=Math.max(performance.now(),r.trequest)),r.loaded+=t.length,r.chunks++,n.onProgress(r,i,t.buffer)}),t.on("error",function(t){n.onError({text:t.message},i)}),t.on("timeout",function(){h.warn("timeout while loading ".concat(i.url)),n.onTimeout(r,i,null)})})}}]),t}(),x=s("NrfG"),C=s("4r7h"),I=s("e6Ps"),U=0,q=function(){function e(t){i()(this,e),this.expectionWatcher=null,this.startStallTime=null,this.startFragNotLoadingTime=0,this.isLoadingFrag=!1,this.lastPlaylistFragSn=0,this.isPlaylistNotUpdate=!0,this.controller=t,this.onPlayStalled=this.onPlayStalled.bind(this),this.onPlayStallRecover=this.onPlayStallRecover.bind(this),this.expectionWatch=this.expectionWatch.bind(this),this.onHlsFragLoading=this.onHlsFragLoading.bind(this),this.onHlsFragLoaded=this.onHlsFragLoaded.bind(this),this.onHlsLevelLoaded=this.onHlsLevelLoaded.bind(this)}return n()(e,[{key:"run",value:function(){this.stop(),this.controller.registerEvent(m.PLAY_STALLED,this.onPlayStalled),this.controller.registerEvent(m.PLAY_STALL_RECOVER,this.onPlayStallRecover),this.controller.registerHlsEvent((this.controller.config.isNewHls?r:o).a.Events.FRAG_LOADING,this.onHlsFragLoading),this.controller.registerHlsEvent((this.controller.config.isNewHls?r:o).a.Events.FRAG_LOADED,this.onHlsFragLoaded),this.controller.registerHlsEvent((this.controller.config.isNewHls?r:o).a.Events.LEVEL_LOADED,this.onHlsLevelLoaded),this.expectionWatcher=setInterval(this.expectionWatch,100)}},{key:"stop",value:function(){clearInterval(this.expectionWatcher),this.startStallTime=null,this.startFragNotLoadingTime=0,this.isLoadingFrag=!1,this.controller.unregisterEvent(this.onPlayStalled),this.controller.unregisterEvent(this.onPlayStallRecover),this.controller.unregisterHlsEvent(this.onHlsFragLoading),this.controller.unregisterHlsEvent(this.onHlsFragLoaded),this.controller.unregisterHlsEvent(this.onHlsLevelLoaded)}},{key:"onPlayStalled",value:function(){this.startStallTime=performance.now()}},{key:"onPlayStallRecover",value:function(){this.startStallTime=null}},{key:"hasFragRequesting",value:function(){return this.controller.config.lowLatencyEnable?this.isLoadingFrag:this.controller.config.isNewHls?!!this.isLoadingFrag:!!this.controller.hls.streamController.getFirstRequestFrag()}},{key:"onHlsFragLoading",value:function(){this.isLoadingFrag=!0}},{key:"onHlsFragLoaded",value:function(){this.isLoadingFrag=!1,this.startFragNotLoadingTime=0}},{key:"onHlsLevelLoaded",value:function(t,e){var s,i=this,n=null===(n=null===(s=null==e?void 0:e.details)||void 0===s?void 0:s.fragments[(null===(n=null===(n=null==e?void 0:e.details)||void 0===n?void 0:n.fragments)||void 0===n?void 0:n.length)-1])||void 0===n?void 0:n.sn;this.lastPlaylistFragSn!==n||this.playlistNotUpdateTimeout?(this.isPlaylistNotUpdate=!1,clearTimeout(this.playlistNotUpdateTimeout),this.playlistNotUpdateTimeout=null):this.playlistNotUpdateTimeout=setTimeout(function(){performance.now()-i.lastPlaylistLoadedTime<=3e3&&(i.isPlaylistNotUpdate=!0)},1e4),this.lastPlaylistFragSn=n,this.lastPlaylistLoadedTime=performance.now()}},{key:"expectionWatch",value:function(){var t,e,s;3<=U||(t=this.startStallTime?performance.now()-this.startStallTime:0,(e=this.hasFragRequesting())?this.startFragNotLoadingTime=0:e||0!==this.startFragNotLoadingTime||(this.startFragNotLoadingTime=performance.now()),s=0!==this.startFragNotLoadingTime?performance.now()-this.startFragNotLoadingTime:0,5e3<t&&!this.isPlaylistNotUpdate&&!e&&1e4<s&&(U+=1,this.startStallTime=null,this.startFragNotLoadingTime=0,this.isLoadingFrag=!1,I.a.glean({lt:"video",ct:"play",dt:"expection_handle",stall_time:t,frag_not_loading_time:s,low_latency:this.controller.config.lowLatencyEnable?1:0,definition:this.controller.config.definition||"",vod_mode:this.controller.config.vodMode?1:0,new_hls:this.controller.config.isNewHls?1:0,log_trace:l.a.trace.join("---")}),this.controller.init(),a.a.log("[player-controller-expection-handler]: restart player due to expection detect, stallTime:".concat(t,", hasFragRequesting:").concat(e,", fragNotLoadingTime:").concat(s))))}}]),e}(),e=s("pBJ0"),G=s.n(e),Y=s("8RJ8"),j=function(){function e(t){i()(this,e),this.controller=t,this.currentPlayStats={firstFrameData:{startPlayTime:0,firstFrameShowTime:0,hlsManifestLoadCost:0,hlsLevelLoadCost:0,hlsTsLoadCost:0},bufferSizes:[]},this.hlsFirstFrameManifestRequest=null,this.hlsFirstFrameLevelRequest=null,this.hlsFirstFrameTsRequest=null,this.watch=this.watch.bind(this),this.onStatusChange=this.onStatusChange.bind(this),this.onHlsManifestLoaded=this.onHlsManifestLoaded.bind(this),this.onHlsLevelLoaded=this.onHlsLevelLoaded.bind(this),this.onHlsFragLoaded=this.onHlsFragLoaded.bind(this),performance.addEventListener&&performance.clearResourceTimings&&performance.addEventListener("resourcetimingbufferfull",function(){performance.clearResourceTimings()})}return n()(e,[{key:"run",value:function(){this.stop(),this.watchInterval=setInterval(this.watch,1e3),this.controller.registerEvent(m.PLAY_STATUS_CHANGE,this.onStatusChange),this.controller.registerHlsEvent(G.a.Events.MANIFEST_LOADED,this.onHlsManifestLoaded),this.controller.registerHlsEvent(G.a.Events.LEVEL_LOADED,this.onHlsLevelLoaded),this.controller.registerHlsEvent(G.a.Events.FRAG_LOADED,this.onHlsFragLoaded)}},{key:"stop",value:function(){this.resetStatsData(),this.hlsFirstFrameManifestRequest=null,this.hlsFirstFrameLevelRequest=null,this.hlsFirstFrameTsRequest=null,this.controller.unregisterEvent(this.onStatusChange),this.controller.unregisterHlsEvent(this.onHlsManifestLoaded),this.controller.unregisterHlsEvent(this.onHlsLevelLoaded),this.controller.unregisterHlsEvent(this.onHlsFragLoaded),clearInterval(this.watchInterval)}},{key:"onStatusChange",value:function(t){var e,s=t.status;s===g.START?this.currentPlayStats.firstFrameData.startPlayTime=performance.now():s===g.PLAYING?(e=this.hlsFirstFrameManifestRequest?Math.round(this.hlsFirstFrameManifestRequest.responseEnd-this.hlsFirstFrameManifestRequest.fetchStart):0,t=this.hlsFirstFrameLevelRequest?Math.round(this.hlsFirstFrameLevelRequest.responseEnd-this.hlsFirstFrameLevelRequest.fetchStart):0,s=this.hlsFirstFrameTsRequest?Math.round(this.hlsFirstFrameTsRequest.responseEnd-this.hlsFirstFrameTsRequest.fetchStart):0,this.currentPlayStats.firstFrameData.hlsManifestLoadCost=e,this.currentPlayStats.firstFrameData.hlsLevelLoadCost=t,this.currentPlayStats.firstFrameData.hlsTsLoadCost=s,this.currentPlayStats.firstFrameData.firstFrameShowTime=performance.now(),console.log("[play_statistic_tracker]: ",this.currentPlayStats.firstFrameData)):this.resetStatsData()}},{key:"watch",value:function(){var t=null===(t=this.controller)||void 0===t?void 0:t.videoDom;this.currentPlayStats.bufferSizes.push(Object(Y.a)(t,null==t?void 0:t.currentTime,.5))}},{key:"onHlsManifestLoaded",value:function(t,e){var s=performance.getEntries().filter(function(t){return t.name.includes(e.url)}),s=s.length&&s[0];s&&(this.hlsFirstFrameManifestRequest=s)}},{key:"onHlsLevelLoaded",value:function(t,e){var s;"auto"!==this.controller.config.definition||this.hlsFirstFrameLevelRequest||(s=(s=performance.getEntries().filter(function(t){return t.name.includes(e.details.url)})).length&&s[0])&&(this.hlsFirstFrameLevelRequest=s)}},{key:"onHlsFragLoaded",value:function(t,e){var s;this.hlsFirstFrameTsRequest||(s=(s=performance.getEntries().filter(function(t){return t.name.includes(e.networkDetails.responseURL)})).length&&s[0])&&(this.hlsFirstFrameTsRequest=s)}},{key:"resetStatsData",value:function(){this.currentPlayStats={firstFrameData:{startPlayTime:0,firstFrameShowTime:0},bufferSizes:[]},this.hlsFirstFrameManifestRequest=null,this.hlsFirstFrameLevelRequest=null,this.hlsFirstFrameTsRequest=null}}]),e}();function W(){var t=-1<window.navigator.userAgent.toLowerCase().indexOf("chrome"),e=-1<window.navigator.userAgent.toLowerCase().indexOf("safari");return!t&&e}function B(){return 1<=window.navigator.userAgent.indexOf("MSIE")}function z(){return-1<navigator.userAgent.toLowerCase().indexOf("firefox")}(s=m=m||{}).AUTO_PLAY_FORCE_MUTED="auto_play_force_muted",s.PLAY_ERROR="play_error",s.PLAY_STALLED="play_stalled",s.PLAY_STALL_RECOVER="play_stall_recover",s.PLAY_SUCCESS="play_success",s.PLAY_STATUS_CHANGE="play_status_change",s.FORCE_PAUSED="force_paused",s.AUTO_DEFINTION_SWITCHED="auto_definition_switch",(s=g=g||{}).INITIAL="initial",s.START="start",s.PLAYING="playing",s.PAUSED="paused",s.END="end",s.ERROR="error";var V=function(){function e(t){i()(this,e),this.playStatus=g.INITIAL,this.hlsAddonConfig={},this.config={src:"",lowLatencyEnable:!1,cmodeWhiteList:[],realtimePlaybackMode:!1,startPosition:0,definition:"",vodMode:!1,playbackRate:1,groupId:"",isNewHls:!1},this.retryPlayTimes=0,this.bufferEosData=null,this.stallStartTime=0,this.stallDetectTimer=0,this.extra={},this.eventListeners=[],this.hlsEventListeners=[],this.videoDom=t,this.play=this.play.bind(this),this.onHlsMediaAttach=this.onHlsMediaAttach.bind(this),this.onHlsManifestLoaded=this.onHlsManifestLoaded.bind(this),this.onHlsLevelSwitched=this.onHlsLevelSwitched.bind(this),this.onHlsLevelLoaded=this.onHlsLevelLoaded.bind(this),this.onHlsManifestParsed=this.onHlsManifestParsed.bind(this),this.onHlsError=this.onHlsError.bind(this),this.onHlsStallRecover=this.onHlsStallRecover.bind(this),this.onHlsBufferEos=this.onHlsBufferEos.bind(this),this.onNativePlay=this.onNativePlay.bind(this),this.onNativePause=this.onNativePause.bind(this),this.onNativeEnd=this.onNativeEnd.bind(this),this.expectionHandler=new q(this),this.firstFrameTracker=new j(this)}return n()(e,[{key:"setup",value:function(t){this.config=Object.assign(Object.assign({},this.config),t)}},{key:"init",value:function(){var e=this;this.reset(),this.firstFrameTracker.run();var t=Object(C.c)("configure",null),s=null===(i=null==t?void 0:t.body)||void 0===i?void 0:i.web_hls_upgrade_switch,i=null===(n=null==t?void 0:t.body)||void 0===n?void 0:n.web_hls_config,n=!!(this.config.vodMode||s&&this.config.lowLatencyEnable)||Object(x.a)(),s={enableWorker:!0,debug:f,mildomFragMaxParallelLoadNum:z()?1:2};n?(s.mildomFragMaxParallelLoadNum=z()?1:2,s.mildomSpeedUpRate=(null==i?void 0:i.speed_up_rate)||1.08,s.mildomSpeedDownRate=(null==i?void 0:i.speed_down_rate)||.92,s.mildomSpeedResetFactor=(null==i?void 0:i.speed_reset_factor)||.2,s.mildomSpeedMaxBufferSizeThreshold=(null==i?void 0:i.speed_max_buffer_size_threshold)||15e3,s.mildomSpeedResetBufferSizeThreshold=(null==i?void 0:i.speed_reset_buffer_size_threshold)||9e3,s.mildomSpeedUpBufferGap=(null==i?void 0:i.speed_up_buffer_gap)||8e3,s.mildomSpeedResetBufferGap=(null==i?void 0:i.speed_reset_buffer_gap)||2e3):s.loader=A,this.config.vodMode?s=Object.assign(Object.assign({},s),{maxAudioFramesDrift:999999,startPosition:(this.config.startPosition||0)/1e3,mildomFragMaxParallelLoadNum:1}):this.config.realtimePlaybackMode?(s=Object.assign(Object.assign({},s),{maxAudioFramesDrift:999999,startPosition:(this.config.startPosition||0)/1e3,livePlaybackMode:!0}),n?s.mildomRealtimePlaybackMode=!0:s.livePlaybackMode=!0):(s=Object.assign(Object.assign({},s),{maxBufferLength:60,maxAudioFramesDrift:999999,forceKeyFrameOnDiscontinuity:!1,autoStartLoad:!1,mildomLevelMaxReloadInterval:1e3}),n?(s.liveSyncDuration=B()?5:4,s.mildomFilterLevels=function(t){return t.length<=1?t:t.filter(function(t){return!e.config.cmodeWhiteList||e.config.cmodeWhiteList.length<=0?t:e.config.cmodeWhiteList.includes(null===(t=t.attrs)||void 0===t?void 0:t.CMODE)})}):(s.cmodeWhiteList=this.config.cmodeWhiteList||[],s.liveSyncDurationCount=B()?2.5:2)),this.config.lowLatencyEnable&&!this.config.realtimePlaybackMode&&(n?(s.mildomLevelMaxReloadInterval=500,s.mildomFragMaxParallelLoadNum=1,s.liveSyncDuration=void 0,s.liveSyncDurationCount=2,s.progressive=!0,s.lowLatencyMode=!0,s.mildomSpeedMaxBufferSizeThreshold=(null==i?void 0:i.ll_speed_max_buffer_size_threshold)||2e3,s.mildomSpeedResetBufferSizeThreshold=(null==i?void 0:i.ll_speed_reset_buffer_size_threshold)||1e3):(s.lowLatencyEnabled=!0,s.lowLatencyStartUpMaxWaitTime=2500,s.lowLatencyStartUpForward=!0,s.bufferTimeAdjustCount=.1,s.targetBufferCount=1.15,s.bufferAdjustDuration=8e3,s.lhlsTargetBufTime=.7,s.lhlsBufferTimeRange=1,s.lhlsStartDelayTime=.3,s.lhlsEnable=!B(),s.lhlsEnable&&(s.liveSyncDurationCount=2,s.lowLatencyStartUpMaxWaitTime=-1,s.loader=v))),(null===(i=null===(i=null==t?void 0:t.body)||void 0===i?void 0:i.web_hls_config)||void 0===i||!i.parallel_load_open_rate||Math.random()>=((null===(a=null===(a=null==t?void 0:t.body)||void 0===a?void 0:a.web_hls_config)||void 0===a?void 0:a.parallel_load_open_rate)||0))&&(console.log("[player-controller]: downgrade frag load parallel number to 1"),s.mildomFragMaxParallelLoadNum=1),this.extra.isParallelLoad=1<s.mildomFragMaxParallelLoadNum,s=Object.assign(Object.assign({},s),this.hlsAddonConfig);var a=((this.config.isNewHls=n)?r:o).a;this.hls=new a(s),this.hls.on(a.Events.MEDIA_ATTACHED,this.onHlsMediaAttach),this.hls.on(a.Events.MANIFEST_LOADED,this.onHlsManifestLoaded),this.hls.on(a.Events.LEVEL_SWITCHED,this.onHlsLevelSwitched),this.hls.on(a.Events.LEVEL_LOADED,this.onHlsLevelLoaded),this.hls.on(a.Events.MANIFEST_PARSED,this.onHlsManifestParsed),this.hls.on(a.Events.ERROR,this.onHlsError),this.hls.on(n?a.Events.MILDOM_STALL_RECOVER:a.Events.STALL_RECOVER,this.onHlsStallRecover),this.hls.on(a.Events.BUFFER_EOS,this.onHlsBufferEos),this.hls.attachMedia(this.videoDom),this.hlsEventListeners.forEach(function(t){e.hls.on(t.event,t.callback)}),this.videoDom.addEventListener("play",this.onNativePlay),this.videoDom.addEventListener("pause",this.onNativePause),this.videoDom.addEventListener("ended",this.onNativeEnd),0===this.retryPlayTimes&&(this.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.START,prevStatus:this.playStatus,data:{}}),this.playStatus=g.START),this.expectionHandler.run()}},{key:"reset",value:function(){clearInterval(this.stallDetectTimer),l.a.clear(),this.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.PAUSED,prevStatus:g.PLAYING,data:{}}),this.destory(),this.playStatus=g.PAUSED,this.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.INITIAL,prevStatus:this.playStatus,data:{}}),this.expectionHandler.stop(),this.firstFrameTracker.stop()}},{key:"destory",value:function(){var t,e=this;this.hls&&(t=(this.config.isNewHls?r:o).a,this.hls.off(t.Events.MEDIA_ATTACHED,this.onHlsMediaAttach),this.hls.off(t.Events.MANIFEST_LOADED,this.onHlsManifestLoaded),this.hls.off(t.Events.LEVEL_SWITCHED,this.onHlsLevelSwitched),this.hls.off(t.Events.LEVEL_LOADED,this.onHlsLevelLoaded),this.hls.off(t.Events.MANIFEST_PARSED,this.onHlsManifestParsed),this.hls.off(t.Events.ERROR,this.onHlsError),this.hls.off(this.config.isNewHls?t.Events.MILDOM_STALL_RECOVER:t.Events.STALL_RECOVER,this.onHlsStallRecover),this.hls.off(t.Events.BUFFER_EOS,this.onHlsBufferEos),this.hlsEventListeners.forEach(function(t){e.hls.off(t.event,t.callback)}),this.hls.stopLoad(),this.hls.detachMedia(),this.hls.destroy()),this.hls=null,this.bufferEosData=null,this.videoDom&&(this.videoDom.removeEventListener("play",this.onNativePlay),this.videoDom.removeEventListener("pause",this.onNativePause),this.videoDom.removeEventListener("ended",this.onNativeEnd))}},{key:"play",value:function(){var t=this;this.checkStallError();var e=this.config.startPosition?this.config.startPosition/1e3:-1;this.hls.startLoad(this.config.realtimePlaybackMode?e:-1),this.tryPlay().then(function(){t.fireEventListener(m.PLAY_SUCCESS),t.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.PLAYING,prevStatus:t.playStatus,data:{}}),t.playStatus=g.PLAYING}).catch(function(t){console.warn("auto play failed, error: ",t)})}},{key:"pause",value:function(){this.videoDom&&(clearInterval(this.stallDetectTimer),this.videoDom.pause(),this.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.PAUSED,prevStatus:this.playStatus,data:{}}),this.playStatus=g.PAUSED),this.hls&&this.hls.stopLoad(),this.expectionHandler.stop()}},{key:"checkStallError",value:function(){var t=this;this.stallDetectTimer=setInterval(function(){t.videoDom&&Object(Y.a)(t.videoDom,t.videoDom.currentTime,.5).len<.2?0===t.stallStartTime&&(t.stallStartTime=performance.now()):t.stallStartTime=0,t.stallStartTime&&6e4<performance.now()-t.stallStartTime&&t.touchReInit({details:"unknow"})},1e3)}},{key:"onHlsMediaAttach",value:function(){this.hls.loadSource(this.config.src),this.setPlaybackRate(this.config.playbackRate||1)}},{key:"onHlsManifestLoaded",value:function(){try{this.play()}catch(t){console.error(t)}}},{key:"onHlsError",value:function(t,e){var s=(this.config.isNewHls?r:o).a;e.details===s.ErrorDetails.BUFFER_STALLED_ERROR&&this.fireEventListener(m.PLAY_STALLED),e.details===s.ErrorDetails.BUFFER_APPEND_MEDIA_ERROR&&(this.hlsAddonConfig={skipDiscontinuity:!0}),[s.ErrorDetails.LEVEL_LOAD_ERROR,s.ErrorDetails.LEVEL_LOAD_TIMEOUT,s.ErrorDetails.MANIFEST_LOAD_ERROR,s.ErrorDetails.MANIFEST_LOAD_TIMEOUT,s.ErrorDetails.FRAG_LOAD_ERROR,s.ErrorDetails.FRAG_LOAD_TIMEOUT].includes(e.details)&&this.fireEventListener(m.PLAY_ERROR,e),(e.fatal||this.stallStartTime&&6e4<performance.now()-this.stallStartTime&&e.details===s.ErrorDetails.FRAG_LOAD_ERROR)&&this.touchReInit(e)}},{key:"touchReInit",value:function(t){1<=this.retryPlayTimes?(this.pause(),this.destory(),this.fireEventListener(m.FORCE_PAUSED),this.playStatus=g.ERROR,this.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.ERROR,prevStatus:this.playStatus,data:t}),this.retryPlayTimes=0,this.stallStartTime=0):(this.retryPlayTimes+=1,this.playStatus!==g.START&&this.playStatus!==g.PLAYING||this.init())}},{key:"onHlsLevelSwitched",value:function(t,e){e=e.level,e=this.hls.levels[e];this.fireEventListener(m.AUTO_DEFINTION_SWITCHED,e)}},{key:"onHlsLevelLoaded",value:function(t,e){this.hls.config.skipDiscontinuity||(this.hls.config.skipDiscontinuity="cae"===e.details.defination&&W())}},{key:"onHlsManifestParsed",value:function(t,e){var s;e&&e.levels&&(e=(s=e.levels).length%2==0?s[Math.max(s.length/2,0)]:s[Math.floor(s.length/2)],e=s.indexOf(e),this.hls.startLevel=-1===e?s.length-1:e),this.hls.startLoad()}},{key:"onHlsStallRecover",value:function(){this.fireEventListener(m.PLAY_STALL_RECOVER)}},{key:"onHlsBufferEos",value:function(t){this.bufferEosData=t}},{key:"onNativePlay",value:function(){this.playStatus!==g.START&&this.playStatus!==g.PLAYING&&(this.playStatus=g.PLAYING,this.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.PLAYING,prevStatus:this.playStatus,data:{}}))}},{key:"onNativePause",value:function(){this.playStatus!==g.PAUSED&&null===this.bufferEosData&&(this.playStatus=g.PAUSED,this.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.PAUSED,prevStatus:this.playStatus,data:{}})),this.expectionHandler.stop()}},{key:"onNativeEnd",value:function(){null!==this.bufferEosData&&(this.playStatus=g.END,this.fireEventListener(m.PLAY_STATUS_CHANGE,{status:g.END,prevStatus:this.playStatus,data:this.bufferEosData}))}},{key:"tryPlay",value:function(){var i=this;return new Promise(function(t,e){i.videoDom||t();try{var s=i.videoDom.play();s&&s.then?s.then(function(){return t()}).catch(function(t){return"NotAllowedError"===t.name||"AbortError"===t.name&&W()?(i.setMuted(!0),i.fireEventListener(m.AUTO_PLAY_FORCE_MUTED),i.play()):void e(t)}):t()}catch(t){return i.setMuted(!0),i.fireEventListener(m.AUTO_PLAY_FORCE_MUTED),i.play()}})}},{key:"registerEvent",value:function(t,e){this.eventListeners=this.eventListeners.concat({event:t,callback:e})}},{key:"unregisterEvent",value:function(e){this.eventListeners=this.eventListeners.filter(function(t){return t.callback!==e})}},{key:"fireEventListener",value:function(e,s){this.eventListeners.filter(function(t){return t.event===e}).forEach(function(t){t.callback(s)})}},{key:"registerHlsEvent",value:function(t,e){this.hlsEventListeners=this.hlsEventListeners.concat({event:t,callback:e}),this.hls&&this.hls.on(t,e)}},{key:"unregisterHlsEvent",value:function(e){var t=this.hlsEventListeners.find(function(t){return t.callback===e});this.hls&&t&&this.hls.off(t.event,e),this.hlsEventListeners=this.hlsEventListeners.filter(function(t){return t.callback!==e})}},{key:"setMuted",value:function(t){this.videoDom&&(this.videoDom.muted=t)}},{key:"setVolume",value:function(t){this.videoDom&&(this.videoDom.volume=t)}},{key:"setPlaybackRate",value:function(t){this.videoDom&&(this.videoDom.playbackRate=t)}}]),e}()}}]);
//# sourceMappingURL=http://hw-source-map.mildom.jp/mildompc-web-server-sourcemap/static_sourcemap/anchor_live_page~embed_room~page_popout_chat~page_popout_gift~page_room~popout_chat_embed_page_8a9fe0a6f40176541e90.js.map