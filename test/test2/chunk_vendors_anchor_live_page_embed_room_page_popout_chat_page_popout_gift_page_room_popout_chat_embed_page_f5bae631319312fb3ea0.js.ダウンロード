(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"+qE3":function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,l=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(i,a){return new Promise(function(e,t){function r(){void 0!==n&&i.removeListener("error",n),e([].slice.call(arguments))}var n;"error"!==a&&(n=function(e){i.removeListener(a,r),t(e)},i.once("error",n)),i.once(a,r)})},(s.EventEmitter=s).prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function h(e,t,r,n){var i,a;return u(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener||r),i=e._events),a=i[t]),void 0===a?(a=i[t]=r,++e._eventsCount):("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),0<(r=d(e))&&a.length>r&&!a.warned&&(a.warned=!0,(r=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",r.emitter=e,r.type=t,r.count=a.length,r=r,console&&console.warn&&console.warn(r))),e}function c(e,t,r){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},t=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(e);return t.listener=r,e.wrapFn=t}function f(e,t,r){e=e._events;if(void 0===e)return[];t=e[t];return void 0===t?[]:"function"==typeof t?r?[t.listener||t]:[t]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):g(t,t.length)}function p(e){var t=this._events;if(void 0!==t){e=t[e];if("function"==typeof e)return 1;if(void 0!==e)return e.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return d(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n,i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){if(0<t.length&&(n=t[0]),n instanceof Error)throw n;i=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw i.context=n,i}e=a[e];if(void 0===e)return!1;if("function"==typeof e)l(e,this,t);else for(var s=e.length,o=g(e,s),r=0;r<s;++r)l(o[r],this,t);return!0},s.prototype.addListener=function(e,t){return h(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return h(this,e,t,!0)},s.prototype.once=function(e,t){return u(t),this.on(e,c(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,c(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,a,s;if(u(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;0<=a;a--)if(r[a]===t||r[a].listener===t){s=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r=this._events;if(void 0===r)return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),a=0;a<i.length;++a)"removeListener"!==(n=i[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(a=t.length-1;0<=a;a--)this.removeListener(e,t[a]);return this},s.prototype.listeners=function(e){return f(this,e,!0)},s.prototype.rawListeners=function(e){return f(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},s.prototype.listenerCount=p,s.prototype.eventNames=function(){return 0<this._eventsCount?n(this._events):[]}},"3BRs":function(k,e,x){"use strict";(function(e,h){function d(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var n;(k.exports=S).WritableState=T;var t={deprecate:x("t9FE")},r=x("QpuX"),c=x("tjlA").Buffer,f=e.Uint8Array||function(){};var i,a=x("RoFp"),s=x("DbZ5").getHighWaterMark,e=x("ybjB").codes,p=e.ERR_INVALID_ARG_TYPE,o=e.ERR_METHOD_NOT_IMPLEMENTED,l=e.ERR_MULTIPLE_CALLBACK,u=e.ERR_STREAM_CANNOT_PIPE,g=e.ERR_STREAM_DESTROYED,m=e.ERR_STREAM_NULL_VALUES,v=e.ERR_STREAM_WRITE_AFTER_END,y=e.ERR_UNKNOWN_ENCODING,b=a.errorOrDestroy;function E(){}function T(e,t,r){n=n||x("sZro"),e=e||{},"boolean"!=typeof r&&(r=t instanceof n),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=s(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;r=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if("function"!=typeof i)throw new l;(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0})(r),t?function(e,t,r,n,i){--t.pendingcb,r?(h.nextTick(i,n),h.nextTick(D,e,t),e._writableState.errorEmitted=!0,b(e,n)):(i(n),e._writableState.errorEmitted=!0,b(e,n),D(e,t))}(e,r,n,t,i):((t=A(r)||e.destroyed)||r.corked||r.bufferProcessing||!r.bufferedRequest||L(e,r),n?h.nextTick(w,e,r,t,i):w(e,r,t,i))}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new d(this)}function S(e){var t=this instanceof(n=n||x("sZro"));if(!t&&!i.call(S,this))return new S(e);this._writableState=new T(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),r.call(this)}function _(e,t,r,n,i,a,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new g("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function w(e,t,r,n){var i;r||(i=e,0===(r=t).length&&r.needDrain&&(r.needDrain=!1,i.emit("drain"))),t.pendingcb--,n(),D(e,t)}function L(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),n=t.corkedRequestsFree;n.entry=r;for(var a=0,s=!0;r;)(i[a]=r).isBuf||(s=!1),r=r.next,a+=1;i.allBuffers=s,_(e,t,!0,t.length,i,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new d(t),t.bufferedRequestCount=0}else{for(;r;){var o=r.chunk,l=r.encoding,u=r.callback;if(_(e,t,!1,t.objectMode?1:o.length,o,l,u),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function A(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function R(t,r){t._final(function(e){r.pendingcb--,e&&b(t,e),r.prefinished=!0,t.emit("prefinish"),D(t,r)})}function D(e,t){var r,n,i=A(t);return i&&(r=e,(n=t).prefinished||n.finalCalled||("function"!=typeof r._final||n.destroyed?(n.prefinished=!0,r.emit("prefinish")):(n.pendingcb++,n.finalCalled=!0,h.nextTick(R,r,n))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),!t.autoDestroy||(!(t=e._readableState)||t.autoDestroy&&t.endEmitted)&&e.destroy())),i}x("P7XM")(S,r),T.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(T.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(i=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(e){return!!i.call(this,e)||this===S&&(e&&e._writableState instanceof T)}})):i=function(e){return e instanceof this},S.prototype.pipe=function(){b(this,new u)},S.prototype.write=function(e,t,r){var n,i,a,s,o,l,u=this._writableState,d=!1,n=!u.objectMode&&(n=e,c.isBuffer(n)||n instanceof f);return n&&!c.isBuffer(e)&&(i=e,e=c.from(i)),"function"==typeof t&&(r=t,t=null),t=n?"buffer":t||u.defaultEncoding,"function"!=typeof r&&(r=E),u.ending?(s=this,o=r,l=new v,b(s,l),h.nextTick(o,l)):(n||(i=this,s=u,o=r,null===(l=e)?a=new m:"string"==typeof l||s.objectMode||(a=new p("chunk",["string","Buffer"],l)),a?(b(i,a),void h.nextTick(o,a)):1))&&(u.pendingcb++,d=function(e,t,r,n,i,a){r||(l=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=c.from(t,r));return t}(t,n,i),n!==l&&(r=!0,i="buffer",n=l));var s=t.objectMode?1:n.length;t.length+=s;var o=t.length<t.highWaterMark;o||(t.needDrain=!0);{var l;t.writing||t.corked?(l=t.lastBufferedRequest,t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1):_(e,t,!1,s,n,i,a)}return o}(this,u,n,e,t,r)),d},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||L(this,e))},S.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new y(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(e,t,r){r(new o("_write()"))},S.prototype._writev=null,S.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,t=e=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||(t=this,r=r,(n=n).ending=!0,D(t,n),r&&(n.finished?h.nextTick(r):t.once("finish",r)),n.ended=!0,t.writable=!1),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),S.prototype.destroy=a.destroy,S.prototype._undestroy=a.undestroy,S.prototype._destroy=function(e,t){t(e)}}).call(this,x("yLpj"),x("8oxB"))},"43KI":function(e,t,r){(((t=e.exports=r("rXFu")).Stream=t).Readable=t).Writable=r("3BRs"),t.Duplex=r("sZro"),t.Transform=r("J78i"),t.PassThrough=r("eA/Y"),t.finished=r("kDxh"),t.pipeline=r("XRzD")},"4GFC":function(t,e,r){(function(a,s){var e;e=function(){return i={},n.m=r=[function(e,t,r){"use strict";r.d(t,"a",function(){return u}),r.d(t,"b",function(){return d});var r=r(9),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(){}var a={trace:i,debug:i,log:i,warn:i,info:i,error:i},s=a;var o=Object(r.a)();function l(a){var s=o.console[a];return s?function(){for(var e,t,r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];n[0]&&(n[0]=(e=a,t=n[0],t=(new Date).toISOString()+" | ["+e+"] > "+t)),s.apply(o.console,n)}:i}var u=function(e){if(!0===e||"object"===(void 0===e?"undefined":n(e))){!function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];r.forEach(function(e){s[e]=t[e]?t[e].bind(t):l(e)})}(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=a}}else s=a},d=s},function(e,t,r){"use strict";t.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",STALL_RECOVER:"hlsStallRecover",LOW_LATENCY_WAIT_TIMEOUT:"hlsLowLatencyWaitTimeout",LOW_LATENCY_ABLE_TO_START:"hlsLowLatencyAbleToStart",BUFFER_TIME_ADJUSTED:"hlsBufferTimeAdjusted"}},function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"a",function(){return i});var n={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},i={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPEND_MEDIA_ERROR:"bufferAppendMediaError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(e,t){var r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t){e.exports=void 0},function(e,O,I){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var o=I(32),a=I(33),s=I(18);function r(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=h.prototype:(null===e&&(e=new h(t)),e.length=t),e}function h(e,t,r){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(e,t,r);if("number"!=typeof e)return n(this,e,t,r);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}function n(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);h.TYPED_ARRAY_SUPPORT?(e=t).__proto__=h.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!h.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|f(t,r),r=(e=i(e,n)).write(t,r);r!==n&&(e=e.slice(0,r));return e}(e,t,r):function(e,t){if(h.isBuffer(t)){var r=0|c(t.length);return 0===(e=i(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?i(e,0):d(e,t);if("Buffer"===t.type&&s(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(l(t),e=i(e,t<0?0:0|c(t)),!h.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|c(t.length);e=i(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function c(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function f(e,t){if(h.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return k(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return x(e).length;default:if(n)return k(e).length;t=(""+t).toLowerCase(),n=!0}}function t(e,t,r){var n,i,a,s=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0);(!r||r<0||n<r)&&(r=n);for(var i="",a=t;a<r;++a)i+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[a]);return i}(this,t,r);case"utf8":case"utf-8":return b(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return n=this,a=r,0===(i=t)&&a===n.length?o.fromByteArray(n):o.fromByteArray(n.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}(this,t,r);default:if(s)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=h.from(t,n)),h.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var a=1,s=e.length,o=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s/=a=2,o/=2,r/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i)for(var u=-1,d=r;d<s;d++)if(l(e,d)===l(t,-1===u?0:d-u)){if(-1===u&&(u=d),d-u+1===o)return u*a}else-1!==u&&(d-=d-u),u=-1;else for(s<r+o&&(r=s-o),d=r;0<=d;d--){for(var h=!0,c=0;c<o;c++)if(l(e,d+c)!==l(t,c)){h=!1;break}if(h)return d}return-1}function v(e,t,r,n){return P(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function y(e,t,r,n){return P(function(e,t){for(var r,n,i=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,n=n%256,i.push(n),i.push(r);return i}(t,e.length-r),e,r,n)}function b(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,s,o,l,u=e[i],d=null,h=239<u?4:223<u?3:191<u?2:1;if(i+h<=r)switch(h){case 1:u<128&&(d=u);break;case 2:128==(192&(a=e[i+1]))&&127<(l=(31&u)<<6|63&a)&&(d=l);break;case 3:a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&2047<(l=(15&u)<<12|(63&a)<<6|63&s)&&(l<55296||57343<l)&&(d=l);break;case 4:a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&65535<(l=(15&u)<<18|(63&a)<<12|(63&s)<<6|63&o)&&l<1114112&&(d=l)}null===d?(d=65533,h=1):65535<d&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|1023&d),n.push(d),i+=h}return function(e){var t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=E));return r}(n)}O.Buffer=h,O.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},O.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),O.kMaxLength=r(),h.poolSize=8192,h._augment=function(e){return e.__proto__=h.prototype,e},h.from=function(e,t,r){return n(null,e,t,r)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(e,t,r){return n=null,t=t,r=r,l(e=e),!(e<=0)&&void 0!==t?"string"==typeof r?i(n,e).fill(t,r):i(n,e).fill(t):i(n,e);var n},h.allocUnsafe=function(e){return u(null,e)},h.allocUnsafeSlow=function(e){return u(null,e)},h.isBuffer=function(e){return!(null==e||!e._isBuffer)},h.compare=function(e,t){if(!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;for(var r=h.allocUnsafe(t),n=0,i=0;i<e.length;++i){var a=e[i];if(!h.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,n),n+=a.length}return r},h.byteLength=f,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},h.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},h.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},h.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?b(this,0,e):t.apply(this,arguments)},h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){var e="",t=O.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},h.prototype.compare=function(e,t,r,n,i){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=t)return 0;if(i<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),o=Math.min(a,s),l=this.slice(n,i),u=e.slice(t,r),d=0;d<o;++d)if(l[d]!==u[d]){a=l[d],s=u[d];break}return a<s?-1:s<a?1:0},h.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},h.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},h.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},h.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||i<r)&&(r=i),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var a,s,o,l=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;if((!n||i<(n=Number(n)))&&(n=i),(i=t.length)%2!=0)throw new TypeError("Invalid hex string");i/2<n&&(n=i/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}(this,e,t,r);case"utf8":case"utf-8":return s=t,o=r,P(k(e,(a=this).length-s),a,s,o);case"ascii":return v(this,e,t,r);case"latin1":case"binary":return v(this,e,t,r);case"base64":return a=this,s=t,o=r,P(x(e),a,s,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y(this,e,t,r);default:if(l)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),l=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function T(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function S(e,t,r,n,i,a){if(!h.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function _(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function w(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function L(e,t,r,n){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function A(e,t,r,n,i){return i||L(e,0,r,4),a.write(e,t,r,n,23,4),r+4}function R(e,t,r,n,i){return i||L(e,0,r,8),a.write(e,t,r,n,52,8),r+8}h.prototype.slice=function(e,t){var r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),h.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=h.prototype;else for(var n=t-e,i=new h(n,void 0),a=0;a<n;++a)i[a]=this[a+e];return i},h.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||T(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},h.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||T(e,t,this.length);for(var n=this[e+--t],i=1;0<t&&(i*=256);)n+=this[e+--t]*i;return n},h.prototype.readUInt8=function(e,t){return t||T(e,1,this.length),this[e]},h.prototype.readUInt16LE=function(e,t){return t||T(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUInt16BE=function(e,t){return t||T(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUInt32LE=function(e,t){return t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUInt32BE=function(e,t){return t||T(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||T(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*t)),n},h.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||T(e,t,this.length);for(var n=t,i=1,a=this[e+--n];0<n&&(i*=256);)a+=this[e+--n]*i;return(i*=128)<=a&&(a-=Math.pow(2,8*t)),a},h.prototype.readInt8=function(e,t){return t||T(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){t||T(e,2,this.length);e=this[e]|this[e+1]<<8;return 32768&e?4294901760|e:e},h.prototype.readInt16BE=function(e,t){t||T(e,2,this.length);e=this[e+1]|this[e]<<8;return 32768&e?4294901760|e:e},h.prototype.readInt32LE=function(e,t){return t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readFloatLE=function(e,t){return t||T(e,4,this.length),a.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return t||T(e,4,this.length),a.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return t||T(e,8,this.length),a.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return t||T(e,8,this.length),a.read(this,e,!1,52,8)},h.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||S(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},h.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||S(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;0<=--i&&(a*=256);)this[t+i]=e/a&255;return t+r},h.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,1,255,0),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},h.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):_(this,e,t,!0),t+2},h.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):_(this,e,t,!1),t+2},h.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):w(this,e,t,!0),t+4},h.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):w(this,e,t,!1),t+4},h.prototype.writeIntLE=function(e,t,r,n){e=+e,t|=0,n||S(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=0,a=1,s=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},h.prototype.writeIntBE=function(e,t,r,n){e=+e,t|=0,n||S(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=r-1,a=1,s=0;for(this[t+i]=255&e;0<=--i&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},h.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,1,127,-128),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):_(this,e,t,!0),t+2},h.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):_(this,e,t,!1),t+2},h.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):w(this,e,t,!0),t+4},h.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||S(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):w(this,e,t,!1),t+4},h.prototype.writeFloatLE=function(e,t,r){return A(this,e,t,!0,r)},h.prototype.writeFloatBE=function(e,t,r){return A(this,e,t,!1,r)},h.prototype.writeDoubleLE=function(e,t,r){return R(this,e,t,!0,r)},h.prototype.writeDoubleBE=function(e,t,r){return R(this,e,t,!1,r)},h.prototype.copy=function(e,t,r,n){if(r=r||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),t=t||0,0<n&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;0<=i;--i)e[i+t]=this[i+r];else if(a<1e3||!h.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},h.prototype.fill=function(e,t,r,n){if("string"==typeof e){var i;if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1!==e.length||(i=e.charCodeAt(0))<256&&(e=i),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!h.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(o=t;o<r;++o)this[o]=e;else for(var a=h.isBuffer(e)?e:k(new h(e,n).toString()),s=a.length,o=0;o<r-t;++o)this[o+t]=a[o%s];return this};var D=/[^+\/0-9A-Za-z-_]/g;function k(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],s=0;s<n;++s){if(55295<(r=e.charCodeAt(s))&&r<57344){if(!i){if(56319<r){-1<(t-=3)&&a.push(239,191,189);continue}if(s+1===n){-1<(t-=3)&&a.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(t-=3)&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(t-=3)&&a.push(239,191,189);if(i=null,r<128){if(--t<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function x(e){return o.toByteArray(function(e){var t;if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function P(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(O,I(3))},function(e,t){var r,n,e=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var o,l=[],u=!1,d=-1;function h(){u&&o&&(u=!1,o.length?l=o.concat(l):d=-1,l.length&&c())}function c(){if(!u){var e=s(h);u=!0;for(var t=l.length;t;){for(o=l,l=[];++d<t;)o&&o[d].run();d=-1,t=l.length}o=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||u||s(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=p,e.addListener=p,e.once=p,e.off=p,e.removeListener=p,e.removeAllListeners=p,e.emit=p,e.prependListener=p,e.prependOnceListener=p,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,r){"use strict";var n=r(13),i=Object.keys||function(e){var t,r=[];for(t in e)r.push(t);return r};e.exports=d;e=r(11);e.inherits=r(4);var a=r(21),s=r(24);e.inherits(d,a);for(var o=i(s.prototype),l=0;l<o.length;l++){var u=o[l];d.prototype[u]||(d.prototype[u]=s.prototype[u])}function d(e){if(!(this instanceof d))return new d(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n(c,this)}function c(e){e.end()}Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n(t,e)}},function(e,t,r){"use strict";t.a=function(){return"undefined"==typeof window?self:window}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}function d(e){return void 0===e}((e.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,i,a,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var o=new Error('Uncaught, unspecified "error" event. ('+t+")");throw o.context=t,o}if(d(r=this._events[e]))return!1;if(l(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),r.apply(this,i)}else if(u(r))for(i=Array.prototype.slice.call(arguments,1),n=(s=r.slice()).length,a=0;a<n;a++)s[a].apply(this,i);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var r;if(!l(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,l(t.listener)?t.listener:t),this._events[e]?u(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,u(this._events[e])&&!this._events[e].warned&&(r=d(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){if(!l(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var r,n,i,a;if(!l(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(r=this._events[e]).length,n=-1,r===t||l(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(u(r)){for(a=i;0<a--;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(l(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){e=this._events&&this._events[e]?l(this._events[e])?[this._events[e]]:this._events[e].slice():[];return e},n.prototype.listenerCount=function(e){if(this._events){e=this._events[e];if(l(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,r,t){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(r,t(6).Buffer)},function(e,t,r){var n,s,i,a,o;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,s=/^([^\/;?#]*)(.*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=this.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}n=this.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return r.alwaysNormalize?(n.path=o.normalizePath(n.path),o.buildURLFromParts(n)):t;var i=this.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");!i.netLoc&&i.path&&"/"!==i.path[0]&&(a=s.exec(i.path),i.netLoc=a[1],i.path=a[2]),i.netLoc&&!i.path&&(i.path="/");var a,e={scheme:i.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};return n.netLoc||(e.netLoc=i.netLoc,"/"!==n.path[0]&&(n.path?(a=(a=i.path).substring(0,a.lastIndexOf("/")+1)+n.path,e.path=o.normalizePath(a)):(e.path=i.path,n.params||(e.params=i.params,n.query||(e.query=i.query))))),null===e.path&&(e.path=r.alwaysNormalize?o.normalizePath(n.path):n.path),o.buildURLFromParts(e)},parseURL:function(e){e=n.exec(e);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},function(e,t,r){"use strict";(function(o){!o.version||0===o.version.indexOf("v0.")||0===o.version.indexOf("v1.")&&0!==o.version.indexOf("v1.8.")?e.exports=function(e,t,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var i,a,s=arguments.length;switch(s){case 0:case 1:return o.nextTick(e);case 2:return o.nextTick(function(){e.call(null,t)});case 3:return o.nextTick(function(){e.call(null,t,r)});case 4:return o.nextTick(function(){e.call(null,t,r,n)});default:for(i=new Array(s-1),a=0;a<i.length;)i[a++]=arguments[a];return o.nextTick(function(){e.apply(null,i)})}}:e.exports=o.nextTick}).call(t,r(7))},function(e,t,r){"use strict";var n=(o.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},o.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},o.getID3Data=function(e,t){for(var r=t,n=0;o.isHeader(e,t);)n+=10,n+=o._readSize(e,t+6),o.isFooter(e,t+10)&&(n+=10),t+=n;if(0<n)return e.subarray(r,r+n)},o._readSize=function(e,t){var r=(127&e[t])<<21;return r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3]},o.getTimeStamp=function(e){for(var t=o.getID3Frames(e),r=0;r<t.length;r++){var n=t[r];if(o.isTimeStampFrame(n))return o._readTimeStamp(n)}},o.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},o._getFrameData=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=o._readSize(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},o.getID3Frames=function(e){for(var t=0,r=[];o.isHeader(e,t);){for(var n=o._readSize(e,t+6),i=(t+=10)+n;t+8<i;){var a=o._getFrameData(e.subarray(t)),s=o._decodeFrame(a);s&&r.push(s),t+=a.size+10}o.isFooter(e,t)&&(t+=10)}return r},o._decodeFrame=function(e){return"PRIV"===e.type?o._decodePrivFrame(e):"T"===e.type[0]?o._decodeTextFrame(e):"W"===e.type[0]?o._decodeURLFrame(e):void 0},o._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),e=1&t[3],t=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return t/=45,e&&(t+=47721858.84),Math.round(t)}},o._decodePrivFrame=function(e){if(!(e.size<2)){var t=o._utf8ArrayToStr(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},o._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=o._utf8ArrayToStr(e.data.subarray(1));t+=r.length+1;t=o._utf8ArrayToStr(e.data.subarray(t));return{key:e.type,info:r,data:t}}t=o._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:t}}},o._decodeURLFrame=function(e){if("WXXX"!==e.type){var t=o._utf8ArrayToStr(e.data);return{key:e.type,data:t}}if(!(e.size<2)){var r=1,t=o._utf8ArrayToStr(e.data.subarray(1));r+=t.length+1;r=o._utf8ArrayToStr(e.data.subarray(r));return{key:e.type,info:t,data:r}}},o._utf8ArrayToStr=function(e){for(var t,r,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=e.length,a=void 0,s="",o=0;o<i;){if(0===(t=e[o++])&&n)return s;if(0!==t&&3!==t)switch(t>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(t);break;case 12:case 13:a=e[o++],s+=String.fromCharCode((31&t)<<6|63&a);break;case 14:a=e[o++],r=e[o++],s+=String.fromCharCode((15&t)<<12|(63&a)<<6|(63&r)<<0)}}return s},o);function o(){!function(e){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this)}t.a=n},function(e,t,r){var n=r(6),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=s),a(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");e=i(e);return void 0!==t?"string"==typeof r?e.fill(t,r):e.fill(t):e.fill(0),e},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,r){"use strict";var a=r(0),l=r(1);var s=Math.pow(2,32)-1,r=(c.prototype.resetTimeStamp=function(e){this.initPTS=e},c.prototype.resetInitSegment=function(e,t,r,n){var i,a;e&&e.byteLength?(null==t&&(t="mp4a.40.5"),null==r&&(r="avc1.42e01e"),a={},(i=this.initData=c.parseInitSegment(e)).audio&&i.video?a.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:n?e:null}:(i.audio&&(a.audio={container:"audio/mp4",codec:t,initSegment:n?e:null}),i.video&&(a.video={container:"video/mp4",codec:r,initSegment:n?e:null})),this.observer.trigger(l.a.FRAG_PARSING_INIT_SEGMENT,{tracks:a})):(t&&(this.audioCodec=t),r&&(this.videoCodec=r))},c.probe=function(e){return 0<c.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length},c.bin2str=function(e){return String.fromCharCode.apply(null,e)},c.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);t=e[t]<<8|e[t+1];return t<0?65536+t:t},c.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);t=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return t<0?4294967296+t:t},c.writeUint32=function(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},c.findBox=function(e,t){var r,n,i,a=[],s=void 0,o=void 0,l=void 0;if(e.data?(l=e.start,o=e.end,e=e.data):(l=0,o=e.byteLength),!t.length)return null;for(s=l;s<o;)i=1<(r=c.readUint32(e,s))?s+r:o,c.bin2str(e.subarray(s+4,s+8))===t[0]&&(1===t.length?a.push({data:e,start:s+8,end:i}):(n=c.findBox({data:e,start:s+8,end:i},t.slice(1))).length&&(a=a.concat(n))),s=i;return a},c.parseSegmentIndex=function(e){var t=c.findBox(e,["moov"])[0],t=t?t.end:null,r=0,n=c.findBox(e,["sidx"]),i=void 0;if(!n||!n[0])return null;i=[];var e=(n=n[0]).data[0],a=c.readUint32(n,r=0===e?8:16);r+=4;r+=0===e?8:16,r+=2;var s=n.end+0,o=c.readUint16(n,r);r+=2;for(var l=0;l<o;l++){var u=r,d=c.readUint32(n,u);u+=4;var h=2147483647&d;if(1==(2147483648&d)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");d=c.readUint32(n,u);u+=4,i.push({referenceSize:h,subsegmentDuration:d,info:{duration:d/a,start:s,end:s+h-1}}),s+=h,r=u+=4}return{earliestPresentationTime:0,timescale:a,version:e,referencesCount:o,references:i,moovEndOffset:t}},c.parseInitSegment=function(e){var i=[];return c.findBox(e,["moov","trak"]).forEach(function(e){var t,r,n=c.findBox(e,["tkhd"])[0];n&&(r=n.data[n.start],t=c.readUint32(n,0===r?12:20),(n=c.findBox(e,["mdia","mdhd"])[0])&&(r=n.data[n.start],n=c.readUint32(n,0===r?12:20),!(r=c.findBox(e,["mdia","hdlr"])[0])||(r={soun:"audio",vide:"video"}[c.bin2str(r.data.subarray(r.start+8,r.start+12))])&&((e=c.findBox(e,["mdia","minf","stbl","stsd"])).length&&(e=e[0],e=c.bin2str(e.data.subarray(e.start+12,e.start+16)),a.b.log("MP4Demuxer:"+r+":"+e+" found")),i[t]={timescale:n,type:r},i[r]={timescale:n,id:t})))}),i},c.getStartDTS=function(i,e){var t=void 0,t=c.findBox(e,["moof","traf"]),r=[].concat.apply([],t.map(function(n){return c.findBox(n,["tfhd"]).map(function(e){var t=c.readUint32(e,4),r=i[t].timescale||9e4;return c.findBox(n,["tfdt"]).map(function(e){var t=void 0,r=e.data[e.start],t=c.readUint32(e,4);return 1===r&&(t*=Math.pow(2,32),t+=c.readUint32(e,8)),t})[0]/r})})),n=Math.min.apply(null,r);return isFinite(n)?n:0},c.offsetStartDTS=function(r,e,i){c.findBox(e,["moof","traf"]).map(function(t){return c.findBox(t,["tfhd"]).map(function(e){var e=c.readUint32(e,4),n=r[e].timescale||9e4;c.findBox(t,["tfdt"]).map(function(e){var t=e.data[e.start],r=c.readUint32(e,4);0===t?c.writeUint32(e,4,r-i*n):(r*=Math.pow(2,32),r+=c.readUint32(e,8),r-=i*n,r=Math.max(r,0),t=Math.floor(r/(1+s)),r=Math.floor(r%(1+s)),c.writeUint32(e,4,t),c.writeUint32(e,8,r))})})})},c.prototype.append=function(e,t,r,n){var i=this.initData;i||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),i=this.initData);var a,s,o=this.initPTS;void 0===o&&(s=c.getStartDTS(i,e),this.initPTS=o=s-t,this.observer.trigger(l.a.INIT_PTS_FOUND,{initPTS:o})),c.offsetStartDTS(i,e,o),a=c.getStartDTS(i,e),this.remuxer.remux(i.audio,i.video,null,null,a,r,n,e)},c.prototype.destroy=function(){},c);function c(e,t){!function(e){if(!(e instanceof c))throw new TypeError("Cannot call a class as a function")}(this),this.observer=e,this.remuxer=t}t.a=r},function(e,t,r){"use strict";var Y=r(1),z=r(2);function n(e,t){!function(e){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this),this.subtle=e,this.aesIV=t}var o=(n.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},n);function i(e,t){!function(e){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this),this.subtle=e,this.key=t}var l=(i.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},i);function a(){!function(e){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(this),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var u=(a.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),n=0;n<4;n++)r[n]=t.getUint32(4*n);return r},a.prototype.initTable=function(){for(var e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],s=r[3],r=this.invSubMix,o=r[0],l=r[1],u=r[2],d=r[3],h=new Uint32Array(256),c=0,f=0,p=0,p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var g=(g=f^f<<1^f<<2^f<<3^f<<4)>>>8^255&g^99,m=h[t[e[c]=g]=c],v=h[m],y=h[v],b=257*h[g]^16843008*g;n[c]=b<<24|b>>>8,i[c]=b<<16|b>>>16,a[c]=b<<8|b>>>24,s[c]=b,b=16843009*y^65537*v^257*m^16843008*c,o[g]=b<<24|b>>>8,l[g]=b<<16|b>>>16,u[g]=b<<8|b>>>24,d[g]=b,c?(c=m^h[h[h[y^m]]],f^=h[h[f]]):c=f=1}},a.prototype.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<t.length&&r;)r=t[n]===this.key[n],n++;if(!r){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);for(var a=this.ksRows=4*(i+6+1),s=void 0,o=void 0,l=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),d=this.sBox,h=this.rcon,e=this.invSubMix,c=e[0],f=e[1],p=e[2],g=e[3],m=void 0,v=void 0,s=0;s<a;s++)s<i?m=l[s]=t[s]:(v=m,s%i==0?(v=d[(v=v<<8|v>>>24)>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[255&v],v^=h[s/i|0]<<24):6<i&&s%i==4&&(v=d[v>>>24]<<24|d[v>>>16&255]<<16|d[v>>>8&255]<<8|d[255&v]),l[s]=m=(l[s-i]^v)>>>0);for(o=0;o<a;o++)s=a-o,v=3&o?l[s]:l[s-4],u[o]=o<4||s<=4?v:c[d[v>>>24]]^f[d[v>>>16&255]]^p[d[v>>>8&255]]^g[d[255&v]],u[o]=u[o]>>>0}},a.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},a.prototype.decrypt=function(e,t,r,n){for(var i,a,s,o,l=this.keySize+6,u=this.invKeySchedule,d=this.invSBox,h=this.invSubMix,c=h[0],f=h[1],p=h[2],g=h[3],r=this.uint8ArrayToUint32Array_(r),m=r[0],v=r[1],y=r[2],b=r[3],E=new Int32Array(e),T=new Int32Array(E.length),S=void 0,_=void 0,w=void 0,L=void 0,A=void 0,R=void 0,D=void 0,k=void 0,x=void 0,P=void 0,O=this.networkToHostOrderSwap;t<E.length;){for(i=O(E[t]),a=O(E[t+1]),s=O(E[t+2]),o=O(E[t+3]),A=i^u[0],R=o^u[1],D=s^u[2],k=a^u[3],x=4,P=1;P<l;P++)S=c[A>>>24]^f[R>>16&255]^p[D>>8&255]^g[255&k]^u[x],_=c[R>>>24]^f[D>>16&255]^p[k>>8&255]^g[255&A]^u[x+1],w=c[D>>>24]^f[k>>16&255]^p[A>>8&255]^g[255&R]^u[x+2],L=c[k>>>24]^f[A>>16&255]^p[R>>8&255]^g[255&D]^u[x+3],A=S,R=_,D=w,k=L,x+=4;S=d[A>>>24]<<24^d[R>>16&255]<<16^d[D>>8&255]<<8^d[255&k]^u[x],_=d[R>>>24]<<24^d[D>>16&255]<<16^d[k>>8&255]<<8^d[255&A]^u[x+1],w=d[D>>>24]<<24^d[k>>16&255]<<16^d[A>>8&255]<<8^d[255&R]^u[x+2],L=d[k>>>24]<<24^d[A>>16&255]<<16^d[R>>8&255]<<8^d[255&D]^u[x+3],x+=3,T[t]=O(S^m),T[t+1]=O(L^v),T[t+2]=O(w^y),T[t+3]=O(_^b),m=i,v=a,y=s,b=o,t+=4}return n?(r=T.buffer,e=r.byteLength,(n=e&&new DataView(r).getUint8(e-1))?r.slice(0,e-n):r):T.buffer},a.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},a),X=r(0),s=r(9);var d=Object(s.a)();function h(e,t){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).removePKCS7Padding,r=void 0===r||r;if(!function(e){if(!(e instanceof h))throw new TypeError("Cannot call a class as a function")}(this),this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=r)try{var n=d.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var m=(h.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},h.prototype.decrypt=function(t,r,n,i){var e,a,s=this;this.disableWebCrypto&&this.config.enableSoftwareAES?(this.logEnabled&&(X.b.log("JS AES decrypt"),this.logEnabled=!1),(e=this.decryptor)||(this.decryptor=e=new u),e.expandKey(r),i(e.decrypt(t,0,n,this.removePKCS7Padding))):(this.logEnabled&&(X.b.log("WebCrypto AES decrypt"),this.logEnabled=!1),a=this.subtle,this.key!==r&&(this.key=r,this.fastAesKey=new l(a,r)),this.fastAesKey.expandKey().then(function(e){new o(a,n).decrypt(t,e).catch(function(e){s.onWebCryptoError(e,t,r,n,i)}).then(function(e){i(e)})}).catch(function(e){s.onWebCryptoError(e,t,r,n,i)}))},h.prototype.onWebCryptoError=function(e,t,r,n,i){this.config.enableSoftwareAES?(X.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,n,i)):(X.b.error("decrypting error : "+e.message),this.observer.trigger(Y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},h.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},h);function c(e,t){return 255===e[t]&&240==(246&e[t+1])}function f(e,t){return 1&e[t+1]?7:9}function p(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function g(e,t){return!!(t+1<e.length&&c(e,t))}function v(e,t,r,n,i){e.samplerate||(i=function(e,t,r,n){var i,a=void 0,s=void 0,o=void 0,l=navigator.userAgent.toLowerCase(),u=n,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=1+((192&t[r+2])>>>6),h=(60&t[r+2])>>>2;if(!(d.length-1<h))return i=(1&t[r+2])<<2,i|=(192&t[r+3])>>>6,X.b.log("manifest codec:"+n+",ADTS data:type:"+a+",sampleingIndex:"+h+"["+d[h]+"Hz],channelConfig:"+i),s=/firefox/i.test(l)?6<=h?(a=5,o=new Array(4),h-3):(a=2,o=new Array(2),h):-1!==l.indexOf("android")?(a=2,o=new Array(2),h):(a=5,o=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&6<=h?h-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(6<=h&&1==i||/vivaldi/i.test(l))||!n&&1==i)&&(a=2,o=new Array(2)),h)),o[0]=a<<3,o[0]|=(14&h)>>1,o[1]|=(1&h)<<7,o[1]|=i<<3,5===a&&(o[1]|=(14&s)>>1,o[2]=(1&s)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:d[h],channelCount:i,codec:"mp4a.40."+a,manifestCodec:u};e.trigger(Y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h})}(t,r,n,i),e.config=i.config,e.samplerate=i.samplerate,e.channelCount=i.channelCount,e.codec=i.codec,e.manifestCodec=i.manifestCodec,X.b.log("parsed codec:"+e.codec+",rate:"+i.samplerate+",nb channel:"+i.channelCount))}function y(e){return 9216e4/e}function b(e,t,r,n,i){var a=function(e,t,r,n,i){var a=e.length,s=f(e,t),e=p(e,t);if(0<(e-=s)&&t+s+e<=a)return{headerLength:s,frameLength:e,stamp:r+n*i}}(t,r,n,i,y(e.samplerate));if(a){n=a.stamp,i=a.headerLength,a=a.frameLength,n={unit:t.subarray(r+i,r+i+a),pts:n,dts:n};return e.samples.push(n),e.len+=a,{sample:n,length:a+i}}}var E=r(14);function T(e,t,r){!function(e){if(!(e instanceof T))throw new TypeError("Cannot call a class as a function")}(this),this.observer=e,this.config=r,this.remuxer=t}var w=(T.prototype.resetInitSegment=function(e,t,r,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},T.prototype.resetTimeStamp=function(){},T.probe=function(e){if(!e)return!1;for(var t=(E.a.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(function(e,t){if(t+1<e.length&&c(e,t)){var r=f(e,t);t+5<e.length&&(r=p(e,t));r=t+r;if(r===e.length||r+1<e.length&&c(e,r))return 1}}(e,t))return X.b.log("ADTS sync word found !"),!0;return!1},T.prototype.append=function(e,t,r,n){for(var i=this._audioTrack,a=E.a.getID3Data(e,0)||[],s=E.a.getTimeStamp(a),o=s?90*s:9e4*t,l=0,u=o,d=e.length,h=a.length,c=[{pts:u,dts:u,data:a}];h<d-1;)if(g(e,h)&&h+5<d){v(i,this.observer,e,h,i.manifestCodec);var f=b(i,e,h,o,l);if(!f){X.b.log("Unable to parse AAC frame");break}h+=f.length,u=f.sample.pts,l++}else E.a.isHeader(e,h)?(a=E.a.getID3Data(e,h),c.push({pts:u,dts:u,data:a}),h+=a.length):h++;this.remuxer.remux(i,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,r,n)},T.prototype.destroy=function(){},T),L=r(16),S={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,n,i){if(!(r+24>t.length)){var a=this.parseHeader(t,r);if(a&&r+a.frameLength<=t.length){i=n+i*(9e4*a.samplesPerFrame/a.sampleRate),i={unit:t.subarray(r,r+a.frameLength),pts:i,dts:i};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(i),e.len+=a.frameLength,{sample:i,length:a.frameLength}}}},parseHeader:function(e,t){var r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!=r&&0!=i&&15!=i&&3!=a){var o=3==r?3-n:3==n?3:4,o=1e3*S.BitratesMap[14*o+i-1],i=3==r?0:2==r?1:2,a=S.SamplingRateMap[3*i+a],e=e[t+3]>>6==3?1:2,t=S.SamplesCoefficients[r][n],r=S.BytesInSlot[n],n=8*t*r;return{sampleRate:a,channelCount:e,frameLength:parseInt(t*o/a+s,10)*r,samplesPerFrame:n}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var r=this.parseHeader(e,t),n=4;r&&r.frameLength&&(n=r.frameLength);n=t+n;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}},_=S;function A(e){!function(e){if(!(e instanceof A))throw new TypeError("Cannot call a class as a function")}(this),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var R=(A.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),t=Math.min(4,t);if(0===t)throw new Error("no bytes available");n.set(e.subarray(r,r+t)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t},A.prototype.skipBits=function(e){var t;this.bitsAvailable>e||(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e},A.prototype.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return 32<e&&X.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?r<<t|this.readBits(t):r},A.prototype.skipLZ=function(){for(var e=void 0,e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},A.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},A.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},A.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},A.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},A.prototype.readBoolean=function(){return 1===this.readBits(1)},A.prototype.readUByte=function(){return this.readBits(8)},A.prototype.readUShort=function(){return this.readBits(16)},A.prototype.readUInt=function(){return this.readBits(32)},A.prototype.skipScalingList=function(e){for(var t=8,r=8,n=void 0,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r},A.prototype.readSPS=function(){var e,t,r,n,i,a,s=0,o=0,l=0,u=0,d=void 0,h=this.readUByte.bind(this),c=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),g=this.skipBits.bind(this),m=this.skipEG.bind(this),v=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(h(),e=h(),c(5),g(3),h(),v(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var b=f();if(3===b&&g(1),v(),v(),g(1),p())for(a=3!==b?8:12,d=0;d<a;d++)p()&&y(d<6?16:64)}v();b=f();if(0===b)f();else if(1===b)for(g(1),m(),m(),t=f(),d=0;d<t;d++)m();v(),g(1),r=f(),n=f(),0===(i=c(1))&&g(1),g(1),p()&&(s=f(),o=f(),l=f(),u=f());var E=[1,1];if(p()&&p())switch(h()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(r+1)-2*s-2*o),height:(2-i)*(n+1)*16-(i?2:4)*(l+u),pixelRatio:E}},A.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},A);function D(e,t,r,n){!function(e){if(!(e instanceof D))throw new TypeError("Cannot call a class as a function")}(this),this.decryptdata=r,this.discardEPB=n,this.decrypter=new m(e,t,{removePKCS7Padding:!1})}var k=(D.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},D.prototype.decryptAacSample=function(t,r,n,i){var a=t[r].unit,e=a.subarray(16,a.length-a.length%16),e=e.buffer.slice(e.byteOffset,e.byteOffset+e.length),s=this;this.decryptBuffer(e,function(e){e=new Uint8Array(e),a.set(e,16),i||s.decryptAacSamples(t,r+1,n)})},D.prototype.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,n),!n)return}}},D.prototype.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),n=0,i=32;i<=e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r},D.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var r=0,n=32;n<=e.length-16;n+=160,r+=16)e.set(t.subarray(r,r+16),n);return e},D.prototype.decryptAvcSample=function(t,r,n,i,a,s){var o=this.discardEPB(a.data),e=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(e.buffer,function(e){a.data=l.getAvcDecryptedUnit(o,e),s||l.decryptAvcSamples(t,r,n+1,i)})},D.prototype.decryptAvcSamples=function(e,t,r,n){for(;;t++,r=0){if(t>=e.length)return void n();for(var i=e[t].units;!(r>=i.length);r++){var a=i[r];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,n,a,s),!s)return}}}},D);var x={video:1,audio:2,id3:3,text:4};function N(e,t,r,n,i){!function(e){if(!(e instanceof N))throw new TypeError("Cannot call a class as a function")}(this),this.observer=e,this.config=r,this.typeSupported=n,this.remuxer=t,this.sampleAes=null;t=navigator.userAgent;this.isSafari=i&&-1<i.indexOf("Apple")&&t&&!t.match("CriOS")}var P=(N.prototype.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new k(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},N.probe=function(e){e=N._syncOffset(e);return!(e<0)&&(e&&X.b.warn("MPEG2-TS detected but first sync word found @ offset "+e+", junk ahead ?"),!0)},N._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},N.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:x[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},N.prototype.resetInitSegment=function(e,t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=N.createTrack("video",n),this._audioTrack=N.createTrack("audio",n),this._id3Track=N.createTrack("id3",n),this._txtTrack=N.createTrack("text",n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=r,this._duration=n,this.data=[],this.len=0,this.contiguous=!0},N.prototype.resetTimeStamp=function(){},N.prototype.append=function(e,t,r,n,i){this.timeOffset=t,this.contiguous&&(this.contiguous=r),this.accurateTimeOffset=n,this.lowLatency=i,0===this.len&&564<e.length?(n=N._syncOffset(e),this.data.push({start:n,data:e})):this.data.push({start:0,data:e}),this.len+=e.length;var a,s,o=this.len,l=void 0,u=void 0,d=!1,h=this.pmtParsed,c=this._avcTrack,f=this._audioTrack,p=this._id3Track,g=c.pid,m=f.pid,v=p.pid,y=this._pmtId,b=c.pesData,E=f.pesData,T=p.pesData,S=this._parsePAT,_=this._parsePMT,w=this._parsePES,L=this._parseAVCPES.bind(this),A=this._parseAACPES.bind(this),R=this._parseMPEGPES.bind(this),D=this._parseID3PES.bind(this);if(!(o<188)){for(var k,x,P,O,e=this.data.shift(),I=e.data,C=e.start,F=0,F=0;F+188<=o;F+=188,C+=188)if(C+188>I.length&&(C<I.length?(O=188-(k=I.length-C),x=this.data[0],P=Math.min(x.data.length,O),(O=new Uint8Array(k+P)).set(I.subarray(C)),x&&(O.set(x.data.subarray(0,P),k),188===O.length?x.start=P:this.data.shift(),I=O,C=0)):(I=this.data.shift())&&(C=I.start,I=I.data)),C+188>I.length)F-=188,C-=188;else if(71===I[C]){if(a=!!(64&I[C+1]),s=((31&I[C+1])<<8)+I[C+2],1<(48&I[C+3])>>4){if((l=C+5+I[C+4])===C+188)continue}else l=C+4;switch(s){case g:a&&(b&&(u=w(b))&&void 0!==u.pts&&L(u,!1),b={data:[],size:0}),b&&(b.data.push(I.subarray(l,C+188)),b.size+=C+188-l);break;case m:a&&(E&&(u=w(E))&&void 0!==u.pts&&(f.isAAC?A:R)(u),E={data:[],size:0}),E&&(E.data.push(I.subarray(l,C+188)),E.size+=C+188-l);break;case v:a&&(T&&(u=w(T))&&D(u),T={data:[],size:0}),T&&(T.data.push(I.subarray(l,C+188)),T.size+=C+188-l);break;case 0:a&&(l+=I[l]+1),y=this._pmtId=S(I,l);break;case y:a&&(l+=I[l]+1);var M=_(I,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(g=M.avc)&&(c.pid=g),0<(m=M.audio)&&(f.pid=m,f.isAAC=M.isAAC),0<(v=M.id3)&&(p.pid=v),d&&!h&&(X.b.log("reparse from beginning"),d=!1,C=C%188-188,F=-188),h=this.pmtParsed=!0;break;case 17:case 8191:break;default:d=!0}}else this.observer.trigger(Y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!0,reason:"TS packet did not start with 0x47 @ offset "+F});e=this.len=o-F;e&&0===this.data.length&&this.data.push({start:I.length-e,data:I}),c.pesData=b,f.pesData=E,p.pesData=T,i&&!this.isSafari&&this.remux()}},N.prototype.remux=function(){var e=this._avcTrack,t=this._audioTrack,r=this._id3Track;1<e.samples.length&&0<t.samples.length&&(null==this.sampleAes?this.remuxer.remux(t,e,r,this._txtTrack,this.timeOffset,this.contiguous,this.accurateTimeOffset,this.lowLatency):this.decryptAndRemux(t,e,r,this._txtTrack,this.timeOffset,this.contiguous,this.accurateTimeOffset,this.lowLatency),this.contiguous=!0)},N.prototype.notifycomplete=function(){var e=this._avcTrack,t=this._audioTrack,r=this._id3Track,n=e.pesData,i=t.pesData,a=r.pesData,s=this._parsePES,o=this._parseAVCPES.bind(this),l=this._parseAACPES.bind(this),u=this._parseMPEGPES.bind(this),d=this._parseID3PES.bind(this),h=void 0;n&&(h=s(n))&&void 0!==h.pts?(o(h,!0),e.pesData=null):e.pesData=n,i&&(h=s(i))&&void 0!==h.pts?((t.isAAC?l:u)(h),t.pesData=null):(i&&i.size&&X.b.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=i),a&&(h=s(a))&&void 0!==h.pts?(d(h),r.pesData=null):r.pesData=a,(0<e.samples.length||0<t.samples.length)&&(null==this.sampleAes?this.remuxer.remux(t,e,r,this._txtTrack,this.timeOffset,this.contiguous,this.accurateTimeOffset,this.lowLatency):this.decryptAndRemux(t,e,r,this._txtTrack,this.timeOffset,this.contiguous,this.accurateTimeOffset,this.lowLatency)),this.observer.trigger(Y.a.FRAG_PARSED),this.data=[],this.len=0,this.contiguous=!0},N.prototype.decryptAndRemux=function(e,t,r,n,i,a,s,o){var l;e.samples&&e.isAAC?(l=this).sampleAes.decryptAacSamples(e.samples,0,function(){l.decryptAndRemuxAvc(e,t,r,n,i,a,s,o)}):this.decryptAndRemuxAvc(e,t,r,n,i,a,s,o)},N.prototype.decryptAndRemuxAvc=function(e,t,r,n,i,a,s,o){var l;t.samples?(l=this).sampleAes.decryptAvcSamples(t.samples,0,0,function(){l.remuxer.remux(e,t,r,n,i,a,s,o)}):this.remuxer.remux(e,t,r,n,i,a,s,o)},N.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},N.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},N.prototype._parsePMT=function(e,t,r,n){var i,a={audio:-1,avc:-1,id3:-1,isAAC:!0},s=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<s;){switch(i=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){X.b.log("unkown stream type:"+e[t]);break}case 15:-1===a.audio&&(a.audio=i);break;case 21:-1===a.id3&&(a.id3=i);break;case 219:if(!n){X.b.log("unkown stream type:"+e[t]);break}case 27:-1===a.avc&&(a.avc=i);break;case 3:case 4:r?-1===a.audio&&(a.audio=i,a.isAAC=!1):X.b.log("MPEG audio found, not supported in this browser for now");break;case 36:X.b.warn("HEVC stream type found, not supported for now");break;default:X.b.log("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return a},N.prototype._parsePES=function(e){var t,r,n=0,i=void 0,a=void 0,s=void 0,o=void 0,l=void 0,u=void 0,d=e.data;if(!e||0===e.size)return null;for(;d[0].length<19&&1<d.length;){var h=new Uint8Array(d[0].length+d[1].length);h.set(d[0]),h.set(d[1],d[0].length),d[0]=h,d.splice(1,1)}if(1!==((i=d[0])[0]<<16)+(i[1]<<8)+i[2])return null;if((a=(i[4]<<8)+i[5])&&a>e.size-6)return null;192&(t=i[7])&&(4294967295<(o=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)&&(o-=8589934592),64&t?(4294967295<(l=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)&&(l-=8589934592),54e5<o-l&&(X.b.warn(Math.round((o-l)/9e4)+"s delta between PTS and DTS, align them"),o=l)):l=o),u=(r=i[8])+9,e.size-=u,s=new Uint8Array(e.size);for(var c=0,f=d.length;c<f;c++){var p=(i=d[c]).byteLength;if(u){if(p<u){u-=p;continue}i=i.subarray(u),p-=u,u=0}s.set(i,n),n+=p}return a&&(a-=r+3),{data:s,pts:o,dts:l,len:a}},N.prototype.pushAccesUnit=function(e,t){var r,n;e.units.length&&e.frame&&(n=(r=t.samples).length,!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(n||this.contiguous)?(e.id=n,r.push(e)):t.dropped++),e.debug.length&&X.b.log(e.pts+"/"+e.dts+":"+e.debug)},N.prototype._parseAVCPES=function(f,e){function p(e,t,r,n){return{key:e,pts:t,dts:r,units:[],debug:n}}var g=this,m=this._avcTrack,t=this._parseAVCNALu(f.data),v=void 0,y=this.avcSample,b=void 0,E=!1,T=void 0,S=this.pushAccesUnit.bind(this);f.data=null,y&&t.length&&!m.audFound&&(S(y,m),y=this.avcSample=p(!1,f.pts,f.dts,"")),t.forEach(function(e){switch(e.type){case 1:b=!0,(y=y||(g.avcSample=p(!0,f.pts,f.dts,""))).frame=!0;var t=e.data;E&&4<t.length&&(2!==(u=new R(t).readSliceType())&&4!==u&&7!==u&&9!==u||(y.key=!0));break;case 5:b=!0,(y=y||(g.avcSample=p(!0,f.pts,f.dts,""))).key=!0,y.frame=!0;break;case 6:b=!0,(v=new R(g.discardEPB(e.data))).readUByte();for(var r=0,n=0,i=!1,a=0;!i&&1<v.bytesAvailable;){for(r=0;r+=a=v.readUByte(),255===a;);for(n=0;n+=a=v.readUByte(),255===a;);if(4===r&&0!==v.bytesAvailable){i=!0;var s=v.readUByte();if(181===s)if(49===v.readUShort()){s=v.readUInt();if(1195456820===s)if(3===v.readUByte()){var s=v.readUByte(),o=31&s,l=[s,v.readUByte()];for(T=0;T<o;T++)l.push(v.readUByte()),l.push(v.readUByte()),l.push(v.readUByte());g._insertSampleInOrder(g._txtTrack.samples,{type:3,pts:f.pts,bytes:l})}}}else if(n<v.bytesAvailable)for(T=0;T<n;T++)v.readUByte()}break;case 7:if(E=b=!0,!m.sps){var u=(v=new R(e.data)).readSPS();m.width=u.width,m.height=u.height,m.pixelRatio=u.pixelRatio,m.sps=[e.data],m.duration=g._duration;var d=e.data.subarray(1,4),h="avc1.";for(T=0;T<3;T++){var c=d[T].toString(16);c.length<2&&(c="0"+c),h+=c}m.codec=h}break;case 8:b=!0,m.pps||(m.pps=[e.data]);break;case 9:b=!1,m.audFound=!0,y&&S(y,m),y=g.avcSample=p(!1,f.pts,f.dts,"");break;case 12:b=!1;break;default:b=!1,y&&(y.debug+="unknown NAL "+e.type+" ")}y&&b&&y.units.push(e)}),e&&y&&(S(y,m),this.avcSample=null)},N.prototype._insertSampleInOrder=function(e,t){var r=e.length;if(0<r){if(t.pts>=e[r-1].pts)e.push(t);else for(var n=r-1;0<=n;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},N.prototype._getLastNalUnit=function(){var e,t=this.avcSample,r=void 0;return t&&0!==t.units.length||(t=(e=this._avcTrack.samples)[e.length-1]),t&&(r=(t=t.units)[t.length-1]),r},N.prototype._parseAVCNALu=function(e){var t,r,n,i=0,a=e.byteLength,s=this._avcTrack,o=p=s.naluState||0,l=[],u=void 0,d=-1,h=void 0;for(-1===p&&(h=31&e[d=0],p=0,i=1);i<a;){var c,f,p,g=e[i++];p?p=1!==p?g?1===g?(0<=d?(u={data:e.subarray(d,i-p-1),type:h},l.push(u)):(c=this._getLastNalUnit())&&(o&&i<=4-o&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-o)),0<(t=i-p-1)&&((f=new Uint8Array(c.data.byteLength+t)).set(c.data,0),f.set(e.subarray(0,t),c.data.byteLength),c.data=f)),i<a?(h=31&e[d=i],0):-1):0:3:g?0:2:p=g?0:1}return 0<=d&&0<=p&&(u={data:e.subarray(d,a),type:h,state:p},l.push(u)),0!==l.length||(r=this._getLastNalUnit())&&((n=new Uint8Array(r.data.byteLength+e.byteLength)).set(r.data,0),n.set(e,r.data.byteLength),r.data=n),s.naluState=p,l},N.prototype.discardEPB=function(e){for(var t,r=e.byteLength,n=[],i=1,a=void 0;i<r-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(0===n.length)return e;t=r-n.length,a=new Uint8Array(t);for(var s=0,i=0;i<t;s++,i++)s===n[0]&&(s++,n.shift()),a[i]=e[s];return a},N.prototype._parseAACPES=function(e){var t,r=this._audioTrack,n=e.data,i=e.pts,a=this.aacOverFlow,s=this.aacLastPTS,o=void 0,l=void 0,u=void 0,d=void 0;for(a&&((h=new Uint8Array(a.byteLength+n.byteLength)).set(a,0),h.set(n,a.byteLength),n=h),u=0,t=n.length;u<t-1&&!g(n,u);u++);if(u){var e=void 0,h=void 0,h=u<t-1?(e="AAC PES did not start with ADTS header,offset:"+u,!1):(e="no ADTS header found in AAC PES",!0);if(X.b.warn("parsing error:"+e),this.observer.trigger(Y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:h,reason:e}),h)return}for(v(r,this.observer,n,u,this.audioCodec),l=0,o=y(r.samplerate),a&&s&&(o=s+o,1<Math.abs(o-i)&&(X.b.log("AAC: align PTS for overlapping frames by "+Math.round((o-i)/90)),i=o));u<t;)if(g(n,u)&&u+5<t){var c=b(r,n,u,i,l);if(!c)break;u+=c.length,d=c.sample.pts,l++}else u++;a=u<t?n.subarray(u,t):null,this.aacOverFlow=a,this.aacLastPTS=d},N.prototype._parseMPEGPES=function(e){for(var t=e.data,r=t.length,n=0,i=0,a=e.pts;i<r;)if(_.isHeader(t,i)){var s=_.appendFrame(this._audioTrack,t,i,a,n);if(!s)break;i+=s.length,n++}else i++},N.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},N);function O(e,t,r){!function(e){if(!(e instanceof O))throw new TypeError("Cannot call a class as a function")}(this),this.observer=e,this.config=r,this.remuxer=t}var I=(O.prototype.resetInitSegment=function(e,t,r,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},O.prototype.resetTimeStamp=function(){},O.probe=function(e){var t,r=void 0,n=E.a.getID3Data(e,0);if(n&&void 0!==E.a.getTimeStamp(n))for(r=n.length,t=Math.min(e.length-1,r+100);r<t;r++)if(_.probe(e,r))return X.b.log("MPEG Audio sync word found !"),!0;return!1},O.prototype.append=function(e,t,r,n){for(var i=E.a.getID3Data(e,0),a=E.a.getTimeStamp(i),s=a?90*a:9e4*t,o=i.length,l=e.length,u=0,d=0,h=this._audioTrack,c=[{pts:s,dts:s,data:i}];o<l;)if(_.isHeader(e,o)){var f=_.appendFrame(h,e,o,s,u);if(!f)break;o+=f.length,d=f.sample.pts,u++}else E.a.isHeader(e,o)?(i=E.a.getID3Data(e,o),c.push({pts:d,dts:d,data:i}),o+=i.length):o++;this.remuxer.remux(h,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,r,n)},O.prototype.destroy=function(){},O);function C(){!function(e){if(!(e instanceof C))throw new TypeError("Cannot call a class as a function")}(this)}var G=(C.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},C);var F=Math.pow(2,32)-1;function M(){!function(e){if(!(e instanceof M))throw new TypeError("Cannot call a class as a function")}(this)}var Q=(M.init=function(){var e=void 0;for(e in M.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})M.types.hasOwnProperty(e)&&(M.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);M.HDLR_TYPES={video:t,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);M.STTS=M.STSC=M.STCO=i,M.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),M.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),M.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),M.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);t=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);M.FTYP=M.box(M.types.ftyp,t,i,t,r),M.DINF=M.box(M.types.dinf,M.box(M.types.dref,n))},M.box=function(e){for(var t=Array.prototype.slice.call(arguments,1),r=8,n=t.length,i=n,a=void 0;n--;)r+=t[n].byteLength;for((a=new Uint8Array(r))[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,a.set(e,4),n=0,r=8;n<i;n++)a.set(t[n],r),r+=t[n].byteLength;return a},M.hdlr=function(e){return M.box(M.types.hdlr,M.HDLR_TYPES[e])},M.mdat=function(e){return M.box(M.types.mdat,e)},M.mdhd=function(e,t){t*=e;var r=Math.floor(t/(1+F)),t=Math.floor(t%(1+F));return M.box(M.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t,85,196,0,0]))},M.mdia=function(e){return M.box(M.types.mdia,M.mdhd(e.timescale,e.duration),M.hdlr(e.type),M.minf(e))},M.mfhd=function(e){return M.box(M.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},M.minf=function(e){return"audio"===e.type?M.box(M.types.minf,M.box(M.types.smhd,M.SMHD),M.DINF,M.stbl(e)):M.box(M.types.minf,M.box(M.types.vmhd,M.VMHD),M.DINF,M.stbl(e))},M.moof=function(e,t,r){return M.box(M.types.moof,M.mfhd(e),M.traf(r,t))},M.moov=function(e){for(var t=e.length,r=[];t--;)r[t]=M.trak(e[t]);return M.box.apply(null,[M.types.moov,M.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(M.mvex(e)))},M.mvex=function(e){for(var t=e.length,r=[];t--;)r[t]=M.trex(e[t]);return M.box.apply(null,[M.types.mvex].concat(r))},M.mvhd=function(e,t){t*=e;var r=Math.floor(t/(1+F)),t=Math.floor(t%(1+F)),t=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return M.box(M.types.mvhd,t)},M.sdtp=function(e){for(var t,r=e.samples||[],n=new Uint8Array(4+r.length),i=void 0,i=0;i<r.length;i++)t=r[i].flags,n[i+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return M.box(M.types.sdtp,n)},M.stbl=function(e){return M.box(M.types.stbl,M.stsd(e),M.box(M.types.stts,M.STTS),M.box(M.types.stsc,M.STSC),M.box(M.types.stsz,M.STSZ),M.box(M.types.stco,M.STCO))},M.avc1=function(e){for(var t=[],r=[],n=void 0,i=void 0,a=void 0,n=0;n<e.sps.length;n++)a=(i=e.sps[n]).byteLength,t.push(a>>>8&255),t.push(255&a),t=t.concat(Array.prototype.slice.call(i));for(n=0;n<e.pps.length;n++)a=(i=e.pps[n]).byteLength,r.push(a>>>8&255),r.push(255&a),r=r.concat(Array.prototype.slice.call(i));var s=M.box(M.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),o=e.width,l=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return M.box(M.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,M.box(M.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),M.box(M.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},M.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},M.mp4a=function(e){var t=e.samplerate;return M.box(M.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),M.box(M.types.esds,M.esds(e)))},M.mp3=function(e){var t=e.samplerate;return M.box(M.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))},M.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?M.box(M.types.stsd,M.STSD,M.mp4a(e)):M.box(M.types.stsd,M.STSD,M.mp3(e)):M.box(M.types.stsd,M.STSD,M.avc1(e))},M.tkhd=function(e){var t=e.id,r=e.duration*e.timescale,n=e.width,i=e.height,e=Math.floor(r/(1+F)),r=Math.floor(r%(1+F));return M.box(M.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))},M.traf=function(e,t){var r=M.sdtp(e),n=e.id,i=Math.floor(t/(1+F)),t=Math.floor(t%(1+F));return M.box(M.types.traf,M.box(M.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),M.box(M.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,t>>24,t>>16&255,t>>8&255,255&t])),M.trun(e,r.length+16+20+8+16+8+8),r)},M.trak=function(e){return e.duration=e.duration||4294967295,M.box(M.types.trak,M.tkhd(e),M.mdia(e))},M.trex=function(e){e=e.id;return M.box(M.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},M.trun=function(e,t){var r,n,i,a,s,o=e.samples||[],l=o.length,e=12+16*l,u=new Uint8Array(e),d=void 0;for(t+=8+e,u.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),d=0;d<l;d++)n=(r=o[d]).duration,i=r.size,a=r.flags,s=r.cts,u.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,s>>>24&255,s>>>16&255,s>>>8&255,255&s],12+16*d);return M.box(M.types.trun,u)},M.initSegment=function(e){M.types||M.init();var t=M.moov(e),e=void 0;return(e=new Uint8Array(M.FTYP.byteLength+t.byteLength)).set(M.FTYP),e.set(t,M.FTYP.byteLength),e},M);function U(e,t,r,n){!function(e){if(!(e instanceof U))throw new TypeError("Cannot call a class as a function")}(this),this.observer=e,this.config=t,this.typeSupported=r;r=navigator.userAgent;this.isSafari=n&&-1<n.indexOf("Apple")&&r&&!r.match("CriOS"),this.ISGenerated=!1}var B=(U.prototype.destroy=function(){},U.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},U.prototype.resetInitSegment=function(){this.ISGenerated=!1},U.prototype.remux=function(e,t,r,n,i,a,s,o){var l,u,d,h,c;this.ISGenerated||this.generateIS(e,t,i),this.ISGenerated&&(c=e.samples.length,l=t.samples.length,d=u=i,c&&l&&(h=(e.samples[0].dts-t.samples[0].dts)/t.inputTimeScale,u+=Math.max(0,h),d+=Math.max(0,-h)),c?(e.timescale||(X.b.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,i)),h=this.remuxAudio(e,u,a,s),l&&(c=void 0,h&&(c=h.endPTS-h.startPTS),t.timescale||(X.b.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,i)),this.remuxVideo(t,d,a,c,s,o))):!l||(s=this.remuxVideo(t,d,a,0,s))&&e.codec&&this.remuxEmptyAudio(e,u,a,s)),r.samples.length&&this.remuxID3(r,i),n.samples.length&&this.remuxText(n,i)},U.prototype.generateIS=function(e,t,r){var n=this.observer,i=e.samples,a=t.samples,s=this.typeSupported,o="audio/mp4",l={},u={tracks:l},d=void 0===this._initPTS,h=void 0,c=void 0;d&&(h=c=1/0),e.config&&i.length&&(e.timescale=e.samplerate,X.b.log("audio sampling rate : "+e.samplerate),e.isAAC||(s.mpeg?(o="audio/mpeg",e.codec=""):s.mp3&&(e.codec="mp3")),l.audio={container:o,codec:e.codec,initSegment:!e.isAAC&&s.mpeg?new Uint8Array:Q.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(h=c=i[0].pts-e.inputTimeScale*r)),t.sps&&t.pps&&a.length&&(e=t.inputTimeScale,t.timescale=e,l.video={container:"video/mp4",codec:t.codec,initSegment:Q.initSegment([t]),metadata:{width:t.width,height:t.height}},d&&(h=Math.min(h,a[0].pts-e*r),c=Math.min(c,a[0].dts-e*r),this.observer.trigger(Y.a.INIT_PTS_FOUND,{initPTS:h}))),Object.keys(l).length?(n.trigger(Y.a.FRAG_PARSING_INIT_SEGMENT,u),this.ISGenerated=!0,d&&(this._initPTS=h,this._initDTS=c)):n.trigger(Y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},U.prototype.remuxVideo=function(e,t,r,n,i,a){var s,o=8,l=e.timescale,u=void 0,d=void 0,h=void 0,c=void 0,f=void 0,p=void 0,g=e.samples,m=[],v=[],y=g.length,b=this._PTSNormalize,E=this._initDTS,T=this.nextAvcDts,S=this.isSafari;if(0!==y){S&&(r|=g.length&&T&&(i&&Math.abs(t-T/l)<.1||Math.abs(g[0].pts-T-E)<l/5)),r||(T=t*l),g.forEach(function(e){e.ptsOrg=e.pts,e.dtsOrg=e.dts,e.pts=b(e.pts-E,T),e.dts=b(e.dts-E,T)}),g.sort(function(e,t){var r=e.dts-t.dts,n=e.pts-t.pts;return r||n||e.id-t.id});var _=g.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(_<0){X.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(_/90)+" ms to overcome this issue");for(var w=0;w<g.length;w++)g[w].dts+=_}var L=g[0],c=Math.max(L.dts,0),h=Math.max(L.pts,0),t=Math.round((c-T)/90);!a&&r&&t&&(1<t?X.b.log("AVC:"+t+" ms hole between fragments detected,filling it"):t<-1&&X.b.log("AVC:"+-t+" ms overlapping between fragments detected"),c=T,g[0].dts=c,h=Math.max(h-t,T),g[0].pts=h,X.b.log("Video/PTS/DTS adjusted: "+Math.round(h/90)+"/"+Math.round(c/90)+",delta:"+t+" ms")),L=g[g.length-1],p=Math.max(L.dts,0),f=Math.max(L.pts,0,p),S&&(u=Math.round((p-c)/(g.length-1)));for(var A=0,R=0,D=0;D<y;D++){for(var k=g[D],x=k.units,P=x.length,O=0,I=0;I<P;I++)O+=x[I].data.length;R+=O,A+=P,k.length=O,k.dts=S?c+D*u:Math.max(k.dts,c),k.pts=Math.max(k.pts,k.dts)}var C=R+4*A+8;try{d=new Uint8Array(C)}catch(e){return void this.observer.trigger(Y.a.ERROR,{type:z.b.MUX_ERROR,details:z.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:C,reason:"fail allocating video mdat "+C})}var F=new DataView(d.buffer);F.setUint32(0,C),d.set(Q.types.mdat,4);for(var M=0;M<y;M++){for(var N=g[M],U=N.units,B=0,G=void 0,j=0,H=U.length;j<H;j++){var q=U[j],V=q.data,q=q.data.byteLength;F.setUint32(o,q),o+=4,d.set(V,o),o+=q,B+=4+q}if(S)G=Math.max(0,u*Math.round((N.pts-N.dts)/u));else{if(M<y-1)u=g[M+1].dts-N.dts;else{if(a){N.pts=N.ptsOrg,N.dts=N.dtsOrg,v.push(N),L=g[0<M?M-1:M],p=Math.max(L.dts,0),f=Math.max(L.pts,0,p);continue}var K=this.config,W=N.dts-g[0<M?M-1:M].dts;K.stretchShortVideoTrack?(K=K.maxBufferHole,Math.floor(K*l)<(K=(n?h+n*l:this.nextAudioPts)-N.pts)?((u=K-W)<0&&(u=W),X.b.log("It is approximately "+K/90+" ms to the next segment; using duration "+u/90+" ms for the last video frame.")):u=W):u=W}G=Math.round(N.pts-N.dts)}m.push({size:B,duration:u,cts:G,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:N.key?2:1,isNonSync:N.key?0:1}})}this.nextAvcDts=p+u;r=e.dropped;e.len=0,e.nbNalu=0,e.dropped=0,m.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")&&((t=m[0].flags).dependsOn=2,t.isNonSync=0),e.samples=m,s=Q.moof(e.sequenceNumber++,c,e),e.samples=v;r={data1:s,data2:d,startPTS:h/l,endPTS:(f+u)/l,startDTS:c/l,endDTS:this.nextAvcDts/l,type:"video",hasAudio:!1,hasVideo:!0,nb:m.length,dropped:r};return this.observer.trigger(Y.a.FRAG_PARSING_DATA,r),r}},U.prototype.remuxAudio=function(e,t,r,n){var i=e.inputTimeScale,a=e.timescale,s=i/a,o=e.isAAC?1024:1152,l=o*s,u=this._PTSNormalize,d=this._initDTS,h=!e.isAAC&&this.typeSupported.mpeg,c=void 0,f=void 0,p=void 0,g=void 0,m=void 0,v=void 0,y=void 0,b=e.samples,E=[],T=this.nextAudioPts;if(r|=b.length&&T&&(n&&Math.abs(t-T/i)<.1||Math.abs(b[0].pts-T-d)<20*l),b.forEach(function(e){e.pts=e.dts=u(e.pts-d,t*i)}),0!==(b=b.filter(function(e){return 0<=e.pts})).length){if(r||(T=n?t*i:b[0].pts),e.isAAC)for(var S=this.config.maxAudioFramesDrift,_=0,w=T;_<b.length;){var L=b[_],A=L.pts-w,R=Math.abs(1e3*A/i);if(A<=-S*l)X.b.warn("Dropping 1 audio frame @ "+(w/i).toFixed(3)+"s due to "+Math.round(R)+" ms overlap."),b.splice(_,1),e.len-=L.unit.length;else if(S*l<=A&&R<1e4&&w){var D=Math.round(A/l);X.b.warn("Injecting "+D+" audio frame @ "+(w/i).toFixed(3)+"s due to "+Math.round(1e3*A/i)+" ms gap.");for(var k=0;k<D;k++){var x=Math.max(w,0);(p=G.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(X.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),p=L.unit.subarray()),b.splice(_,0,{unit:p,pts:x,dts:x}),e.len+=p.length,w+=l,_++}L.pts=L.dts=w,w+=l,_++}else Math.abs(A),L.pts=L.dts=w,w+=l,_++}for(var P=0,O=b.length;P<O;P++){var I=b[P],C=I.unit,I=I.pts;if(void 0!==y)f.duration=Math.round((I-y)/s);else{var F=Math.round(1e3*(I-T)/i),M=0;if(r&&e.isAAC&&F){if(0<F&&F<1e4)M=Math.round((I-T)/l),X.b.log(F+" ms hole between AAC samples detected,filling it"),0<M&&(p=(p=G.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||C.subarray(),e.len+=M*p.length);else if(F<-12){X.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(T/i).toFixed(3)+"s/"+(I/i).toFixed(3)+"s/"+-F+"ms"),e.len-=C.byteLength;continue}I=T}if(v=I,!(0<e.len))return;var N=h?e.len:e.len+8,c=h?0:8;try{g=new Uint8Array(N)}catch(e){return void this.observer.trigger(Y.a.ERROR,{type:z.b.MUX_ERROR,details:z.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating audio mdat "+N})}h||(new DataView(g.buffer).setUint32(0,N),g.set(Q.types.mdat,4));for(var U=0;U<M;U++)(p=G.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(X.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),p=C.subarray()),g.set(p,c),c+=p.byteLength,f={size:p.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(f)}g.set(C,c);F=C.byteLength;c+=F,f={size:F,cts:0,duration:o,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(f),y=I}var B=o,a=E.length;if(2<=a&&(B=E[a-2].duration,f.duration=B),a){this.nextAudioPts=T=y+s*B,e.len=0,e.samples=E,m=h?new Uint8Array:Q.moof(e.sequenceNumber++,v/s,e),e.samples=[];n=v/i,B=T/i,a={data1:m,data2:g,startPTS:n,endPTS:B,startDTS:n,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!1,nb:a};return this.observer.trigger(Y.a.FRAG_PARSING_DATA,a),a}return null}},U.prototype.remuxEmptyAudio=function(e,t,r,n){var i=e.inputTimeScale,a=i/(e.samplerate||i),s=this.nextAudioPts,o=(void 0!==s?s:n.startDTS*i)+this._initDTS,i=n.endDTS*i+this._initDTS,l=1024*a,u=Math.ceil((i-o)/l),d=G.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(X.b.warn("remux empty Audio"),d){for(var h=[],c=0;c<u;c++){var f=o+c*l;h.push({unit:d,pts:f,dts:f}),e.len+=d.length}e.samples=h,this.remuxAudio(e,t,r)}else X.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},U.prototype.remuxID3=function(e,t){var r=e.samples.length,n=void 0,i=e.inputTimeScale,a=this._initPTS,s=this._initDTS;if(r){for(var o=0;o<r;o++)(n=e.samples[o]).pts=(n.pts-a)/i,n.dts=(n.dts-s)/i;this.observer.trigger(Y.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[]},U.prototype.remuxText=function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var r=e.samples.length,n=void 0,i=e.inputTimeScale,a=this._initPTS;if(r){for(var s=0;s<r;s++)(n=e.samples[s]).pts=(n.pts-a)/i;this.observer.trigger(Y.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},U.prototype._PTSNormalize=function(e,t){var r=void 0;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=r;return e},U);function j(e){!function(e){if(!(e instanceof j))throw new TypeError("Cannot call a class as a function")}(this),this.observer=e}var H=(j.prototype.destroy=function(){},j.prototype.resetTimeStamp=function(){},j.prototype.resetInitSegment=function(){},j.prototype.remux=function(e,t,r,n,i,a,s,o){var l=this.observer,u="";e&&(u+="audio"),t&&(u+="video"),l.trigger(Y.a.FRAG_PARSING_DATA,{data1:o,startPTS:i,startDTS:i,type:u,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),l.trigger(Y.a.FRAG_PARSED)},j);var q=Object(s.a)(),s=(V.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},V.prototype.synccall=function(e,t){var r=this;this.fnqueue.push(function(){e.apply(r,t)}),this.lock||this.next()},V.prototype.next=function(){0<this.fnqueue.length?(this.lock=!0,this.fnqueue.shift()()):this.lock=!1},V.prototype.append=function(e,t,r,n,i,a,s,o,l,u,d,h,c){this.synccall(this.appendTask,[e,t,r,n,i,a,s,o,l,u,d,h,c])},V.prototype.appendTask=function(e,r,n,i,a,s,o,l,u,d,h,c,f){if(0<e.byteLength&&null!=r&&null!=r.key&&"AES-128"===r.method){var t=this.decrypter;null==t&&(t=this.decrypter=new m(this.observer,this.config));var p=this,g=void 0;try{g=q.now()}catch(e){g=Date.now()}t.decrypt(e,r.key.buffer,r.iv.buffer,function(e){var t=void 0;try{t=q.now()}catch(e){t=Date.now()}p.observer.trigger(Y.a.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:t}}),p.appendDecrypted(new Uint8Array(e),r,new Uint8Array(n),i,a,s,o,l,u,d,h,c,f),p.next()})}else this.appendDecrypted(new Uint8Array(e),r,new Uint8Array(n),i,a,s,o,l,u,d,h,c,f),this.next()},V.prototype.appendDecrypted=function(e,t,r,n,i,a,s,o,l,u,d,h,c){if(!(S=this.demuxer)||(s||o)&&!this.probe(e)){for(var f=this.observer,p=this.typeSupported,g=this.config,m=[{demux:P,remux:B},{demux:L.a,remux:H},{demux:w,remux:B},{demux:I,remux:B}],v=0,y=m.length;v<y;v++){var b=m[v],E=b.demux.probe;if(E(e)){var T=this.remuxer=new b.remux(f,g,p,this.vendor),S=new b.demux(f,T,g,p,this.vendor);this.probe=E;break}}if(!S)return void f.trigger(Y.a.ERROR,{type:z.b.MEDIA_ERROR,details:z.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=S}var _=this.remuxer;(s||o)&&(S.resetInitSegment(r,n,i,u),_.resetInitSegment()),s&&(S.resetTimeStamp(h),_.resetTimeStamp(h)),"function"==typeof S.setDecryptData&&S.setDecryptData(t),S.append(e,a,l,d,c)},V.prototype.notifycomplete=function(){this.synccall(this.notifycompleteTask,[])},V.prototype.notifycompleteTask=function(){var e=this.demuxer;e&&e.notifycomplete(),this.next()},V);function V(e,t,r,n){!function(e){if(!(e instanceof V))throw new TypeError("Cannot call a class as a function")}(this),this.observer=e,this.typeSupported=t,this.config=r,this.vendor=n,this.fnqueue=[],this.lock=!1}t.a=s},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,o,t){(function(e){o.fetch=s(e.fetch)&&s(e.ReadableStream),o.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),o.blobConstructor=!0}catch(e){}var t;function r(){if(void 0!==t)return t;if(e.XMLHttpRequest){t=new e.XMLHttpRequest;try{t.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(e){t=null}}else t=null;return t}function n(e){var t=r();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(e){}return!1}var i=void 0!==e.ArrayBuffer,a=i&&s(e.ArrayBuffer.prototype.slice);function s(e){return"function"==typeof e}o.arraybuffer=o.fetch||i&&n("arraybuffer"),o.msstream=!o.fetch&&a&&n("ms-stream"),o.mozchunkedarraybuffer=!o.fetch&&i&&n("moz-chunked-arraybuffer"),o.overrideMimeType=o.fetch||!!r()&&s(r().overrideMimeType),o.vbArray=s(e.VBArray),t=null}).call(o,t(3))},function(e,t,r){(((t=e.exports=r(21)).Stream=t).Readable=t).Writable=r(24),t.Duplex=r(8),t.Transform=r(26),t.PassThrough=r(40)},function(P,e,O){"use strict";(function(e,v){var y=O(13);P.exports=l;var n,b=O(18);l.ReadableState=o;function E(e,t){return e.listeners(t).length}O(10).EventEmitter;var r=O(22),d=O(15).Buffer,h=e.Uint8Array||function(){};var t=O(11);t.inherits=O(4);var i,e=O(35),T=void 0,T=e&&e.debuglog?e.debuglog("stream"):function(){},a=O(36),e=O(23);t.inherits(l,r);var s=["error","close","destroy","pause","resume"];function o(e,t){n=n||O(8),e=e||{},this.objectMode=!!e.objectMode,t instanceof n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,t=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:t,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new a,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(i=i||O(25).StringDecoder,this.decoder=new i(e.encoding),this.encoding=e.encoding)}function l(e){if(n=n||O(8),!(this instanceof l))return new l(e);this._readableState=new o(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),r.call(this)}function u(e,t,r,n,i){var a,s,o,l,u=e._readableState;return null===t?(u.reading=!1,s=e,(o=u).ended||(!o.decoder||(l=o.decoder.end())&&l.length&&(o.buffer.push(l),o.length+=o.objectMode?1:l.length),o.ended=!0,g(s))):(i||(a=function(e,t){var r;(function(e){return d.isBuffer(e)||e instanceof h})(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(u,t)),a?e.emit("error",a):u.objectMode||t&&0<t.length?("string"==typeof t||u.objectMode||Object.getPrototypeOf(t)===d.prototype||(a=t,t=d.from(a)),n?u.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):c(e,u,t,!0):u.ended?e.emit("error",new Error("stream.push() after EOF")):(u.reading=!1,u.decoder&&!r?(t=u.decoder.write(t),u.objectMode||0!==t.length?c(e,u,t,!1):S(e,u)):c(e,u,t,!1))):n||(u.reading=!1)),!(u=u).ended&&(u.needReadable||u.length<u.highWaterMark||0===u.length)}function c(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&g(e)),S(e,t)}Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),l.prototype.destroy=e.destroy,l.prototype._undestroy=e.undestroy,l.prototype._destroy=function(e,t){this.push(null),t(e)},l.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=d.from(e,t),t=""),r=!0),u(this,e,t,!1,r)},l.prototype.unshift=function(e){return u(this,e,null,!0,!1)},l.prototype.isPaused=function(){return!1===this._readableState.flowing},l.prototype.setEncoding=function(e){return i=i||O(25).StringDecoder,this._readableState.decoder=new i(e),this._readableState.encoding=e,this};var f=8388608;function p(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?(t.flowing&&t.length?t.buffer.head.data:t).length:(e>t.highWaterMark&&(t.highWaterMark=(f<=(r=e)?r=f:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var r}function g(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(T("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?y(m,e):m(e))}function m(e){T("emit readable"),e.emit("readable"),A(e)}function S(e,t){t.readingMore||(t.readingMore=!0,y(_,e,t))}function _(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(T("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function w(e){T("readable nexttick read 0"),e.read(0)}function L(e,t){t.reading||(T("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(T("flow",t.flowing);t.flowing&&null!==e.read(););}function R(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():(r?function(e,t){var r=t.head,n=1,i=r.data;e-=i.length;for(;r=r.next;){var a=r.data,s=e>a.length?a.length:e;if(s===a.length?i+=a:i+=a.slice(0,e),0===(e-=s)){s===a.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=a.slice(s);break}++n}return t.length-=n,i}:function(e,t){var r=d.allocUnsafe(e),n=t.head,i=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var a=n.data,s=e>a.length?a.length:e;if(a.copy(r,r.length-e,0,s),0===(e-=s)){s===a.length?(++i,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=a.slice(s);break}++i}return t.length-=i,r})(e,t);return n}(e,t.buffer,t.decoder),r);var r}function D(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,y(k,t,e))}function k(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function x(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}l.prototype.read=function(e){T("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return T("read: emitReadable",t.length,t.ended),(0===t.length&&t.ended?D:g)(this),null;if(0===(e=p(e,t))&&t.ended)return 0===t.length&&D(this),null;var n=t.needReadable;return T("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&T("length less than watermark",n=!0),t.ended||t.reading?T("reading or ended",n=!1):n&&(T("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=p(r,t))),null===(n=0<e?R(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&D(this)),null!==n&&this.emit("data",n),n},l.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},l.prototype.pipe=function(r,e){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=r;break;case 1:i.pipes=[i.pipes,r];break;default:i.pipes.push(r)}i.pipesCount+=1,T("pipe count=%d opts=%j",i.pipesCount,e);var t=(!e||!1!==e.end)&&r!==v.stdout&&r!==v.stderr?s:m;function a(e,t){T("onunpipe"),e===n&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,T("cleanup"),r.removeListener("close",p),r.removeListener("finish",g),r.removeListener("drain",l),r.removeListener("error",f),r.removeListener("unpipe",a),n.removeListener("end",s),n.removeListener("end",m),n.removeListener("data",c),u=!0,!i.awaitDrain||r._writableState&&!r._writableState.needDrain||l())}function s(){T("onend"),r.end()}i.endEmitted?y(t):n.once("end",t),r.on("unpipe",a);var o,l=(o=n,function(){var e=o._readableState;T("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&E(o,"data")&&(e.flowing=!0,A(o))});r.on("drain",l);var u=!1;var d,h=!1;function c(e){T("ondata"),(h=!1)!==r.write(e)||h||((1===i.pipesCount&&i.pipes===r||1<i.pipesCount&&-1!==x(i.pipes,r))&&!u&&(T("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,h=!0),n.pause())}function f(e){T("onerror",e),m(),r.removeListener("error",f),0===E(r,"error")&&r.emit("error",e)}function p(){r.removeListener("finish",g),m()}function g(){T("onfinish"),r.removeListener("close",p),m()}function m(){T("unpipe"),n.unpipe(r)}return n.on("data",c),d="error",e=f,"function"==typeof(t=r).prependListener?t.prependListener(d,e):t._events&&t._events[d]?b(t._events[d])?t._events[d].unshift(e):t._events[d]=[e,t._events[d]]:t.on(d,e),r.once("close",p),r.once("finish",g),r.emit("pipe",n),i.flowing||(T("pipe resume"),n.resume()),r},l.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,r);return this}var s=x(t.pipes,e);return-1===s||(t.pipes.splice(s,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},l.prototype.addListener=l.prototype.on=function(e,t){t=r.prototype.on.call(this,e,t);return"data"===e?!1!==this._readableState.flowing&&this.resume():"readable"===e&&((e=this._readableState).endEmitted||e.readableListening||(e.readableListening=e.needReadable=!0,e.emittedReadable=!1,e.reading?e.length&&g(this):y(w,this))),t},l.prototype.resume=function(){var e,t=this._readableState;return t.flowing||(T("resume"),t.flowing=!0,e=this,(t=t).resumeScheduled||(t.resumeScheduled=!0,y(L,e,t))),this},l.prototype.pause=function(){return T("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(T("pause"),this._readableState.flowing=!1,this.emit("pause")),this},l.prototype.wrap=function(t){var e,r=this._readableState,n=!1,i=this;for(e in t.on("end",function(){var e;T("wrapped end"),!r.decoder||r.ended||(e=r.decoder.end())&&e.length&&i.push(e),i.push(null)}),t.on("data",function(e){T("wrapped data"),r.decoder&&(e=r.decoder.write(e)),r.objectMode&&null==e||(r.objectMode||e&&e.length)&&(i.push(e)||(n=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var a=0;a<s.length;a++)t.on(s[a],i.emit.bind(i,s[a]));return i._read=function(e){T("wrapped _read",e),n&&(n=!1,t.resume())},i},l._fromList=R}).call(e,O(3),O(7))},function(e,t,r){e.exports=r(10).EventEmitter},function(e,t,r){"use strict";var a=r(13);function s(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;n||i?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||a(s,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(a(s,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)}))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(T,e,S){"use strict";(function(e,t,r){var c=S(13);function d(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}T.exports=u;var n,s=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?t:c;u.WritableState=l;t=S(11);t.inherits=S(4);var i={deprecate:S(39)},a=S(22),f=S(15).Buffer,p=r.Uint8Array||function(){};var o,r=S(23);function g(){}function l(e,a){n=n||S(8),e=e||{},this.objectMode=!!e.objectMode,a instanceof n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var t=e.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=t||0===t?t:r,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;r=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){var t,r,n,i;r=e,n=(t=a)._writableState,i=n.sync,e=n.writecb,function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),r?function(e,t,r,n,i){--t.pendingcb,r?(c(i,n),c(E,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(i(n),e._writableState.errorEmitted=!0,e.emit("error",n),E(e,t))}(t,n,i,r,e):((r=y(n))||n.corked||n.bufferProcessing||!n.bufferedRequest||v(t,n),i?s(h,t,n,r,e):h(t,n,r,e))},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new d(this)}function u(e){if(n=n||S(8),!(o.call(u,this)||this instanceof n))return new u(e);this._writableState=new l(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),a.call(this)}function m(e,t,r,n,i,a,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function h(e,t,r,n){var i;r||(i=e,0===(r=t).length&&r.needDrain&&(r.needDrain=!1,i.emit("drain"))),t.pendingcb--,n(),E(e,t)}function v(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),n=t.corkedRequestsFree;n.entry=r;for(var a=0,s=!0;r;)(i[a]=r).isBuf||(s=!1),r=r.next,a+=1;i.allBuffers=s,m(e,t,!0,t.length,i,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new d(t)}else{for(;r;){var o=r.chunk,l=r.encoding,u=r.callback;if(m(e,t,!1,t.objectMode?1:o.length,o,l,u),r=r.next,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=r,t.bufferProcessing=!1}function y(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function b(t,r){t._final(function(e){r.pendingcb--,e&&t.emit("error",e),r.prefinished=!0,t.emit("prefinish"),E(t,r)})}function E(e,t){var r,n,i=y(t);return i&&(r=e,(n=t).prefinished||n.finalCalled||("function"==typeof r._final?(n.pendingcb++,n.finalCalled=!0,c(b,r,n)):(n.prefinished=!0,r.emit("prefinish"))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),i}t.inherits(u,a),l.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(l.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(o=Function.prototype[Symbol.hasInstance],Object.defineProperty(u,Symbol.hasInstance,{value:function(e){return!!o.call(this,e)||e&&e._writableState instanceof l}})):o=function(e){return e instanceof this},u.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},u.prototype.write=function(e,t,r){var n,i,a,s,o,l,u=this._writableState,d=!1,h=(i=e,(f.isBuffer(i)||i instanceof p)&&!u.objectMode);return h&&!f.isBuffer(e)&&(a=e,e=f.from(a)),"function"==typeof t&&(r=t,t=null),t=h?"buffer":t||u.defaultEncoding,"function"!=typeof r&&(r=g),u.ended?(s=this,o=r,l=new Error("write after end"),s.emit("error",l),c(o,l)):(h||(n=this,i=u,a=r,o=!(s=!0),null===(l=e)?o=new TypeError("May not write null values to stream"):"string"==typeof l||void 0===l||i.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(n.emit("error",o),c(a,o),s=!1),s))&&(u.pendingcb++,d=function(e,t,r,n,i,a){r||(l=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,r));return t}(t,n,i),n!==l&&(r=!0,i="buffer",n=l));var s=t.objectMode?1:n.length;t.length+=s;var o=t.length<t.highWaterMark;o||(t.needDrain=!0);{var l;t.writing||t.corked?(l=t.lastBufferedRequest,t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1):m(e,t,!1,s,n,i,a)}return o}(this,u,h,e,t,r)),d},u.prototype.cork=function(){this._writableState.corked++},u.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||v(this,e))},u.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},u.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},u.prototype._writev=null,u.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,t=e=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||(t=this,r=r,(n=n).ending=!0,E(t,n),r&&(n.finished?c(r):t.once("finish",r)),n.ended=!0,t.writable=!1)},Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),u.prototype.destroy=r.destroy,u.prototype._undestroy=r.undestroy,u.prototype._destroy=function(e,t){this.end(),t(e)}}).call(e,S(7),S(37).setImmediate,S(3))},function(e,t,r){var n=r(6).Buffer,i=n.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};t=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!i(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=o;break;default:return void(this.write=a)}this.charBuffer=new n(6),this.charReceived=0,this.charLength=0};function a(e){return e.toString(this.encoding)}function s(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function o(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}t.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(e=e.slice(r,e.length),!(55296<=(i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&i<=56319)){if((this.charReceived=this.charLength=0)===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var i,n=(t+=e.toString(this.encoding,0,n)).length-1;if(55296<=(i=t.charCodeAt(n))&&i<=56319){var a=this.surrogateSize;return this.charLength+=a,this.charReceived+=a,this.charBuffer.copy(this.charBuffer,a,0,a),e.copy(this.charBuffer,0,0,a),t.substring(0,n)}return t},t.prototype.detectIncompleteChar=function(e){for(var t=3<=e.length?3:e.length;0<t;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},t.prototype.end=function(e){var t,r,n="";return e&&e.length&&(n=this.write(e)),this.charReceived&&(t=this.charReceived,r=this.charBuffer,e=this.encoding,n+=r.slice(0,t).toString(e)),n}},function(e,t,r){"use strict";e.exports=a;var n=r(8),e=r(11);function i(r){this.afterTransform=function(e,t){return function(e,t,r){var n=e._transformState;n.transforming=!1;var i=n.writecb;if(!i)return e.emit("error",new Error("write callback called multiple times"));n.writechunk=null,(n.writecb=null)!=r&&e.push(r);i(t);t=e._readableState;t.reading=!1,(t.needReadable||t.length<t.highWaterMark)&&e._read(t.highWaterMark)}(r,e,t)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function a(e){if(!(this instanceof a))return new a(e);n.call(this,e),this._transformState=new i(this);var r=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,t){s(r,e,t)}):s(r)})}function s(e,t,r){if(t)return e.emit("error",t);null!=r&&e.push(r);t=e._writableState,r=e._transformState;if(t.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.inherits=r(4),e.inherits(a,n),a.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},a.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},a.prototype._write=function(e,t,r){var n=this._transformState;n.writecb=r,n.writechunk=e,n.writeencoding=t,n.transforming||(t=this._readableState,(n.needTransform||t.needReadable||t.length<t.highWaterMark)&&this._read(t.highWaterMark))},a.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},a.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),i=r.n(n),d=r(2),m=r(1),w=r(0),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var s=new Set(["hlsEventGeneric","hlsHandlerDestroying","hlsHandlerDestroyed"]);function o(e){!function(e){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this),this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}var l=(o.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},o.prototype.onHandlerDestroying=function(){},o.prototype.onHandlerDestroyed=function(){},o.prototype.isEventHandler=function(){return"object"===a(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},o.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if(s.has(e))throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)},this)},o.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},o.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},o.prototype.onEventGeneric=function(t,e){try{(function(e,t){var r="on"+e.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)}).call(this,t,e).call()}catch(e){w.b.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(m.a.ERROR,{type:d.b.OTHER_ERROR,details:d.a.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},o),u=r(16);function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(){!function(e){if(!(e instanceof c))throw new TypeError("Cannot call a class as a function")}(this),this.method=null,this.key=null,this.iv=null,this._uri=null}var L=(function(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}(c,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=i.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),c),f=function(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),e};function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(){var e;!function(e){if(!(e instanceof g))throw new TypeError("Cannot call a class as a function")}(this),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this._elementaryStreams=((e={})[g.ElementaryStreamTypes.AUDIO]=!1,e[g.ElementaryStreamTypes.VIDEO]=!1,e)}var A=(g.prototype.addElementaryStream=function(e){this._elementaryStreams[e]=!0},g.prototype.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},g.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},g.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&((r=new L).method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r},f(g,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=i.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var e,t,r=[];return this.rawByteRange&&(1===(e=this.rawByteRange.split("@",2)).length?(t=this.lastByteRangeEndOffset,r[0]=t||0):r[0]=parseInt(e[1]),r[1]=parseInt(e[0])+r[0],this._byteRange=r),r}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}],[{key:"ElementaryStreamTypes",get:function(){return{AUDIO:"audio",VIDEO:"video"}}}]),g);var v=/^(\d+)x(\d+)$/,y=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;function b(e){for(var t in!function(e){if(!(e instanceof b))throw new TypeError("Cannot call a class as a function")}(this),"string"==typeof e&&(e=b.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var R=(b.prototype.decimalInteger=function(e){e=parseInt(this[e],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},b.prototype.hexadecimalInteger=function(e){if(this[e]){for(var t=(1&(t=(this[e]||"0x").slice(2)).length?"0":"")+t,r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null},b.prototype.hexadecimalIntegerAsNumber=function(e){e=parseInt(this[e],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},b.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},b.prototype.enumeratedString=function(e){return this[e]},b.prototype.decimalResolution=function(e){e=v.exec(this[e]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},b.parseAttrList=function(e){var t,r={};for(y.lastIndex=0;null!==(t=y.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1]]=n}return r},b),E={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function T(e,t){return window.MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var S=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,_=/#EXT-X-MEDIA:(.*)/g,D=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),k=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(DEFINITION):(.+))|(?:#EXT-X-(PREFETCH-DIS)CONTINUITY)|(?:#EXT-X-(PREFETCH):(.+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,x=/\.(mp4|m4s|m4v|m4a)$/i;function P(){!function(e){if(!(e instanceof P))throw new TypeError("Cannot call a class as a function")}(this)}var O=(P.findGroup=function(e,t){if(!e)return null;for(var r=null,n=0;n<e.length;n++){var i=e[n];i.id===t&&(r=i)}return r},P.convertAVC1ToAVCOTI=function(e){var t=void 0,r=e.split(".");return 2<r.length?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t},P.resolve=function(e,t){return i.a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},P.parseMasterPlaylist=function(e,t,r){var n,i=[];function a(n,i){["video","audio"].forEach(function(r){var e,t=n.filter(function(e){return t=e,!!(e=E[e=r])&&!0===e[t.slice(0,4)];var t});t.length&&(e=t.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}),i[r+"Codec"]=(0<e.length?e:t)[0],n=n.filter(function(e){return-1===t.indexOf(e)}))}),i.unknownCodecs=n}for(S.lastIndex=0;null!=(n=S.exec(e));){var s={},o=s.attrs=new R(n[1]);s.url=P.resolve(n[2],t);var l=o.decimalResolution("RESOLUTION");l&&(s.width=l.width,s.height=l.height),s.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),s.averageDuration=o.decimalFloatingPoint("AVERAGE-DURATION"),s.cmode=o.enumeratedString("CMODE"),s.name=o.NAME,a([].concat((o.CODECS||"").split(/[ ,]+/)),s),s.videoCodec&&-1!==s.videoCodec.indexOf("avc1")&&(s.videoCodec=P.convertAVC1ToAVCOTI(s.videoCodec)),i.push(s)}if(Array.isArray(r)&&0<r.length){for(var u=[],d=0;d<i.length;d++){var h=i[d];h&&-1<r.indexOf(h.cmode)&&u.push(h)}i=u}return i},P.parseMasterPlaylistMedia=function(e,t,r){var n,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],a=[],s=0;for(_.lastIndex=0;null!==(n=_.exec(e));){var o={},l=new R(n[1]);l.TYPE===r&&(o.groupId=l["GROUP-ID"],o.name=l.NAME,o.type=r,o.default="YES"===l.DEFAULT,o.autoselect="YES"===l.AUTOSELECT,o.forced="YES"===l.FORCED,l.URI&&(o.url=P.resolve(l.URI,t)),o.lang=l.LANGUAGE,o.name||(o.name=o.lang),i.length&&(l=P.findGroup(i,o.groupId),o.audioCodec=(l||i[0]).codec),o.id=s++,a.push(o))}return a},P.parseLevelPlaylist=function(e,t,r,n,i,a){var s=0,o=0,l={type:null,version:null,url:t,fragments:[],live:!0,isLiveEnd:!1,startSN:0},u=new L,d=0,h=null,c=new A,f=void 0,p=void 0;for(D.lastIndex=0;null!==(f=D.exec(e));){var g,m=f[1];if(m){c.prefetch=!1,c.duration=parseFloat(m);var v=(" "+f[2]).slice(1);c.title=v||null,c.tagList.push(v?["INF",m,v]:["INF",m])}else if(f[3])isNaN(c.duration)||(g=s++,c.type=n,c.start=o,c.levelkey=u,c.sn=g,c.level=r,c.cc=d,c.urlId=i,c.baseurl=t,c.relurl=(" "+f[3]).slice(1),l.programDateTime&&(h?c.rawProgramDateTime?c.pdt=Date.parse(c.rawProgramDateTime):c.pdt=h.pdt+1e3*h.duration:c.pdt=Date.parse(l.programDateTime),c.endPdt=c.pdt+1e3*c.duration),l.fragments.push(c),o+=(h=c).duration,c=new A);else if(f[4])c.rawByteRange=(" "+f[4]).slice(1),!h||(g=h.byteRangeEndOffset)&&(c.lastByteRangeEndOffset=g);else if(f[5])c.rawProgramDateTime=(" "+f[5]).slice(1),c.tagList.push(["PROGRAM-DATE-TIME",c.rawProgramDateTime]),void 0===l.programDateTime&&(l.programDateTime=new Date(new Date(Date.parse(f[5]))-1e3*o));else{for(f=f[0].match(k),p=1;p<f.length&&void 0===f[p];p++);var y=(" "+f[p+1]).slice(1),b=(" "+f[p+2]).slice(1);switch(f[p]){case"#":c.tagList.push(b?[y,b]:[y]);break;case"PLAYLIST-TYPE":l.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":s=l.startSN=parseInt(y);break;case"TARGETDURATION":l.targetduration=parseFloat(y);break;case"VERSION":l.version=parseInt(y);break;case"DEFINITION":l.defination=y;break;case"EXTM3U":break;case"ENDLIST":l.live=!1,l.isLiveEnd=!0;break;case"DIS":d++,c.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(y);break;case"PREFETCH":a&&(c.prefetch=!0,c.duration=0<l.fragments.length?l.fragments[l.fragments.length-1].duration:l.targetduration,c.title=null,c.type=n,c.start=o,c.levelkey=u,c.sn=s++,c.level=r,c.cc=d,c.urlId=i,c.baseurl=t,c.relurl=y,l.fragments.push(c),o+=(h=c).duration,c=new A);break;case"PREFETCH-DIS":a&&(d++,c.tagList.push(["PREFETCH-DIS"]));break;case"KEY":var E=new R(y),T=E.enumeratedString("METHOD"),S=E.URI,E=E.hexadecimalInteger("IV");T&&(u=new L,S&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(T)&&(u.method=T,u.baseuri=t,u.reluri=S,u.key=null,u.iv=E));break;case"START":var _=new R(y).decimalFloatingPoint("TIME-OFFSET");isNaN(_)||(l.startTimeOffset=_);break;case"MAP":_=new R(y);c.relurl=_.URI,c.rawByteRange=_.BYTERANGE,c.baseurl=t,c.level=r,c.type=n,c.sn="initSegment",l.initSegment=c,c=new A;break;default:w.b.warn("line parsed but not handled: "+f)}}}return(c=h)&&!c.relurl&&(l.fragments.pop(),o-=c.duration),l.totalduration=o,l.averagetargetduration=o/l.fragments.length,l.endSN=s-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=d,!l.initSegment&&l.fragments.length&&l.fragments.every(function(e){return x.test(e.relurl)})&&(w.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(c=new A).relurl=l.fragments[0].relurl,c.baseurl=t,c.level=r,c.type=n,c.sn="initSegment",l.initSegment=c,l.needSidxRanges=!0),l},P),I=function(e,t,r){return t&&C(e.prototype,t),r&&C(e,r),e};function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var F,M=window.performance,N={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},U={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function B(e){!function(e){if(!(e instanceof B))throw new TypeError("Cannot call a class as a function")}(this);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,F.call(this,e,m.a.MANIFEST_LOADING,m.a.LEVEL_LOADING,m.a.AUDIO_TRACK_LOADING,m.a.SUBTITLE_TRACK_LOADING));return e.loaders={},e.m3u8RetryTimes=0,e}var G,j=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(B,F=l),B.canHaveQualityLevels=function(e){return e!==N.AUDIO_TRACK&&e!==N.SUBTITLE_TRACK},B.mapContextToLevelType=function(e){switch(e.type){case N.AUDIO_TRACK:return U.AUDIO;case N.SUBTITLE_TRACK:return U.SUBTITLE;default:return U.MAIN}},B.getResponseUrl=function(e,t){e=e.url;return void 0!==e&&0!==e.indexOf("data:")||(e=t.url),e},B.prototype.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,n=t.loader,t=new(r||n)(t);return e.loader=t,this.loaders[e.type]=t},B.prototype.getInternalLoader=function(e){return this.loaders[e.type]},B.prototype.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},B.prototype.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},B.prototype.destroy=function(){this.destroyInternalLoaders(),F.prototype.destroy.call(this)},B.prototype.onManifestLoading=function(e){this.load(e.url,{type:N.MANIFEST,level:0,id:null})},B.prototype.onLevelLoading=function(e){this.load(e.url,{type:N.LEVEL,level:e.level,id:e.id})},B.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:N.AUDIO_TRACK,level:0,id:e.id})},B.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:N.SUBTITLE_TRACK,level:0,id:e.id})},B.prototype.load=function(e,t){var r=this.hls.config;w.b.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var n=this.getInternalLoader(t);if(n){var i=n.context;if(i&&i.url===e)return w.b.trace("playlist request ongoing"),!1;w.b.warn("aborting previous loader for type: "+t.type),n.abort()}var a=void 0,s=void 0,o=void 0,l=void 0;switch(t.type){case N.MANIFEST:a=r.manifestLoadingMaxRetry,s=r.manifestLoadingTimeOut,o=r.manifestLoadingRetryDelay,l=r.manifestLoadingMaxRetryTimeout;break;case N.LEVEL:a=0,s=r.levelLoadingTimeOut;break;default:a=r.levelLoadingMaxRetry,s=r.levelLoadingTimeOut,o=r.levelLoadingRetryDelay,l=r.levelLoadingMaxRetryTimeout}n=this.createInternalLoader(t),t.url=e,t.responseType=t.responseType||"";var u={timeout:s,maxRetry:a,retryDelay:o,maxRetryDelay:l},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return w.b.debug("Calling internal loader delegate for URL: "+e),n.load(t,u,i),!0},B.prototype.loadsuccess=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;if(r.isSidxRequest)return this._handleSidxRequest(e,r),void this._handlePlaylistLoaded(e,t,r,n);this.resetInternalLoader(r.type);var i=e.data;t.tload=M.now(),0===i.indexOf("#EXTM3U")?0<i.indexOf("#EXTINF:")||0<i.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(e,t,r,n):this._handleMasterPlaylist(e,t,r,n):this._handleManifestParsingError(e,r,"no EXTM3U delimiter",n)},B.prototype.loaderror=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,r)},B.prototype.loadtimeout=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this._handleNetworkError(t,r,!0)},B.prototype._handleMasterPlaylist=function(e,t,r,n){var i,a,s=this,o=this.hls,l=e.data,u=B.getResponseUrl(e,r),d=O.parseMasterPlaylist(l,u,o.config.cmodeWhiteList),h=d.map(function(e){return e.cmode});if(o.config.cmodeWhiteList.reduce(function(e,t){return e||!h.includes(t)},!1)){if(this.m3u8RetryTimes+=1,this.m3u8RetryTimes<5)return void setTimeout(function(){s.m3u8RetryTimes<5&&(w.b.warn("found cmode white list item not match master m3u8, reload master m3u8 again, retryTimes: "+s.m3u8RetryTimes),s.load(u,{type:N.MANIFEST,level:0,id:null}))},2e3);w.b.warn("found cmode white list item not match master m3u8, exceed retry times, use current master m3u8")}d.length?(i=d.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),i=O.parseMasterPlaylistMedia(l,u,"AUDIO",i),l=O.parseMasterPlaylistMedia(l,u,"SUBTITLES"),i.length&&(a=!1,i.forEach(function(e){e.url||(a=!0)}),!1===a&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(w.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),i.unshift({type:"main",name:"main"}))),this.m3u8RetryTimes=0,o.trigger(m.a.MANIFEST_LOADED,{levels:d,audioTracks:i,subtitles:l,url:u,stats:t,networkDetails:n})):this._handleManifestParsingError(e,r,"no level found in manifest",n)},B.prototype._handleTrackOrLevelPlaylist=function(e,t,r,n){var i=this.hls,a=r.id,s=r.level,o=r.type,l=B.getResponseUrl(e,r),u=isNaN(a)?0:a,d=isNaN(s)?u:s,h=B.mapContextToLevelType(r),h=O.parseLevelPlaylist(e.data,l,d,h,u,i.config.lhlsEnable);h.tload=t.tload,o===N.MANIFEST&&(u={url:l,details:h},i.trigger(m.a.MANIFEST_LOADED,{levels:[u],audioTracks:[],url:l,stats:t,networkDetails:n})),t.tparsed=M.now(),h.needSidxRanges?(l=h.initSegment.url,this.load(l,{isSidxRequest:!0,type:o,level:s,levelDetails:h,id:a,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})):(r.levelDetails=h,this._handlePlaylistLoaded(e,t,r,n))},B.prototype._handleSidxRequest=function(e,r){e=u.a.parseSegmentIndex(new Uint8Array(e.data));e.references.forEach(function(e,t){e=e.info,t=r.levelDetails.fragments[t];0===t.byteRange.length&&(t.rawByteRange=String(1+e.end-e.start)+"@"+String(e.start))}),r.levelDetails.initSegment.rawByteRange=String(e.moovEndOffset)+"@0"},B.prototype._handleManifestParsingError=function(e,t,r,n){this.hls.trigger(m.a.ERROR,{type:d.b.NETWORK_ERROR,details:d.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:r,networkDetails:n})},B.prototype._handleNetworkError=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];w.b.info("A network error occured while loading a "+e.type+"-type playlist");var n=void 0,i=void 0,a=this.getInternalLoader(e);switch(e.type){case N.MANIFEST:n=r?d.a.MANIFEST_LOAD_TIMEOUT:d.a.MANIFEST_LOAD_ERROR,i=!0;break;case N.LEVEL:n=r?d.a.LEVEL_LOAD_TIMEOUT:d.a.LEVEL_LOAD_ERROR,i=!1;break;case N.AUDIO_TRACK:n=r?d.a.AUDIO_TRACK_LOAD_TIMEOUT:d.a.AUDIO_TRACK_LOAD_ERROR,i=!1;break;default:i=!1}a&&(a.abort(),this.resetInternalLoader(e.type)),this.hls.trigger(m.a.ERROR,{type:d.b.NETWORK_ERROR,details:n,fatal:i,url:a.url,loader:a,context:e,networkDetails:t})},B.prototype._handlePlaylistLoaded=function(e,t,r,n){var i=r.type,a=r.level,s=r.id,o=r.levelDetails;if(o.targetduration)if(B.canHaveQualityLevels(r.type))this.hls.trigger(m.a.LEVEL_LOADED,{details:o,level:a||0,id:s||0,stats:t,networkDetails:n});else switch(i){case N.AUDIO_TRACK:this.hls.trigger(m.a.AUDIO_TRACK_LOADED,{details:o,id:s,stats:t,networkDetails:n});break;case N.SUBTITLE_TRACK:this.hls.trigger(m.a.SUBTITLE_TRACK_LOADED,{details:o,id:s,stats:t,networkDetails:n})}else this._handleManifestParsingError(e,r,"invalid target duration",n)},I(B,null,[{key:"ContextType",get:function(){return N}},{key:"LevelType",get:function(){return U}}]),B);function H(e){!function(e){if(!(e instanceof H))throw new TypeError("Cannot call a class as a function")}(this);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,G.call(this,e,m.a.FRAG_LOADING));return e.loaders={},e}var q,V=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(H,G=l),H.prototype.destroy=function(){var e,t=this.loaders;for(e in t){var r,n=t[e];for(r in n)n[r].destroy()}this.loaders={},G.prototype.destroy.call(this)},H.prototype.onFragLoading=function(e){var t=e.frag,r=t.type,n=this.loaders,i=this.hls.config,a=!t.bitrateTest&&this.hls.lhlsEnable,s=i.fLoader,o=i.loader,e=void(t.loaded=0),e=t.loader=new(i.fLoader?s:o)(i,a);n[r]||(n[r]={}),n[r][t.sn]=e;o=void 0,n=void 0,o={url:t.url,frag:t,responseType:"arraybuffer",progressData:a},a=t.byteRangeStartOffset,t=t.byteRangeEndOffset;isNaN(a)||isNaN(t)||(o.rangeStart=a,o.rangeEnd=t),n={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},r={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},e.load(o,n,r)},H.prototype.loadsuccess=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,e=e.data,r=r.frag;r.loader=void 0,this.loaders[r.type]&&delete this.loaders[r.type][r.sn],this.hls.trigger(m.a.FRAG_LOADED,{payload:e,frag:r,stats:t,networkDetails:n})},H.prototype.loaderror=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=t.frag,i=n.loader;i&&i.abort(),this.loaders[n.type]&&delete this.loaders[n.type][n.sn],this.hls.trigger(m.a.ERROR,{type:d.b.NETWORK_ERROR,details:d.a.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:r})},H.prototype.loadtimeout=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=t.frag,i=n.loader;i&&i.abort(),this.loaders[n.type]&&delete this.loaders[n.type][n.sn],this.hls.trigger(m.a.ERROR,{type:d.b.NETWORK_ERROR,details:d.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:r})},H.prototype.loadprogress=function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,t=t.frag;this.hls.trigger(m.a.FRAG_LOAD_PROGRESS,{frag:t,stats:e,payload:r,networkDetails:n})},H);function K(e){!function(e){if(!(e instanceof K))throw new TypeError("Cannot call a class as a function")}(this);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,q.call(this,e,m.a.KEY_LOADING));return e.loaders={},e.decryptkey=null,e.decrypturl=null,e}var W=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(K,q=l),K.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},l.prototype.destroy.call(this)},K.prototype.onKeyLoading=function(e){var t,r=e.frag,n=r.type,i=this.loaders[n],a=r.decryptdata,s=a.uri;s!==this.decrypturl||null===this.decryptkey?(t=this.hls.config,i&&(w.b.warn("abort previous key loader for type:"+n),i.abort()),r.loader=this.loaders[n]=new t.loader(t),this.decrypturl=s,this.decryptkey=null,n=i=e=void 0,e={url:s,frag:r,responseType:"arraybuffer"},i={timeout:t.fragLoadingTimeOut,maxRetry:t.fragLoadingMaxRetry,retryDelay:t.fragLoadingRetryDelay,maxRetryDelay:t.fragLoadingMaxRetryTimeout},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.loader.load(e,i,n)):this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(m.a.KEY_LOADED,{frag:r}))},K.prototype.loadsuccess=function(e,t,r){r=r.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(m.a.KEY_LOADED,{frag:r})},K.prototype.loaderror=function(e,t){var r=t.frag,n=r.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(m.a.ERROR,{type:d.b.NETWORK_ERROR,details:d.a.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},K.prototype.loadtimeout=function(e,t){var r=t.frag,n=r.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(m.a.ERROR,{type:d.b.NETWORK_ERROR,details:d.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},K);var Y,z="NOT_LOADED",X="APPENDING",Q="PARTIAL",Z="OK",$=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(J,Y=l),J.prototype.destroy=function(){this.fragments=null,this.timeRanges=null,this.config=null,l.prototype.destroy.call(this),Y.prototype.destroy.call(this)},J.prototype.getBufferedFrag=function(t,r){var n=this.fragments,e=Object.keys(n).filter(function(e){e=n[e];if(e.body.type!==r)return!1;if(!e.buffered)return!1;e=e.body;return e.startPTS<=t&&t<=e.endPTS});if(0===e.length)return null;e=e.pop();return n[e].body},J.prototype.detectEvictedFragments=function(n,i){var a,s,o=this;Object.keys(this.fragments).forEach(function(e){var t=o.fragments[e];if(!0===t.buffered){e=t.range[n];if(e){a=e.time;for(var r=0;r<a.length;r++)if(s=a[r],!1===o.isTimeBuffered(s.startPTS,s.endPTS,i)){o.removeFragment(t.body);break}}}})},J.prototype.detectPartialFragments=function(r){var n=this,e=this.getFragmentKey(r),i=this.fragments[e];i&&(i.buffered=!0,Object.keys(this.timeRanges).forEach(function(e){var t;!0===r.hasElementaryStream(e)&&(t=n.timeRanges[e],i.range[e]=n.getBufferedTimes(r.startPTS,r.endPTS,t))}))},J.prototype.getBufferedTimes=function(e,t,r){for(var n,i,a=[],s=!1,o=0;o<r.length;o++){if(n=r.start(o)-this.bufferPadding,i=r.end(o)+this.bufferPadding,n<=e&&t<=i){a.push({startPTS:Math.max(e,r.start(o)),endPTS:Math.min(t,r.end(o))});break}if(e<i&&n<t)a.push({startPTS:Math.max(e,r.start(o)),endPTS:Math.min(t,r.end(o))}),s=!0;else if(t<=n)break}return{time:a,partial:s}},J.prototype.getFragmentKey=function(e){return e.type+"_"+e.relurl},J.prototype.getPartialFragment=function(t){var r,n,i,a=this,s=null,o=0;return Object.keys(this.fragments).forEach(function(e){e=a.fragments[e];a.isPartial(e)&&(n=e.body.startPTS-a.bufferPadding,i=e.body.endPTS+a.bufferPadding,n<=t&&t<=i&&(r=Math.min(t-n,i-t),o<=r&&(s=e.body,o=r)))}),s},J.prototype.getState=function(e){var t=this.getFragmentKey(e),e=this.fragments[t],t=z;return void 0!==e&&(t=e.buffered?!0===this.isPartial(e)?Q:Z:X),t},J.prototype.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},J.prototype.isTimeBuffered=function(e,t,r){for(var n,i,a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,n<=e&&t<=i)return!0;if(t<=n)return!1}return!1},J.prototype.onFragLoaded=function(e){var t=e.frag;isNaN(t.sn)||t.bitrateTest||(e=this.getFragmentKey(t),t={body:t,range:Object.create(null),buffered:!1},this.fragments[e]=t)},J.prototype.onBufferAppended=function(e){var r=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach(function(e){var t=r.timeRanges[e];r.detectEvictedFragments(e,t)})},J.prototype.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},J.prototype.hasFragment=function(e){e=this.getFragmentKey(e);return void 0!==this.fragments[e]},J.prototype.removeFragment=function(e){e=this.getFragmentKey(e);delete this.fragments[e]},J.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},J);function J(e){!function(e){if(!(e instanceof J))throw new TypeError("Cannot call a class as a function")}(this);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,Y.call(this,e,m.a.BUFFER_APPENDED,m.a.FRAG_BUFFERED,m.a.FRAG_LOADED));return t.bufferPadding=.2,t.fragments=Object.create(null),t.timeRanges=Object.create(null),t.config=e.config,t}var ee={search:function(e,t){for(var r,n,i=0,a=e.length-1;i<=a;){var s=t(n=e[r=(i+a)/2|0]);if(0<s)i=1+r;else{if(!(s<0))return n;a=r-1}}return null}};var te=(re.isBuffered=function(e,t){try{if(e)for(var r=e.buffered,n=0;n<r.length;n++)if(t>=r.start(n)&&t<=r.end(n))return!0}catch(e){}return!1},re.bufferInfo=function(e,t,r){try{if(e){for(var n=e.buffered,i=[],a=void 0,a=0;a<n.length;a++)i.push({start:n.start(a),end:n.end(a)});return this.bufferedInfo(i,t,r)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},re.bufferedInfo=function(e,t,r){var n=[],i=void 0,a=void 0,s=void 0,o=void 0,l=void 0;for(e.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end}),l=0;l<e.length;l++){var u,d=n.length;d?(u=n[d-1].end,e[l].start-u<r?e[l].end>u&&(n[d-1].end=e[l].end):n.push(e[l])):n.push(e[l])}for(i=l=0,a=s=t;l<n.length;l++){var h=n[l].start,c=n[l].end;if(h<=t+r&&t<c)a=h,i=(s=c)-t;else if(t+r<h){o=h;break}}return{len:i,start:a,end:s,nextStart:o}},re);function re(){!function(e){if(!(e instanceof re))throw new TypeError("Cannot call a class as a function")}(this)}var ne=r(10),ie=r.n(ne),ae=r(28),se=r.n(ae),oe=r(17);function le(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}var ue=r(9);var de=Object(ue.a)(),he=le();function ce(r,e){!function(e){if(!(e instanceof ce))throw new TypeError("Cannot call a class as a function")}(this),this.hls=r,this.id=e,this.totalDecryptedDataSize=0,this.incomeDataSize=0;var i=this.observer=new ie.a,t=r.config;i.trigger=function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];i.emit.apply(i,[e,e].concat(r))},i.off=function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];i.removeListener.apply(i,[e].concat(r))};var n=function(e,t){(t=t||{}).frag=this.frag,t.id=this.id,r.trigger(e,t)}.bind(this);i.on(m.a.FRAG_DECRYPTED,n),i.on(m.a.FRAG_PARSING_INIT_SEGMENT,n),i.on(m.a.FRAG_PARSING_DATA,n),i.on(m.a.FRAG_PARSED,n),i.on(m.a.ERROR,n),i.on(m.a.FRAG_PARSING_METADATA,n),i.on(m.a.FRAG_PARSING_USERDATA,n),i.on(m.a.INIT_PTS_FOUND,n);var a={mp4:he.isTypeSupported("video/mp4"),mpeg:he.isTypeSupported("audio/mpeg"),mp3:he.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(t.enableWorker&&"undefined"!=typeof Worker){w.b.log("demuxing in webworker");var o=void 0;try{o=this.w=se()(29),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(e){r.trigger(m.a.ERROR,{type:d.b.OTHER_ERROR,details:d.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:a,vendor:s,id:e,config:JSON.stringify(t)})}catch(e){w.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&de.URL.revokeObjectURL(o.objectURL),this.demuxer=new oe.a(i,a,t,s),this.w=void 0}}else this.demuxer=new oe.a(i,a,t,s)}var fe=(ce.prototype.destroy=function(){var e=this.w;e?(e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null):(t=this.demuxer)&&(t.destroy(),this.demuxer=null);var t=this.observer;t&&(t.removeAllListeners(),this.observer=null)},ce.prototype.append=function(e,t,r,n,i,a,s,o,l,u){var d=new Uint8Array(e);this.incomeDataSize=this.incomeDataSize+d.length;var h=this.w,c=isNaN(i.startDTS)?i.start:i.startDTS,f=i.decryptdata,p=this.frag,g=!(p&&i.cc===p.cc),m=!(p&&i.level===p.level),d=p&&i.sn===p.sn+1,p=p&&i.sn===p.sn,p=!m&&(d||p);g&&w.b.log(this.id+":discontinuity detected"),m&&w.b.log(this.id+":switch detected"),this.frag=i,l&&g&&(g=!1,w.b.log(this.id+": skip discontinuity")),h?h.postMessage({cmd:"demux",data:e,decryptdata:f,initSegment:t,audioCodec:r,videoCodec:n,timeOffset:c,discontinuity:g,trackSwitch:m,contiguous:p,duration:a,accurateTimeOffset:s,defaultInitPTS:o,lowLatency:u},e instanceof ArrayBuffer?[e]:[]):(h=this.demuxer)&&h.append(e,f,t,r,n,c,g,m,p,a,s,o,u)},ce.prototype.notifycomplete=function(){var e=this.w;e?e.postMessage({cmd:"complete"}):(e=this.demuxer)&&e.notifycomplete()},ce.prototype.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":de.URL.revokeObjectURL(this.w.objectURL);break;case m.a.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));case m.a.FRAG_DECRYPTED:this.totalDecryptedDataSize=this.incomeDataSize;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},ce);function pe(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}}function ge(e,t,r){var n=e[t],i=e[r],e=i.startPTS;isNaN(e)?i.start=t<r?n.start+n.duration:Math.max(n.start-i.duration,0):t<r?n.duration<0&&w.b.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!"):i.duration<0&&w.b.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")}function me(e,t,r,n,i,a){var s=r;isNaN(t.startPTS)||(o=Math.abs(t.startPTS-r),isNaN(t.deltaPTS)?t.deltaPTS=o:t.deltaPTS=Math.max(o,t.deltaPTS),s=Math.max(r,t.startPTS),r=Math.min(r,t.startPTS),n=Math.max(n,t.endPTS),i=Math.min(i,t.startDTS),a=Math.max(a,t.endDTS));var o=r-t.start;t.start=t.startPTS=r,t.maxStartPTS=s,t.endPTS=n,t.startDTS=i,t.endDTS=a;i=t.sn;if(!e||i<e.startSN||i>e.endSN)return 0;var a=void 0,l=void 0,u=void 0,a=i-e.startSN;for((l=e.fragments)[a]=t,u=a;0<u;u--)ge(l,u,u-1);for(u=a;u<l.length-1;u++)ge(l,u,u+1);return e.PTSKnown=!0,o}function ve(e,t){var r=Math.max(e.startSN,t.startSN)-t.startSN,n=Math.min(e.endSN,t.endSN)-t.startSN,i=t.startSN-e.startSN,a=e.fragments,s=t.fragments,o=0,l=void 0;if(t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment),n<r){if(0===t.startSN&&0<a.length)for(var u=a[a.length-1].cc,d=0;d<s.length;d++)s[d].cc+=u+1;t.PTSKnown=!1}else{for(var h=r;h<=n;h++){var c=a[i+h],f=s[h];f&&c&&(o=c.cc-f.cc,isNaN(c.startPTS)||(f.start=f.startPTS=c.startPTS,f.endPTS=c.endPTS,f.duration=c.duration,f.backtracked=c.backtracked,f.dropped=c.dropped,l=f))}if(o)for(w.b.log("discontinuity sliding from playlist, take drift into account"),h=0;h<s.length;h++)s[h].cc+=o;if(l)me(t,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS);else if(0<=i&&i<a.length)for(var p=a[i].start,h=0;h<s.length;h++)s[h].start+=p;t.PTSKnown=e.PTSKnown}}var ye,be,Ee,Te={toString:function(e){for(var t="",r=e.length,n=0;n<r;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}};function Se(e,t){e=e.fragments,t=t.fragments;if(t.length&&e.length){t=function(e,t){for(var r=null,n=0;n<e.length;n+=1){var i=e[n];if(i&&i.cc===t){r=i;break}}return r}(e,t[0].cc);if(t&&(!t||t.startPTS))return t;w.b.log("No frag in previous level to align on")}else w.b.log("No fragments to align")}function _e(e,t,r){var n,i,a,s;i=e,a=r,s=!1,(e=t)&&e.details&&a&&(a.endCC>a.startCC||i&&i.cc<a.startCC)&&(s=!0),s&&(n=Se(t.details,r))&&(w.b.log("Adjusting PTS using last level due to CC increase within current level"),function(e,t){for(var r=t.fragments,n=0,i=r.length;n<i;n++)we(r[n],e);t.fragmentHint&&we(t.fragmentHint,e),t.alignedSliding=!0}(n.start,r))}function we(e,t){e&&(t=e.start+t,e.start=e.startPTS=t,e.endPTS=t+e.duration)}function Le(e){!function(e){if(!(e instanceof Le))throw new TypeError("Cannot call a class as a function")}(this);for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,ye.call.apply(ye,[this,e].concat(r)));return e._tickInterval=null,e._tickTimer=null,e._tickCallCount=0,e._boundTick=e.tick.bind(e),e}function Ae(e){return be.apply(this,arguments)}function Re(){return Ee.apply(this,arguments)}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(Le,ye=l),Le.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},Le.prototype.hasInterval=function(){return!!this._tickInterval},Le.prototype.hasNextTick=function(){return!!this._tickTimer},Le.prototype.setInterval=(be=function(e){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,e),!0)},Ae.toString=function(){return be.toString()},Ae),Le.prototype.clearInterval=(Ee=function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),!(this._tickInterval=null))},Re.toString=function(){return Ee.toString()},Re),Le.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),!(this._tickTimer=null))},Le.prototype.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},Le.prototype.doTick=function(){},n=Le;function De(e,t,r){var n=0<arguments.length&&void 0!==e?e:0,e=1<arguments.length&&void 0!==t?t:0,t=0;return r.programDateTime&&(r=Date.parse(r.programDateTime),isNaN(r)||(t=1e3*e+r-1e3*n)),t}function ke(e,t){var r=1<arguments.length&&void 0!==t?t:null;if(!Array.isArray(e)||!e.length||null===r)return null;if(r<e[0].pdt)return null;if(r>=e[e.length-1].endPdt)return null;for(var n=0;n<e.length;++n){var i=e[n];if(r<i.endPdt){var a=e[n+1];return a?r<(i.endPdt+i.pdt)/2?i:a:i}}return null}function xe(e,t,r,n,i){var a=2<arguments.length&&void 0!==r?r:0,r=3<arguments.length&&void 0!==n?n:0,n=4<arguments.length&&void 0!==i?i:0,i=void 0,e=e?t[e.sn-t[0].sn+1]:null;return a<r&&(r-n<a&&(n=0),i=e&&!Pe(a,n,e)?e:ee.search(t,Pe.bind(null,a,n))),i}function Pe(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=arguments[2],t=Math.min(t,r.duration+(r.deltaPTS||0));return r.start+r.duration-t<=e?1:r.start-t>e&&r.start?-1:0}function Oe(e,t,r,n){!function(e){if(!(e instanceof Oe))throw new TypeError("Cannot call a class as a function")}(this),this.media=e,this.stallThresholdSeconds_=t,this.maxBufferHole_=r,this.onStall_=n,this.wasMakingProgress_=this.shouldBeMakingProgress(),this.value_=this.getPresentationSeconds(),this.lastUpdateSeconds_=this.getWallSeconds()}var Ie=(Oe.prototype.poll=function(){var e=this.shouldBeMakingProgress(),t=this.getPresentationSeconds(),r=this.getWallSeconds();this.value_===t&&this.wasMakingProgress_===e||(this.lastUpdateSeconds_=r,this.value_=t,this.wasMakingProgress_=e);r-=this.lastUpdateSeconds_;r>=this.stallThresholdSeconds_&&e&&this.onStall_(this.value_,r)},Oe.prototype.getPresentationSeconds=function(){return this.media.currentTime},Oe.prototype.getWallSeconds=function(){return Date.now()/1e3},Oe.prototype.shouldBeMakingProgress=function(){var e=this.media;if(e.ended||e.paused||0===e.playbackRate)return!1;if(null==e.buffered||!e.buffered.length)return!1;var t=this.getPresentationSeconds();return(!e.seeking||!te.isBuffered(e,t))&&this.hasContentFor_()},Oe.prototype.hasContentFor_=function(){var e=this.media,t=this.getPresentationSeconds();return.5<te.bufferInfo(e,t,this.maxBufferHole_).len},Oe);function Ce(e,t,r,n){!function(e){if(!(e instanceof Ce))throw new TypeError("Cannot call a class as a function")}(this),this.config=e,this.media=t,this.fragmentTracker=r,this.hls=n,this.stallReported=!1,this.stallDetector=new Ie(t,e.highBufferWatchdogPeriod,e.maxBufferHole,this._tryNudgeBuffer.bind(this))}var Fe=(Ce.prototype.poll=function(e,t){var r=this.hls,n=this.media,i=n.currentTime,a=window.performance.now(),s=te.bufferInfo(n,i,0);if(this.stallDetector.poll(),i!==e&&.1<s.len)return this.stallReported&&(w.b.warn("playback not stuck anymore @"+i+", after "+Math.round(a-this.stalled)+"ms"),this.stallReported=!1,r.trigger(m.a.STALL_RECOVER,{stallDuration:Math.round(a-this.stalled)})),this.stalled=null,void(this.nudgeRetry=0);n.ended||!n.buffered.length||2<n.readyState||n.seeking&&te.isBuffered(n,i)||(i=a-this.stalled,this.stalled?(1e3<=i&&this._reportStall(s.len),this._tryFixBufferStall()):this.stalled=a)},Ce.prototype._tryFixBufferStall=function(){var e=this.fragmentTracker,t=this.media.currentTime,t=e.getPartialFragment(t);(this.hls.config.skipBufferHole||t)&&this._trySkipBufferHole(t)},Ce.prototype._reportStall=function(e){var t=this.hls,r=this.media,n=this.stallReported,i=Te.toString(r.buffered),a=r.readyState;n||(this.stallReported=!0,w.b.warn("Playback stalling at @"+r.currentTime+" due to low buffer"),t.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:e,bufferLevel:e,currentTime:r.currentTime.toFixed(1),buffered:i,readyState:a}))},Ce.prototype._trySkipBufferHole=function(e){for(var t=this.hls,r=this.media,n=r.currentTime,i=0,a=0;a<r.buffered.length;a++){var s=r.buffered.start(a);if(i-.5<=n&&n<s)return r.currentTime=Math.max(s,r.currentTime+.1),w.b.warn("skipping hole, adjusting currentTime from "+n+" to "+r.currentTime+": readyState="+r.readyState),this.stalled=null,void t.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+r.currentTime,frag:e});i=r.buffered.end(a)}},Ce.prototype._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,n=r.currentTime,i=Te.toString(r.buffered),a=r.readyState,s=(this.nudgeRetry||0)+1;(this.nudgeRetry=s)<e.nudgeMaxRetry?(s=n+s*e.nudgeOffset,w.b.log("adjust currentTime from "+n+" to "+s+": readyState="+a+" buffered="+i),r.currentTime=s,t.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.BUFFER_NUDGE_ON_STALL,fatal:!1,readyState:a,currentTime:n,targetTime:s,buffered:i})):(w.b.error("still stuck in high buffer @"+n+" after "+e.nudgeMaxRetry+", raise fatal error: readyState="+a+" buffered="+i),t.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.BUFFER_STALLED_ERROR,fatal:!0,readyState:a,currentTime:n,buffered:i}))},Ce),f=function(e,t,r){return t&&Me(e.prototype,t),r&&Me(e,r),e};function Me(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ne,Ue={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"};function Be(e,t){!function(e){if(!(e instanceof Be))throw new TypeError("Cannot call a class as a function")}(this);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,Ne.call(this,e,m.a.MEDIA_ATTACHED,m.a.MEDIA_DETACHING,m.a.MANIFEST_LOADING,m.a.MANIFEST_PARSED,m.a.LEVEL_LOADED,m.a.KEY_LOADED,m.a.FRAG_LOADED,m.a.FRAG_LOAD_EMERGENCY_ABORTED,m.a.FRAG_PARSING_INIT_SEGMENT,m.a.FRAG_PARSING_DATA,m.a.FRAG_PARSED,m.a.ERROR,m.a.AUDIO_TRACK_SWITCHING,m.a.AUDIO_TRACK_SWITCHED,m.a.BUFFER_CREATED,m.a.BUFFER_APPENDED,m.a.BUFFER_FLUSHED));return r.fragmentTracker=t,r.config=e.config,r.audioCodecSwap=!1,r._state=Ue.STOPPED,r.stallReported=!1,r.gapController=null,r.pendingDownloadFrags=[],r.pendingParseFragDatas=[],r.fragCurrent=null,r._isLiveEnd=!1,r.ableToStart=!1,r.pendingDownloadFragsOnError=null,r.pendingParseFragsOnError=null,r.lowLatencyFirstM3u8FinishTime=null,r}var Ge=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Be,Ne=n),Be.prototype.onHandlerDestroying=function(){this.stopLoad(),Ne.prototype.onHandlerDestroying.call(this)},Be.prototype.onHandlerDestroyed=function(){this.state=Ue.STOPPED,this.fragmentTracker=null,Ne.prototype.onHandlerDestroyed.call(this)},Be.prototype.getFirstRequestFrag=function(){for(var e=1/0,t=null,r=0;r<this.pendingDownloadFrags.length;r++){var n=this.pendingDownloadFrags[r];n.sn<e&&(e=n.sn,t=n)}return t},Be.prototype.startLoad=function(e){var t,r,n;this.hls.config.lowLatencyEnabled&&(this.ableToStart=!1,this.lowLatencyFirstM3u8FinishTime=null),this.levels?(t=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(n=r.startLevel)&&(n=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1),0<t&&-1===e&&(w.b.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=Ue.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()):(this.forceStartLoad=!0,this.state=Ue.STOPPED)},Be.prototype.stopLoad=function(){var t=this;this.pendingDownloadFrags.forEach(function(e){e&&(e.loader&&e.loader.abort(),t.fragmentTracker.removeFragment(e),w.b.log("stop load, cancel downloading frag "+e.sn))}),this.pendingDownloadFrags=[],this.pendingParseFragDatas=[],this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=Ue.STOPPED,this.forceStartLoad=!1},Be.prototype.doTick=function(){switch(this.state){case Ue.BUFFER_FLUSHING:this.fragLoadError=0;break;case Ue.IDLE:this._doTickIdle();break;case Ue.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=Ue.IDLE);break;case Ue.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),e=this.retryDate;(!e||e<=t||this.media&&this.media.seeking)&&(w.b.log("mediaController: retryDate reached, switch back to IDLE state, seeking="+(this.media&&this.media.seeking)),this.state=Ue.IDLE);break;case Ue.ERROR:case Ue.STOPPED:case Ue.FRAG_LOADING:case Ue.PARSING:case Ue.PARSED:case Ue.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},Be.prototype._getAvailableFragConnection=function(){return this.hls.config.fragDownloadParallelNb-this.pendingDownloadFrags.length},Be.prototype._getLastRequestFrag=function(){for(var e=-1,t=null,r=0;r<this.pendingDownloadFrags.length;r++){var n=this.pendingDownloadFrags[r];n.sn>e&&(e=n.sn,t=n)}return this.fragPrevious&&this.fragPrevious.sn>e&&(e=this.fragPrevious.sn,t=this.fragPrevious),t},Be.prototype._doTickIdle=function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&t.startFragPrefetch)){var n=this._getAvailableFragConnection();if((this.loadedmetadata||!(n<=1))&&!(n<=0)){var i=void 0,i=this.loadedmetadata?r.currentTime:this.nextLoadPosition,a=e.nextLoadLevel,s=this.levels[a];if(s){var o=s.bitrate,n=void 0,n=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength;n=Math.min(n,t.maxMaxBufferLength);for(var s=s.details,l=te.bufferInfo(this.mediaBuffer||r,i,s&&s.live?t.maxBufferHole:0),t=l.len,u=0;u<this.pendingDownloadFrags.length;u++)l.end+=this.pendingDownloadFrags[u].duration;if(n<=t)w.b.debug("buffer length "+t+" greater than maxBufLen "+n);else{if(w.b.trace("buffer length of "+t.toFixed(3)+" is below max of "+n.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=a,!s||s.live&&this.levelLastLoaded!==a)return w.b.log("level switched. clear all frag queue."),this._resetFragQueue(),void(this.state=Ue.WAITING_LEVEL);a=this.getBufferedFrag(i);if((!s.live||this.isLiveEnd)&&a&&!a.backtracked&&a.sn===s.endSN&&!l.nextStart){r=Math.min(r.duration,a.start+a.duration),a=!s.live&&r-Math.max(l.end,a.start)<=Math.max(.2,a.duration);if(this.hls.config.livePlaybackMode&&!(1<this.media.playbackRate||s.isLiveEnd))return;if(s.live||a){a={isLiveEnd:s.isLiveEnd};return this.altAudio&&(a.type="video"),this.hls.trigger(m.a.BUFFER_EOS,a),void(this.state=Ue.ENDED)}}this._fetchPayloadOrEos(i,l,s)}}}}},Be.prototype._fetchPayloadOrEos=function(e,t,r){var n=this._getLastRequestFrag(),i=this.level,a=r.fragments,s=a.length,o=this.hls.config;if(0!==s){var l=a[0].start,u=a[s-1].start+a[s-1].duration,d=t.end,h=void 0;if(r.initSegment&&!r.initSegment.data)h=r.initSegment;else if(r.live){t=this.config.initialLiveManifestSize;if(s<t)return void w.b.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+t);if(!1===this.ableToStart&&o.lowLatencyEnabled)return void w.b.info("cannot start playback of a level, reason: ableToStart=false");if(null===(h=this._ensureFragmentAtLivePoint(r,d,l,u,n,a,s)))return}else d<l&&(h=a[0]);(h=h||this._findFragment(l,r.live?n:null,s,a,d,u,r))&&(h.encrypted?(w.b.log("Loading key for "+h.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+i),this._loadKey(h)):(u=this.pendingDownloadFrags.map(function(e){return e.sn}).join(),w.b.log("Loading "+h.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+i+", currentTime:"+e.toFixed(3)+",bufferEnd:"+d.toFixed(3)+" fragPrevious: "+(n?n.sn:"none")+" queueFrag: "+u),this._loadFragment(h)))}},Be.prototype._ensureFragmentAtLivePoint=function(e,t,r,n,i,a,s){var o=this.hls.config,l=this.media,u=void 0,d=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*e.averagetargetduration;return t<Math.max(r-o.maxFragLookUpTolerance,n-d)&&(r=this.liveSyncPosition=this.computeLivePosition(r,e),w.b.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+r.toFixed(3)),t=r,l&&l.readyState&&l.duration>r&&(l.currentTime=r),this.nextLoadPosition=r),e.PTSKnown&&n<t&&l&&l.readyState?null:(this.startFragRequested&&!e.PTSKnown&&(i&&(e.programDateTime?u=ke(a,i.endPdt+1):((l=i.sn+1)>=e.startSN&&l<=e.endSN&&(e=a[l-e.startSN],i.cc===e.cc&&(u=e,w.b.log("live playlist, switching playlist, load frag with next SN: "+u.sn))),u||(u=ee.search(a,function(e){return i.cc-e.cc}))&&w.b.log("live playlist, switching playlist, load frag with same CC: "+u.sn))),u||(u=a[Math.min(s-1,Math.round(s/2))],w.b.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))),u)},Be.prototype._findFragment=function(e,t,r,n,i,a,s){var o,l=this.hls.config,u=void 0,d=void 0;return i<a?s.programDateTime?(d=ke(n,De(e,i,s)))&&!Pe(i,l.maxFragLookUpTolerance,d)||(d=xe(t,n,i,a,l.maxFragLookUpTolerance)):d=xe(t,n,i,a,s.live?l.maxFragLookUpTolerance:.25):d=n[r-1],d&&(o=(u=d).sn-s.startSN,e=t&&u.level===t.level,r=n[o-1],d=n[1+o],t&&u.sn===t.sn&&(e&&!u.backtracked?u.sn<s.endSN?(s=t.deltaPTS)&&s>l.maxBufferHole&&t.dropped&&o?(u=r,w.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(u=d,w.b.log("SN just loaded, load next one: "+u.sn)):u=null:u.backtracked&&(d&&d.backtracked?(w.b.warn("Already backtracked from fragment "+d.sn+", will not backtrack to fragment "+u.sn+". Loading fragment "+d.sn),u=d):(w.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),u.dropped=0,r?(u=r).backtracked=!0:o&&(u=null))))),u},Be.prototype._loadKey=function(e){this.state=Ue.KEY_LOADING,this.hls.trigger(m.a.KEY_LOADING,{frag:e})},Be.prototype._isFragInPendingDownloadQueue=function(e){return 0<=this.pendingDownloadFrags.map(function(e){return e.sn}).indexOf(e.sn)},Be.prototype._loadFragment=function(e){var t;this._isFragInPendingDownloadQueue(e)?(t=this.pendingDownloadFrags.map(function(e){return e.sn}).join(),w.b.warn("Abort Loading frag "+e.sn+", because frag is loading now, queueFrag: "+t)):(t=this.fragmentTracker.getState(e),this.startFragRequested=!0,isNaN(e.sn)||e.bitrateTest||(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===z||t===Q?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(m.a.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new fe(this.hls,"main")),this.pendingDownloadFrags.push(e)):t===X&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e))},Be.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,j.LevelType.MAIN)},Be.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},Be.prototype._checkFragmentChanged=function(){var e=void 0,t=void 0,r=this.media;r&&r.readyState&&!1===r.seeking&&((t=r.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),te.isBuffered(r,t)?e=this.getBufferedFrag(t):te.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),!e||(t=e)!==this.fragPlaying&&(this.hls.trigger(m.a.FRAG_CHANGED,{frag:t}),e=t.level,this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(m.a.LEVEL_SWITCHED,{level:e}),this.fragPlaying=t))},Be.prototype.immediateLevelSwitch=function(){var e;w.b.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,t=void 0,(e=this.media)?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t);var t=this.fragCurrent;t&&t.loader&&t.loader.abort(),w.b.log("immediate switch level, reset frag queue"),this._resetFragQueue(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},Be.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,te.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},Be.prototype.nextLevelSwitch=function(){var e,t,r,n,i=this.media;i&&i.readyState&&(r=n=t=void 0,(n=this.getBufferedFrag(i.currentTime))&&1<n.startPTS&&this.flushMainBuffer(0,n.startPTS-1),t=i.paused?0:(e=this.hls.nextLoadLevel,n=this.levels[e],(e=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*e)+1:0),(r=(r=this.getBufferedFrag(i.currentTime+t))&&this.followingBufferedFrag(r))&&((t=this.fragCurrent)&&t.loader&&t.loader.abort(),w.b.log("manual switch nextLevel. reset frag queue"),this._resetFragQueue(),this.fragCurrent=null,this.flushMainBuffer(r.maxStartPTS,Number.POSITIVE_INFINITY)))},Be.prototype.flushMainBuffer=function(e,t){this.state=Ue.BUFFER_FLUSHING;t={startOffset:e,endOffset:t};this.altAudio&&(t.type="video"),this.hls.trigger(m.a.BUFFER_FLUSHING,t)},Be.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);e=this.config;this.levels&&e.autoStartLoad&&this.hls.startLoad(e.startPosition),this.gapController=new Fe(e,t,this.fragmentTracker,this.hls)},Be.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(w.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},Be.prototype.onMediaSeeking=function(){var e=this.media,t=e?e.currentTime:void 0,r=this.config;isNaN(t)||w.b.log("media seeking to "+t.toFixed(3));var n,i=this.mediaBuffer||e,a=te.bufferInfo(i,t,this.config.maxBufferHole);this.state===Ue.FRAG_LOADING&&(n=this.fragCurrent,0===a.len&&n&&(i=r.maxFragLookUpTolerance,r=n.start-i,i=n.start+n.duration+i,t<r||i<t?(n.loader&&(w.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),n.loader.abort()),this._resetFragQueue(),this.fragCurrent=null,this.fragPrevious=null,this.state=Ue.IDLE):w.b.log("seeking outside of buffer but within currently loaded fragment range"))),this.state===Ue.ENDED&&(0===a.len&&(this.fragPrevious=0),this.state=Ue.IDLE),e&&(this.lastCurrentTime=t),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()},Be.prototype.onMediaSeeked=function(){var e=this.media,e=e?e.currentTime:void 0;isNaN(e)||w.b.log("media seeked to "+e.toFixed(3)),this.tick()},Be.prototype.onMediaEnded=function(){w.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},Be.prototype.onManifestLoading=function(){w.b.log("trigger BUFFER_RESET"),this.hls.trigger(m.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},Be.prototype.onManifestParsed=function(e){var t=!1,r=!1,n=void 0;e.levels.forEach(function(e){(n=e.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(t=!0),-1!==n.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=t&&r,this.audioCodecSwitch&&w.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},Be.prototype.onLevelLoaded=function(e){var t,r,n=e.details,i=e.level,a=this.levels[this.levelLastLoaded],s=this.levels[i],o=n.totalduration,l=0,u=this.hls.config;w.b.log("level "+i+" loaded ["+n.startSN+","+n.endSN+"],duration:"+o),n.live?(t=s.details,u.lowLatencyEnabled&&null===this.lowLatencyFirstM3u8FinishTime&&(this.lowLatencyFirstM3u8FinishTime=window.performance.now()),t&&n.endSN>t.endSN&&u.lowLatencyEnabled&&!this.ableToStart&&(w.b.info("able to start, lastSn="+t.endSN+" nowSn="+n.endSN),this.hls.trigger(m.a.LOW_LATENCY_ABLE_TO_START,{cost:Math.round(window.performance.now()-this.lowLatencyFirstM3u8FinishTime),ts_duration:n.averagetargetduration}),this.ableToStart=!0,this.startUpM3u8Trequest=e.stats.trequest),r=window.performance.now(),!1===this.ableToStart&&u.lowLatencyEnabled&&this.lowLatencyFirstM3u8FinishTime&&r-this.lowLatencyFirstM3u8FinishTime>u.lowLatencyStartUpMaxWaitTime&&(w.b.info("stop wait for new fragment, start playback now, reason: timeout="+u.lowLatencyStartUpMaxWaitTime),this.hls.trigger(m.a.LOW_LATENCY_WAIT_TIMEOUT,{timeout:u.lowLatencyStartUpMaxWaitTime,ts_duration:n.averagetargetduration}),this.ableToStart=!0,this.startUpM3u8Trequest=e.stats.trequest),t&&n.endSN>t.endSN&&(e=(r=this.media).currentTime,e=te.bufferInfo(r,e,0),w.b.info("discover new ts, lastSn="+t.endSN+" nowSn="+n.endSN+" bufferLen="+e.len)),t&&0<n.fragments.length?(ve(t,n),l=n.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(l,t),n.PTSKnown&&!isNaN(l)?w.b.log("live playlist sliding:"+l.toFixed(3)):(w.b.log("live playlist - outdated PTS, unknown sliding"),_e(this.fragPrevious,a,n))):(w.b.log("live playlist - first load, unknown sliding"),n.PTSKnown=!1,_e(this.fragPrevious,a,n))):n.PTSKnown=!1,s.details=n,this.levelLastLoaded=i,this.hls.trigger(m.a.LEVEL_UPDATED,{details:n,level:i}),!1===this.startFragRequested&&(u.lowLatencyEnabled&&n.live&&!this.ableToStart||(-1!==this.startPosition&&-1!==this.lastCurrentTime||(u=n.startTimeOffset,isNaN(u)?n.live?(this.startPosition=this.computeLivePosition(l,n),w.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(u<0&&(w.b.log("negative start time offset "+u+", count from end of last fragment"),u=l+o+u),w.b.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u),this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition)),this.state===Ue.WAITING_LEVEL&&(this.state=Ue.IDLE),this.tick()},Be.prototype.onKeyLoaded=function(){this.state===Ue.KEY_LOADING&&(this.state=Ue.IDLE,this.tick())},Be.prototype.onFragLoaded=function(e){var s=this,t=e.frag,r=this.levels[t.level].details;w.b.log("Loaded  "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+t.level),this.bitrateTest=!1,this.fragLoadError=0,this.pendingParseFragDatas.push(e),this.pendingParseFragDatas.sort(function(e,t){var r=e.frag.sn,n=t.frag.sn,i=0,a=0;return s.pendingDownloadFrags.forEach(function(e,t){e.sn===r&&(i=t),e.sn===n&&(a=t)}),i-a}),this._consumeLoadedFrag()},Be.prototype._consumeLoadedFrag=function(){var e=void 0;if(null===this.fragCurrent&&0<this.pendingParseFragDatas.length){var t=this.pendingParseFragDatas[0].frag;if(!this.pendingDownloadFrags[0]||this.pendingDownloadFrags[0].sn!==t.sn)return this.pendingDownloadFragsOnError=this.pendingDownloadFrags.map(function(e){return e.sn}),void(this.pendingParseFragsOnError=this.pendingParseFragDatas.map(function(e){return e&&e.frag&&e.frag.sn}));var r,n,i=(e=this.pendingParseFragDatas.shift()).frag,a=e.stats,s=this.levels[i.level],o=s.details;this.fragCurrent=i,this.stats=a,!0===i.bitrateTest&&this.hls.nextLoadLevel?(this.state=Ue.IDLE,this.startFragRequested=!1,a.tparsed=a.tbuffered=window.performance.now(),this.hls.trigger(m.a.FRAG_BUFFERED,{stats:a,frag:i,id:"main"}),this.tick()):"initSegment"===i.sn?(this.state=Ue.IDLE,a.tparsed=a.tbuffered=window.performance.now(),o.initSegment.data=e.payload,this.hls.trigger(m.a.FRAG_BUFFERED,{stats:a,frag:i,id:"main"}),this.tick()):(this.state=Ue.PARSING,r=o.totalduration,n=i.level,t=i.sn,a=this.config.defaultAudioCodec||s.audioCodec,this.audioCodecSwap&&(w.b.log("swapping playlist audio codec"),void 0===a&&(a=this.lastAudioCodec),a=a&&(-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,w.b.log("Parsing "+t+" of ["+o.startSN+" ,"+o.endSN+"],level "+n+", cc "+i.cc),t=(t=this.demuxer)||(this.demuxer=new fe(this.hls,"main")),n=!((n=this.media)&&n.seeking)&&(o.PTSKnown||!o.live),o=o.initSegment?o.initSegment.data:[],t.append(e.payload,o,a,s.videoCodec,i,r,n,void 0,this.hls.config.skipDiscontinuity,!1),t.notifycomplete())}},Be.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===Ue.PARSING){var n=e.tracks,i=void 0,a=void 0;for(i in n.audio&&this.altAudio&&delete n.audio,(a=n.audio)&&(r=this.levels[this.level].audioCodec,t=navigator.userAgent.toLowerCase(),r&&this.audioCodecSwap&&(w.b.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===t.indexOf("firefox")&&(r="mp4a.40.5"),-1!==t.indexOf("android")&&"audio/mpeg"!==a.container&&(r="mp4a.40.2",w.b.log("Android: force audio codec to "+r)),a.levelCodec=r,a.id=e.id),(a=n.video)&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=e.id),this.hls.trigger(m.a.BUFFER_CODECS,n),n){a=n[i],w.b.log("main track:"+i+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var s=a.initSegment;s&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(m.a.BUFFER_APPENDING,{type:i,data:s,parent:"main",content:"initSegment"}))}this.tick()}},Be.prototype.onFragParsingData=function(r){var n=this,i=this.fragCurrent,a=r.frag;if(i&&"main"===r.id&&a.sn===i.sn&&a.level===i.level&&("audio"!==r.type||!this.altAudio)&&this.state===Ue.PARSING){var s=this.levels[this.level],e=i;if(isNaN(r.endPTS)&&(r.endPTS=r.startPTS+i.duration,r.endDTS=r.startDTS+i.duration),!0===r.hasAudio&&e.addElementaryStream(A.ElementaryStreamTypes.AUDIO),!0===r.hasVideo&&e.addElementaryStream(A.ElementaryStreamTypes.VIDEO),w.b.log("Parsed "+r.type+",PTS:["+r.startPTS.toFixed(3)+","+r.endPTS.toFixed(3)+"],DTS:["+r.startDTS.toFixed(3)+"/"+r.endDTS.toFixed(3)+"],nb:"+r.nb+",dropped:"+(r.dropped||0)),"video"===r.type)if(e.dropped=r.dropped,e.dropped)if(e.backtracked)w.b.warn("Already backtracked on this fragment, appending with the gap",e.sn);else{var t=s.details;if(!t||e.sn!==t.startSN)return w.b.warn("missing video frame(s), backtracking fragment",e.sn),this.fragmentTracker.removeFragment(e),e.backtracked=!0,this.nextLoadPosition=r.startPTS,this.state=Ue.IDLE,this.fragPrevious=e,void this.tick();w.b.warn("missing video frame(s) on first frag, appending with gap",e.sn)}else e.backtracked=!1;var e=me(s.details,e,r.startPTS,r.endPTS,r.startDTS,r.endDTS),o=this.hls;o.trigger(m.a.LEVEL_PTS_UPDATED,{details:s.details,level:this.level,drift:e,type:r.type,start:r.startPTS,end:r.endPTS}),[r.data1,r.data2].forEach(function(e){var t;e&&e.length&&n.state===Ue.PARSING&&(n.appended=!0,n.pendingBuffering=!0,t=i&&a.cc===i.cc,o.trigger(m.a.BUFFER_APPENDING,{type:r.type,data:e,parent:"main",content:"data",levelDetails:s.details,discontinuity:t}))}),this.tick()}},Be.prototype.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===Ue.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=Ue.PARSED,this._checkAppendedParsed())},Be.prototype.onAudioTrackSwitching=function(e){var t,r=!!e.url,e=e.id;r||(this.mediaBuffer!==this.media&&(w.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(t=this.fragCurrent).loader&&(w.b.log("switching to main audio track, cancel main fragment load"),t.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Ue.IDLE),(t=this.hls).trigger(m.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),t.trigger(m.a.AUDIO_TRACK_SWITCHED,{id:e}),this.altAudio=!1)},Be.prototype.onAudioTrackSwitched=function(e){var t=e.id,e=!!this.hls.audioTracks[t].url;!e||(t=this.videoBuffer)&&this.mediaBuffer!==t&&(w.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t),this.altAudio=e,this.tick()},Be.prototype.onBufferCreated=function(e){var t,r=e.tracks,n=void 0,i=void 0,a=!1;for(t in r){var s=r[t];"main"===s.id?(n=s,"video"===(i=t)&&(this.videoBuffer=r[t].buffer)):a=!0}a&&n?(w.b.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},Be.prototype.onBufferAppended=function(e){var t;"main"===e.parent&&((t=this.state)!==Ue.PARSING&&t!==Ue.PARSED||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed()))},Be.prototype._checkAppendedParsed=function(){var e,t;this.state!==Ue.PARSED||this.appended&&this.pendingBuffering||(e=this.fragCurrent)&&(t=this.mediaBuffer||this.media,w.b.log("main buffered : "+Te.toString(t.buffered)),this.fragPrevious=e,(t=this.stats).tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*t.total/(t.tbuffered-t.tfirst)),this.hls.trigger(m.a.FRAG_BUFFERED,{stats:t,frag:e,id:"main"}),this.fragCurrent=null,this._removePendingFrag(e),0<this.pendingParseFragDatas.length?this._consumeLoadedFrag():(this.state=Ue.IDLE,this.tick()))},Be.prototype._removePendingFrag=function(e){e=this.pendingDownloadFrags.map(function(e){return e.sn}).indexOf(e.sn);0<=e&&this.pendingDownloadFrags.splice(e,1)},Be.prototype._removePendingParseFragData=function(e){e=this.pendingParseFragDatas.map(function(e){return e.frag.sn}).indexOf(e);return 0<=e&&(this.pendingParseFragDatas.splice(e,1),!0)},Be.prototype._rearrangeFragQueueWhenFragLoadFail=function(e){var t=this.pendingDownloadFrags.map(function(e){return e.sn}).indexOf(e.sn);if(t<0)w.b.error("frag "+e.sn+" loading failed, but this frag doesn't exist in pending download queue");else{w.b.log("frag "+e.sn+"(idx="+t+") loading failed, pendingDownloadFrags="+this.pendingDownloadFrags.map(function(e){return e.sn}).join()+", pendingParseFragDatas="+this.pendingParseFragDatas.join());for(var r=this.pendingDownloadFrags.length-1;t<=r;r--){var n=this.pendingDownloadFrags[r];n&&(n.loader&&(w.b.log("frag "+e.sn+" loading failed, cancel downloading frag "+n.sn),n.loader.abort()),w.b.log("frag "+e.sn+" loading failed, remove frag "+n.sn+" from downloading frag queue"),this._removePendingFrag(n),this._removePendingParseFragData(n.sn)&&w.b.log("frag "+e.sn+" loading failed, remove frag "+n.sn+" from wait to parse queue"),this.fragmentTracker.removeFragment(n))}}},Be.prototype.onError=function(e){var t,r=e.frag;switch(e.details){case d.a.FRAG_LOAD_ERROR:case d.a.FRAG_LOAD_TIMEOUT:case d.a.KEY_LOAD_ERROR:case d.a.KEY_LOAD_TIMEOUT:r&&"main"===r.type&&!e.fatal&&(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(this._rearrangeFragQueueWhenFragLoadFail(r),this.state===Ue.IDLE?(t=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),this.retryDate=window.performance.now()+t,w.b.warn("mediaController: frag loading failed, retry in "+t+" ms"),this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=Ue.FRAG_LOADING_WAITING_RETRY):w.b.warn("mediaController: frag loading failed, current state is "+this.state+", no need to change state to FRAG_LOADING_WAITING_RETRY")):(w.b.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Ue.ERROR));break;case d.a.LEVEL_LOAD_ERROR:case d.a.LEVEL_LOAD_TIMEOUT:this.state!==Ue.ERROR&&(e.fatal?(this.state=Ue.ERROR,w.b.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==Ue.WAITING_LEVEL||(this.state=Ue.IDLE));break;case d.a.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==Ue.PARSING&&this.state!==Ue.PARSED||(!!this.media&&te.isBuffered(this.media,this.media.currentTime)&&te.isBuffered(this.media,this.media.currentTime+.5)?(this._reduceMaxBufferLength(this.config.maxBufferLength),this._resetFragQueue(),this.fragCurrent=null,this.state=Ue.IDLE):(w.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}},Be.prototype._resetFragQueue=function(){w.b.log("reset frag queue, clear pendingDownloadFrags and pendingParseFragDatas");for(var e=0;e<this.pendingDownloadFrags.length;e++){var t=this.pendingDownloadFrags[e];t&&(t.loader&&(w.b.log("reset frag queue, cancel downloading frag "+t.sn+" and remove from pending download queue"),t.loader.abort()),this.fragmentTracker.removeFragment(t))}this.pendingDownloadFrags=[];for(var r=0;r<this.pendingParseFragDatas.length;r++)w.b.log("reset frag queue, remove frag "+this.pendingParseFragDatas[r].frag.sn+" from wait to parse queue");this.pendingParseFragDatas=[]},Be.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,w.b.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},Be.prototype._checkBuffer=function(){var e=this.media;e&&0!==e.readyState&&(e=(this.mediaBuffer||e).buffered,!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e))},Be.prototype.onFragLoadEmergencyAborted=function(e){e=e.frag;e&&(w.b.log("frag load is emergency aborted, rearrage queue from frag:"+e.sn+"."),this._rearrangeFragQueueWhenFragLoadFail(e)),this.state=Ue.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},Be.prototype.onBufferFlushed=function(){var e=this.mediaBuffer||this.media;e&&this.fragmentTracker.detectEvictedFragments(A.ElementaryStreamTypes.VIDEO,e.buffered),this._resetFragQueue(),this.fragPrevious=null,this.state=Ue.IDLE},Be.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},Be.prototype.computeLivePosition=function(e,t){var r=0;if(this.config.liveSyncDuration)r=this.config.liveSyncDuration;else for(var n=t.fragments,i=0;i<Math.min(this.config.liveSyncDurationCount,n.length);i++)r+=n[n.length-1-i].duration;return e+Math.max(0,t.totalduration-r)},Be.prototype._seekToStartPos=function(){var e,t,r,n=this.media,i=this.hls.config,a=n.currentTime,s=n.seeking?a:this.startPosition;i.lowLatencyEnabled&&i.lowLatencyStartUpForward&&(e=(window.performance.now()-this.startUpM3u8Trequest)/1e3,0<(t=(this.mediaBuffer||n).buffered).length&&(r=t.end(t.length-1)-t.start(t.length-1),i=Math.max(.5,r-e),s=t.end(t.length-1)-i,w.b.log("low latency mode, new startPosition: "+s+" startUpTime="+e+"s startUpDelay="+i+"s initBufferLen="+r))),a!==s&&(w.b.log("target start position not buffered, seek to buffered.start(0) "+s+" from current time "+a+" "),n.currentTime=s)},f(Be,[{key:"state",set:function(e){var t;this.state!==e&&(t=this.state,this._state=e,w.b.log("main stream:"+t+"->"+e),this.hls.trigger(m.a.STREAM_STATE_TRANSITION,{previousState:t,nextState:e}))},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){e=this.getBufferedFrag(e.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}},{key:"isLiveEnd",get:function(){return this._isLiveEnd},set:function(e){this._isLiveEnd=e}}]),Be),I=function(e,t,r){return t&&je(e.prototype,t),r&&je(e,r),e};function je(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var He,qe={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"};function Ve(e,t){!function(e){if(!(e instanceof Ve))throw new TypeError("Cannot call a class as a function")}(this);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,He.call(this,e,m.a.MEDIA_ATTACHED,m.a.MEDIA_DETACHING,m.a.MANIFEST_LOADING,m.a.MANIFEST_PARSED,m.a.LEVEL_LOADED,m.a.KEY_LOADED,m.a.FRAG_LOAD_PROGRESS,m.a.FRAG_LOADED,m.a.FRAG_LOAD_EMERGENCY_ABORTED,m.a.FRAG_PARSING_INIT_SEGMENT,m.a.FRAG_PARSING_DATA,m.a.FRAG_PARSED,m.a.ERROR,m.a.AUDIO_TRACK_SWITCHING,m.a.AUDIO_TRACK_SWITCHED,m.a.BUFFER_CREATED,m.a.BUFFER_APPENDED,m.a.BUFFER_FLUSHED));return r.fragmentTracker=t,r.config=e.config,r.audioCodecSwap=!1,r._state=qe.STOPPED,r.stallReported=!1,r.gapController=null,r.ableToStart=!1,r.lowLatencyFirstM3u8FinishTime=null,r}var Ke=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Ve,He=n),Ve.prototype.onHandlerDestroying=function(){this.stopLoad(),He.prototype.onHandlerDestroying.call(this)},Ve.prototype.onHandlerDestroyed=function(){this.state=qe.STOPPED,this.fragmentTracker=null,He.prototype.onHandlerDestroyed.call(this)},Ve.prototype.startLoad=function(e){var t,r,n;this.hls.config.lowLatencyEnabled&&(this.ableToStart=!1,this.lowLatencyFirstM3u8FinishTime=null),this.levels?(t=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(n=r.startLevel)&&(n=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1),0<t&&-1===e&&(w.b.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=qe.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()):(this.forceStartLoad=!0,this.state=qe.STOPPED)},Ve.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.clearInterval(),this.state=qe.STOPPED,this.forceStartLoad=!1},Ve.prototype.doTick=function(){switch(this.state){case qe.BUFFER_FLUSHING:this.fragLoadError=0;break;case qe.IDLE:this._doTickIdle();break;case qe.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=qe.IDLE);break;case qe.FRAG_LOADING_WAITING_RETRY:var t=window.performance.now(),r=this.retryDate;(!r||r<=t||this.media&&this.media.seeking)&&(w.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=qe.IDLE);break;case qe.ERROR:case qe.STOPPED:break;case qe.FRAG_LOADING:case qe.PARSING:case qe.PARSED:var n;this.isLiveEnd&&(n=this.hls.config,e=this.media,r=void 0,r=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition,t=te.bufferInfo(this.mediaBuffer||e,r,n.maxBufferHole),e=this.getBufferedFrag(r),n=this.hls.nextLoadLevel,r=(r=(r=(n=(r=this.levels&&this.levels.length&&this.levels[n])&&r.details)&&n.fragments)&&r.length&&n.fragments.filter(function(e){return!e.prefetch}))&&r[r.length-1].sn,!e||e.backtracked||e.sn!==r||t.nextStart||(t={},this.altAudio&&(t.type="video"),this.hls.trigger(m.a.BUFFER_EOS,t),this.state=qe.ENDED));break;case qe.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},Ve.prototype._doTickIdle=function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&t.startFragPrefetch)){var n=void 0,n=this.loadedmetadata?r.currentTime:this.nextLoadPosition,i=e.nextLoadLevel,a=this.levels[i];if(a){var s=a.bitrate,o=void 0,o=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength;o=Math.min(o,t.maxMaxBufferLength);r=te.bufferInfo(this.mediaBuffer||r,n,t.maxBufferHole),t=r.len;if(!(o<=t)){w.b.trace("buffer length of "+t.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;a=a.details;if(!a||a.live&&this.levelLastLoaded!==i)this.state=qe.WAITING_LEVEL;else{i=this.getBufferedFrag(n);if((!a.live||this.isLiveEnd)&&i&&!i.backtracked&&i.sn===a.endSN&&!r.nextStart){i={};return this.altAudio&&(i.type="video"),this.hls.trigger(m.a.BUFFER_EOS,i),void(this.state=qe.ENDED)}this._fetchPayloadOrEos(n,r,a)}}}}},Ve.prototype._fetchPayloadOrEos=function(e,t,r){var n=this.fragPrevious,i=this.level,a=r.fragments,s=a.length,o=this.hls.config;if(0!==s){var l=a[0].start,u=a[s-1].start+a[s-1].duration,d=t.end,h=void 0;if(r.initSegment&&!r.initSegment.data)h=r.initSegment;else if(r.live){t=this.config.initialLiveManifestSize;if(s<t)return void w.b.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+t);if(!1===this.ableToStart&&o.lowLatencyEnabled)return void w.b.info("cannot start playback of a level, reason: ableToStart=false");if(null===(h=this._ensureFragmentAtLivePoint(r,d,l,u,n,a,s)))return}else d<l&&(h=a[0]);(h=h||this._findFragment(l,n,s,a,d,u,r))&&(h.encrypted?(w.b.log("Loading key for "+h.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+i),this._loadKey(h)):(w.b.log("Loading "+h.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+i+", currentTime:"+e.toFixed(3)+",bufferEnd:"+d.toFixed(3)),this._loadFragment(h)))}},Ve.prototype._ensureFragmentAtLivePoint=function(e,t,r,n,i,a,s){var o,l=this.hls.config,u=this.media,d=void 0,h=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*e.averagetargetduration;return t<Math.max(r-l.maxFragLookUpTolerance,n-h)&&(o=this.liveSyncPosition=this.computeLivePosition(r,e),w.b.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+o.toFixed(3)),t=o,u&&u.readyState&&u.duration>o&&(u.currentTime=o),this.nextLoadPosition=o),this.startFragRequested&&!e.PTSKnown&&(i&&(e.programDateTime?d=ke(a,i.endPdt+1):((o=i.sn+1)>=e.startSN&&o<=e.endSN&&(e=a[o-e.startSN],i.cc===e.cc&&(d=e,w.b.log("live playlist, switching playlist, load frag with next SN: "+d.sn))),d||(d=ee.search(a,function(e){return i.cc-e.cc}))&&w.b.log("live playlist, switching playlist, load frag with same CC: "+d.sn))),d||(d=a[Math.min(s-1,Math.round(s/2))],w.b.log("live playlist, switching playlist, unknown, load middle frag : "+d.sn))),d},Ve.prototype._findFragment=function(e,t,r,n,i,a,s){var o,l=this.hls.config,u=void 0,d=void 0;return i<a?s.programDateTime&&(d=ke(n,De(e,i,s)))&&!Pe(i,l.maxFragLookUpTolerance,d)||(d=xe(t,n,i,a,l.maxFragLookUpTolerance)):d=n[r-1],d&&(o=(u=d).sn-s.startSN,e=t&&u.level===t.level,r=n[o-1],d=n[1+o],t&&u.sn===t.sn&&(e&&!u.backtracked?u.sn<s.endSN?(s=t.deltaPTS)&&s>l.maxBufferHole&&t.dropped&&o?(u=r,w.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(u=d,w.b.log("SN just loaded, load next one: "+u.sn)):u=null:u.backtracked&&(d&&d.backtracked?(w.b.warn("Already backtracked from fragment "+d.sn+", will not backtrack to fragment "+u.sn+". Loading fragment "+d.sn),u=d):(w.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),u.dropped=0,r?(u=r).backtracked=!0:o&&(u=null))))),u},Ve.prototype._loadKey=function(e){this.state=qe.KEY_LOADING,this.hls.trigger(m.a.KEY_LOADING,{frag:e})},Ve.prototype._loadFragment=function(e){var t=this.fragmentTracker.getState(e);this.fragCurrent=e,this.startFragRequested=!0,this.pendingAppending=0,isNaN(e.sn)||e.bitrateTest||(this.nextLoadPosition=e.start+e.duration),e.backtracked||t===z||t===Q?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.hls.trigger(m.a.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new fe(this.hls,"main")),this.demuxer.totalDecryptedDataSize=0,this.demuxer.incomeDataSize=0,this.state=qe.FRAG_LOADING):t===X&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},Ve.prototype.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,j.LevelType.MAIN)},Ve.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},Ve.prototype._checkFragmentChanged=function(){var e=void 0,t=void 0,r=this.media;r&&r.readyState&&!1===r.seeking&&((t=r.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),te.isBuffered(r,t)?e=this.getBufferedFrag(t):te.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),!e||(t=e)!==this.fragPlaying&&(this.hls.trigger(m.a.FRAG_CHANGED,{frag:t}),e=t.level,this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(m.a.LEVEL_SWITCHED,{level:e}),this.fragPlaying=t))},Ve.prototype.immediateLevelSwitch=function(){var e;w.b.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,t=void 0,(e=this.media)?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t);var t=this.fragCurrent;t&&t.loader&&t.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},Ve.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,te.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},Ve.prototype.nextLevelSwitch=function(){var e,t,r,n,i=this.media;i&&i.readyState&&(r=n=t=void 0,(n=this.getBufferedFrag(i.currentTime))&&1<n.startPTS&&this.flushMainBuffer(0,n.startPTS-1),t=i.paused?0:(e=this.hls.nextLoadLevel,n=this.levels[e],(e=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*e)+1:0),(r=(r=this.getBufferedFrag(i.currentTime+t))&&this.followingBufferedFrag(r))&&((t=this.fragCurrent)&&t.loader&&t.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.maxStartPTS,Number.POSITIVE_INFINITY)))},Ve.prototype.flushMainBuffer=function(e,t){this.state=qe.BUFFER_FLUSHING;t={startOffset:e,endOffset:t};this.altAudio&&(t.type="video"),this.hls.trigger(m.a.BUFFER_FLUSHING,t)},Ve.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);e=this.config;this.levels&&e.autoStartLoad&&this.hls.startLoad(e.startPosition),this.gapController=new Fe(e,t,this.fragmentTracker,this.hls)},Ve.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(w.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},Ve.prototype.onMediaSeeking=function(){var e=this.media,t=e?e.currentTime:void 0,r=this.config;isNaN(t)||w.b.log("media seeking to "+t.toFixed(3));var n,i=this.mediaBuffer||e,a=te.bufferInfo(i,t,this.config.maxBufferHole);this.state===qe.FRAG_LOADING?(n=this.fragCurrent,0===a.len&&n&&(i=r.maxFragLookUpTolerance,r=n.start-i,i=n.start+n.duration+i,t<r||i<t?(n.loader&&(w.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=qe.IDLE):w.b.log("seeking outside of buffer but within currently loaded fragment range"))):this.state===qe.ENDED&&(0===a.len&&(this.fragPrevious=0),this.state=qe.IDLE),e&&(this.lastCurrentTime=t),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()},Ve.prototype.onMediaSeeked=function(){var e=this.media,e=e?e.currentTime:void 0;isNaN(e)||w.b.log("media seeked to "+e.toFixed(3)),this.tick()},Ve.prototype.onMediaEnded=function(){w.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},Ve.prototype.onManifestLoading=function(){w.b.log("trigger BUFFER_RESET"),this.hls.trigger(m.a.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},Ve.prototype.onManifestParsed=function(e){var t=!1,r=!1,n=void 0;e.levels.forEach(function(e){(n=e.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(t=!0),-1!==n.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=t&&r,this.audioCodecSwitch&&w.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1;e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},Ve.prototype.onLevelLoaded=function(e){var t,r,n=e.details,i=e.level,a=this.levels[this.levelLastLoaded],s=this.levels[i],o=n.totalduration,l=0,u=this.hls.config;w.b.log("level "+i+" loaded ["+n.startSN+","+n.endSN+"],duration:"+o),n.live?(t=s.details,u.lowLatencyEnabled&&null===this.lowLatencyFirstM3u8FinishTime&&(this.lowLatencyFirstM3u8FinishTime=window.performance.now()),t&&n.endSN>t.endSN&&u.lowLatencyEnabled&&!this.ableToStart&&(w.b.info("able to start, lastSn="+t.endSN+" nowSn="+n.endSN),this.hls.trigger(m.a.LOW_LATENCY_ABLE_TO_START,{cost:Math.round(window.performance.now()-this.lowLatencyFirstM3u8FinishTime),ts_duration:n.averagetargetduration}),this.ableToStart=!0,this.startUpM3u8Trequest=e.stats.trequest),r=window.performance.now(),!1===this.ableToStart&&u.lowLatencyEnabled&&this.lowLatencyFirstM3u8FinishTime&&r-this.lowLatencyFirstM3u8FinishTime>u.lowLatencyStartUpMaxWaitTime&&(w.b.info("stop wait for new fragment, start playback now, reason: timeout="+u.lowLatencyStartUpMaxWaitTime),this.hls.trigger(m.a.LOW_LATENCY_WAIT_TIMEOUT,{timeout:u.lowLatencyStartUpMaxWaitTime,ts_duration:n.averagetargetduration}),this.ableToStart=!0,this.startUpM3u8Trequest=e.stats.trequest),t&&n.endSN>t.endSN&&(e=(r=this.media).currentTime,e=te.bufferInfo(r,e,0),w.b.info("discover new ts, lastSn="+t.endSN+" nowSn="+n.endSN+" bufferLen="+e.len)),t&&0<n.fragments.length?(ve(t,n),l=n.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(l,t),n.PTSKnown&&!isNaN(l)?w.b.log("live playlist sliding:"+l.toFixed(3)):(w.b.log("live playlist - outdated PTS, unknown sliding"),_e(this.fragPrevious,a,n))):(w.b.log("live playlist - first load, unknown sliding"),n.PTSKnown=!1,_e(this.fragPrevious,a,n))):n.PTSKnown=!1,s.details=n,this.levelLastLoaded=i,this.hls.trigger(m.a.LEVEL_UPDATED,{details:n,level:i}),!1===this.startFragRequested&&(u.lowLatencyEnabled&&n.live&&!this.ableToStart||(-1!==this.startPosition&&-1!==this.lastCurrentTime||(u=n.startTimeOffset,isNaN(u)?n.live?(this.startPosition=this.computeLivePosition(l,n),w.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(u<0&&(w.b.log("negative start time offset "+u+", count from end of last fragment"),u=l+o+u),w.b.log("start time offset found in playlist, adjust startPosition to "+u),this.startPosition=u),this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition)),this.state===qe.WAITING_LEVEL&&(this.state=qe.IDLE),this.tick()},Ve.prototype.onKeyLoaded=function(){this.state===qe.KEY_LOADING&&(this.state=qe.IDLE,this.tick())},Ve.prototype.onFragLoadProgress=function(e){this.processFragChunk(e,!1)},Ve.prototype.onFragLoaded=function(e){this.processFragChunk(e,!0)},Ve.prototype.processFragChunk=function(e,t){var r,n,i,a,s,o=this.fragCurrent,l=e.frag;this.state!==qe.FRAG_LOADING&&this.state!==qe.PARSING||!o||"main"!==l.type||l.level!==o.level||l.sn!==o.sn||(i=e.stats,s=(r=this.levels[o.level]).details,t&&(w.b.log("Loaded  "+o.sn+" of ["+s.startSN+" ,"+s.endSN+"],level "+o.level),this.fragLoadError=0),this.bitrateTest=!1,this.stats=i,!0===l.bitrateTest&&this.hls.nextLoadLevel?(this.state=qe.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=window.performance.now(),this.hls.trigger(m.a.FRAG_BUFFERED,{stats:i,frag:o,id:"main"}),this.tick()):"initSegment"===l.sn?(this.state=qe.IDLE,i.tparsed=i.tbuffered=window.performance.now(),s.initSegment.data=e.payload,this.hls.trigger(m.a.FRAG_BUFFERED,{stats:i,frag:o,id:"main"}),this.tick()):(n=s.totalduration,a=o.level,l=o.sn,i=this.config.defaultAudioCodec||r.audioCodec,this.audioCodecSwap&&(w.b.log("swapping playlist audio codec"),void 0===i&&(i=this.lastAudioCodec),i=i&&(-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.state!==qe.PARSING&&(this.state=qe.PARSING,this.pendingBuffering=!0,this.appended=!1,w.b.log("Parsing "+l+" of ["+s.startSN+" ,"+s.endSN+"],level "+a+", cc "+o.cc)),l=(l=this.demuxer)||(this.demuxer=new fe(this.hls,"main")),e.payload&&(a=!((a=this.media)&&a.seeking)&&(s.PTSKnown||!s.live),s=s.initSegment?s.initSegment.data:[],l.append(e.payload,s,i,r.videoCodec,o,n,a,void 0,this.hls.config.skipDiscontinuity,this.hls.lhlsEnable)),t&&l.notifycomplete()))},Ve.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===qe.PARSING){var n=e.tracks,i=void 0,a=void 0;for(i in n.audio&&this.altAudio&&delete n.audio,(a=n.audio)&&(r=this.levels[this.level].audioCodec,t=navigator.userAgent.toLowerCase(),r&&this.audioCodecSwap&&(w.b.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===t.indexOf("firefox")&&(r="mp4a.40.5"),-1!==t.indexOf("android")&&"audio/mpeg"!==a.container&&(r="mp4a.40.2",w.b.log("Android: force audio codec to "+r)),a.levelCodec=r,a.id=e.id),(a=n.video)&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=e.id),this.hls.trigger(m.a.BUFFER_CODECS,n),n){a=n[i],w.b.log("main track:"+i+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var s=a.initSegment;s&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(m.a.BUFFER_APPENDING,{type:i,data:s,parent:"main",content:"initSegment"}))}this.tick()}},Ve.prototype.onFragParsingData=function(r){var n=this,i=this.fragCurrent,a=r.frag;if(i&&"main"===r.id&&a.sn===i.sn&&a.level===i.level&&("audio"!==r.type||!this.altAudio)&&this.state===qe.PARSING){var s=this.levels[this.level],e=i;if(isNaN(r.endPTS)&&(r.endPTS=r.startPTS+i.duration,r.endDTS=r.startDTS+i.duration),!0===r.hasAudio&&e.addElementaryStream(A.ElementaryStreamTypes.AUDIO),!0===r.hasVideo&&e.addElementaryStream(A.ElementaryStreamTypes.VIDEO),w.b.log("Parsed "+r.type+",PTS:["+r.startPTS.toFixed(3)+","+r.endPTS.toFixed(3)+"],DTS:["+r.startDTS.toFixed(3)+"/"+r.endDTS.toFixed(3)+"],nb:"+r.nb+",dropped:"+(r.dropped||0)),"video"===r.type)if(e.dropped=r.dropped,e.dropped)if(e.backtracked)w.b.warn("Already backtracked on this fragment, appending with the gap",e.sn);else{var t=s.details;if(!t||e.sn!==t.startSN)return w.b.warn("missing video frame(s), backtracking fragment",e.sn),this.fragmentTracker.removeFragment(e),e.backtracked=!0,this.nextLoadPosition=r.startPTS,this.state=qe.IDLE,this.fragPrevious=e,void this.tick();w.b.warn("missing video frame(s) on first frag, appending with gap",e.sn)}else e.backtracked=!1;var e=me(s.details,e,r.startPTS,r.endPTS,r.startDTS,r.endDTS),o=this.hls;o.trigger(m.a.LEVEL_PTS_UPDATED,{details:s.details,level:this.level,drift:e,type:r.type,start:r.startPTS,end:r.endPTS}),[r.data1,r.data2].forEach(function(e){var t;e&&e.length&&n.state===qe.PARSING&&(n.appended=!0,n.pendingBuffering=!0,t=i&&a.cc===i.cc,o.trigger(m.a.BUFFER_APPENDING,{type:r.type,data:e,parent:"main",content:"data",levelDetails:s.details,discontinuity:t}))}),this.tick()}},Ve.prototype.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===qe.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=qe.PARSED,this._checkAppendedParsed())},Ve.prototype.onAudioTrackSwitching=function(e){var t,r=!!e.url,e=e.id;r||(this.mediaBuffer!==this.media&&(w.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(t=this.fragCurrent).loader&&(w.b.log("switching to main audio track, cancel main fragment load"),t.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=qe.IDLE),(t=this.hls).trigger(m.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),t.trigger(m.a.AUDIO_TRACK_SWITCHED,{id:e}),this.altAudio=!1)},Ve.prototype.onAudioTrackSwitched=function(e){var t=e.id,e=!!this.hls.audioTracks[t].url;!e||(t=this.videoBuffer)&&this.mediaBuffer!==t&&(w.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t),this.altAudio=e,this.tick()},Ve.prototype.onBufferCreated=function(e){var t,r=e.tracks,n=void 0,i=void 0,a=!1;for(t in r){var s=r[t];"main"===s.id?(n=s,"video"===(i=t)&&(this.videoBuffer=r[t].buffer)):a=!0}a&&n?(w.b.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},Ve.prototype.onBufferAppended=function(e){var t;"main"===e.parent&&((t=this.state)!==qe.PARSING&&t!==qe.PARSED||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed()))},Ve.prototype._checkAppendedParsed=function(){var e,t;this.state!==qe.PARSED||this.appended&&this.pendingBuffering||((e=this.fragCurrent)&&(t=this.mediaBuffer||this.media,w.b.log("main buffered : "+Te.toString(t.buffered)),this.fragPrevious=e,(t=this.stats).tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*t.total/(t.tbuffered-t.tfirst)),this.hls.trigger(m.a.FRAG_BUFFERED,{stats:t,frag:e,id:"main"}),this.state=qe.IDLE),this.tick())},Ve.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r,n=!!this.media&&te.isBuffered(this.media,this.media.currentTime)&&te.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case d.a.FRAG_LOAD_ERROR:case d.a.FRAG_LOAD_TIMEOUT:case d.a.KEY_LOAD_ERROR:case d.a.KEY_LOAD_TIMEOUT:e.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),w.b.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=qe.FRAG_LOADING_WAITING_RETRY):(w.b.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=qe.ERROR));break;case d.a.LEVEL_LOAD_ERROR:case d.a.LEVEL_LOAD_TIMEOUT:this.state!==qe.ERROR&&(e.fatal?(this.state=qe.ERROR,w.b.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==qe.WAITING_LEVEL||(this.state=qe.IDLE));break;case d.a.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==qe.PARSING&&this.state!==qe.PARSED||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=qe.IDLE):(w.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},Ve.prototype._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,w.b.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},Ve.prototype._checkBuffer=function(){var e=this.media;e&&0!==e.readyState&&(e=(this.mediaBuffer||e).buffered,!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e))},Ve.prototype.onFragLoadEmergencyAborted=function(){this.state=qe.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},Ve.prototype.onBufferFlushed=function(){var e=this.mediaBuffer||this.media;e&&this.fragmentTracker.detectEvictedFragments(A.ElementaryStreamTypes.VIDEO,e.buffered),this.state=qe.IDLE,this.fragPrevious=null},Ve.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},Ve.prototype.computeLivePosition=function(e,t){var r=0;if(this.config.liveSyncDuration)r=this.config.liveSyncDuration;else for(var n=t.fragments,i=0;i<Math.min(this.config.liveSyncDurationCount,n.length);i++)r+=n[n.length-1-i].duration;return e+Math.max(0,t.totalduration-r)},Ve.prototype._seekToStartPos=function(){var e,t,r;this.hls.lhlsEnable?this._seekToStartPosLhls():(t=(e=this.media).currentTime)!==(r=e.seeking?t:this.startPosition)&&(w.b.log("target start position not buffered, seek to buffered.start(0) "+r+" from current time "+t+" "),e.currentTime=r)},Ve.prototype._seekToStartPosLhls=function(){var n=0,i=setInterval(function(){100<n&&(w.b.warn("seekToStartPos was forced to stop."),clearInterval(i));var e=0;this.demuxer&&(e=this.demuxer.totalDecryptedDataSize);var t=0,r=this.fragCurrent;!r||(r=r.loader)&&r.firstChunkSizeOfFirstFragment&&(t=r.firstChunkSizeOfFirstFragment()),0<t&&t<=e?(w.b.log("totalDecryptedDataSize:"+e+", firstChunkSize:"+t),clearInterval(i),setTimeout(function(){var e,t,r,n=this.media.currentTime,i=(this.mediaBuffer||this.media).buffered;0<i.length&&(e=i.length-1,w.b.log("buffer index:"+e),t=i.end(e)-i.start(e),w.b.log("buffer start:"+i.start(i.length-1)+", end:"+i.end(i.length-1)+", len:"+t.toFixed(2)),r=i.start(e),t>this.config.lhlsStartDelayTime&&(n!==(r=i.end(e)-this.config.lhlsStartDelayTime)&&w.b.log("new startPosition:"+r.toFixed(2)),this.media.currentTime=r))}.bind(this),50)):w.b.log("waiting for load the part one of the first fragment...["+n+"]["+e+"]["+t+"]"),n++}.bind(this),50)},I(Ve,[{key:"state",set:function(e){var t;this.state!==e&&(t=this.state,this._state=e,w.b.log("main stream:"+t+"->"+e),this.hls.trigger(m.a.STREAM_STATE_TRANSITION,{previousState:t,nextState:e}))},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){e=this.getBufferedFrag(e.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),Ve),We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne=function(e,t,r){return t&&Ye(e.prototype,t),r&&Ye(e,r),e};function Ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ze,Xe=window.performance;function Qe(e){!function(e){if(!(e instanceof Qe))throw new TypeError("Cannot call a class as a function")}(this);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,ze.call(this,e,m.a.MANIFEST_LOADED,m.a.LEVEL_LOADED,m.a.AUDIO_TRACK_SWITCHED,m.a.FRAG_LOADED,m.a.FRAG_PARSED,m.a.FRAG_CHANGED,m.a.ERROR));return e.canload=!1,e.currentLevelIndex=null,e.manualLevelIndex=-1,e.timer=null,e.handleLivePlaybackModeLoadLevel=e.handleLivePlaybackModeLoadLevel.bind(e),e.livePlaybackModeLoadLevel=e.livePlaybackModeLoadLevel.bind(e),e}var Ze,$e=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Qe,ze=l),Qe.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},Qe.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},Qe.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},Qe.prototype.stopLoad=function(){this.canload=!1},Qe.prototype.onManifestLoaded=function(e){var t,r=[],n={},i=null,a=!1,s=!1,o=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=[];if(e.levels.forEach(function(e){e.loadError=0,e.fragmentError=!1,a=a||!!e.videoCodec,s=s||!!e.audioCodec||!(!e.attrs||!e.attrs.AUDIO),o&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(i=n[e.bitrate])?i.url.push(e.url):(e.url=[e.url],e.urlId=0,n[e.bitrate]=e,r.push(e)),e.attrs&&e.attrs.AUDIO&&pe(i||e,"audio",e.attrs.AUDIO),e.attrs&&e.attrs.SUBTITLES&&pe(i||e,"text",e.attrs.SUBTITLES)}),a&&s&&(r=r.filter(function(e){return!!e.videoCodec})),r=r.filter(function(e){var t=e.audioCodec,e=e.videoCodec;return(!t||T(t))&&(!e||T(e))}),e.audioTracks&&(l=e.audioTracks.filter(function(e){return!e.audioCodec||T(e.audioCodec,"audio")})),0<r.length){t=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r;for(var u=0;u<r.length;u++)if(r[u].bitrate===t){this._firstLevel=u,w.b.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(m.a.MANIFEST_PARSED,{levels:r,audioTracks:l,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:a,altAudio:0<l.length&&a})}else this.hls.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Qe.prototype.handleLivePlaybackModeLoadLevel=function(e){var t;this.hls.config.livePlaybackMode&&this.hls.levels&&((t=10<=(t=(t=this.hls.levels[this.hls.levels.length-1])&&t.details?t.details.fragments:[]).length?t[t.length-10]:null)?(e=e.sn,t.sn<=e?(w.b.debug("start load live playback m3u8"),this.loadLevelIntervalTimer||(this.loadLevelIntervalTimer=setInterval(this.livePlaybackModeLoadLevel,3e3))):(clearInterval(this.loadLevelIntervalTimer),this.loadLevelIntervalTimer=null)):(clearInterval(this.loadLevelIntervalTimer),this.loadLevelIntervalTimer=setInterval(this.livePlaybackModeLoadLevel,3e3)))},Qe.prototype.livePlaybackModeLoadLevel=function(){this.levels&&this.levels[this.level]&&this.levels[this.level].details&&this.levels[this.level].details.isLiveEnd&&(clearInterval(this.loadLevelIntervalTimer),this.loadLevelIntervalTimer=null),this.loadLevel()},Qe.prototype.setLevelInternal=function(e){var t,r=this._levels,n=this.hls;0<=e&&e<r.length?(this.clearTimer(),this.currentLevelIndex!==e&&(w.b.log("switching to level "+e),(t=r[this.currentLevelIndex=e]).level=e,n.trigger(m.a.LEVEL_SWITCHING,t)),(r=(t=r[e]).details)&&!r.live||(r=t.urlId,n.trigger(m.a.LEVEL_LOADING,{url:t.url[r],level:e,id:r}))):n.trigger(m.a.ERROR,{type:d.b.OTHER_ERROR,details:d.a.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},Qe.prototype.onError=function(e){if(e.fatal)e.type===d.b.NETWORK_ERROR&&this.clearTimer();else{var t=!1,r=!1,n=void 0;switch(e.details){case d.a.FRAG_LOAD_ERROR:case d.a.FRAG_LOAD_TIMEOUT:case d.a.KEY_LOAD_ERROR:case d.a.KEY_LOAD_TIMEOUT:n=e.frag.level,r=!0;break;case d.a.LEVEL_LOAD_ERROR:case d.a.LEVEL_LOAD_TIMEOUT:n=e.context.level,t=!0;break;case d.a.REMUX_ALLOC_ERROR:n=e.level,t=!0}void 0!==n&&this.recoverLevel(e,n,t,r)}},Qe.prototype.recoverLevel=function(e,t,r,n){var i,a,s,o=this,l=this.hls.config,u=e.details,d=this._levels[t];if(d.loadError++,d.fragmentError=n,r){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return w.b.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);a=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return o.loadLevel()},a),e.levelRetry=!0,this.levelRetryCount++,w.b.warn("level controller, "+u+", retry in "+a+" ms, current retry count is "+this.levelRetryCount)}(r||n)&&(1<(i=d.url.length)&&d.loadError<i?(d.urlId=(d.urlId+1)%i,d.details=void 0,w.b.warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+d.urlId)):-1!==this.manualLevelIndex||n?n&&(w.b.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null):(s=0===t?this._levels.length-1:t-1,w.b.warn("level controller, "+u+": switch to "+s),this.hls.nextAutoLevel=this.currentLevelIndex=s))},Qe.prototype.onFragLoaded=function(e){e=e.frag;void 0===e||"main"!==e.type||void 0!==(e=this._levels[e.level])&&(e.fragmentError=!1,e.loadError=0,this.levelRetryCount=0)},Qe.prototype.onFragParsed=function(e){e=e.frag;this.handleLivePlaybackModeLoadLevel(e)},Qe.prototype.onFragChanged=function(e){e=e.frag;this.handleLivePlaybackModeLoadLevel(e)},Qe.prototype.onLevelLoaded=function(e){var t,r=this,n=this.hls.config,i=e.level;i===this.currentLevelIndex&&((t=this._levels[i]).fragmentError||(t.loadError=0,this.levelRetryCount=0),i=e.details,this.hls.config.livePlaybackMode&&(i.live=!1),i.live?(t=2e3,n.lowLatencyEnabled&&(t=this.hls.ableToStart?500:0),t=t,0<i.fragments.length&&(i=i.fragments[i.fragments.length-1].prefetch,this.hls.config.lhlsEnable&&(this.hls.lhlsEnable=i)),t-=Xe.now()-e.stats.trequest,t=Math.max(0,Math.round(t)),w.b.log("live playlist, reload in "+Math.round(t)+" ms"),null===this.timer&&(this.timer=setTimeout(function(){return r.loadLevel()},t))):this.clearTimer())},Qe.prototype.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,r=this.hls.levels[this.currentLevelIndex];r&&(!r.audioGroupIds||(e=r.audioGroupIds.findIndex(function(e){return e===t}))!==r.urlId&&(r.urlId=e,this.startLoad()))},Qe.prototype.loadLevel=function(){var e,t,r;w.b.debug("call to loadLevel"),(this.timer=null)===this.currentLevelIndex||!this.canload||"object"===(void 0===(r=this._levels[this.currentLevelIndex])?"undefined":We(r))&&0<r.url.length&&(e=this.currentLevelIndex,t=r.urlId,r=r.url[t],w.b.log("Attempt loading level index "+e+" with URL-id "+t),this.hls.trigger(m.a.LEVEL_LOADING,{url:r,level:e,id:t}))},ne(Qe,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),Qe),Je=r(14);function et(e){!function(e){if(!(e instanceof et))throw new TypeError("Cannot call a class as a function")}(this);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,Ze.call(this,e,m.a.MEDIA_ATTACHED,m.a.MEDIA_DETACHING,m.a.FRAG_PARSING_METADATA));return e.id3Track=void 0,e.media=void 0,e}var tt=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(et,Ze=l),et.prototype.destroy=function(){l.prototype.destroy.call(this)},et.prototype.onMediaAttached=function(e){this.media=e.media,this.media},et.prototype.onMediaDetaching=function(){!function(e){if(e&&e.cues)for(;0<e.cues.length;)e.removeCue(e.cues[0])}(this.id3Track),this.id3Track=void 0,this.media=void 0},et.prototype.getID3Track=function(e){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return function(e,t){var r=null;try{r=new window.Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}(r,this.media),r}return this.media.addTextTrack("metadata","id3")},et.prototype.onFragParsingMetadata=function(e){var t=e.frag,r=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<r.length;i++){var a=Je.a.getID3Frames(r[i].data);if(a){var s=r[i].pts,o=i<r.length-1?r[i+1].pts:t.endPTS;s===o&&(o+=1e-4);for(var l=0;l<a.length;l++){var u,d=a[l];Je.a.isTimeStampFrame(d)||((u=new n(s,o,"")).value=d,this.id3Track.addCue(u))}}}},et);function rt(e){!function(e){if(!(e instanceof rt))throw new TypeError("Cannot call a class as a function")}(this),this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var nt=(rt.prototype.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},rt.prototype.getTotalWeight=function(){return this.totalWeight_},rt.prototype.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},rt);function it(e,t,r,n){!function(e){if(!(e instanceof it))throw new TypeError("Cannot call a class as a function")}(this),this.hls=e,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new nt(t),this.fast_=new nt(r)}var at=(it.prototype.sample=function(e,t){t=8e3*t/(e=Math.max(e,this.minDelayMs_)),e/=1e3;this.fast_.sample(e,t),this.slow_.sample(e,t)},it.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},it.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},it.prototype.destroy=function(){},it),ae=function(e,t,r){return t&&st(e.prototype,t),r&&st(e,r),e};function st(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ot,lt=window.performance;function ut(e){!function(e){if(!(e instanceof ut))throw new TypeError("Cannot call a class as a function")}(this);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,ot.call(this,e,m.a.FRAG_LOADING,m.a.FRAG_LOADED,m.a.FRAG_BUFFERED,m.a.ERROR));return t.lastLoadedFragLevel=0,t._nextAutoLevel=-1,t.hls=e,t.timer=null,t._bwEstimator=null,t.onCheck=t._abandonRulesCheck.bind(t),t._bwEstimatorBootTs=Date.now(),t}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(ut,ot=l),ut.prototype.destroy=function(){this.clearTimer(),l.prototype.destroy.call(this)},ut.prototype.onFragLoading=function(e){var t,r,n,i=e.frag;"main"===i.type&&(this.timer||(this.timer=setInterval(this.onCheck,100)),this._bwEstimator||(r=(t=this.hls).config,n=i.level,i=e=void 0,i=t.levels[n].details.live?(e=r.abrEwmaFastLive,r.abrEwmaSlowLive):(e=r.abrEwmaFastVoD,r.abrEwmaSlowVoD),this._bwEstimator=new at(t,i,e,r.abrEwmaDefaultEstimate),this._bwEstimatorBootTs=Date.now()))},ut.prototype._abandonRulesCheck=function(){var e=this.hls,t=e.media,r=this.fragCurrent;if(r){var n=r.loader,i=e.minAutoLevel;if(!n||n.stats&&n.stats.aborted)this._nextAutoLevel=-1;else{var a=n.stats;if(t&&a&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var s=lt.now()-a.trequest,o=Math.abs(t.playbackRate);if(s>500*r.duration/o){var l=e.levels,u=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/s),d=l[r.level],h=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,d=a.total||Math.max(a.loaded,Math.round(r.duration*h/8)),h=t.currentTime,d=(d-a.loaded)/u,c=(te.bufferInfo(t,h,e.config.maxBufferHole).end-h)/o;if(c<2*r.duration/o&&c<d){for(var f=void 0,p=void 0,p=r.level-1;i<p;p--){var g=l[p].realBitrate?Math.max(l[p].realBitrate,l[p].bitrate):l[p].bitrate;if((f=(l[p].averageDuration||r.duration)*g/(6.4*u))<c){w.b.log("found a lower level could safely reload, nextLoadLevel: "+p+", fragLevelNextLoadedDelay: "+f+", bufferStarvationDelay: "+c);break}}f<d&&(w.b.warn("loading too slow, abort fragment loading and switch to level "+p+":fragLoadedDelay["+p+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+f.toFixed(1)+"<"+d.toFixed(1)+":"+c.toFixed(1)),e.nextLoadLevel=p,this._bwEstimator.sample(s,a.loaded),n.abort(),e.trigger(m.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:a}),a=this._bwEstimator?this._bwEstimator.getEstimate():this.config.abrEwmaDefaultEstimate,e.trigger(m.a.QUALITY_CHANGE,{type:"abandonCheckFragment",oldQuality:r.level,newQuality:p,reason:{bufferLevel:c.toFixed(1),requestDelay:s.toFixed(1),fragLoadedDelay:d.toFixed(1),throughput:(a/1e3).toFixed()+"kbps"}}))}}}}}},ut.prototype.onFragLoaded=function(e){var t,r,n=e.frag;"main"!==n.type||isNaN(n.sn)||(this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(n=((t=this.hls.levels[n.level]).loaded?t.loaded.bytes:0)+e.stats.loaded,r=(t.loaded?t.loaded.duration:0)+e.frag.duration,t.loaded={bytes:n,duration:r},t.realBitrate=Math.round(8*n/r)),e.frag.bitrateTest&&((r=e.stats).tparsed=r.tbuffered=r.tload,this.onFragBuffered(e)))},ut.prototype.onFragBuffered=function(e){var t=e.stats,r=e.frag;!0===t.aborted||"main"!==r.type||isNaN(r.sn)||r.bitrateTest&&t.tload!==t.tbuffered||(e=t.tparsed-t.trequest,this._bwEstimator.sample(e,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),w.b.log("latency/loading/parsing/append/kbps/bwEstimate:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))+"/"+Math.round(t.bwEstimate)),r.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0)},ut.prototype.onError=function(e){switch(e.details){case d.a.FRAG_LOAD_ERROR:case d.a.FRAG_LOAD_TIMEOUT:}},ut.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},ut.prototype._findBestLevel=function(e,t,r,n,i,a,s,o,l){for(var u=i;n<=u;u--){var d=l[u];if(d){var h=d.details,c=d.averageDuration||(h?h.totalduration/h.fragments.length:t),f=!!h&&h.live,p=void 0,p=u<=e?s*r:o*r,d=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,h=d*c/p;if(w.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+d+"/"+c+"/"+a+"/"+h),d<p&&(!h||f&&!this.bitrateTestDelay||h<a))return u<e?w.b.debug("abr-controller: able to switch down lastLoadedFragLevel/level/currentBw/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+e+"/"+u+"/"+Math.round(r)+"/"+Math.round(p)+"/"+d+"/"+c+"/"+a+"/"+h):e<u&&w.b.debug("abr-controller: able to switch up lastLoadedFragLevel/level/currentBw/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+e+"/"+u+"/"+Math.round(r)+"/"+Math.round(p)+"/"+d+"/"+c+"/"+a+"/"+h),u}}return-1},ae(ut,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator,r=this.hls,n=r.loadLevel;if(!(-1===e||t&&t.canEstimate()))return e;var i=this._nextABRAutoLevel,t=i.level,i=i.reason;return-1!==e&&(t=Math.min(e,t)),Date.now()-this._bwEstimatorBootTs<this.hls.config.bwEstimatorUpStableTime&&(t=Math.min(t,this.hls.startLevel)),n&&n!==t&&r.trigger(m.a.QUALITY_CHANGE,{type:"throughput",oldQuality:n,newQuality:t,reason:i}),t},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.levels,n=e.config,i=e.minAutoLevel,a=this.fragCurrent,s=e.media,o=this.lastLoadedFragLevel,l=a?a.duration:0,u=s?s.currentTime:0,d=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,h=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,c=(te.bufferInfo(s,u,n.maxBufferHole).end-u)/d,e=this._findBestLevel(o,l,h,i,t,c,n.abrBandWidthFactor,n.abrBandWidthUpFactor,r);return e<0&&(w.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering"),a=l?Math.min(l,n.maxStarvationDelay):n.maxStarvationDelay,s=n.abrBandWidthFactor,u=n.abrBandWidthUpFactor,0!==c||(d=this.bitrateTestDelay)&&(a=(l?Math.min(l,n.maxLoadingDelay):n.maxLoadingDelay)-d,w.b.trace("bitrate test took "+Math.round(1e3*d)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*a)+" ms"),s=u=1),e=this._findBestLevel(o,l,h,i,t,c+a,s,u,r),e=Math.max(e,0)),{level:e,reason:{throughput:(h/1e3).toFixed()+"kbps",bufferLevel:c.toFixed(1)}}}},{key:"fragCurrent",get:function(){return this.hls.streamController.getFirstRequestFrag?this.hls.streamController.getFirstRequestFrag():null}}]),ue=ut;var dt,ht=le();function ct(e){!function(e){if(!(e instanceof ct))throw new TypeError("Cannot call a class as a function")}(this);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,dt.call(this,e,m.a.MEDIA_ATTACHING,m.a.MEDIA_DETACHING,m.a.MANIFEST_PARSED,m.a.BUFFER_RESET,m.a.BUFFER_APPENDING,m.a.BUFFER_CODECS,m.a.BUFFER_EOS,m.a.BUFFER_FLUSHING,m.a.LEVEL_PTS_UPDATED,m.a.FRAG_BUFFERED,m.a.LEVEL_UPDATED));return e._msDuration=null,e._levelDuration=null,e._live=null,e._objectUrl=null,e.onsbue=e.onSBUpdateEnd.bind(e),e.onsbe=e.onSBUpdateError.bind(e),e.pendingTracks={},e.tracks={},e.bufferingTimeTooHighStartTime=null,e}var ft,f=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ct,dt=l),ct.prototype.destroy=function(){l.prototype.destroy.call(this)},ct.prototype.onLevelPtsUpdated=function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){var n=this.sourceBuffer.audio;if(.1<Math.abs(n.timestampOffset-e.start)){r=n.updating;try{n.abort()}catch(e){r=!0,w.b.warn("can not abort audio buffer: "+e)}r?this.audioTimestampOffset=e.start:(w.b.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+e.start),n.timestampOffset=e.start)}}},ct.prototype.onManifestParsed=function(e){var t=e.audio,r=e.video||e.levels.length&&e.altAudio,n=0;e.altAudio&&(t||r)&&(n=(t?1:0)+(r?1:0),w.b.log(n+" sourceBuffer(s) expected")),this.sourceBufferNb=n},ct.prototype.onMediaAttaching=function(e){var t=this.media=e.media;t&&(e=this.mediaSource=new ht,this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),e.addEventListener("sourceopen",this.onmso),e.addEventListener("sourceended",this.onmse),e.addEventListener("sourceclose",this.onmsc),t.src=window.URL.createObjectURL(e),this._objectUrl=t.src)},ct.prototype.onMediaDetaching=function(){w.b.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){w.b.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):w.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0,this.bufferingTimeTooHighStartTime=null}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(m.a.MEDIA_DETACHED)},ct.prototype.onMediaSourceOpen=function(){w.b.log("media source opened"),this.hls.trigger(m.a.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},ct.prototype.checkPendingTracks=function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},ct.prototype.onMediaSourceClose=function(){w.b.log("media source closed")},ct.prototype.onMediaSourceEnded=function(){w.b.log("media source ended")},ct.prototype.onSBUpdateEnd=function(){this.audioTimestampOffset&&(t=this.sourceBuffer.audio,w.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset),this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e,t,r=this.parent,n=this.segments.reduce(function(e,t){return t.parent===r?e+1:e},0),i={},a=this.sourceBuffer;for(e in a)i[e]=a[e].buffered;this.hls.trigger(m.a.BUFFER_APPENDED,{parent:r,pending:n,timeRanges:i}),this._needsFlush||this.doAppending(),this.hls.config.lowLatencyEnabled&&this.hls.lhlsEnable&&(n=(t=this.hls.config).lhlsBufferTimeRange/2,t=t.lhlsTargetBufTime,this.adjustBufferingTime(t,n)),this.updateMediaElementDuration()},ct.prototype.onSBUpdateError=function(e){w.b.error("sourceBuffer error:",e),this.hls.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.BUFFER_APPENDING_ERROR,fatal:!1})},ct.prototype.onBufferReset=function(){var e,t=this.sourceBuffer;for(e in t){var r=t[e];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0,this.bufferingTimeTooHighStartTime=null},ct.prototype.onBufferCodecs=function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}},ct.prototype.createSourceBuffers=function(e){var t,r=this.sourceBuffer,n=this.mediaSource;for(t in e)if(!r[t]){var i=e[t],a=i.levelCodec||i.codec,s=i.container+";codecs="+a;w.b.log("creating sourceBuffer("+s+")");try{var o=r[t]=n.addSourceBuffer(s);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[t]={codec:a,container:i.container},i.buffer=o}catch(e){w.b.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(m.a.BUFFER_CREATED,{tracks:e})},ct.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},ct.prototype.onBufferAppendFail=function(e){w.b.error("sourceBuffer error:",e.event),this.hls.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.BUFFER_APPENDING_ERROR,fatal:!1})},ct.prototype.onBufferEos=function(e){var t,r=this.sourceBuffer,n=e.type;for(t in r)n&&t!==n||r[t].ended||(r[t].ended=!0,w.b.log(t+" sourceBuffer now EOS"));this.checkEos()},ct.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e){var n=e[r];if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}w.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){w.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},ct.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},ct.prototype.onLevelUpdated=function(e){e=e.details;0<e.fragments.length&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._live=e.live,this.updateMediaElementDuration())},ct.prototype.updateMediaElementDuration=function(){var e,t=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(w.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||e===1/0||isNaN(e))&&(w.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},ct.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var n in r)t+=r[n].buffered.length}catch(e){w.b.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(m.a.BUFFER_FLUSHED)}},ct.prototype.doAppending=function(){var t=this.hls,e=this.sourceBuffer,r=this.segments;if(Object.keys(e).length){if(this.media.error)return w.b.error("trying to append although a media error occured, flush segment and abort"),0<this.segments.length&&this.segments[0].discontinuity?this.hls.trigger(m.a.ERROR,{type:d.b.MEDIA_ERROR,details:d.a.BUFFER_APPEND_MEDIA_ERROR,fatal:!0,levelDetails:this.segments[0].levelDetails}):(3===(a={type:d.b.MEDIA_ERROR,details:d.a.CANNOT_APPEND_BUFFER_WHEN_MEDIA_ERROR,fatal:!1,code:this.media.error.code,msg:this.media.error.message}).code&&(a.fatal=!0),t.trigger(m.a.ERROR,a)),void(this.segments=[]);if(!this.appending&&(r&&r.length)){var n=r.shift();try{var i=e[n.type];i?i.updating?r.unshift(n):(i.ended=!1,this.parent=n.parent,i.appendBuffer(n.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){w.b.error("error while trying to append buffer:"+e.message),r.unshift(n);var a={type:d.b.MEDIA_ERROR,parent:n.parent};22!==e.code?(this.appendError?this.appendError++:this.appendError=1,a.details=d.a.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry?(w.b.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],a.fatal=!0):a.fatal=!1):(this.segments=[],a.details=d.a.BUFFER_FULL_ERROR,a.fatal=!1),t.trigger(m.a.ERROR,a)}}}},ct.prototype.flushBuffer=function(e,t,r){var n,i,a=void 0,s=void 0,o=void 0,l=void 0,u=this.sourceBuffer;if(Object.keys(u).length){if(w.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if((a=u[d]).ended=!1,a.updating)return w.b.warn("cannot flush, sb updating in progress"),!1;try{for(s=0;s<a.buffered.length;s++)if(n=a.buffered.start(s),i=a.buffered.end(s),l=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(o=e,t):(o=Math.max(n,e),Math.min(i,t)),.5<Math.min(l,i)-o)return this.flushBufferCounter++,w.b.log("flush "+d+" ["+o+","+l+"], of ["+n+","+i+"], pos:"+this.media.currentTime),a.remove(o,l),!1}catch(e){w.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else w.b.warn("abort flushing too many retries");w.b.log("buffer flushed")}return!0},ct.prototype.onFragBuffered=function(e){var t,r;this.hls.config.lowLatencyEnabled&&!this.hls.lhlsEnable&&(r=(t=this.hls).levels,t=t.config,r=r[e.frag.level].details,e=this.maxDurationOfPlaylist(r),r=t.bufferTimeAdjustCount*e,e=t.targetBufferCount*e,this.adjustBufferingTime(e,r))},ct.prototype.maxDurationOfPlaylist=function(e){for(var t=0,r=0;r<e.fragments.length;r++){var n=e.fragments[r];n.duration>t&&(t=n.duration)}return t},ct.prototype.adjustBufferingTime=function(e,t){var r,n,i=this.hls.config;0<this.media.buffered.length&&0<this.media.played.length&&(r=te.bufferInfo(this.media,this.media.currentTime,.5).len,w.b.log("check buffering time: bufferingTime="+r.toFixed(3)+"s targetBufferTime="+(e+t)+"s"),e+t<r?(null===this.bufferingTimeTooHighStartTime&&(this.bufferingTimeTooHighStartTime=window.performance.now()),n=window.performance.now()-this.bufferingTimeTooHighStartTime,w.b.log("check buffering time: bufferingTime="+r.toFixed(3)+"s "+(e+t)+"s continue="+n+"ms"),n>i.bufferAdjustDuration&&!this.media.seeking&&(i=(n=this.media.currentTime)+r-e,w.b.log("buffering time too high, adjusting currentTime from "+n+" to "+i),this.hls.trigger(m.a.BUFFER_TIME_ADJUSTED,{currentTime:n,bufferingTime:r,targetTime:i,targetBufferingTime:e}),this.media.currentTime=i,this.bufferingTimeTooHighStartTime=null)):this.bufferingTimeTooHighStartTime=null)},ct),n=function(e,t,r){return t&&pt(e.prototype,t),r&&pt(e,r),e};function pt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gt(e){!function(e){if(!(e instanceof gt))throw new TypeError("Cannot call a class as a function")}(this);e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,ft.call(this,e,m.a.FPS_DROP_LEVEL_CAPPING,m.a.MEDIA_ATTACHING,m.a.MANIFEST_PARSED,m.a.BUFFER_CODECS,m.a.MEDIA_DETACHING));return e.autoLevelCapping=Number.POSITIVE_INFINITY,e.firstLevel=null,e.levels=[],e.media=null,e.restrictedLevels=[],e.timer=null,e}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(gt,ft=l),gt.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},gt.prototype.onFpsDropLevelCapping=function(e){gt.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},gt.prototype.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},gt.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&(e.video||e.levels.length&&e.altAudio)&&this._startCapping()},gt.prototype.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this._startCapping()},gt.prototype.onLevelsUpdated=function(e){this.levels=e.levels},gt.prototype.onMediaDetaching=function(){this._stopCapping()},gt.prototype.detectPlayerSize=function(){var e,t;!this.media||(e=this.levels?this.levels.length:0)&&((t=this.hls).autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping)},gt.prototype.getMaxLevel=function(r){var n=this;if(!this.levels)return-1;var e=this.levels.filter(function(e,t){return gt.isLevelAllowed(t,n.restrictedLevels)&&t<=r});return gt.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)},gt.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},gt.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},gt.isLevelAllowed=function(e){return-1===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]).indexOf(e)},gt.getMaxLevelByMediaSize=function(e,t,r){if(!e||e&&!e.length)return-1;for(var n,i,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=r)&&(n=o,!(i=e[s+1])||(n.width!==i.width||n.height!==i.height))){a=s;break}}return a},n(gt,[{key:"mediaWidth",get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=gt.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=gt.contentScaleFactor),e}}],[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}]),I=gt;var mt,vt=window.performance;function yt(e){return function(e){if(!(e instanceof yt))throw new TypeError("Cannot call a class as a function")}(this),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,mt.call(this,e,m.a.MEDIA_ATTACHING))}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(yt,mt=l),yt.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},yt.prototype.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},yt.prototype.checkFPS=function(e,t,r){var n,i,a,s,o=vt.now();t&&(this.lastTime&&(a=o-this.lastTime,n=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,i=1e3*n/a,(a=this.hls).trigger(m.a.FPS_DROP,{currentDropped:n,currentDecoded:s,totalDroppedFrames:r}),0<i&&n>a.config.fpsDroppedMonitoringThreshold*s&&(s=a.currentLevel,w.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),0<s&&(-1===a.autoLevelCapping||a.autoLevelCapping>=s)&&(--s,a.trigger(m.a.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:a.currentLevel}),a.autoLevelCapping=s,a.streamController.nextLevelSwitch()))),this.lastTime=o,this.lastDroppedFrames=r,this.lastDecodedFrames=t)},yt.prototype.checkFPSInterval=function(){var e,t=this.video;t&&(this.isVideoPlaybackQualityAvailable?(e=t.getVideoPlaybackQuality(),this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)):this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount))},ne=yt;var ae=window,bt=ae.performance,Et=ae.XMLHttpRequest;function Tt(e){!function(e){if(!(e instanceof Tt))throw new TypeError("Cannot call a class as a function")}(this),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var St=(Tt.prototype.destroy=function(){this.abort(),this.loader=null},Tt.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},Tt.prototype.load=function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:bt.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},Tt.prototype.loadInternal=function(){var t=void 0,r=this.context,t=this.loader=new Et,e=this.stats;e.tfirst=0,e.loaded=0,e.chunks=0;var n=this.xhrSetup;try{if(n)try{n(t,r.url)}catch(e){t.open("GET",r.url,!0),n(t,r.url)}t.readyState||t.open("GET",r.url,!0)}catch(e){return void this.callbacks.onError({code:t.status,text:e.message},r,t)}r.rangeEnd&&t.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=r.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},Tt.prototype.readystatechange=function(e){var t,r=e.currentTarget,n=r.readyState,i=this.stats,a=this.context,s=this.config;i.aborted||2<=n&&(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(bt.now(),i.trequest)),4===n?200<=(t=r.status)&&t<300?(i.tload=Math.max(i.tfirst,bt.now()),n=e=void 0,n="arraybuffer"===a.responseType?(e=r.response).byteLength:(e=r.responseText).length,i.loaded=i.total=n,i.chunks++,e={url:r.responseURL,data:e},this.callbacks.onSuccess(e,i,a,r)):i.retry>=s.maxRetry||400<=t&&t<499?(w.b.error(t+" while loading "+a.url),this.callbacks.onError({code:t,text:r.statusText},a,r)):(w.b.warn(t+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout))},Tt.prototype.loadtimeout=function(){w.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},Tt.prototype.loadprogress=function(e){var t=e.currentTarget,r=this.stats;r.loaded=e.loaded,e.lengthComputable&&(r.total=e.total);e=this.callbacks.onProgress;e&&e(r,this.context,null,t)},Tt);var n=window,_t=n.performance,wt=n.Headers,Lt=n.fetch,At=n.Request;function Rt(e){!function(e){if(!(e instanceof Rt))throw new TypeError("Cannot call a class as a function")}(this),this.fetchSetup=e.fetchSetup}var Dt=(Rt.isSupported=function(){try{return window.fetch&&window.ReadableStream}catch(e){return!1}},Rt.prototype.destroy=function(){},Rt.prototype.abort=function(){this._requestAbort=!0},Rt.prototype.load=function(r,e,n){var i=this.stats={trequest:_t.now(),retry:0,loaded:0,chunks:0},t=void 0,a={method:"GET",mode:"cors",credentials:"same-origin"};this.context=r,this.callbacks=n,this.targetURL=r.url;var s={};r.rangeEnd&&(s.Range="bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),a.headers=new wt(s),t=this.fetchSetup?this.fetchSetup(r,a):new At(r.url,a);a=Lt(t,a).then(function(e){if(!this._requestAbort&&e.ok){if(i.tfirst=Math.max(i.trequest,_t.now()),this.targetURL=e.url,!r.progressData||!n.onProgress)return"arraybuffer"===r.responseType?e.arrayBuffer():e.text();this._pump(e.body.getReader())}else this._requestAbort||n.onError({text:"fetch, bad network response "+e.statusText},r)}.bind(this)).catch(function(e){n.onError({text:e.message},r)});!this._requestAbort&&a&&a.then(function(e){var t;e&&!this._requestAbort&&(i.tload=Math.max(i.tfirst,_t.now()),t=void 0,t="string"==typeof e?e.length:e.byteLength,i.loaded=i.total=t,i.chunks++,e={url:this.targetURL,data:e},n.onSuccess(e,i,r))}.bind(this))},Rt.prototype._pump=function(a){var s=this;this._requestAbort||a.read().then(function(e){var t=e.value,r=e.done,n=s.callbacks,i=s.stats,e=s.context;if(!r)return i.loaded+=t.length,i.chunks++,n.onProgress(i,s.context,t.buffer),s._pump(a);i.total=i.loaded,i.tload=Math.max(i.tfirst,_t.now()),n.onSuccess({url:s.targetURL},i,e)})},Rt),ae=r(30),kt=r.n(ae);function xt(){!function(e){if(!(e instanceof xt))throw new TypeError("Cannot call a class as a function")}(this)}var Pt=(xt.prototype.destroy=function(){},xt.prototype.abort=function(){var e=this.req;e&&e.abort()},xt.prototype.load=function(t,e,r){var n=this.stats={trequest:window.performance.now(),retry:0,loaded:0,chunks:0,tfirst:0};t.rangeEnd&&(t.rangeStart,t.rangeEnd),this.req=kt.a.get({path:t.url,mode:"allow-wrong-content-type",timeout:e.timeout},function(e){e.on("end",function(){n.total=n.loaded,n.tload=Math.max(n.tfirst,window.performance.now()),r.onSuccess({url:t.url},n,t)}),e.on("data",function(e){0===n.tfirst&&(n.tfirst=Math.max(window.performance.now(),n.trequest)),n.loaded+=e.length,n.chunks++,r.onProgress(n,t,e.buffer)}),e.on("error",function(e){r.onError({text:e.message},t)}),e.on("timeout",function(){w.b.warn("timeout while loading "+t.url),this.callbacks.onTimeout(n,t,null)})})},xt);var n=function t(e){var r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),new(r?Dt.isSupported()?Dt:Pt:St)(e)},ae=r(5),Ot={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:0,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragDownloadParallelNb:2,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:n,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:ue,bufferController:f,capLevelController:I,fpsController:ne,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null,skipBufferHole:!1,cmodeWhiteList:[],bwEstimatorUpStableTime:1e4,lowLatencyEnabled:!1,lowLatencyStartUpMaxWaitTime:2100,bufferTimeAdjustCount:.1,targetBufferCount:1.15,bufferAdjustDuration:8e3,lowLatencyStartUpForward:!1,lhlsStartDelayTime:.3,lhlsTargetBufTime:.7,lhlsBufferTimeRange:1,lhlsEnabled:!1,livePlaybackMode:!1};ne=function(e,t,r){return t&&It(e.prototype,t),r&&It(e,r),e};function It(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(51);Ct.isSupported=function(){return e=le(),t=window.SourceBuffer||window.WebKitSourceBuffer,e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,!!e&&!!t;var e,t},ne(Ct,null,[{key:"version",get:function(){return"0.11.3-mildom.beta.11"}},{key:"Events",get:function(){return m.a}},{key:"ErrorTypes",get:function(){return d.b}},{key:"ErrorDetails",get:function(){return d.a}},{key:"DefaultConfig",get:function(){return Ct.defaultConfig||Ot},set:function(e){Ct.defaultConfig=e}}]),Ct.prototype.destroy=function(){w.b.log("destroy"),this.trigger(m.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1,this._enableLhls=this.config.lowLatencyEnabled&&this.config.lhlsEnable},Ct.prototype.attachMedia=function(e){w.b.log("attachMedia"),this.media=e,this.trigger(m.a.MEDIA_ATTACHING,{media:e})},Ct.prototype.detachMedia=function(){w.b.log("detachMedia"),this.trigger(m.a.MEDIA_DETACHING),this.media=null},Ct.prototype.loadSource=function(e){e=i.a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),w.b.log("loadSource:"+e),this.url=e,this.trigger(m.a.MANIFEST_LOADING,{url:e})},Ct.prototype.startLoad=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;w.b.log("startLoad("+t+")"),this.streamController.isLiveEnd=!1,this.networkControllers.forEach(function(e){e.startLoad(t)})},Ct.prototype.stopLoad=function(){w.b.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},Ct.prototype.notifyLiveEnd=function(){this.streamController.isLiveEnd=!0},Ct.prototype.swapAudioCodec=function(){w.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},Ct.prototype.recoverMediaError=function(){w.b.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)},ne(Ct,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){w.b.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"ableToStart",get:function(){return this.streamController.ableToStart}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){w.b.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){w.b.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){w.b.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){w.b.log("set startLevel:"+e);-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){w.b.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,r=e?e.length:0,n=0;n<r;n++)if(t<(e[n].realBitrate?Math.max(e[n].realBitrate,e[n].bitrate):e[n].bitrate))return n;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lhlsEnable",get:function(){return this._enableLhls},set:function(e){w.b.log("set lhlsEnable:"+e),this._enableLhls=e}}]),ne=Ct;function Ct(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e){if(!(e instanceof Ct))throw new TypeError("Cannot call a class as a function")}(this);var r,n=Ct.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(r in n)r in e||(e[r]=n[r]);if(void 0!==e.liveMaxLatencyDurationCount&&e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(e.liveMaxLatencyDuration<=e.liveSyncDuration||void 0===e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(w.a)(e.debug),this.config=e,this._autoLevelCapping=-1,this._enableLhls=e.lowLatencyEnabled&&e.lhlsEnable;var i=this.observer=new ie.a;i.trigger=function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];i.emit.apply(i,[e,e].concat(r))},i.off=function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];i.removeListener.apply(i,[e].concat(r))},this.on=i.on.bind(i),this.off=i.off.bind(i),this.once=i.once.bind(i),this.trigger=i.trigger.bind(i);var a=this.abrController=new e.abrController(this),s=new e.bufferController(this),o=new e.capLevelController(this),l=new e.fpsController(this),u=new j(this),d=new V(this),h=new W(this),c=new tt(this),f=this.levelController=new $e(this),p=new $(this),g=[f,e.lowLatencyEnabled&&e.lhlsEnable?this.streamController=new Ke(this,p):this.streamController=new Ge(this,p)],f=e.audioStreamController;f&&g.push(new f(this,p)),this.networkControllers=g;var m,v=[u,d,h,a,s,o,l,c,p];(f=e.audioTrackController)&&(m=new f(this),this.audioTrackController=m,v.push(m)),(f=e.subtitleTrackController)&&(m=new f(this),this.subtitleTrackController=m,v.push(m)),(f=e.emeController)&&(f=new f(this),this.emeController=f,v.push(f)),[e.subtitleStreamController,e.timelineController].forEach(function(e){e&&v.push(new e(t))}),this.coreComponents=v}t.default=ne},function(e,t,c){function a(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var e=i(i.s=ENTRY_MODULE);return e.default||e}var f="[\\.|\\-|\\+|\\w|/|@]+",p="\\((/\\*.*?\\*/)?s?.*?("+f+").*?\\)";function g(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};function(r){return Object.keys(r).reduce(function(e,t){return e||0<r[t].length},!1)}(r);)for(var a=Object.keys(r),s=0;s<a.length;s++){var o=a[s],l=r[o].pop();if(i[o]=i[o]||{},!i[o][l]&&e[o][l]){i[o][l]=!0,n[o]=n[o]||[],n[o].push(l);for(var u=function(e,t,r){var n={};n[r]=[];var i=t.toString();if(!(t=i.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/)))return n;for(var a,t=t[1],s=new RegExp("(\\\\n|\\W)"+g(t)+p,"g");a=s.exec(i);)"dll-reference"!==a[3]&&n[r].push(a[3]);for(s=new RegExp("\\("+g(t)+'\\("(dll-reference\\s('+f+'))"\\)\\)'+p,"g");a=s.exec(i);)e[a[2]]||(n[r].push(a[1]),e[a[2]]=c(a[1]).m),n[a[2]]=n[a[2]]||[],n[a[2]].push(a[4]);return n}(e,e[o][l],o),d=Object.keys(u),h=0;h<d.length;h++)r[d[h]]=r[d[h]]||[],r[d[h]]=r[d[h]].concat(u[d[h]])}}return n}e.exports=function(e,t){t=t||{};var r={main:c.m},n=t.all?{main:Object.keys(r)}:s(r,e),i="";Object.keys(n).filter(function(e){return"main"!==e}).forEach(function(t){for(var e=0;n[t][e];)e++;n[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+"var "+t+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n[t].map(function(e){return JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"}),i=i+"("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map(function(e){return JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"})(self);";e=new window.Blob([i],{type:"text/javascript"});if(t.bare)return e;t=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(e),e=new window.Worker(t);return e.objectURL=t,e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r(17),o=r(1),l=r(0),n=r(10),u=r.n(n);t.default=function(n){var i=new u.a;i.trigger=function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];i.emit.apply(i,[e,e].concat(r))},i.off=function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];i.removeListener.apply(i,[e].concat(r))};function a(e,t){n.postMessage({event:e,data:t})}n.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":var r=JSON.parse(t.config);n.demuxer=new s.a(i,t.typeSupported,r,t.vendor);try{Object(l.a)(!0===r.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}a("init",null);break;case"demux":n.demuxer.append(t.data,t.decryptdata,t.initSegment,t.audioCodec,t.videoCodec,t.timeOffset,t.discontinuity,t.trackSwitch,t.contiguous,t.duration,t.accurateTimeOffset,t.defaultInitPTS,t.lowLatency);break;case"complete":n.demuxer.notifycomplete()}}),i.on(o.a.FRAG_DECRYPTED,a),i.on(o.a.FRAG_PARSING_INIT_SEGMENT,a),i.on(o.a.FRAG_PARSED,a),i.on(o.a.ERROR,a),i.on(o.a.FRAG_PARSING_METADATA,a),i.on(o.a.FRAG_PARSING_USERDATA,a),i.on(o.a.INIT_PTS_FOUND,a),i.on(o.a.FRAG_PARSING_DATA,function(e,t){var r=[],e={event:e,data:t};t.data1&&(e.data1=t.data1.buffer,r.push(t.data1.buffer),delete t.data1),t.data2&&(e.data2=t.data2.buffer,r.push(t.data2.buffer),delete t.data2),n.postMessage(e,r)})}},function(e,t,n){(function(s){var o=n(31),l=n(42),e=n(43),u=n(44),r=t;r.request=function(e,t){e="string"==typeof e?u.parse(e):l(e);var r=-1===s.location.protocol.search(/^https?:$/)?"http:":"",n=e.protocol||r,i=e.hostname||e.host,a=e.port,r=e.path||"/";i&&-1!==i.indexOf(":")&&(i="["+i+"]"),e.url=(i?n+"//"+i:"")+(a?":"+a:"")+r,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};e=new o(e);return t&&e.on("response",t),e},r.get=function(e,t){t=r.request(e,t);return t.end(),t},r.Agent=function(){},r.Agent.defaultMaxSockets=4,r.STATUS_CODES=e,r.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(t,n(3))},function(a,e,c){(function(s,o,l){var u=c(19),e=c(4),t=c(34),i=c(20),d=c(41),r=t.IncomingMessage,h=t.readyStates;t=a.exports=function(t){var r=this;i.Writable.call(r),r._opts=t,r._body=[],r._headers={},t.auth&&r.setHeader("Authorization","Basic "+new s(t.auth).toString("base64")),Object.keys(t.headers).forEach(function(e){r.setHeader(e,t.headers[e])});var e,n=!0;if("disable-fetch"===t.mode||"timeout"in t)e=!(n=!1);else if("prefer-streaming"===t.mode)e=!1;else if("allow-wrong-content-type"===t.mode)e=!u.overrideMimeType;else{if(t.mode&&"default"!==t.mode&&"prefer-fast"!==t.mode)throw new Error("Invalid value for opts.mode");e=!0}r._mode=(e=e,n=n,u.fetch&&n?"fetch":u.mozchunkedarraybuffer?"moz-chunked-arraybuffer":u.msstream?"ms-stream":u.arraybuffer&&e?"arraybuffer":u.vbArray&&e?"text:vbarray":"text"),r.on("finish",function(){r._onFinish()})};e(t,i.Writable),t.prototype.setHeader=function(e,t){var r=e.toLowerCase();-1===n.indexOf(r)&&(this._headers[r]={name:e,value:t})},t.prototype.getHeader=function(e){e=this._headers[e.toLowerCase()];return e?e.value:null},t.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},t.prototype._onFinish=function(){var t=this;if(!t._destroyed){var e=t._opts,r=t._headers,n=null;"GET"!==e.method&&"HEAD"!==e.method&&(n=u.blobConstructor?new o.Blob(t._body.map(function(e){return d(e)}),{type:(r["content-type"]||{}).value||""}):s.concat(t._body).toString());var i=[];if(Object.keys(r).forEach(function(e){var t=r[e].name,e=r[e].value;Array.isArray(e)?e.forEach(function(e){i.push([t,e])}):i.push([t,e])}),"fetch"===t._mode)o.fetch(t._opts.url,{method:t._opts.method,headers:i,body:n||void 0,mode:"cors",credentials:e.withCredentials?"include":"same-origin"}).then(function(e){t._fetchResponse=e,t._connect()},function(e){t.emit("error",e)});else{var a=t._xhr=new o.XMLHttpRequest;try{a.open(t._opts.method,t._opts.url,!0)}catch(e){return void l.nextTick(function(){t.emit("error",e)})}"responseType"in a&&(a.responseType=t._mode.split(":")[0]),"withCredentials"in a&&(a.withCredentials=!!e.withCredentials),"text"===t._mode&&"overrideMimeType"in a&&a.overrideMimeType("text/plain; charset=x-user-defined"),"timeout"in e&&(a.timeout=e.timeout,a.ontimeout=function(){t.emit("timeout")}),i.forEach(function(e){a.setRequestHeader(e[0],e[1])}),t._response=null,a.onreadystatechange=function(){switch(a.readyState){case h.LOADING:case h.DONE:t._onXHRProgress()}},"moz-chunked-arraybuffer"===t._mode&&(a.onprogress=function(){t._onXHRProgress()}),a.onerror=function(){t._destroyed||t.emit("error",new Error("XHR error"))};try{a.send(n)}catch(e){return void l.nextTick(function(){t.emit("error",e)})}}}},t.prototype._onXHRProgress=function(){!function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return}}(this._xhr)||this._destroyed||(this._response||this._connect(),this._response._onXHRProgress())},t.prototype._connect=function(){var t=this;t._destroyed||(t._response=new r(t._xhr,t._fetchResponse,t._mode),t._response.on("error",function(e){t.emit("error",e)}),t.emit("response",t._response))},t.prototype._write=function(e,t,r){this._body.push(e),r()},t.prototype.abort=t.prototype.destroy=function(){this._destroyed=!0,this._response&&(this._response._destroyed=!0),this._xhr&&this._xhr.abort()},t.prototype.end=function(e,t,r){"function"==typeof e&&(r=e,e=void 0),i.Writable.prototype.end.call(this,e,t,r)},t.prototype.flushHeaders=function(){},t.prototype.setTimeout=function(){},t.prototype.setNoDelay=function(){},t.prototype.setSocketKeepAlive=function(){};var n=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(e,c(6).Buffer,c(3),c(7))},function(e,t,r){"use strict";t.byteLength=function(e){return 3*e.length/4-h(e)},t.toByteArray=function(e){var t,r,n,i,a,s=e.length;i=h(e),a=new d(3*s/4-i),r=0<i?s-4:s;var o=0;for(t=0;t<r;t+=4)n=u[e.charCodeAt(t)]<<18|u[e.charCodeAt(t+1)]<<12|u[e.charCodeAt(t+2)]<<6|u[e.charCodeAt(t+3)],a[o++]=n>>16&255,a[o++]=n>>8&255,a[o++]=255&n;2===i?(n=u[e.charCodeAt(t)]<<2|u[e.charCodeAt(t+1)]>>4,a[o++]=255&n):1===i&&(n=u[e.charCodeAt(t)]<<10|u[e.charCodeAt(t+1)]<<4|u[e.charCodeAt(t+2)]>>2,a[o++]=n>>8&255,a[o++]=255&n);return a},t.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i="",a=[],s=0,o=r-n;s<o;s+=16383)a.push(function(e,t,r){for(var n,i=[],a=t;a<r;a+=3)n=(e[a]<<16)+(e[a+1]<<8)+e[a+2],i.push(function(e){return l[e>>18&63]+l[e>>12&63]+l[e>>6&63]+l[63&e]}(n));return i.join("")}(e,s,o<s+16383?o:s+16383));1==n?(t=e[r-1],i+=l[t>>2],i+=l[t<<4&63],i+="=="):2==n&&(t=(e[r-2]<<8)+e[r-1],i+=l[t>>10],i+=l[t>>4&63],i+=l[t<<2&63],i+="=");return a.push(i),a.join("")};for(var l=[],u=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,a=n.length;i<a;++i)l[i]=n[i],u[n.charCodeAt(i)]=i;function h(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,i){var a,s,o=8*i-n-1,l=(1<<o)-1,u=l>>1,d=-7,h=r?i-1:0,c=r?-1:1,r=e[t+h];for(h+=c,a=r&(1<<-d)-1,r>>=-d,d+=o;0<d;a=256*a+e[t+h],h+=c,d-=8);for(s=a&(1<<-d)-1,a>>=-d,d+=n;0<d;s=256*s+e[t+h],h+=c,d-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(r?-1:1);s+=Math.pow(2,n),a-=u}return(r?-1:1)*s*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var s,o,l=8*a-i-1,u=(1<<l)-1,d=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,c=n?0:a-1,f=n?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-s))<1&&(s--,n*=2),2<=(t+=1<=s+d?h/n:h*Math.pow(2,1-d))*n&&(s++,n/=2),u<=s+d?(o=0,s=u):1<=s+d?(o=(t*n-1)*Math.pow(2,i),s+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));8<=i;e[r+c]=255&o,c+=f,o/=256,i-=8);for(s=s<<i|o,l+=i;0<l;e[r+c]=255&s,c+=f,s/=256,l-=8);e[r+c-f]|=128*a}},function(e,r,n){(function(a,o,l){var s=n(19),e=n(4),u=n(20),d=r.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},t=r.IncomingMessage=function(e,t,r){var n,i=this;u.Readable.call(i),i._mode=r,i.headers={},i.rawHeaders=[],i.trailers={},i.rawTrailers=[],i.on("end",function(){a.nextTick(function(){i.emit("close")})}),"fetch"===r?(i._fetchResponse=t,i.url=t.url,i.statusCode=t.status,i.statusMessage=t.statusText,t.headers.forEach(function(e,t){i.headers[t.toLowerCase()]=e,i.rawHeaders.push(t,e)}),n=t.body.getReader(),function t(){n.read().then(function(e){i._destroyed||(e.done?i.push(null):(i.push(new o(e.value)),t()))}).catch(function(e){i.emit("error",e)})}()):(i._xhr=e,i._pos=0,i.url=e.responseURL,i.statusCode=e.status,i.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t=e.match(/^([^:]+):\s*(.*)/);t&&("set-cookie"===(e=t[1].toLowerCase())?(void 0===i.headers[e]&&(i.headers[e]=[]),i.headers[e].push(t[2])):void 0!==i.headers[e]?i.headers[e]+=", "+t[2]:i.headers[e]=t[2],i.rawHeaders.push(t[1],t[2]))}),i._charset="x-user-defined",s.overrideMimeType||(!(e=i.rawHeaders["mime-type"])||(e=e.match(/;\s*charset=([^;])(;|$)/))&&(i._charset=e[1].toLowerCase()),i._charset||(i._charset="utf-8")))};e(t,u.Readable),t.prototype._read=function(){},t.prototype._onXHRProgress=function(){var t=this,e=t._xhr,r=null;switch(t._mode){case"text:vbarray":if(e.readyState!==d.DONE)break;try{r=new l.VBArray(e.responseBody).toArray()}catch(e){}if(null!==r){t.push(new o(r));break}case"text":try{r=e.responseText}catch(e){t._mode="text:vbarray";break}if(r.length>t._pos){var n=r.substr(t._pos);if("x-user-defined"===t._charset){for(var i=new o(n.length),a=0;a<n.length;a++)i[a]=255&n.charCodeAt(a);t.push(i)}else t.push(n,t._charset);t._pos=r.length}break;case"arraybuffer":if(e.readyState!==d.DONE||!e.response)break;r=e.response,t.push(new o(new Uint8Array(r)));break;case"moz-chunked-arraybuffer":if(r=e.response,e.readyState!==d.LOADING||!r)break;t.push(new o(new Uint8Array(r)));break;case"ms-stream":if(r=e.response,e.readyState!==d.LOADING)break;var s=new l.MSStreamReader;s.onprogress=function(){s.result.byteLength>t._pos&&(t.push(new o(new Uint8Array(s.result.slice(t._pos)))),t._pos=s.result.byteLength)},s.onload=function(){t.push(null)},s.readAsArrayBuffer(r)}t._xhr.readyState===d.DONE&&"ms-stream"!==t._mode&&t.push(null)}}).call(r,n(7),n(6).Buffer,n(3))},function(e,t){},function(e,t,r){"use strict";var o=r(15).Buffer;function n(){!function(e){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this),this.head=null,this.tail=null,this.length=0}e.exports=(n.prototype.push=function(e){e={data:e,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length},n.prototype.unshift=function(e){e={data:e,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},n.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},n.prototype.clear=function(){this.head=this.tail=null,this.length=0},n.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},n.prototype.concat=function(e){if(0===this.length)return o.alloc(0);if(1===this.length)return this.head.data;for(var t,r,n,i=o.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,r=i,n=s,t.copy(r,n),s+=a.data.length,a=a.next;return i},n)},function(e,t,r){var n=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(38),t.setImmediate=a,t.clearImmediate=s},function(e,t,r){(function(e,p){!function(r,n){"use strict";var i,a,t,s,o,l,u,d,e;function h(e){delete a[e]}function c(e){if(t)setTimeout(c,0,e);else{var r=a[e];if(r){t=!0;try{!function(){var e=r.callback,t=r.args;switch(t.length){case 0:e();break;case 1:e(t[0]);break;case 2:e(t[0],t[1]);break;case 3:e(t[0],t[1],t[2]);break;default:e.apply(n,t)}}()}finally{h(e),t=!1}}}}function f(e){e.source===r&&"string"==typeof e.data&&0===e.data.indexOf(d)&&c(+e.data.slice(d.length))}r.setImmediate||(i=1,t=!(a={}),s=r.document,e=(e=Object.getPrototypeOf&&Object.getPrototypeOf(r))&&e.setTimeout?e:r,o="[object process]"==={}.toString.call(r.process)?function(e){p.nextTick(function(){c(e)})}:function(){if(r.postMessage&&!r.importScripts){var e=!0,t=r.onmessage;return r.onmessage=function(){e=!1},r.postMessage("","*"),r.onmessage=t,e}}()?(d="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",f,!1):r.attachEvent("onmessage",f),function(e){r.postMessage(d+e,"*")}):r.MessageChannel?((u=new MessageChannel).port1.onmessage=function(e){c(e.data)},function(e){u.port2.postMessage(e)}):s&&"onreadystatechange"in s.createElement("script")?(l=s.documentElement,function(e){var t=s.createElement("script");t.onreadystatechange=function(){c(e),t.onreadystatechange=null,l.removeChild(t),t=null},l.appendChild(t)}):function(e){setTimeout(c,0,e)},e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];return e={callback:e,args:t},a[i]=e,o(i),i++},e.clearImmediate=h)}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,r(3),r(7))},function(e,t,r){(function(t){function n(e){try{if(!t.localStorage)return}catch(e){return}e=t.localStorage[e];return null!=e&&"true"===String(e).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(t,r(3))},function(e,t,r){"use strict";e.exports=i;var n=r(26),e=r(11);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}e.inherits=r(4),e.inherits(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},function(e,t,r){var i=r(6).Buffer;e.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(i.isBuffer(e)){for(var t=new Uint8Array(e.length),r=e.length,n=0;n<r;n++)t[n]=e[n];return t.buffer}throw new Error("Argument must be a Buffer")}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r,n=arguments[t];for(r in n)i.call(n,r)&&(e[r]=n[r])}return e};var i=Object.prototype.hasOwnProperty},function(e,t){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(e,t,r){"use strict";var A=r(45),R=r(47);function T(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=i,t.resolve=function(e,t){return i(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},t.format=function(e){R.isString(e)&&(e=i(e));return e instanceof T?e.format():T.prototype.format.call(e)},t.Url=T;var D=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,k=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,t=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),x=["'"].concat(t),P=["%","/","?",";","#"].concat(x),O=["/","?","#"],I=/^[+a-z0-9A-Z_-]{0,63}$/,C=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,F={javascript:!0,"javascript:":!0},M={javascript:!0,"javascript:":!0},N={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},U=r(48);function i(e,t,r){if(e&&R.isObject(e)&&e instanceof T)return e;var n=new T;return n.parse(e,t,r),n}T.prototype.parse=function(e,t,r){if(!R.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),i=-1!==n&&n<e.indexOf("#")?"?":"#",n=e.split(i);n[0]=n[0].replace(/\\/g,"/");var a=(a=e=n.join(i)).trim();if(!r&&1===e.split("#").length){var s=k.exec(a);if(s)return this.path=a,this.href=a,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?U.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var o,s=D.exec(a);if(s&&(L=(s=s[0]).toLowerCase(),this.protocol=L,a=a.substr(s.length)),(r||s||a.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(o="//"===a.substr(0,2))||s&&M[s]||(a=a.substr(2),this.slashes=!0)),!M[s]&&(o||s&&!N[s])){for(var l=-1,u=0;u<O.length;u++)-1!==(d=a.indexOf(O[u]))&&(-1===l||d<l)&&(l=d);-1!==(T=-1===l?a.lastIndexOf("@"):a.lastIndexOf("@",l))&&(S=a.slice(0,T),a=a.slice(T+1),this.auth=decodeURIComponent(S)),l=-1;for(var d,u=0;u<P.length;u++)-1!==(d=a.indexOf(P[u]))&&(-1===l||d<l)&&(l=d);-1===l&&(l=a.length),this.host=a.slice(0,l),a=a.slice(l),this.parseHost(),this.hostname=this.hostname||"";var h="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!h)for(var c=this.hostname.split(/\./),u=0,f=c.length;u<f;u++){var p=c[u];if(p&&!p.match(I)){for(var g="",m=0,v=p.length;m<v;m++)127<p.charCodeAt(m)?g+="x":g+=p[m];if(!g.match(I)){var y=c.slice(0,u),b=c.slice(u+1),E=p.match(C);E&&(y.push(E[1]),b.unshift(E[2])),b.length&&(a="/"+b.join(".")+a),this.hostname=y.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),h||(this.hostname=A.toASCII(this.hostname));var T=this.port?":"+this.port:"",S=this.hostname||"";this.host=S+T,this.href+=this.host,h&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!F[L])for(u=0,f=x.length;u<f;u++){var _,w=x[u];-1!==a.indexOf(w)&&((_=encodeURIComponent(w))===w&&(_=escape(w)),a=a.split(w).join(_))}h=a.indexOf("#");-1!==h&&(this.hash=a.substr(h),a=a.slice(0,h));var L,h=a.indexOf("?");return-1!==h?(this.search=a.substr(h),this.query=a.substr(h+1),t&&(this.query=U.parse(this.query)),a=a.slice(0,h)):t&&(this.search="",this.query={}),a&&(this.pathname=a),N[L]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(T=this.pathname||"",L=this.search||"",this.path=T+L),this.href=this.format(),this},T.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,a="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&R.isObject(this.query)&&Object.keys(this.query).length&&(a=U.stringify(this.query));a=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||N[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i=i||"",n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+n},T.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},T.prototype.resolveObject=function(e){R.isString(e)&&((f=new T).parse(e,!1,!0),e=f);for(var t=new T,r=Object.keys(this),n=0;n<r.length;n++){var i=r[n];t[i]=this[i]}if(t.hash=e.hash,""===e.href)return t.href=t.format(),t;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),s=0;s<a.length;s++){var o=a[s];"protocol"!==o&&(t[o]=e[o])}return N[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(e.protocol&&e.protocol!==t.protocol){if(!N[e.protocol]){for(var l=Object.keys(e),u=0;u<l.length;u++){var d=l[u];t[d]=e[d]}return t.href=t.format(),t}if(t.protocol=e.protocol,e.host||M[e.protocol])t.pathname=e.pathname;else{for(var h=(e.pathname||"").split("/");h.length&&!(e.host=h.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==h[0]&&h.unshift(""),h.length<2&&h.unshift(""),t.pathname=h.join("/")}return t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(p=t.pathname||"",g=t.search||"",t.path=p+g),t.slashes=t.slashes||e.slashes,t.href=t.format(),t}var c=t.pathname&&"/"===t.pathname.charAt(0),f=e.host||e.pathname&&"/"===e.pathname.charAt(0),p=f||c||t.host&&e.pathname,g=p,m=t.pathname&&t.pathname.split("/")||[],h=e.pathname&&e.pathname.split("/")||[],c=t.protocol&&!N[t.protocol];if(c&&(t.hostname="",t.port=null,t.host&&(""===m[0]?m[0]=t.host:m.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===h[0]?h[0]=e.host:h.unshift(e.host)),e.host=null),p=p&&(""===h[0]||""===m[0])),f)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,m=h;else if(h.length)(m=m||[]).pop(),m=m.concat(h),t.search=e.search,t.query=e.query;else if(!R.isNullOrUndefined(e.search))return c&&(t.hostname=t.host=m.shift(),(E=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=E.shift(),t.host=t.hostname=E.shift())),t.search=e.search,t.query=e.query,R.isNull(t.pathname)&&R.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(!m.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var v=m.slice(-1)[0],f=(t.host||e.host||1<m.length)&&("."===v||".."===v)||""===v,y=0,b=m.length;0<=b;b--)"."===(v=m[b])?m.splice(b,1):".."===v?(m.splice(b,1),y++):y&&(m.splice(b,1),y--);if(!p&&!g)for(;y--;)m.unshift("..");!p||""===m[0]||m[0]&&"/"===m[0].charAt(0)||m.unshift(""),f&&"/"!==m.join("/").substr(-1)&&m.push("");var E,f=""===m[0]||m[0]&&"/"===m[0].charAt(0);return c&&(t.hostname=t.host=!f&&m.length?m.shift():"",(E=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=E.shift(),t.host=t.hostname=E.shift())),(p=p||t.host&&m.length)&&!f&&m.unshift(""),m.length?t.pathname=m.join("/"):(t.pathname=null,t.path=null),R.isNull(t.pathname)&&R.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t.href=t.format(),t},T.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,x,P){(function(f,g){var m;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(){"object"==typeof x&&x&&x.nodeType,"object"==typeof f&&f&&f.nodeType;var e="object"==typeof g&&g;e.global!==e&&e.window!==e&&e.self;var t,v=2147483647,y=36,b=1,E=26,i=38,a=700,T=72,S=128,_="-",r=/^xn--/,n=/[^\x20-\x7E]/,s=/[\x2E\u3002\uFF0E\uFF61]/g,o={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},l=y-b,w=Math.floor,L=String.fromCharCode;function A(e){throw new RangeError(o[e])}function u(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function d(e,t){var r=e.split("@"),n="";return 1<r.length&&(n=r[0]+"@",e=r[1]),n+u((e=e.replace(s,".")).split("."),t).join(".")}function R(e){for(var t,r,n=[],i=0,a=e.length;i<a;)55296<=(t=e.charCodeAt(i++))&&t<=56319&&i<a?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function p(e){return u(e,function(e){var t="";return 65535<e&&(t+=L((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=L(e)}).join("")}function D(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function k(e,t,r){var n=0;for(e=r?w(e/a):e>>1,e+=w(e/t);l*E>>1<e;n+=y)e=w(e/l);return w(n+(l+1)*e/(e+i))}function h(e){var t,r,n,i,a,s,o,l=[],u=e.length,d=0,h=S,c=T,f=e.lastIndexOf(_);for(f<0&&(f=0),r=0;r<f;++r)128<=e.charCodeAt(r)&&A("not-basic"),l.push(e.charCodeAt(r));for(n=0<f?f+1:0;n<u;){for(i=d,a=1,s=y;u<=n&&A("invalid-input"),o=e.charCodeAt(n++),(y<=(o=o-48<10?o-22:o-65<26?o-65:o-97<26?o-97:y)||o>w((v-d)/a))&&A("overflow"),d+=o*a,!(o<(o=s<=c?b:c+E<=s?E:s-c));s+=y)a>w(v/(o=y-o))&&A("overflow"),a*=o;c=k(d-i,t=l.length+1,0==i),w(d/t)>v-h&&A("overflow"),h+=w(d/t),d%=t,l.splice(d++,0,h)}return p(l)}function c(e){for(var t,r,n,i,a,s,o,l,u,d,h,c=[],f=(e=R(e)).length,p=S,g=T,m=t=0;m<f;++m)(l=e[m])<128&&c.push(L(l));for(r=n=c.length,n&&c.push(_);r<f;){for(i=v,m=0;m<f;++m)p<=(l=e[m])&&l<i&&(i=l);for(i-p>w((v-t)/(u=r+1))&&A("overflow"),t+=(i-p)*u,p=i,m=0;m<f;++m)if((l=e[m])<p&&++t>v&&A("overflow"),l==p){for(a=t,s=y;!(a<(o=s<=g?b:g+E<=s?E:s-g));s+=y)h=a-o,d=y-o,c.push(L(D(o+h%d,0))),a=w(h/d);c.push(L(D(a,0))),g=k(t,u,r==n),t=0,++r}++t,++p}return c.join("")}t={version:"1.4.1",ucs2:{decode:R,encode:p},decode:h,encode:c,toASCII:function(e){return d(e,function(e){return n.test(e)?"xn--"+c(e):e})},toUnicode:function(e){return d(e,function(e){return r.test(e)?h(e.slice(4).toLowerCase()):e})}},void 0===(m=function(){return t}.call(x,P,x,f))||(f.exports=m)}()}).call(x,P(46)(e),P(3))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){"use strict";t.decode=t.parse=r(49),t.encode=t.stringify=r(50)},function(e,t,r){"use strict";e.exports=function(e,t,r,n){t=t||"&",r=r||"=";var i={};if("string"!=typeof e||0===e.length)return i;var a=/\+/g;e=e.split(t);t=1e3;n&&"number"==typeof n.maxKeys&&(t=n.maxKeys);var s=e.length;0<t&&t<s&&(s=t);for(var o=0;o<s;++o){var l,u=e[o].replace(a,"%20"),d=u.indexOf(r),h=0<=d?(l=u.substr(0,d),u.substr(d+1)):(l=u,""),c=decodeURIComponent(l),d=decodeURIComponent(h);u=i,h=c,Object.prototype.hasOwnProperty.call(u,h)?f(i[c])?i[c].push(d):i[c]=[i[c],d]:i[c]=d}return i};var f=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";function a(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}e.exports=function(r,n,i,e){return n=n||"&",i=i||"=",null===r&&(r=void 0),"object"==typeof r?o(l(r),function(e){var t=encodeURIComponent(a(e))+i;return s(r[e])?o(r[e],function(e){return t+encodeURIComponent(a(e))}).join(n):t+encodeURIComponent(a(r[e]))}).join(n):e?encodeURIComponent(a(e))+i+encodeURIComponent(a(r)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var l=Object.keys||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r}},function(e,t){
/*! http://mths.be/endswith v0.2.0 by @mathias */
String.prototype.endsWith||function(){"use strict";function e(e){if(null==this)throw TypeError();var t=String(this);if(e&&"[object RegExp]"==l.call(e))throw TypeError();var r=t.length,n=String(e),i=n.length,a=r;1<arguments.length&&(void 0!==(e=arguments[1])&&(a=e?Number(e):0)!=a&&(a=0));var s=Math.min(Math.max(a,0),r)-i;if(s<0)return!1;for(var o=-1;++o<i;)if(t.charCodeAt(s+o)!=n.charCodeAt(o))return!1;return!0}var t=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),l={}.toString;t?t(String.prototype,"endsWith",{value:e,configurable:!0,writable:!0}):String.prototype.endsWith=e}()}],n.c=i,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=27).default;function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var r,i},t.exports=e()}).call(this,r("URgk").setImmediate,r("URgk").clearImmediate)},"4JlD":function(e,t,r){"use strict";function a(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}e.exports=function(r,n,i,e){return n=n||"&",i=i||"=",null===r&&(r=void 0),"object"==typeof r?o(l(r),function(e){var t=encodeURIComponent(a(e))+i;return s(r[e])?o(r[e],function(e){return t+encodeURIComponent(a(e))}).join(n):t+encodeURIComponent(a(r[e]))}).join(n):e?encodeURIComponent(a(e))+i+encodeURIComponent(a(r)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var l=Object.keys||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r}},B8Yt:function(e,t){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},CxY0:function(e,t,r){"use strict";var A=r("GYWy"),R=r("Nehr");function T(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=i,t.resolve=function(e,t){return i(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},t.format=function(e){R.isString(e)&&(e=i(e));return e instanceof T?e.format():T.prototype.format.call(e)},t.Url=T;var D=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,k=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,t=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),x=["'"].concat(t),P=["%","/","?",";","#"].concat(x),O=["/","?","#"],I=/^[+a-z0-9A-Z_-]{0,63}$/,C=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,F={javascript:!0,"javascript:":!0},M={javascript:!0,"javascript:":!0},N={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},U=r("s4NR");function i(e,t,r){if(e&&R.isObject(e)&&e instanceof T)return e;var n=new T;return n.parse(e,t,r),n}T.prototype.parse=function(e,t,r){if(!R.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),i=-1!==n&&n<e.indexOf("#")?"?":"#",n=e.split(i);n[0]=n[0].replace(/\\/g,"/");var a=(a=e=n.join(i)).trim();if(!r&&1===e.split("#").length){var s=k.exec(a);if(s)return this.path=a,this.href=a,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?U.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var o,s=D.exec(a);if(s&&(L=(s=s[0]).toLowerCase(),this.protocol=L,a=a.substr(s.length)),(r||s||a.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(o="//"===a.substr(0,2))||s&&M[s]||(a=a.substr(2),this.slashes=!0)),!M[s]&&(o||s&&!N[s])){for(var l=-1,u=0;u<O.length;u++)-1!==(d=a.indexOf(O[u]))&&(-1===l||d<l)&&(l=d);-1!==(T=-1===l?a.lastIndexOf("@"):a.lastIndexOf("@",l))&&(S=a.slice(0,T),a=a.slice(T+1),this.auth=decodeURIComponent(S)),l=-1;for(var d,u=0;u<P.length;u++)-1!==(d=a.indexOf(P[u]))&&(-1===l||d<l)&&(l=d);-1===l&&(l=a.length),this.host=a.slice(0,l),a=a.slice(l),this.parseHost(),this.hostname=this.hostname||"";var h="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!h)for(var c=this.hostname.split(/\./),u=0,f=c.length;u<f;u++){var p=c[u];if(p&&!p.match(I)){for(var g="",m=0,v=p.length;m<v;m++)127<p.charCodeAt(m)?g+="x":g+=p[m];if(!g.match(I)){var y=c.slice(0,u),b=c.slice(u+1),E=p.match(C);E&&(y.push(E[1]),b.unshift(E[2])),b.length&&(a="/"+b.join(".")+a),this.hostname=y.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),h||(this.hostname=A.toASCII(this.hostname));var T=this.port?":"+this.port:"",S=this.hostname||"";this.host=S+T,this.href+=this.host,h&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!F[L])for(u=0,f=x.length;u<f;u++){var _,w=x[u];-1!==a.indexOf(w)&&((_=encodeURIComponent(w))===w&&(_=escape(w)),a=a.split(w).join(_))}h=a.indexOf("#");-1!==h&&(this.hash=a.substr(h),a=a.slice(0,h));var L,h=a.indexOf("?");return-1!==h?(this.search=a.substr(h),this.query=a.substr(h+1),t&&(this.query=U.parse(this.query)),a=a.slice(0,h)):t&&(this.search="",this.query={}),a&&(this.pathname=a),N[L]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(T=this.pathname||"",L=this.search||"",this.path=T+L),this.href=this.format(),this},T.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,a="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&R.isObject(this.query)&&Object.keys(this.query).length&&(a=U.stringify(this.query));a=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||N[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i=i||"",n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+n},T.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},T.prototype.resolveObject=function(e){R.isString(e)&&((f=new T).parse(e,!1,!0),e=f);for(var t=new T,r=Object.keys(this),n=0;n<r.length;n++){var i=r[n];t[i]=this[i]}if(t.hash=e.hash,""===e.href)return t.href=t.format(),t;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),s=0;s<a.length;s++){var o=a[s];"protocol"!==o&&(t[o]=e[o])}return N[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(e.protocol&&e.protocol!==t.protocol){if(!N[e.protocol]){for(var l=Object.keys(e),u=0;u<l.length;u++){var d=l[u];t[d]=e[d]}return t.href=t.format(),t}if(t.protocol=e.protocol,e.host||M[e.protocol])t.pathname=e.pathname;else{for(var h=(e.pathname||"").split("/");h.length&&!(e.host=h.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==h[0]&&h.unshift(""),h.length<2&&h.unshift(""),t.pathname=h.join("/")}return t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(p=t.pathname||"",g=t.search||"",t.path=p+g),t.slashes=t.slashes||e.slashes,t.href=t.format(),t}var c=t.pathname&&"/"===t.pathname.charAt(0),f=e.host||e.pathname&&"/"===e.pathname.charAt(0),p=f||c||t.host&&e.pathname,g=p,m=t.pathname&&t.pathname.split("/")||[],h=e.pathname&&e.pathname.split("/")||[],c=t.protocol&&!N[t.protocol];if(c&&(t.hostname="",t.port=null,t.host&&(""===m[0]?m[0]=t.host:m.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===h[0]?h[0]=e.host:h.unshift(e.host)),e.host=null),p=p&&(""===h[0]||""===m[0])),f)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,m=h;else if(h.length)(m=m||[]).pop(),m=m.concat(h),t.search=e.search,t.query=e.query;else if(!R.isNullOrUndefined(e.search))return c&&(t.hostname=t.host=m.shift(),(E=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=E.shift(),t.host=t.hostname=E.shift())),t.search=e.search,t.query=e.query,R.isNull(t.pathname)&&R.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(!m.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var v=m.slice(-1)[0],f=(t.host||e.host||1<m.length)&&("."===v||".."===v)||""===v,y=0,b=m.length;0<=b;b--)"."===(v=m[b])?m.splice(b,1):".."===v?(m.splice(b,1),y++):y&&(m.splice(b,1),y--);if(!p&&!g)for(;y--;)m.unshift("..");!p||""===m[0]||m[0]&&"/"===m[0].charAt(0)||m.unshift(""),f&&"/"!==m.join("/").substr(-1)&&m.push("");var E,f=""===m[0]||m[0]&&"/"===m[0].charAt(0);return c&&(t.hostname=t.host=!f&&m.length?m.shift():"",(E=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=E.shift(),t.host=t.hostname=E.shift())),(p=p||t.host&&m.length)&&!f&&m.unshift(""),m.length?t.pathname=m.join("/"):(t.pathname=null,t.path=null),R.isNull(t.pathname)&&R.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes,t.href=t.format(),t},T.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},DbZ5:function(e,t,r){"use strict";var s=r("ybjB").codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,r,n){var i,a=(i=n,a=r,null!=(t=t).highWaterMark?t.highWaterMark:i?t[a]:null);if(null==a)return e.objectMode?16:16384;if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new s(n?r:"highWaterMark",a);return Math.floor(a)}}},GYWy:function(e,x,P){(function(f,g){var m;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(){x&&x.nodeType,f&&f.nodeType;var e="object"==typeof g&&g;e.global!==e&&e.window!==e&&e.self;var t,v=2147483647,y=36,b=1,E=26,i=38,a=700,T=72,S=128,_="-",r=/^xn--/,n=/[^\x20-\x7E]/,s=/[\x2E\u3002\uFF0E\uFF61]/g,o={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},l=y-b,w=Math.floor,L=String.fromCharCode;function A(e){throw new RangeError(o[e])}function u(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function d(e,t){var r=e.split("@"),n="";return 1<r.length&&(n=r[0]+"@",e=r[1]),n+u((e=e.replace(s,".")).split("."),t).join(".")}function R(e){for(var t,r,n=[],i=0,a=e.length;i<a;)55296<=(t=e.charCodeAt(i++))&&t<=56319&&i<a?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function p(e){return u(e,function(e){var t="";return 65535<e&&(t+=L((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=L(e)}).join("")}function D(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function k(e,t,r){var n=0;for(e=r?w(e/a):e>>1,e+=w(e/t);l*E>>1<e;n+=y)e=w(e/l);return w(n+(l+1)*e/(e+i))}function h(e){var t,r,n,i,a,s,o,l=[],u=e.length,d=0,h=S,c=T,f=e.lastIndexOf(_);for(f<0&&(f=0),r=0;r<f;++r)128<=e.charCodeAt(r)&&A("not-basic"),l.push(e.charCodeAt(r));for(n=0<f?f+1:0;n<u;){for(i=d,a=1,s=y;u<=n&&A("invalid-input"),o=e.charCodeAt(n++),(y<=(o=o-48<10?o-22:o-65<26?o-65:o-97<26?o-97:y)||o>w((v-d)/a))&&A("overflow"),d+=o*a,!(o<(o=s<=c?b:c+E<=s?E:s-c));s+=y)a>w(v/(o=y-o))&&A("overflow"),a*=o;c=k(d-i,t=l.length+1,0==i),w(d/t)>v-h&&A("overflow"),h+=w(d/t),d%=t,l.splice(d++,0,h)}return p(l)}function c(e){for(var t,r,n,i,a,s,o,l,u,d,h,c=[],f=(e=R(e)).length,p=S,g=T,m=t=0;m<f;++m)(l=e[m])<128&&c.push(L(l));for(r=n=c.length,n&&c.push(_);r<f;){for(i=v,m=0;m<f;++m)p<=(l=e[m])&&l<i&&(i=l);for(i-p>w((v-t)/(u=r+1))&&A("overflow"),t+=(i-p)*u,p=i,m=0;m<f;++m)if((l=e[m])<p&&++t>v&&A("overflow"),l==p){for(a=t,s=y;!(a<(o=s<=g?b:g+E<=s?E:s-g));s+=y)h=a-o,d=y-o,c.push(L(D(o+h%d,0))),a=w(h/d);c.push(L(D(a,0))),g=k(t,u,r==n),t=0,++r}++t,++p}return c.join("")}t={version:"1.4.1",ucs2:{decode:R,encode:p},decode:h,encode:c,toASCII:function(e){return d(e,function(e){return n.test(e)?"xn--"+c(e):e})},toUnicode:function(e){return d(e,function(e){return r.test(e)?h(e.slice(4).toLowerCase()):e})}},void 0===(m=function(){return t}.call(x,P,x,f))||(f.exports=m)}()}).call(this,P("YuTi")(e),P("yLpj"))},J78i:function(e,t,r){"use strict";e.exports=l;var e=r("ybjB").codes,n=e.ERR_METHOD_NOT_IMPLEMENTED,i=e.ERR_MULTIPLE_CALLBACK,a=e.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=e.ERR_TRANSFORM_WITH_LENGTH_0,o=r("sZro");function l(e){if(!(this instanceof l))return new l(e);o.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new i);r.writechunk=null,(r.writecb=null)!=t&&this.push(t),n(e),(e=this._readableState).reading=!1,(e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",u)}function u(){var r=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush(function(e,t){d(r,e,t)})}function d(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new s;if(e._transformState.transforming)throw new a;return e.push(null)}r("P7XM")(l,o),l.prototype.push=function(e,t){return this._transformState.needTransform=!1,o.prototype.push.call(this,e,t)},l.prototype._transform=function(e,t,r){r(new n("_transform()"))},l.prototype._write=function(e,t,r){var n=this._transformState;n.writecb=r,n.writechunk=e,n.writeencoding=t,n.transforming||(t=this._readableState,(n.needTransform||t.needReadable||t.length<t.highWaterMark)&&this._read(t.highWaterMark))},l.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},l.prototype._destroy=function(e,t){o.prototype._destroy.call(this,e,function(e){t(e)})}},JeXc:function(e,t,r){var n;"undefined"!=typeof window&&(n=function(){return n={},i.m=r={"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,f="~";function i(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,r,n,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");i=new a(r,n||e,i),t=f?f+t:t;return e._events[t]?e._events[t].fn?e._events[t]=[e._events[t],i]:e._events[t].push(i):(e._events[t]=i,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(f=!1)),o.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(f?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var e=f?f+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,n=t.length,i=new Array(n);r<n;r++)i[r]=t[r].fn;return i},o.prototype.listenerCount=function(e){e=f?f+e:e,e=this._events[e];return e?e.fn?1:e.length:0},o.prototype.emit=function(e,t,r,n,i,a){var s=f?f+e:e;if(!this._events[s])return!1;var o,l=this._events[s],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,i),!0;case 6:return l.fn.call(l.context,t,r,n,i,a),!0}for(c=1,o=new Array(u-1);c<u;c++)o[c-1]=arguments[c];l.fn.apply(l.context,o)}else for(var d,h=l.length,c=0;c<h;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),u){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,r);break;case 4:l[c].fn.call(l[c].context,t,r,n);break;default:if(!o)for(d=1,o=new Array(u-1);d<u;d++)o[d-1]=arguments[d];l[c].fn.apply(l[c].context,o)}return!0},o.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,r,n){e=f?f+e:e;if(!this._events[e])return this;if(!t)return l(this,e),this;var i=this._events[e];if(i.fn)i.fn!==t||n&&!i.once||r&&i.context!==r||l(this,e);else{for(var a=0,s=[],o=i.length;a<o;a++)(i[a].fn!==t||n&&!i[a].once||r&&i[a].context!==r)&&s.push(i[a]);s.length?this._events[e]=1===s.length?s[0]:s:l(this,e)}return this},o.prototype.removeAllListeners=function(e){return e?(e=f?f+e:e,this._events[e]&&l(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=f,o.EventEmitter=o,e.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */function(e,t,r){var n,a,i,s,o;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,a=/^([^\/?#]*)(.*)$/,i=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=o.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}n=o.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return r.alwaysNormalize?(n.path=o.normalizePath(n.path),o.buildURLFromParts(n)):t;t=o.parseURL(e);if(!t)throw new Error("Error trying to parse base URL.");!t.netLoc&&t.path&&"/"!==t.path[0]&&(i=a.exec(t.path),t.netLoc=i[1],t.path=i[2]),t.netLoc&&!t.path&&(t.path="/");var i,e={scheme:t.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};return n.netLoc||(e.netLoc=t.netLoc,"/"!==n.path[0]&&(n.path?(i=(i=t.path).substring(0,i.lastIndexOf("/")+1)+n.path,e.path=o.normalizePath(i)):(e.path=t.path,n.params||(e.params=t.params,n.query||(e.query=t.query))))),null===e.path&&(e.path=r.alwaysNormalize?o.normalizePath(n.path):n.path),o.buildURLFromParts(e)},parseURL:function(e){e=n.exec(e);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */function(e,t,h){function a(r){var n={};function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=r,i.c=n,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var e=i(i.s=ENTRY_MODULE);return e.default||e}var c="[\\.|\\-|\\+|\\w|/|@]+",f="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+c+").*?\\)";function p(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function g(e,t,r){var n={};n[r]=[];var i=t.toString(),t=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!t)return n;for(var a,t=t[1],s=new RegExp("(\\\\n|\\W)"+p(t)+f,"g");a=s.exec(i);)"dll-reference"!==a[3]&&n[r].push(a[3]);for(s=new RegExp("\\("+p(t)+'\\("(dll-reference\\s('+c+'))"\\)\\)'+f,"g");a=s.exec(i);)e[a[2]]||(n[r].push(a[1]),e[a[2]]=h(a[1]).m),n[a[2]]=n[a[2]]||[],n[a[2]].push(a[4]);for(var o,l=Object.keys(n),u=0;u<l.length;u++)for(var d=0;d<n[l[u]].length;d++)o=n[l[u]][d],isNaN(+o)||(n[l[u]][d]=+n[l[u]][d]);return n}function s(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};function(r){return Object.keys(r).reduce(function(e,t){return e||0<r[t].length},!1)}(r);)for(var a=Object.keys(r),s=0;s<a.length;s++){var o=a[s],l=r[o].pop();if(i[o]=i[o]||{},!i[o][l]&&e[o][l]){i[o][l]=!0,n[o]=n[o]||[],n[o].push(l);for(var u=g(e,e[o][l],o),d=Object.keys(u),h=0;h<d.length;h++)r[d[h]]=r[d[h]]||[],r[d[h]]=r[d[h]].concat(u[d[h]])}}return n}e.exports=function(e,t){t=t||{};var r={main:h.m},n=t.all?{main:Object.keys(r.main)}:s(r,e),i="";Object.keys(n).filter(function(e){return"main"!==e}).forEach(function(t){for(var e=0;n[t][e];)e++;n[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+"var "+t+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n[t].map(function(e){return JSON.stringify(e)+": "+r[t][e].toString()}).join(",")+"});\n"}),i=i+"new (("+a.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map(function(e){return JSON.stringify(e)+": "+r.main[e].toString()}).join(",")+"}))(self);";e=new window.Blob([i],{type:"text/javascript"});if(t.bare)return e;t=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(e),e=new window.Worker(t);return e.objectURL=t,e}},"./src/config.ts":
/*!***********************!*\
  !*** ./src/config.ts ***!
  \***********************/
/*! exports provided: hlsDefaultConfig, mergeConfig, setStreamingMode */function(e,t,r){"use strict";r.r(t),r.d(t,"hlsDefaultConfig",function(){return p}),r.d(t,"mergeConfig",function(){return g}),r.d(t,"setStreamingMode",function(){return v});var n=r(/*! ./controller/abr-controller */"./src/controller/abr-controller.ts"),i=r(/*! ./controller/audio-stream-controller */"./src/empty.js"),a=r(/*! ./controller/buffer-controller */"./src/controller/buffer-controller.ts"),s=r(/*! ./controller/cap-level-controller */"./src/controller/cap-level-controller.ts"),o=r(/*! ./controller/fps-controller */"./src/controller/fps-controller.ts"),l=r(/*! ./utils/xhr-loader */"./src/utils/xhr-loader.ts"),u=r(/*! ./utils/fetch-loader */"./src/utils/fetch-loader.ts"),t=r(/*! ./utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts"),d=r(/*! ./utils/logger */"./src/utils/logger.ts");function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function c(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function f(n){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach(function(e){var t,r;t=n,e=i[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})}return n}var p=f(f(f({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,minLiveSyncPlaybackRate:.75,maxLiveSyncPlaybackRate:1.5,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:l.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:n.default,bufferController:a.default,capLevelController:s.default,fpsController:o.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!1,userConfig:{},mildomLevelMaxReloadInterval:2e3,mildomFragMaxParallelLoadNum:2,mildomRealtimePlaybackMode:!1},{cueHandler:i,enableCEA708Captions:!1,enableWebVTT:!1,enableIMSC1:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{mildomMaxBufferSizeThreshold:1e4,mildomBufferSizeLimitionDuration:15e3,mildomChasePositionBefore:9e3,mildomSpeedResetFactor:.2,mildomSpeedDownRate:.92,mildomSpeedUpRate:1.08,mildomSpeedUpMinBufferDuration:15e3,mildomSpeedMaxBufferSizeThreshold:15e3,mildomSpeedResetBufferSizeThreshold:9e3,mildomSpeedUpBufferGap:8e3,mildomSpeedResetBufferGap:2e3}),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0});function g(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return h({},e,t)}var m=Object(u.fetchSupported)();function v(e,t){var r=e.loader;if(r!==u.default&&r!==l.default)return d.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),void(e.progressive=!1);t&&m?(e.loader=u.default,e.progressive=!0,e.enableSoftwareAES=!0,d.logger.log("[config]: Progressive streaming enabled, using FetchLoader")):(e.loader=l.default,e.progressive=!1,d.logger.log("[config]: Progressive streaming disabled, using XhrLoader"))}},"./src/controller/abr-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/abr-controller.ts ***!
  \******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var v=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),y=r(/*! ../events */"./src/events.ts"),b=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),i=r(/*! ../errors */"./src/errors.ts"),E=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=r(/*! ../utils/ewma-bandwidth-estimator */"./src/utils/ewma-bandwidth-estimator.ts");function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var T=self.performance,r=function(){function e(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.bitrateTestDelay=0,this.mildomBootTime=0,this.bwEstimator=void 0;e=(this.hls=e).config;this.bwEstimator=new a.default(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.mildomBootTime=0,this.registerListeners()}var t,r,n=e.prototype;return n.registerListeners=function(){var e=this.hls;e.on(y.Events.FRAG_LOADING,this.onFragLoading,this),e.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var e=this.hls;e.off(y.Events.FRAG_LOADING,this.onFragLoading,this),e.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(y.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.Events.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.clearTimer()},n.onFragLoading=function(e,t){t=t.frag;"main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=self.setInterval(this.onCheck,100)))},n.onLevelLoaded=function(e,t){var r=this.hls.config;t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),0===this.mildomBootTime&&(this.mildomBootTime=T.now())},n._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.hls,r=t.autoLevelEnabled,n=t.config,i=t.media;if(e&&i){var a=e.loader;if(!a||a.stats.aborted)return E.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!i.paused&&i.playbackRate&&i.readyState){var s=a.stats,o=T.now()-s.loading.start,l=Math.abs(i.playbackRate);if(!(o<=500*e.duration/l)){var u=t.levels,d=t.minAutoLevel,h=u[e.level],r=s.total||Math.max(s.loaded,Math.round(e.duration*h.maxBitrate/8)),c=Math.max(1,s.bwEstimate?s.bwEstimate/8:1e3*s.loaded/o),h=(r-s.loaded)/c,r=i.currentTime,f=(b.BufferHelper.bufferInfo(i,r,n.maxBufferHole).end-r)/l;if(!(f>=2*e.duration/l||h<=f)){for(var p=Number.POSITIVE_INFINITY,g=e.level-1;d<g;g--){var m=u[g].maxBitrate;if((p=e.duration*m/(6.4*c))<f)break}h<=p||(l=this.bwEstimator.getEstimate(),E.logger.warn("Fragment "+e.sn+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+g+"\n      Current BW estimate: "+(Object(v.isFiniteNumber)(l)?(l/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+h.toFixed(3)+" s\n      Estimated load time for the next fragment: "+p.toFixed(3)+" s\n      Time to underbuffer: "+f.toFixed(3)+" s"),t.nextLoadLevel=g,this.bwEstimator.sample(o,s.loaded),a.abort(),this.clearTimer(),t.trigger(y.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,stats:s}))}}}}},n.onFragLoaded=function(e,t){var r,n,i=t.frag,a=i.stats;"main"===i.type&&Object(v.isFiniteNumber)(i.sn)&&(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(n=((r=this.hls.levels[i.level]).loaded?r.loaded.bytes:0)+a.loaded,a=(r.loaded?r.loaded.duration:0)+i.duration,r.loaded={bytes:n,duration:a},r.realBitrate=Math.round(8*n/a)),i.bitrateTest&&(t={stats:t.frag.stats,frag:t.frag},this.onFragBuffered(y.Events.FRAG_BUFFERED,t)))},n.onFragBuffered=function(e,t){var r=t.frag,n=r.stats;n.aborted||"main"!==r.type||"initSegment"===r.sn||r.bitrateTest||(t=n.parsing.end-n.loading.start,this.bwEstimator.sample(t,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=t/1e3:this.bitrateTestDelay=0)},n.onError=function(e,t){switch(t.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},n.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},n._findBestLevel=function(e,t,r,n,i,a,s,o,l){for(var u=i;n<=u;u--){var d=l[u];if(d){var h=d.details,c=(null==h?void 0:h.averagetargetduration)||t,f=!!h&&h.live,p=void 0,p=u<=e?s*r:o*r,d=l[u].maxBitrate,h=d*c/p;if(E.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+d+"/"+c+"/"+a+"/"+h),d<p&&(!h||f&&!this.bitrateTestDelay||h<a))return u}}return-1},t=e,(n=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;t=this._nextABRAutoLevel;return-1!==e&&(t=Math.min(e,t)),0!==this.mildomBootTime&&T.now()-this.mildomBootTime<=1e4&&(t=Math.min(this.lastLoadedFragLevel,t)),t},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.fragCurrent,t=this.hls,r=this.lastLoadedFragLevel,n=t.maxAutoLevel,i=t.levels,a=t.config,s=t.minAutoLevel,o=t.media,l=e?e.duration:0,u=o?o.currentTime:0,d=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():a.abrEwmaDefaultEstimate,c=(b.BufferHelper.bufferInfo(o,u,a.maxBufferHole).end-u)/d,t=this._findBestLevel(r,l,h,s,n,c,a.abrBandWidthFactor,a.abrBandWidthUpFactor,i);if(0<=t)return t;E.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");e=l?Math.min(l,a.maxStarvationDelay):a.maxStarvationDelay,o=a.abrBandWidthFactor,u=a.abrBandWidthUpFactor;return c||(d=this.bitrateTestDelay)&&(e=(l?Math.min(l,a.maxLoadingDelay):a.maxLoadingDelay)-d,E.logger.trace("bitrate test took "+Math.round(1e3*d)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*e)+" ms"),o=u=1),t=this._findBestLevel(r,l,h,s,n,c+e,o,u,i),Math.max(t,0)}}])&&s(t.prototype,n),r&&s(t,r),e}();t.default=r},"./src/controller/base-playlist-controller.ts":
/*!****************************************************!*\
  !*** ./src/controller/base-playlist-controller.ts ***!
  \****************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var o=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),d=r(/*! ../types/level */"./src/types/level.ts"),h=r(/*! ./level-helper */"./src/controller/level-helper.ts"),c=r(/*! ../utils/logger */"./src/utils/logger.ts"),n=function(){function e(e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer()},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var r=null==t?void 0:t.renditionReports;if(r)for(var n=0;n<r.length;n++){var i=r[n],a=""+i.URI;if(a===e.substr(-a.length)){var s=parseInt(i["LAST-MSN"]),a=parseInt(i["LAST-PART"]);if(t&&this.hls.config.lowLatencyMode&&(i=Math.min(t.age-t.partTarget,t.targetduration),void 0!==a&&i>t.partTarget&&(a+=1)),Object(o.isFiniteNumber)(s))return new d.HlsUrlParameters(s,Object(o.isFiniteNumber)(a)?a:void 0,d.HlsSkip.No)}}},t.loadPlaylist=function(e){},t.shouldLoadTrack=function(e){return this.canLoad&&e&&!!e.url&&(!e.details||e.details.live)},t.playlistLoaded=function(e,t,r){var n=this,i=t.details,a=t.stats;if(i.live){if(i.reloaded(r),r&&c.logger.log("["+this.constructor.name+"] live playlist "+e+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),r&&0<i.fragments.length&&h.mergeDetails(r,i),this.canLoad){if(i.canBlockReload&&i.endSN&&i.advanced){var s,o=this.hls.config.lowLatencyMode,l=i.lastPartIndex,o=o?(s=-1!==l?i.lastPartSn:i.endSN+1,-1!==l?l+1:void 0):(s=-1!==l?i.lastPartSn+1:i.endSN+1,-1!==l?0:void 0),l=Math.min(i.age-i.partTarget,1.5*i.targetduration);0<l&&(r&&l>r.tuneInGoal?(c.logger.warn("["+this.constructor.name+"] CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+l+" with playlist age: "+i.age),l=0):(s+=u=Math.floor(l/i.targetduration),void 0!==o&&(o+=Math.round(l%i.targetduration/i.partTarget)),c.logger.log("["+this.constructor.name+"] CDN Tune-in age: "+i.age+" goal: "+l+" skip sn "+u+" to part "+o)),i.tuneInGoal=l);var u=Object(d.getSkipValue)(i,s);return null!==(l=t.deliveryDirectives)&&void 0!==l&&l.skip&&i.deltaUpdateFailed&&(s=t.deliveryDirectives.msn,o=t.deliveryDirectives.part,u=d.HlsSkip.No),void this.loadPlaylist(new d.HlsUrlParameters(s,o,u))}a=Math.min(this.hls.config.mildomLevelMaxReloadInterval,Object(h.computeReloadInterval)(i,a));c.logger.log("["+this.constructor.name+"] reload live playlist "+e+" in "+Math.round(a)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist()},a)}}else this.clearTimer()},t.retryLoadingOrFail=function(e){var t,r=this,n=this.hls.config,i=this.retryCount<n.levelLoadingMaxRetry;return i?(this.retryCount++,-1<e.details.indexOf("LoadTimeOut")&&null!==(t=e.context)&&void 0!==t&&t.deliveryDirectives?(c.logger.warn("["+this.constructor.name+"]: retry playlist loading #"+this.retryCount+' after "'+e.details+'"'),this.loadPlaylist()):(n=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout),this.timer=self.setTimeout(function(){return r.loadPlaylist()},n),c.logger.warn("["+this.constructor.name+"]: retry playlist loading #"+this.retryCount+" in "+n+' ms after "'+e.details+'"'))):(c.logger.error(this.constructor.name+']: cannot recover from error "'+e.details+'"'),this.clearTimer(),e.fatal=!0),i},e}()},"./src/controller/base-stream-controller.ts":
/*!**************************************************!*\
  !*** ./src/controller/base-stream-controller.ts ***!
  \**************************************************/
/*! exports provided: State, default */function(e,t,r){"use strict";r.r(t),r.d(t,"State",function(){return y}),r.d(t,"default",function(){return n});var s=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),t=r(/*! ../task-loop */"./src/task-loop.ts"),o=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),l=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),u=r(/*! ../utils/logger */"./src/utils/logger.ts"),d=r(/*! ../events */"./src/events.ts"),a=r(/*! ../errors */"./src/errors.ts"),h=r(/*! ./level-helper */"./src/controller/level-helper.ts"),c=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),f=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),p=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),g=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),m=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts");function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},n=function(n){function e(e,t){var r=n.call(this)||this;return r.hls=void 0,r.fragPrevious=null,r.fragCurrent=null,r.fragmentTracker=void 0,r.transmuxer=null,r._state=y.STOPPED,r.media=void 0,r.mediaBuffer=void 0,r.config=void 0,r.lastCurrentTime=0,r.nextLoadPosition=0,r.startPosition=0,r.loadedmetadata=!1,r.fragLoadError=0,r.levels=null,r.fragmentLoader=void 0,r.levelLastLoaded=null,r.startFragRequested=!1,r.decrypter=void 0,r.initPTS=[],r.mildomFragmentRequestManager=null,r.logPrefix="",r.hls=e,r.fragmentTracker=t,r.config=e.config,r.decrypter=new m.default(e,e.config),r}t=n,(i=e).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t;var t,r,i=e.prototype;return i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(e){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=y.STOPPED},i._streamEnded=function(e,t){var r=this.fragCurrent,n=this.fragmentTracker;if(t.live&&!this.hls.isMildomLiveEnd||!r||r.backtracked||r.sn!==t.endSN||e.nextStart)return!1;r=n.getState(r);return r===o.FragmentState.PARTIAL||r===o.FragmentState.OK},i.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,r=this.media,n=this.mediaBuffer,i=this.state,a=r?r.currentTime:null,n=l.BufferHelper.bufferInfo(n||r,a,e.maxBufferHole);this.log("media seeking to "+(Object(s.isFiniteNumber)(a)?a.toFixed(3):a)+", state: "+i),i===y.ENDED?(n.len||(this.fragPrevious=null,this.fragCurrent=null),this.state=y.IDLE):t&&!n.len&&(n=e.maxFragLookUpTolerance,e=t.start-n,n=t.start+t.duration+n,(a<e||n<a)&&(t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),this.mildomFragmentRequestManager&&this.mildomFragmentRequestManager.abort(),this.state=y.IDLE)),r&&(this.lastCurrentTime=a),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=a),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),n.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=y.STOPPED,n.prototype.onHandlerDestroyed.call(this)},i._loadFragForPlayback=function(r,e){var n=this;this._doFragLoad(r,e,function(e){if(n._fragLoadAborted(r))return n.warn("Fragment "+r.sn+" of level "+r.level+" was aborted during progressive download."),void n.fragmentTracker.removeFragment(r);r.stats.chunkCount++,n.mildomFragmentRequestManager?n.mildomFragmentRequestManager.enquePendingFragParse(r,n._handleFragmentLoadProgress.bind(n,e)):n._handleFragmentLoadProgress(e)}).then(function(e){n.fragLoadError=0;var t=n._fragLoadAborted(r);e&&!t&&(n.log("Loaded fragment "+r.sn+" of level "+r.level),n.hls.trigger(d.Events.FRAG_LOADED,e),n._handleFragmentLoadComplete(e))})},i._loadInitSegment=function(a){var s=this;this._doFragLoad(a).then(function(e){if(!e||s._fragLoadAborted(a)||!s.levels)throw new Error("init load aborted");return e}).then(function(r){var n=s.hls,e=r.payload,t=a.decryptdata;if(e&&0<e.byteLength&&t&&t.key&&t.iv&&"AES-128"===t.method){var i=performance.now();return s.decrypter.webCryptoDecrypt(new Uint8Array(e),t.key.buffer,t.iv.buffer).then(function(e){var t=performance.now();return n.trigger(d.Events.FRAG_DECRYPTED,{frag:a,payload:e,stats:{tstart:i,tdecrypt:t}}),r.payload=e,r})}return r}).then(function(e){var t=s.fragCurrent,r=s.hls,n=s.levels;if(!n)throw new Error("init load aborted, missing levels");var i=n[a.level].details;console.assert(i,"Level details are defined when init segment is loaded");n=i.initSegment;console.assert(n,"Fragment initSegment is defined when init segment is loaded");i=a.stats;s.state=y.IDLE,s.fragLoadError=0,n.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),e.frag===t&&r.trigger(d.Events.FRAG_BUFFERED,{stats:i,frag:t,id:a.type}),s.tick()}).catch(function(e){u.logger.warn(e)})},i._fragLoadAborted=function(e){if(this.mildomFragmentRequestManager)return this.mildomFragmentRequestManager.isFragAborted(e);var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn},i._handleFragmentLoadComplete=function(e){var t,r=this.transmuxer;r&&(t=e.frag,e=(e=e.part)?e.index:-1,(e=new c.ChunkMetadata(t.level,t.sn,t.stats.chunkCount+1,0,e)).transmuxing.start=performance.now(),r.flush(e))},i._handleFragmentLoadProgress=function(e){},i._doFragLoad=function(t,e,r){var n=this;return void 0===e&&(e=null),this.state=y.FRAG_LOADING,this.hls.trigger(d.Events.FRAG_LOADING,{frag:t,targetBufferTime:e}),this.fragmentLoader.load(t,e,r).catch(function(e){e=e.data;return e&&e.details===a.ErrorDetails.INTERNAL_ABORTED?n.handleFragLoadAborted(t,e.part):n.hls.trigger(d.Events.ERROR,e),null})},i._handleTransmuxerFlush=function(e){var t,r=this.getCurrentContext(e);!r||this.state!==y.PARSING&&this.hls.config.mildomFragMaxParallelLoadNum<=1?this.fragCurrent||(this.state=y.IDLE):(t=r.frag,e=r.partIndex,r=r.level,t&&(t.stats.parsing.end=performance.now(),this.updateLevelTiming(t,r),this.state=y.PARSED,this.hls.trigger(d.Events.FRAG_PARSED,{frag:t,partIndex:e})))},i.getCurrentContext=function(e){var t=this.levels,r=this.mildomFragmentRequestManager?this.mildomFragmentRequestManager.currentParseFrag:this.fragCurrent,n=e.level,i=e.sn;if(!t||!t[n])return this.warn("Levels object was unset while buffering fragment "+i+" of level "+n+". The current chunk will not be buffered."),null;n=t[n],i=h.getFragmentWithSN(n,i);return this._fragLoadAborted(i)?null:{frag:r,partIndex:e.part,level:n}},i.bufferFragmentData=function(e,t,r){var n,i,a;e&&this.state===y.PARSING&&(n=e.data1,i=e.data2,(a=n)&&i&&(a=Object(f.appendUint8Array)(n,i)),a&&a.length&&(r={type:e.type,data:a,frag:t,chunkMeta:r},this.hls.trigger(d.Events.BUFFER_APPENDING,r),this.tick()))},i.getNextFragment=function(e,t){var r=this.config,n=this.startFragRequested,i=t.fragments,a=i.length;if(!a)return null;var s,o=i[0].start,l=t.edge;if(t.initSegment&&!t.initSegment.data)s=t.initSegment;else if(t.live){r=r.initialLiveManifestSize;if(a<r)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+r+")"),null;t.PTSKnown||n||(s=this.getInitialLiveFragment(t,i))}else e<o&&(s=i[0]);return s=s||this.getFragmentAtPosition(e,l,t)},i.getInitialLiveFragment=function(e,t){var r=this.config,n=this.fragPrevious,i=null;return n&&(e.hasProgramDateTime?(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),i=Object(g.findFragmentByPDT)(t,n.endProgramDateTime,r.maxFragLookUpTolerance)):((r=n.sn+1)>=e.startSN&&r<=e.endSN&&(e=t[r-e.startSN],n.cc===e.cc&&(i=e,this.log("Live playlist, switching playlist, load frag with next SN: "+i.sn))),i||(i=Object(g.findFragWithCC)(t,n.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+i.sn))),i},i.getFragmentAtPosition=function(e,t,r){var n,i=this.config,a=this.fragPrevious,s=r.fragments,i=i.maxFragLookUpTolerance;return(t=e<t?(n=t-i<e?0:i,Object(g.findFragmentByPTS)(a,s,e,n)):s[s.length-1])&&(i=t.sn-r.startSN,e=a&&t.level===a.level,n=s[i-1],s=s[1+i],a&&t.sn===a.sn&&(e&&!t.backtracked?t.sn<r.endSN?(t=s,this.fragmentTracker.getState(t)!==o.FragmentState.OK&&this.log("SN just loaded, load next one: "+t.sn)):t=null:t.backtracked&&(null!=s&&s.backtracked?(this.warn("Already backtracked from fragment "+s.sn+", will not backtrack to fragment "+t.sn+". Loading fragment "+s.sn),t=s):(t.dropped=0,n?(t=n).backtracked=!0:i&&(t=null))))),t},i.synchronizeToLiveEdge=function(e){var t=this.config,r=this.media,n=this.hls.liveSyncPosition,i=r.currentTime;if(null!==n&&null!=r&&r.readyState&&r.duration>n&&i<n){var a=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration,s=e.fragments[0].start,e=e.edge;if(i<Math.max(s-t.maxFragLookUpTolerance,e-a))return this.warn("Playback: "+i.toFixed(3)+" is located too far from the end of live sliding playlist: "+e+", reset currentTime to : "+n.toFixed(3)),(!this.loadedmetadata||1<this.hls.config.mildomFragMaxParallelLoadNum)&&(this.nextLoadPosition=n),r.currentTime=n}return null},i.alignPlaylists=function(e,t){var r=this.levels,n=this.levelLastLoaded,r=null!==n?r[n]:null,n=0;return t&&0<e.fragments.length?(n=e.fragments[0].start,e.alignedSliding&&Object(s.isFiniteNumber)(n)?this.log("Live playlist sliding:"+n.toFixed(3)):n||(this.warn("["+this.constructor.name+"] Live playlist - outdated PTS, unknown sliding"),Object(p.alignStream)(this.fragPrevious,r,e))):(this.log("Live playlist - first load, unknown sliding"),Object(p.alignStream)(this.fragPrevious,r,e)),n},i.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},i.setStartPosition=function(e,t){var r;-1!==this.startPosition&&-1!==this.lastCurrentTime||(r=e.startTimeOffset,Object(s.isFiniteNumber)(r)?(r<0&&(this.log("Negative start time offset "+r+", count from end of last fragment"),r=t+e.totalduration+r),this.log("Start time offset found in playlist, adjust startPosition to "+r),this.startPosition=r):e.live?(this.startPosition=this.hls.liveSyncPosition||t,this.log("Configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition},i.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},i.handleFragLoadAborted=function(t,e){var r=this.transmuxer;r&&"initSegment"!==t.sn&&r.flush(new c.ChunkMetadata(t.level,t.sn,t.stats.chunkCount+1,0,e?e.index:-1)),Object.keys(t.elementaryStreams).forEach(function(e){t.elementaryStreams[e]=null}),this.log("Fragment "+t.sn+" of level "+t.level+" was aborted, flushing transmuxer & resetting nextLoadPosition to "+this.nextLoadPosition),this.mildomFragmentRequestManager&&this.mildomFragmentRequestManager.onFragLoadAborted(t)},i.updateLevelTiming=function(n,i){var a=this,s=i.details;console.assert(!!s,"level.details must be defined"),Object.keys(n.elementaryStreams).forEach(function(e){var t,r=n.elementaryStreams[e];r&&(t=h.updateFragPTSDTS(s,n,r.startPTS,r.endPTS,r.startDTS,r.endDTS),a.hls.trigger(d.Events.LEVEL_PTS_UPDATED,{details:s,level:i,drift:t,type:e,start:r.startPTS,end:r.endPTS}))})},i.log=function(e){u.logger.log(this.logPrefix+": "+e)},i.warn=function(e){u.logger.warn(this.logPrefix+": "+e)},t=e,(i=[{key:"state",set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))},get:function(){return this._state}}])&&v(t.prototype,i),r&&v(t,r),e}(t.default)},"./src/controller/buffer-controller.ts":
/*!*********************************************!*\
  !*** ./src/controller/buffer-controller.ts ***!
  \*********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return o});var s=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),h=r(/*! ../events */"./src/events.ts"),c=r(/*! ../utils/logger */"./src/utils/logger.ts"),f=r(/*! ../errors */"./src/errors.ts"),p=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),t=r(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),a=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),n=r(/*! ./buffer-operation-queue */"./src/controller/buffer-operation-queue.ts"),i=Object(t.getMediaSource)(),o=function(){function e(e){var n=this;this._msDuration=null,this._levelTargetDuration=null,this._live=!1,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=n.hls,t=n.media,r=n.mediaSource;c.logger.log("media source opened"),t?e.trigger(h.Events.MEDIA_ATTACHED,{media:t}):c.logger.log("[buffer-controller]: Media source opened, and no media was attached"),r&&r.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},this._onMediaSourceClose=function(){c.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){c.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners()},t.registerListeners=function(){var e=this.hls;e.on(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(h.Events.BUFFER_RESET,this.onBufferReset,this),e.on(h.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(h.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(h.Events.BUFFER_EOS,this.onBufferEos,this),e.on(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(h.Events.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this),e.on(h.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(h.Events.FRAG_PARSED,this.onFragParsed,this)},t.unregisterListeners=function(){var e=this.hls;e.off(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(h.Events.BUFFER_RESET,this.onBufferReset,this),e.off(h.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(h.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(h.Events.BUFFER_EOS,this.onBufferEos,this),e.off(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(h.Events.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this),e.off(h.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(h.Events.FRAG_PARSED,this.onFragParsed,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new n.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},t.onManifestParsed=function(e,t){var r=2;(!t.audio||t.video)&&t.altAudio||(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var r=this.media=t.media;r&&i&&((t=this.mediaSource=new i).addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(t),this._objectUrl=r.src)},t.onMediaDetaching=function(){c.logger.log("media source detaching");var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){c.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):c.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(h.Events.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var r=this,n=this.sourceBuffer;this.getSourceBufferTypes().forEach(function(t){var e=n[t];try{e&&(r.removeBufferListeners(t),r.mediaSource&&r.mediaSource.removeSourceBuffer(e),n[t]=void 0)}catch(e){c.logger.warn("Failed to reset the "+t+" buffer",e)}}),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var r=this;Object.keys(this.sourceBuffer).length||(Object.keys(t).forEach(function(e){r.pendingTracks[e]=t[e]}),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.onBufferAppending=function(e,t){var i=this,r=this.hls,n=this.operationQueue,a=t.data,s=t.type,o=t.frag,l=t.chunkMeta,u=l.buffering[s],d=o.stats.buffering,t=performance.now();u.start=t,d.start||(d.start=t);t={execute:function(){u.executeStart=performance.now(),i.appendExecutor(a,s)},onStart:function(){c.logger.debug("[buffer-controller]: "+s+" SourceBuffer updatestart")},onComplete:function(){c.logger.debug("[buffer-controller]: "+s+" SourceBuffer updateend");var e=performance.now();u.executeEnd=u.end=e,d.first||(d.first=e);var t,r=i.sourceBuffer,n={};for(t in r)n[t]=p.BufferHelper.getBuffered(r[t]);i.appendError=0,i.hls.trigger(h.Events.BUFFER_APPENDED,{parent:o.type,timeRanges:n,frag:o,chunkMeta:l})},onError:function(e){c.logger.error("[buffer-controller]: Error encountered while trying to append to the "+s+" SourceBuffer",e);var t={type:f.ErrorTypes.MEDIA_ERROR,parent:o.type,details:f.ErrorDetails.BUFFER_APPEND_ERROR,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=f.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,t.details=f.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>r.config.appendErrorMaxRetry&&(c.logger.log("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0)),r.trigger(h.Events.ERROR,t)}};n.append(t,s)},t.onBufferFlushing=function(e,r){function t(t){return{execute:n.removeExecutor.bind(n,t,r.startOffset,r.endOffset),onStart:function(){c.logger.debug("[buffer-controller]: Started flushing "+r.startOffset+" -> "+r.endOffset+" for "+t+" Source Buffer")},onComplete:function(){c.logger.debug("[buffer-controller]: Finished flushing "+r.startOffset+" -> "+r.endOffset+" for "+t+" Source Buffer"),n.hls.trigger(h.Events.BUFFER_FLUSHED,{type:t})},onError:function(e){c.logger.warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",e)}}}var n=this,i=this.operationQueue;r.type?i.append(t(r.type),r.type):(i.append(t("audio"),"audio"),i.append(t("video"),"video"))},t.onFragParsed=function(e,t){var r=this,n=t.frag,i=[];n.elementaryStreams[a.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(n.elementaryStreams[a.ElementaryStreamTypes.AUDIO]&&i.push("audio"),n.elementaryStreams[a.ElementaryStreamTypes.VIDEO]&&i.push("video"));t=function(){n.stats.buffering.end=self.performance.now(),r.hls.trigger(h.Events.FRAG_BUFFERED,{frag:n,stats:n.stats,id:n.type})};if(0===i.length)return c.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),void t();this.blockBuffers(t,i),this.flushLiveBackBuffer()},t.onBufferEos=function(e,t){var r,n,i=this;for(r in this.sourceBuffer)t.type&&t.type!==r||(n=this.sourceBuffer[r])&&!n.ended&&(n.ended=!0,c.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS"));c.logger.log("[buffer-controller: End of stream signalled, enqueuing end of stream operation"),this.blockBuffers(function(){var e=i.mediaSource;e&&"open"===e.readyState&&(c.logger.log("[buffer-controller]: Signaling end of stream"),e.endOfStream())})},t.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this._levelTargetDuration=r.levelTargetDuration,this._live=r.live,t=r.fragments[0].start+r.totalduration,c.logger.log("[buffer-controller]: Duration update required; enqueueing duration change operation"),this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this,t)):(this.updateMediaElementDuration(t),this.hls.config.liveDurationInfinity&&this.updateSeekableRange(r)))},t.onLevelPtsUpdated=function(e,t){var r,n=this.operationQueue,i=this.sourceBuffer,a=this.tracks,s=t.type,a=a.audio;"audio"!==s||a&&"audio/mpeg"!==a.container||(r=i[s])&&(Math.abs(r.timestampOffset-t.start)<.1||(i={execute:this.abortExecutor.bind(this,s),onStart:function(){c.logger.debug("[buffer-controller]: Starting abort on source buffer "+s)},onComplete:function(){r&&(c.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+t.start),r.timestampOffset=t.start)},onError:function(e){c.logger.warn("[buffer-controller]: Failed to abort the audio SourceBuffer",e)}},n.insertAbort(i,s),this.hls.config.liveDurationInfinity&&this.updateSeekableRange(t.details)))},t.flushLiveBackBuffer=function(){var r,n=this.hls,e=this._levelTargetDuration,t=this._live,i=this.media,a=this.sourceBuffer;i&&t&&null!==e&&(t=n.config.liveBackBufferLength,!Object(s.isFiniteNumber)(t)||t<0||(r=i.currentTime-Math.max(t,e),this.getSourceBufferTypes().forEach(function(e){var t=a[e];!t||0<(t=p.BufferHelper.getBuffered(t)).length&&r>t.start(0)&&(n.trigger(h.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r}),n.trigger(h.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:e}))})))},t.updateMediaElementDuration=function(e){var t,r,n,i,a;this.media&&this.mediaSource&&"open"===this.mediaSource.readyState&&(t=this.hls,r=this._live,i=this.media,n=this.mediaSource,a=this._msDuration,i=i.duration,null===(a=a)&&(this._msDuration=a=n.duration),r&&t.config.liveDurationInfinity?(c.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),this._msDuration=n.duration=1/0):(a<e&&i<e||!Object(s.isFiniteNumber)(i))&&(c.logger.log("[buffer-controller]: Updating Media Source duration to "+e.toFixed(3)),this._msDuration=n.duration=e))},t.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;r.length&&null!=t&&t.setLiveSeekableRange&&(e=(r=r[0].start)+e.totalduration,t.setLiveSeekableRange(r,e))},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,n=Object.keys(r).length;(n&&!e||2===n)&&(this.createSourceBuffers(r),this.pendingTracks={},Object.keys(this.sourceBuffer).forEach(function(e){t.executeNext(e)}))},t.createSourceBuffers=function(e){var t,r=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(t in e)if(!r[t]){var i=e[t];if(!i)throw Error("source buffer exists for track "+t+", however track does not");var a=i.levelCodec||i.codec,s=i.container+";codecs="+a;c.logger.log("creating sourceBuffer("+s+")");try{var o=r[t]=n.addSourceBuffer(s),l=t;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[t]={buffer:o,codec:a,container:i.container,levelCodec:i.levelCodec,id:i.id}}catch(e){c.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(h.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:s})}}this.hls.trigger(h.Events.BUFFER_CREATED,{tracks:this.tracks})},t._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){c.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(h.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});e=this.operationQueue.current(e);e&&e.onError(t)},t.removeExecutor=function(e,t,r){var n=this.media,i=this.operationQueue,a=this.sourceBuffer[e];if(!n||!a)return c.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(e);t=Math.max(0,t),r=Math.min(n.duration,r);t<r?(c.logger.log("[buffer-controller]: Removing ["+t+","+r+"] from the "+e+" SourceBuffer"),console.assert(!a.updating,e+" sourceBuffer must not be updating"),a.remove(t,r)):i.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var r=this.operationQueue,n=this.sourceBuffer[t];if(!n)return c.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);n.ended=!1,console.assert(!n.updating,t+" sourceBuffer must not be updating"),n.appendBuffer(e)},t.abortExecutor=function(e){var t=this.operationQueue,r=this.sourceBuffer[e];if(!r)return c.logger.warn("[buffer-controller]: Attempting to abort to the "+e+" SourceBuffer, but it does not exist"),void t.shiftAndExecuteNext(e);c.logger.log("[buffer-controller]: Aborting the "+e+" SourceBuffer");t=r.updating;r.abort(),t||this._onSBUpdateEnd(e)},t.blockBuffers=function(e,t){var r,n,i=this;void 0===t&&(t=this.getSourceBufferTypes()),t.length?(r=this.operationQueue,n=t.map(function(e){return r.appendBlocker(e)}),Promise.all(n).then(function(){e(),t.forEach(function(e){var t=i.sourceBuffer[e];t&&t.updating||r.shiftAndExecuteNext(e)})})):e()},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,r){var n=this.sourceBuffer[e];n&&(r=r.bind(this,e),this.listeners[e].push({event:t,listener:r}),n.addEventListener(t,r))},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(e){t.removeEventListener(e.event,e.listener)})},e}()},"./src/controller/buffer-operation-queue.ts":
/*!**************************************************!*\
  !*** ./src/controller/buffer-operation-queue.ts ***!
  \**************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var a=r(/*! ../utils/logger */"./src/utils/logger.ts"),n=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t,!0)},t.appendBlocker=function(e){var t,r=new Promise(function(e){t=e}),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),r},t.executeNext=function(t,e){var r=this.buffers,n=this.queues,r=r[t];console.assert(!r||e||!r.updating,t+" sourceBuffer must exist, and must not be updating");t=n[t];if(t.length){var i=t[0];try{i.execute()}catch(e){a.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),i.onError(e),r&&r.updating||t.shift()}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}()},"./src/controller/cap-level-controller.ts":
/*!************************************************!*\
  !*** ./src/controller/cap-level-controller.ts ***!
  \************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ../events */"./src/events.ts");function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r=function(){function i(e){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.levels=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=[],this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var e,t,r=i.prototype;return r.setStreamController=function(e){this.streamController=e},r.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},r.registerListeners=function(){var e=this.hls;e.on(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(n.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},r.unregisterListener=function(){var e=this.hls;e.off(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(n.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},r.onFpsDropLevelCapping=function(e,t){i.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},r.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null},r.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},r.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},r.onLevelsUpdated=function(e,t){this.levels=t.levels},r.onMediaDetaching=function(){this.stopCapping()},r.detectPlayerSize=function(){var e,t;this.media&&0<this.mediaHeight&&0<this.mediaWidth&&((e=this.levels?this.levels.length:0)&&((t=this.hls).autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping))},r.getMaxLevel=function(r){var n=this;if(!this.levels)return-1;var e=this.levels.filter(function(e,t){return i.isLevelAllowed(t,n.restrictedLevels)&&t<=r});return this.clientRect=null,i.getMaxLevelByMediaSize(e,this.mediaWidth,this.mediaHeight)},r.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},r.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},r.getDimensions=function(){if(this.clientRect)return this.clientRect;var e,t=this.media,r={width:0,height:0};return t&&(e=t.getBoundingClientRect(),r.width=e.width,r.height=e.height,r.width||r.height||(r.width=e.right-e.left||t.width||0,r.height=e.bottom-e.top||t.height||0)),this.clientRect=r},i.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},i.getMaxLevelByMediaSize=function(e,t,r){if(!e||e&&!e.length)return-1;for(var n,i,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=r)&&(n=o,!(i=e[s+1])||(n.width!==i.width||n.height!==i.height))){a=s;break}}return a},e=i,t=[{key:"contentScaleFactor",get:function(){var e=1;try{e=self.devicePixelRatio}catch(e){}return e}}],(r=[{key:"mediaWidth",get:function(){return this.getDimensions().width*i.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*i.contentScaleFactor}}])&&a(e.prototype,r),t&&a(e,t),i}();t.default=r},"./src/controller/fps-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/fps-controller.ts ***!
  \******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var l=r(/*! ../events */"./src/events.ts"),u=r(/*! ../utils/logger */"./src/utils/logger.ts"),d=self.performance,r=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(l.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(l.Events.MEDIA_ATTACHING,this.onMediaAttaching)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var r=this.hls.config;r.capLevelOnFPSDrop&&(t=t.media instanceof self.HTMLVideoElement?t.media:null,(this.media=t)&&"function"==typeof t.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setTimeout(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod))},t.checkFPS=function(e,t,r){var n,i,a,s,o=d.now();t&&(this.lastTime&&(a=o-this.lastTime,n=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,i=1e3*n/a,(a=this.hls).trigger(l.Events.FPS_DROP,{currentDropped:n,currentDecoded:s,totalDroppedFrames:r}),0<i&&n>a.config.fpsDroppedMonitoringThreshold*s&&(s=a.currentLevel,u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),0<s&&(-1===a.autoLevelCapping||a.autoLevelCapping>=s)&&(--s,a.trigger(l.Events.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:a.currentLevel}),a.autoLevelCapping=s,this.streamController.nextLevelSwitch()))),this.lastTime=o,this.lastDroppedFrames=r,this.lastDecodedFrames=t)},t.checkFPSInterval=function(){var e,t=this.media;t&&(this.isVideoPlaybackQualityAvailable?(e=t.getVideoPlaybackQuality(),this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)):this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount))},e}();t.default=r},"./src/controller/fragment-finders.ts":
/*!********************************************!*\
  !*** ./src/controller/fragment-finders.ts ***!
  \********************************************/
/*! exports provided: findFragmentByPDT, findFragmentByPTS, fragmentWithinToleranceTest, pdtWithinToleranceTest, findFragWithCC */function(e,t,r){"use strict";r.r(t),r.d(t,"findFragmentByPDT",function(){return n}),r.d(t,"findFragmentByPTS",function(){return i}),r.d(t,"fragmentWithinToleranceTest",function(){return o}),r.d(t,"pdtWithinToleranceTest",function(){return l}),r.d(t,"findFragWithCC",function(){return u});var a=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),s=r(/*! ../utils/binary-search */"./src/utils/binary-search.ts");function n(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!Object(a.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if((e[e.length-1].endProgramDateTime||0)<=t)return null;r=r||0;for(var n=0;n<e.length;++n){var i=e[n];if(l(t,r,i))return i}return null}function i(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=null;if(e?i=t[e.sn-t[0].sn+1]:0===r&&0===t[0].start&&(i=t[0]),i&&0===o(r,n,i))return i;n=s.default.search(t,o.bind(null,r,n));return n||i}function o(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0);t=Math.min(t,r.duration+(r.deltaPTS||0));return r.start+r.duration-t<=e?1:r.start-t>e&&r.start?-1:0}function l(e,t,r){t=1e3*Math.min(t,r.duration+(r.deltaPTS||0));return e<(r.endProgramDateTime||0)-t}function u(e,t){return s.default.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}},"./src/controller/fragment-tracker.ts":
/*!********************************************!*\
  !*** ./src/controller/fragment-tracker.ts ***!
  \********************************************/
/*! exports provided: FragmentState, FragmentTracker */function(e,t,r){"use strict";r.r(t),r.d(t,"FragmentState",function(){return n}),r.d(t,"FragmentTracker",function(){return a});var n,i=r(/*! ../events */"./src/events.ts");(r=n=n||{}).NOT_LOADED="NOT_LOADED",r.APPENDING="APPENDING",r.PARTIAL="PARTIAL",r.OK="OK";var a=function(){function e(e){this.activeFragment=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(i.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.on(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(i.Events.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(i.Events.BUFFER_APPENDED,this.onBufferAppended,this),e.off(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(i.Events.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this._unregisterListeners()},t.getAppendedFrag=function(e,t){var r=this.activeFragment;return r?void 0!==r.appendedPTS&&r.start<=e&&e<=r.appendedPTS?r:this.getBufferedFrag(e,t):null},t.getBufferedFrag=function(e,t){for(var r=this.fragments,n=Object.keys(r),i=n.length;i--;){var a=r[n[i]];if((null==a?void 0:a.body.type)===t&&a.buffered){a=a.body;if(a.start<=e&&e<=a.end)return a}}return null},t.detectEvictedFragments=function(r,n){var i=this;Object.keys(this.fragments).forEach(function(e){var t=i.fragments[e];t&&t.buffered&&((e=t.range[r])&&e.time.some(function(e){e=!i.isTimeBuffered(e.startPTS,e.endPTS,n);return e&&i.removeFragment(t.body),e}))})},t.detectPartialFragments=function(t){var r,n=this,i=this.timeRanges,e=this.fragments;!i||"initSegment"===t.sn||(r=e[s(t)])&&(r.buffered=!0,Object.keys(i).forEach(function(e){t.elementaryStreams[e]&&(r.range[e]=n.getBufferedTimes(t,i[e]))}))},t.getBufferedTimes=function(e,t){for(var r=[],n=!1,i=0;i<t.length;i++){var a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a,u=t.start(i)-this.bufferPadding,d=t.end(i)+this.bufferPadding;if(u<=l&&o<=d){r.push({startPTS:Math.max(a,t.start(i)),endPTS:Math.min(s,t.end(i))});break}if(a<d&&u<s)r.push({startPTS:Math.max(a,t.start(i)),endPTS:Math.min(s,t.end(i))}),n=!0;else if(s<=u)break}return{time:r,partial:n}},t.getPartialFragment=function(t){var r,n,i=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach(function(e){e=o[e];e&&l(e)&&(r=e.body.start-s,n=e.body.end+s,r<=t&&t<=n&&(n=Math.min(t-r,n-t),a<=n&&(i=e.body,a=n)))}),i},t.getState=function(e){e=s(e),e=this.fragments[e];return e?e.buffered?l(e)?n.PARTIAL:n.OK:n.APPENDING:n.NOT_LOADED},t.isTimeBuffered=function(e,t,r){for(var n,i,a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,n<=e&&t<=i)return!0;if(t<=n)return!1}return!1},t.onFragLoaded=function(e,t){t=t.frag;"initSegment"===t.sn||t.bitrateTest||(this.fragments[s(t)]={body:t,range:Object.create(null),buffered:!1})},t.onBufferAppended=function(e,t){var n=this,i=t.frag,a=t.timeRanges;this.activeFragment=i,this.timeRanges=a,Object.keys(a).forEach(function(e){var t=a[e];n.detectEvictedFragments(e,t);for(var r=0;r<t.length;r++)i.appendedPTS=Math.max(t.end(r),i.appendedPTS||0)})},t.onFragBuffered=function(e,t){this.detectPartialFragments(t.frag)},t.hasFragment=function(e){e=s(e);return!!this.fragments[e]},t.removeFragment=function(e){e=s(e);delete this.fragments[e]},t.removeAllFragments=function(){this.fragments=Object.create(null)},e}();function l(e){var t;return e.buffered&&(null!==(t=e.range.video)&&void 0!==t&&t.partial||null!==(e=e.range.audio)&&void 0!==e&&e.partial)}function s(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}},"./src/controller/gap-controller.ts":
/*!******************************************!*\
  !*** ./src/controller/gap-controller.ts ***!
  \******************************************/
/*! exports provided: STALL_MINIMUM_DURATION_MS, MAX_START_GAP_JUMP, SKIP_BUFFER_HOLE_STEP_SECONDS, SKIP_BUFFER_RANGE_START, default */function(e,t,r){"use strict";r.r(t),r.d(t,"STALL_MINIMUM_DURATION_MS",function(){return g}),r.d(t,"MAX_START_GAP_JUMP",function(){return m}),r.d(t,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return d}),r.d(t,"SKIP_BUFFER_RANGE_START",function(){return h}),r.d(t,"default",function(){return n});var c=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),u=r(/*! ../errors */"./src/errors.ts"),f=r(/*! ../events */"./src/events.ts"),p=r(/*! ../utils/logger */"./src/utils/logger.ts"),g=1e3,m=2,d=.1,h=.05,n=function(){function e(e,t,r,n){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=n}var t=e.prototype;return t.poll=function(e){var t=this.config,r=this.media,n=this.stalled,i=r.currentTime,a=r.seeking,s=this.seeking&&!a,o=!this.seeking&&a,l=self.performance.now();if(this.seeking=a,i!==e)return this.moved=!0,void(null!==n&&(this.stallReported&&(u=self.performance.now()-n,p.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(u)+"ms"),this.stallReported=!1,this.stalled&&this.hls.trigger(f.Events.MILDOM_STALL_RECOVER,{stallDuration:Math.round(self.performance.now()-this.stalled)})),this.stalled=null,this.nudgeRetry=0));if((o||s)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&c.BufferHelper.getBuffered(r).length){var u=c.BufferHelper.bufferInfo(r,i,0),o=0<u.len,s=u.nextStart||0;if(o||s){if(a){var o=u.len>m,d=!s||m<s-i&&!this.fragmentTracker.getPartialFragment(i);if(o||d)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var h,d=Math.max(s,u.start||0)-i,s=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,s=(null==s||null===(h=s.details)||void 0===h?void 0:h.live)?2*s.details.targetduration:m;if(0<d&&d<=s)return void this._trySkipBufferHole(null)}null!==n?(n=l-n,!a&&g<=n&&this._reportStall(u.len),t=c.BufferHelper.bufferInfo(r,i,t.maxBufferHole),this._tryFixBufferStall(t,n)):this.stalled=l}}},t._tryFixBufferStall=function(e,t){var r=this.config,n=this.fragmentTracker,i=this.media.currentTime,i=n.getPartialFragment(i);if(i&&this._trySkipBufferHole(i))return;e.len>r.maxBufferHole&&t>1e3*r.highBufferWatchdogPeriod&&(p.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,p.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,r=this.hls,n=this.media,i=n.currentTime,a=0,s=c.BufferHelper.getBuffered(n),o=0;o<s.length;o++){var l=s.start(o);if(i+t.maxBufferHole>=a&&i<l){l=Math.max(l+h,n.currentTime+d);return p.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+l),this.moved=!0,this.stalled=null,n.currentTime=l,e&&r.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+l,frag:e}),l}a=s.end(o)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,n=r.currentTime,i=(this.nudgeRetry||0)+1;(this.nudgeRetry=i)<e.nudgeMaxRetry?(i=n+i*e.nudgeOffset,p.logger.warn("Nudging 'currentTime' from "+n+" to "+i),r.currentTime=i,t.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(p.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0}))},e}()},"./src/controller/id3-track-controller.ts":
/*!************************************************!*\
  !*** ./src/controller/id3-track-controller.ts ***!
  \************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ../events */"./src/events.ts"),o=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),c=r(/*! ../demux/id3 */"./src/demux/id3.ts"),r=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners()},t._registerListeners=function(){var e=this.hls;e.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t._unregisterListeners=function(){var e=this.hls;e.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},t.onMediaAttached=function(e,t){this.media=t.media,this.media},t.onMediaDetaching=function(){this.id3Track&&(Object(o.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Object(o.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var r=t.frag,n=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var i=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,a=0;a<n.length;a++){var s=c.getID3Frames(n[a].data);if(s){var o=n[a].pts,l=a<n.length-1?n[a+1].pts:r.end;l-o<=0&&(l=o+.25);for(var u=0;u<s.length;u++){var d,h=s[u];c.isTimeStampFrame(h)||((d=new i(o,l,"")).value=h,this.id3Track.addCue(d))}}}}},t.onBufferFlushing=function(e,t){var r=t.startOffset,n=t.endOffset,t=t.type;if(!t||"audio"===t){var i=this.id3Track;if(i&&i.cues&&i.cues.length)for(var a=Object(o.getCuesInRange)(i.cues,r,n),s=0;s<a.length;s++)i.removeCue(a[s])}},e}();t.default=r},"./src/controller/latency-controller.ts":
/*!**********************************************!*\
  !*** ./src/controller/latency-controller.ts ***!
  \**********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts");function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t,r,n=e.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetaching()},n.registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(a.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(a.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(a.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(a.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(a.Events.ERROR,this.onError)},n.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},n.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},n.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},n.onLevelUpdated=function(e,t){t=t.details;(this.levelDetails=t).advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},n.onError=function(e,t){t.details===i.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,s.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},n.timeupdate=function(){},n.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},n.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},t=e,(n=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,r=e.partHoldBack,n=e.targetduration,i=this.config,a=i.liveSyncDuration,s=i.liveSyncDurationCount,o=i.lowLatencyMode,i=this.hls.userConfig,t=o&&r||t;if(i.liveSyncDuration||i.liveSyncDurationCount||0===t){for(var l=e.fragments,u=0,d=l.length-s;d<l.length&&l.length>=s;d++)u+=l[d].duration;u=u||s*n,t=void 0!==a?a:u}e=e.targetduration;return t+Math.min(+this.stallCount,e)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency;return null===e||null===t||null===this.levelDetails?null:Math.min(this.levelDetails.edge,e-t-this.edgeStalled)}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}}])&&o(t.prototype,n),r&&o(t,r),e}()},"./src/controller/level-controller.ts":
/*!********************************************!*\
  !*** ./src/controller/level-controller.ts ***!
  \********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var c=r(/*! ../types/level */"./src/types/level.ts"),f=r(/*! ../events */"./src/events.ts"),p=r(/*! ../utils/logger */"./src/utils/logger.ts"),g=r(/*! ../errors */"./src/errors.ts"),m=r(/*! ../utils/codecs */"./src/utils/codecs.ts"),v=r(/*! ./level-helper */"./src/controller/level-helper.ts"),t=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),a=r(/*! ./mildom/mildom-level-controller-manager */"./src/controller/mildom/mildom-level-controller-manager.ts");function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var b=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function(r){function e(e){var t=r.call(this,e)||this;return t._levels=[],t._firstLevel=-1,t._startLevel=void 0,t.currentLevelIndex=-1,t.manualLevelIndex=-1,t.mildomLevelController=void 0,t.onParsedComplete=void 0,t._registerListeners(),e&&(t.mildomLevelController=new a.MildomLevelController(e,t.loadPlaylist.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t))),t.mildomLevelController.run()),t}t=r,(i=e).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t;var t,n,i=e.prototype;return i._registerListeners=function(){var e=this.hls;e.on(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(f.Events.ERROR,this.onError,this)},i._unregisterListeners=function(){var e=this.hls;e.off(f.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(f.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(f.Events.ERROR,this.onError,this)},i.destroy=function(){r.prototype.destroy.call(this),this._unregisterListeners(),this.manualLevelIndex=-1,this.mildomLevelController&&this.mildomLevelController.destroy()},i.startLoad=function(){this._levels.forEach(function(e){e.loadError=0}),r.prototype.startLoad.call(this)},i.onManifestLoaded=function(e,t){var r,n,i=[],a=[],s=[],o={},l=!1,u=!1;if(t.levels.forEach(function(e){var t=e.attrs;l=l||!!e.videoCodec,u=u||!!e.audioCodec,b&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(n=o[e.bitrate])?n.url.push(e.url):(n=new c.Level(e),o[e.bitrate]=n,i.push(n)),t&&(t.AUDIO&&Object(v.addGroupId)(n,"audio",t.AUDIO),t.SUBTITLES&&Object(v.addGroupId)(n,"text",t.SUBTITLES))}),l&&u&&(i=i.filter(function(e){return!!e.videoCodec})),i=i.filter(function(e){var t=e.audioCodec,e=e.videoCodec;return(!t||Object(m.isCodecSupportedInMp4)(t,"audio"))&&(!e||Object(m.isCodecSupportedInMp4)(e,"video"))}),this.hls.config.mildomFilterLevels&&(i=this.hls.config.mildomFilterLevels(i)),t.audioTracks&&(a=t.audioTracks.filter(function(e){return!e.audioCodec||Object(m.isCodecSupportedInMp4)(e.audioCodec,"audio")})).forEach(function(e,t){e.id=t}),t.subtitles&&(s=t.subtitles.map(function(e,t){return y({id:t},e)})),0<i.length){r=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i;for(var d=0;d<i.length;d++)if(i[d].bitrate===r){this._firstLevel=d,p.logger.log("[level-controller]: manifest loaded, "+i.length+" level(s) found, first bitrate: "+r);break}var h=u&&!l,a={levels:i,audioTracks:a,subtitleTracks:s,firstLevel:this._firstLevel,stats:t.stats,audio:u,video:l,altAudio:!h&&a.some(function(e){return!!e.url})};this.hls.trigger(f.Events.MANIFEST_PARSED,a),this.onParsedComplete()}else this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},i.onError=function(e,t){if(t.fatal)t.type===g.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var r,n=!1,i=!1,a=!0;switch(t.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:console.assert(t.frag,"Event has a fragment defined."),r=t.frag.level,i=!0;break;case g.ErrorDetails.LEVEL_LOAD_ERROR:case g.ErrorDetails.LEVEL_LOAD_TIMEOUT:t.context&&(t.context.deliveryDirectives&&(a=!1),r=t.context.level),n=!0;break;case g.ErrorDetails.REMUX_ALLOC_ERROR:r=t.level,n=!0}void 0!==r&&this.recoverLevel(t,r,n,i,a)}},i.recoverLevel=function(e,t,r,n,i){var a=e.details,s=this._levels[t];if(s.loadError++,s.fragmentError=n,r){if(!this.retryLoadingOrFail(e))return void(this.currentLevelIndex=-1);e.levelRetry=!0}i&&(r||n)&&(1<(r=s.url.length)&&s.loadError<r?(s.urlId=(s.urlId+1)%r,s.details=void 0,p.logger.warn("[level-controller]: "+a+" for level "+t+": switching to redundant URL-id "+s.urlId)):(-1===this.manualLevelIndex&&(t=0===t?this._levels.length-1:t-1,this.currentLevelIndex!==t&&(n=!1,p.logger.warn("[level-controller]: "+a+": switch to "+t),this.hls.nextAutoLevel=this.currentLevelIndex=t)),n&&(p.logger.warn("[level-controller]: "+a+": reload a fragment"),this.currentLevelIndex=-1)))},i.onFragLoaded=function(e,t){t=t.frag;void 0===t||"main"!==t.type||void 0!==(t=this._levels[t.level])&&(t.fragmentError=!1,t.loadError=0)},i.onLevelLoaded=function(e,t){var r=t.level,n=t.details,i=this._levels[r];this.mildomLevelController&&this.mildomLevelController.switchToRealtimePlaybackLoadMode(n),i?(p.logger.log("[level-controller]: level "+r+" loaded ["+n.startSN+"-"+n.endSN+"]"),r===this.currentLevelIndex&&(i.fragmentError||(i.loadError=0,this.retryCount=0),this.playlistLoaded(r,t,i.details))):p.logger.warn("[level-controller]: Invalid level index:",r)},i.onAudioTrackSwitched=function(e,t){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var n=-1,i=this.hls.audioTracks[t.id].groupId,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===i){n=a;break}n!==r.urlId&&(r.urlId=n,this.startLoad())}},i.loadPlaylist=function(e){var t=this.currentLevelIndex,r=this._levels[t];if(this.canLoad&&r&&0<r.url.length){var n=r.urlId,i=r.url[n];if(e)try{i=e.addDirectives(i)}catch(e){p.logger.warn("[level-controller] Could not construct new URL with HLS Delivery Directives: "+e)}p.logger.log("[level-controller]: Attempt loading level index "+t+(e?" at sn "+e.msn+" part "+e.part:"")+" with URL-id "+n+" "+i),this.clearTimer(),this.hls.trigger(f.Events.LEVEL_LOADING,{url:i,level:t,id:n,deliveryDirectives:e||null})}},i.removeLevel=function(r,n){var e=this._levels.filter(function(e,t){return t!==r||1<e.url.length&&void 0!==n&&(e.url=e.url.filter(function(e,t){return t!==n}),!(e.urlId=0))}).map(function(e,t){var r=e.details;return null!=r&&r.fragments&&r.fragments.forEach(function(e){e.level=t}),e});this._levels=e,this.hls.trigger(f.Events.LEVELS_UPDATED,{levels:e})},t=e,(i=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,r,n=this._levels;this.currentLevelIndex===e&&null!==(r=n[e])&&void 0!==r&&r.details||(e<0||e>=n.length?this.hls.trigger(f.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"}):(this.clearTimer(),r=n[t=this.currentLevelIndex],n=n[e],p.logger.log("[level-controller]: switching to level "+e+" from "+t),this.currentLevelIndex=e,this.hls.trigger(f.Events.LEVEL_SWITCHING,y({},n,{level:e})),(e=n.details)&&!e.live||(r=this.switchParams(n.uri,null==r?void 0:r.details),this.loadPlaylist(r))))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&s(t.prototype,i),n&&s(t,n),e}(t.default)},"./src/controller/level-helper.ts":
/*!****************************************!*\
  !*** ./src/controller/level-helper.ts ***!
  \****************************************/
/*! exports provided: addGroupId, updatePTS, updateFragPTSDTS, mergeDetails, mapFragmentIntersection, adjustSliding, computeReloadInterval, getFragmentWithSN */function(e,t,r){"use strict";r.r(t),r.d(t,"addGroupId",function(){return n}),r.d(t,"updatePTS",function(){return i}),r.d(t,"updateFragPTSDTS",function(){return d}),r.d(t,"mergeDetails",function(){return a}),r.d(t,"mapFragmentIntersection",function(){return h}),r.d(t,"adjustSliding",function(){return c}),r.d(t,"computeReloadInterval",function(){return s}),r.d(t,"getFragmentWithSN",function(){return o});var f=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),u=r(/*! ../utils/logger */"./src/utils/logger.ts");function n(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}}function i(e,t,r){p(e[t],e[r])}function p(e,t){var r,n=t.startPTS;Object(f.isFiniteNumber)(n)?(r=0,(n=t.sn>e.sn?(r=n-e.start,e):(r=e.start-n,t)).duration!==r&&(n.duration=r)):t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function d(e,t,r,n,i,a){var s,o=r,l=n,u=t.startPTS,d=t.endPTS;Object(f.isFiniteNumber)(u)&&(s=Math.abs(u-r),Object(f.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(s,t.deltaPTS):t.deltaPTS=s,o=Math.max(r,u),r=Math.min(r,u),l=Math.min(n,d),n=Math.max(n,d),i=Math.min(i,t.startDTS),a=Math.max(a,t.endDTS));u=n-r,d=r-t.start;t.appendedPTS=n,t.start=t.startPTS=r,t.maxStartPTS=o,t.startDTS=i,t.endPTS=n,t.minEndPTS=l,t.endDTS=a,t.duration=u,console.assert(0<t.duration,"Fragment should have a positive duration",t);var h,u=t.sn;if(!e||u<e.startSN||u>e.endSN)return 0;var u=u-e.startSN,c=e.fragments;for(c[u]=t,h=u;0<h;h--)p(c[h],c[h-1]);for(h=u;h<c.length-1;h++)p(c[h],c[h+1]);return e.fragmentHint&&p(c[c.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function a(e,r){var t;r.initSegment&&e.initSegment&&(r.initSegment=e.initSegment);var n,i=0,a=(null===(t=e.fragments[e.fragments.length-1])||void 0===t?void 0:t.cc)||null;if(h(e,r,function(e,t){i=e.cc-t.cc,Object(f.isFiniteNumber)(e.startPTS)&&Object(f.isFiniteNumber)(e.endPTS)&&(t.start=t.startPTS=e.startPTS,t.startDTS=e.startDTS,t.appendedPTS=e.appendedPTS,t.maxStartPTS=e.maxStartPTS,e.hasParts||(t.endPTS=e.endPTS,t.endDTS=e.endDTS,t.minEndPTS=e.minEndPTS,t.duration=e.endPTS-e.startPTS),t.backtracked=e.backtracked,t.dropped=e.dropped,n=t,0===r.startSN&&null!==a&&(t.cc+=a+1),r.PTSKnown=r.alignedSliding=!0),t.stats=e.stats,t.loader=e.loader,t.urlId=e.urlId}),r.skippedSegments&&(r.deltaUpdateFailed=r.fragments.some(function(e){return!e}),r.deltaUpdateFailed)){u.logger.warn("["+this.constructor.name+"] Previous playlist missing segments skipped in delta playlist");for(var s=r.skippedSegments;s--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}var o=r.fragments;if(i){u.logger.log("discontinuity sliding from playlist, take drift into account");for(var l=0;l<o.length;l++)o[l].cc+=i}r.skippedSegments&&(r.initSegment||(r.initSegment=e.initSegment),r.startCC=r.fragments[0].cc),n?d(r,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):c(e,r),o.length&&(r.totalduration=r.edge-o[0].start)}function h(e,t,r){for(var n=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,a=(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=i;o<=a;o++){var l=e.fragments[s+o],u=t.fragments[o];n&&!u&&o<n&&(u=t.fragments[o]=l),l&&u&&r(l,u,o)}}function c(e,t){var r=t.startSN+t.skippedSegments-e.startSN,e=e.fragments,n=t.fragments;if(!(r<0||r>=e.length)){var i=e[r].start;if(i){for(var a=t.skippedSegments;a<n.length;a++)n[a].start+=i;t.fragmentHint&&(t.fragmentHint.start+=i)}}}function s(e,t){var r=1e3*e.levelTargetDuration,n=r/2,i=e.lastModified?+new Date-e.lastModified:0,a=0<i&&i<3*r,s=t?t.loading.end-t.loading.start:0,o=r,l=e.availabilityDelay;return!1===e.updated?a?(t=333*e.misses,o=Math.max(Math.min(n,2*s),t),e.availabilityDelay=(e.availabilityDelay||0)+o):o=n:o=a?(l=Math.min(l||r/2,i),(e.availabilityDelay=l)+r-i):r-s,Math.round(o)}function o(e,t){if(!e||!e.details)return null;e=e.details;return e.fragments[t-e.startSN]}},"./src/controller/mildom/fragment-request-manager.ts":
/*!***********************************************************!*\
  !*** ./src/controller/mildom/fragment-request-manager.ts ***!
  \***********************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return s});var n=r(/*! ../../events */"./src/events.ts"),i=r(/*! ../../errors */"./src/errors.ts"),a=r(/*! ../../utils/logger */"./src/utils/logger.ts"),s=function(){function e(e,t){this.loadingFrags=[],this.pendingFragParse=[],this.abortedFrags=[],this.hls=void 0,this.findFragment=void 0,this.currentParseFrag=null,this.hls=e,this.findFragment=t,e.on(n.Events.FRAG_LOADING,this.onFragLoading,this),e.on(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(n.Events.ERROR,this.onError,this)}var t=e.prototype;return t.destory=function(){var e=this.hls;e.off(n.Events.FRAG_LOADING,this.onFragLoading,this),e.off(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(n.Events.ERROR,this.onError,this)},t.getNextFragment=function(e,t){var r=this.findFragment(e,t),e=!this.hasAvaiableConnection(),t=r&&0<this.loadingFrags.length&&r.sn<=this.loadingFrags[this.loadingFrags.length-1].sn;return(e||t)&&(r=null),r},t.getLatestRequestFrag=function(){return 0<this.loadingFrags.length?this.loadingFrags[this.loadingFrags.length-1]:null},t.removePendingFrag=function(t){this.loadingFrags=this.loadingFrags.filter(function(e){return e.sn!==t.sn})},t.hasAvaiableConnection=function(){return 0<this.hls.config.mildomFragMaxParallelLoadNum-this.loadingFrags.length},t.onFragLoadAborted=function(e){this.removePendingFrag(e),this.abortedFrags.push(e),a.logger.log("[mildom-fragment-request-manager]: remove frag "+e.sn+" due to load aborted, current loading pending frags["+this.loadingFrags.map(function(e){return e.sn}).join(",")+"]")},t.enquePendingFragParse=function(e,t){this.removePendingFrag(e),a.logger.log("[mildom-fragment-request-manager]: remove frag "+(null==e?void 0:e.sn)+" due to loaded, current loading pending frags["+this.loadingFrags.map(function(e){return e.sn}).join(",")+"]"),this.pendingFragParse.push({frag:e,parse:t}),this.pendingFragParse.sort(function(e,t){return e.frag.sn-t.frag.sn}),this.comusePendingParse()},t.abort=function(){var t=this;this.loadingFrags.forEach(function(e){e.loader&&(e.loader.abort(),t.abortedFrags.push(e))}),this.loadingFrags=[],this.pendingFragParse=[],this.currentParseFrag=null,a.logger.log("[mildom-fragment-request-manager]: abort all request")},t.comusePendingParse=function(){var e;this.pendingFragParse.length<=0||(e=this.pendingFragParse.shift(),this.currentParseFrag=e.frag,a.logger.log("[mildom-fragment-request-manager]: consume frag "+this.currentParseFrag.sn),e.parse())},t.onFragLoading=function(e,t){var r=t.frag;0===this.loadingFrags.filter(function(e){return e.sn===r.sn}).length&&(this.loadingFrags.push(r),this.loadingFrags.sort(function(e,t){return e.sn-t.sn})),a.logger.log("[mildom-fragment-request-manager]: current loading pending frags["+this.loadingFrags.map(function(e){return e.sn}).join(",")+"]")},t.onFragBuffered=function(e,t){t=t.frag;0<this.pendingFragParse.length&&this.pendingFragParse[0].frag.sn===t.sn+1&&this.comusePendingParse()},t.onError=function(e,t){switch(t.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:t.frag&&(this.removePendingFrag(t.frag),a.logger.log("[mildom-fragment-request-manager]: remove frag "+t.frag.sn+" due to error, current pending frags["+this.loadingFrags.map(function(e){return e.sn}).join(",")+"]"))}},t.isFragAborted=function(t){return!t||0!==this.abortedFrags.filter(function(e){return e.sn===t.sn}).length},e}()},"./src/controller/mildom/latency-controller.ts":
/*!*****************************************************!*\
  !*** ./src/controller/mildom/latency-controller.ts ***!
  \*****************************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var t=r(/*! ../../task-loop */"./src/task-loop.ts"),s=r(/*! ../../events */"./src/events.ts");var o;(r=o=o||{}).SPEED_UP="speed_up",r.SPEED_RESET="speed_reset",r.SPEED_DOWN="speed_down";var n=function(r){var e;function t(e){var t=r.call(this)||this;return t.hls=void 0,t.upperMaxBufferSizeTime=0,t.mildomUpperSpeedMaxBufferSizeTimeStamp=0,t.mildomSpeedResetTimeStamp=0,t.hls=e,t.setInterval(100),t}n=r,(e=t).prototype=Object.create(n.prototype),(e.prototype.constructor=e).__proto__=n;var n=t.prototype;return n.doTick=function(){var e,t,r;0<this.hls.levels.length&&(null!=(t=this.hls.levels[0<this.hls.currentLevel?this.hls.currentLevel:0].details)&&t.live&&this.hls.isRunning&&(!this.hls.lowLatencyMode&&null!=t&&t.averagetargetduration&&(e=Math.round(1e3*t.averagetargetduration),t=(r=this.hls.config).mildomSpeedUpBufferGap,r=r.mildomSpeedResetBufferGap,this.hls.config.mildomSpeedMaxBufferSizeThreshold=e+t,this.hls.config.mildomSpeedResetBufferSizeThreshold=e+r),this.chaseToLiveEdge()))},n.chaseToLiveEdge=function(){var e=this.hls,t=e.media,r=e.config,n=r.mildomSpeedMaxBufferSizeThreshold,i=r.mildomSpeedUpRate,a=r.mildomSpeedResetFactor,e=r.mildomSpeedUpMinBufferDuration,r=r.mildomSpeedResetBufferSizeThreshold;!t||t.buffered.length<=0||t.played.length<=0||(n<=(n=1e3*(t.buffered.end(t.buffered.length-1)-t.played.end(t.played.length-1)))?0===this.mildomUpperSpeedMaxBufferSizeTimeStamp&&(this.mildomUpperSpeedMaxBufferSizeTimeStamp=performance.now()):this.mildomUpperSpeedMaxBufferSizeTimeStamp=0,1===t.playbackRate&&0!==this.mildomUpperSpeedMaxBufferSizeTimeStamp&&performance.now()-this.mildomUpperSpeedMaxBufferSizeTimeStamp>=e&&!t.paused&&(t.playbackRate=i,this.mildomUpperSpeedMaxBufferSizeTimeStamp=0,this.hls.trigger(s.Events.MILDOM_LATENCY_CONTROL,{status:o.SPEED_UP,playbackRate:i})),1!==t.playbackRate&&(n<=r?0===this.mildomSpeedResetTimeStamp&&(this.mildomSpeedResetTimeStamp=performance.now()):this.mildomSpeedResetTimeStamp=0,0!==this.mildomSpeedResetTimeStamp&&performance.now()-this.mildomSpeedResetTimeStamp>a*e&&(t.playbackRate=1,this.mildomSpeedResetTimeStamp=0,this.hls.trigger(s.Events.MILDOM_LATENCY_CONTROL,{status:o.SPEED_RESET,playbackRate:1}))))},t}(t.default)},"./src/controller/mildom/mildom-level-controller-manager.ts":
/*!******************************************************************!*\
  !*** ./src/controller/mildom/mildom-level-controller-manager.ts ***!
  \******************************************************************/
/*! exports provided: MildomLevelController */function(e,t,r){"use strict";r.r(t),r.d(t,"MildomLevelController",function(){return a});var n=r(/*! ../../events */"./src/events.ts"),i=r(/*! ../../utils/logger */"./src/utils/logger.ts"),a=function(){function e(e,t){this.loadPlaylistIntervalTimer=void 0,this.hls=void 0,this.loadPlaylist=void 0,this.hls=e,this.loadPlaylist=t}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(n.Events.FRAG_PARSED,this.onFragParsed,this),e.on(n.Events.FRAG_CHANGED,this.onFragChanged,this)},t._unregisterListeners=function(){var e=this.hls;e.off(n.Events.FRAG_PARSED,this.onFragParsed,this),e.off(n.Events.FRAG_CHANGED,this.onFragChanged,this)},t.handleRealtimePlaybackModeloadPlaylist=function(e){var t,r,n=this;this.hls.config.mildomRealtimePlaybackMode&&this.hls.levels&&(t=10<=(t=null!=(t=this.hls.levels[this.hls.levels.length-1])&&t.details?t.details.fragments:[]).length?t[t.length-10]:null,r=this,t?(e=e.sn,t.sn<=e?(i.logger.debug("start load live playback m3u8"),this.loadPlaylistIntervalTimer||(this.loadPlaylistIntervalTimer=self.setInterval(function(){return n.realtimePlaybackModeloadPlaylist(r)},3e3))):(clearInterval(this.loadPlaylistIntervalTimer),this.loadPlaylistIntervalTimer=void 0)):(clearInterval(this.loadPlaylistIntervalTimer),this.loadPlaylistIntervalTimer=self.setInterval(function(){return n.realtimePlaybackModeloadPlaylist(r)},3e3)))},t.realtimePlaybackModeloadPlaylist=function(e){var t;e.levels&&e.levels[e.level]&&e.levels[e.level].details&&null!==(t=e.levels[e.level].details)&&void 0!==t&&t.isMildomLiveEnd&&(clearInterval(e.loadPlaylistIntervalTimer),e.loadPlaylistIntervalTimer=void 0),e.loadPlaylist()},t.onFragParsed=function(e,t){t=t.frag;this.handleRealtimePlaybackModeloadPlaylist(t)},t.onFragChanged=function(e,t){t=t.frag;this.handleRealtimePlaybackModeloadPlaylist(t)},t.switchToRealtimePlaybackLoadMode=function(e){this.hls.config.mildomRealtimePlaybackMode&&(e.live=!1)},t.run=function(){this._registerListeners()},t.destroy=function(){this._unregisterListeners()},e}()},"./src/controller/stream-controller.ts":
/*!*********************************************!*\
  !*** ./src/controller/stream-controller.ts ***!
  \*********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var c=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),f=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),u=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),d=r(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),p=r(/*! ../events */"./src/events.ts"),h=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),g=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),a=r(/*! ../utils/time-ranges */"./src/utils/time-ranges.ts"),s=r(/*! ../errors */"./src/errors.ts"),m=r(/*! ../utils/logger */"./src/utils/logger.ts"),v=r(/*! ./gap-controller */"./src/controller/gap-controller.ts"),o=r(/*! ../loader/fragment-loader */"./src/loader/fragment-loader.ts"),y=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),b=r(/*! ../types/loader */"./src/types/loader.ts"),l=r(/*! ./mildom/fragment-request-manager */"./src/controller/mildom/fragment-request-manager.ts");function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(n){function e(e,t){var r=n.call(this,e,t)||this;return r.audioCodecSwap=!1,r.bitrateTest=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.retryDate=0,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.previouslyPaused=!1,r.immediateSwitch=!1,r.onvplaying=null,r.onvseeking=null,r.onvseeked=null,r.onvended=null,r.fragLastKbps=0,r.stalled=!1,r.audioCodecSwitch=!1,r.videoBuffer=null,r.logPrefix="[stream-controller]",r.fragmentLoader=new o.default(e.config),r.fragmentTracker=t,r.state=f.State.STOPPED,r.mildomFragmentRequestManager=1<e.config.mildomFragMaxParallelLoadNum?new l.default(e,r.getNextFragment.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r))):null,r._registerListeners(),r}t=n,(i=e).prototype=Object.create(t.prototype),(i.prototype.constructor=i).__proto__=t;var t,r,i=e.prototype;return i._registerListeners=function(){var e=this.hls;e.on(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(p.Events.KEY_LOADED,this.onKeyLoaded,this),e.on(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(p.Events.ERROR,this.onError,this),e.on(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(p.Events.BUFFER_CREATED,this.onBufferCreated,this),e.on(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(p.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var e=this.hls;e.off(p.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(p.Events.KEY_LOADED,this.onKeyLoaded,this),e.off(p.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(p.Events.ERROR,this.onError,this),e.off(p.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(p.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(p.Events.BUFFER_CREATED,this.onBufferCreated,this),e.off(p.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(p.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(p.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.mildomFragmentRequestManager&&this.mildomFragmentRequestManager.destory()},i.startLoad=function(e){var t,r,n;this.levels?(t=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(n=r.startLevel)&&(r.config.testBandwidth?(n=0,this.bitrateTest=!0):n=r.nextAutoLevel),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1),0<t&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=f.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()):(this._forceStartLoad=!0,this.state=f.State.STOPPED)},i.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case f.State.IDLE:this.doTickIdle();break;case f.State.FRAG_LOADING:null!==(e=this.mildomFragmentRequestManager)&&void 0!==e&&e.hasAvaiableConnection()&&this.doTickIdle();break;case f.State.WAITING_LEVEL:var e=this.levels,t=this.level,t=null==e||null===(r=e[t])||void 0===r?void 0:r.details;if(!t||t.live&&this.levelLastLoaded!==this.level)break;if(this.waitForCdnTuneIn(t))break;this.state=f.State.IDLE;break;case f.State.FRAG_LOADING_WAITING_RETRY:var r=self.performance.now(),t=this.retryDate;(!t||t<=r||null!==(r=this.media)&&void 0!==r&&r.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=f.State.IDLE)}this.onTickEnd()},i.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,r=this.levels,n=this.media,i=e.config,a=e.nextLoadLevel;if(null!==t&&(n||!(this.startFragRequested&&i.mildomFragMaxParallelLoadNum<=1)&&i.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&r&&r[a]){var s=r[a],t=this.getLoadPosition();if(Object(c.isFiniteNumber)(t)){r=s.maxBitrate,r=r?Math.max(8*i.maxBufferSize/r,i.maxBufferLength):i.maxBufferLength;r=Math.min(r,i.maxMaxBufferLength);var i=t<i.maxBufferHole?Math.max(v.MAX_START_GAP_JUMP,i.maxBufferHole):i.maxBufferHole,i=u.BufferHelper.bufferInfo(this.mediaBuffer||n,t,i);if(!(r<=i.len)){this.level=e.nextLoadLevel=a;e=s.details;if(!e||this.state===f.State.WAITING_LEVEL||e.live&&this.levelLastLoaded!==a)this.state=f.State.WAITING_LEVEL;else{if(this._streamEnded(i,e)){if(this.hls.config.mildomRealtimePlaybackMode&&!(1<this.media.playbackRate||e.isMildomLiveEnd))return;var o={isLiveEnd:e.isMildomLiveEnd};return this.altAudio&&(o.type="video"),this.hls.trigger(p.Events.BUFFER_EOS,o),void(this.state=f.State.ENDED)}var l,s=i.end,o=this.mildomFragmentRequestManager?this.mildomFragmentRequestManager.getNextFragment(this.nextLoadPosition,e):this.getNextFragment(s,e);o&&this.fragmentTracker.getState(o)===h.FragmentState.OK&&this.nextLoadPosition>s&&(o=this.getNextFragment(this.nextLoadPosition,e)),o&&("identity"!==(null===(i=o.decryptdata)||void 0===i?void 0:i.keyFormat)||null!==(l=o.decryptdata)&&void 0!==l&&l.key?((null===(l=this.fragCurrent)||void 0===l?void 0:l.sn)!==o.sn&&this.log("Loading fragment "+o.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+a+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(t.toFixed(3))+", bufferInfo.end: "+parseFloat(s.toFixed(3))),this.loadFragment(o,s)):(this.log("Loading key for "+o.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+a),this.loadKey(o)))}}}}},i.loadKey=function(e){this.state=f.State.KEY_LOADING,this.hls.trigger(p.Events.KEY_LOADING,{frag:e})},i.loadFragment=function(e,t){var r=this.fragmentTracker.getState(e);this.fragCurrent=e,Object(c.isFiniteNumber)(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||r===h.FragmentState.NOT_LOADED||r===h.FragmentState.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e):this.bitrateTest?(e.bitrateTest=!0,this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e)):(this.startFragRequested=!0,this._loadFragForPlayback(e,t)):r===h.FragmentState.APPENDING?this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e):0===(null===(e=this.media)||void 0===e?void 0:e.buffered.length)&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(e){return this.fragmentTracker.getAppendedFrag(e,b.PlaylistLevelType.MAIN)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,b.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},i.immediateLevelSwitch=function(){var e;this.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,(e=this.media)?(t=e.paused)||e.pause():t=!0,this.previouslyPaused=t);var t=this.fragCurrent;null!=t&&t.loader&&t.loader.abort(),this.fragCurrent=null,this.mildomFragmentRequestManager&&this.mildomFragmentRequestManager.abort(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.immediateLevelSwitchEnd=function(){var e=this.media;u.BufferHelper.getBuffered(e).length&&(this.immediateSwitch=!1,0<e.currentTime&&u.BufferHelper.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},i.nextLevelSwitch=function(){var e,t,r,n=this.levels,i=this.media;null!=i&&i.readyState&&((e=this.getAppendedFrag(i.currentTime))&&1<e.start&&this.flushMainBuffer(0,e.start-1),r=!i.paused&&n?(r=n[this.hls.nextLoadLevel],(t=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*r.maxBitrate/(1e3*t)+1:0):0,!(t=this.getBufferedFrag(i.currentTime+r))||(i=this.followingBufferedFrag(t))&&(null!=(r=this.fragCurrent)&&r.loader&&r.loader.abort(),this.fragCurrent=null,r=i.maxStartPTS||i.start,i=Math.max(t.end,r+Math.min(this.config.maxFragLookUpTolerance,i.duration)),this.flushMainBuffer(i,Number.POSITIVE_INFINITY)))},i.flushMainBuffer=function(e,t){t={startOffset:e,endOffset:t,type:this.altAudio?"video":null};this.fragLoadError=0,this.hls.trigger(p.Events.BUFFER_FLUSHING,t)},i.onMediaAttached=function(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeking",this.onvseeking),r.addEventListener("seeked",this.onvseeked),r.addEventListener("ended",this.onvended);t=this.config;this.levels&&t.autoStartLoad&&this.hls.startLoad(t.startPosition),this.gapController=new v.default(t,r,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var e=this.levels,t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&e.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.backtracked=!1})}),t&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvplaying=this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var e=this.media,e=e?e.currentTime:null;Object(c.isFiniteNumber)(e)&&this.log("Media seeked to "+e.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(p.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},i.onManifestParsed=function(e,t){var r,n=!1,i=!1;t.levels.forEach(function(e){(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(n=!0),-1!==r.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=n&&i,this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},i.onLevelLoading=function(e,t){var r=this.levels;!r||this.state!==f.State.IDLE||(!(r=r[t.level]).details||r.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(r.details))&&(this.state=f.State.WAITING_LEVEL)},i.onLevelLoaded=function(e,t){var r=this.levels,n=t.level,i=t.details,a=i.totalduration;if(r){this.log("Level "+n+" loaded ["+i.startSN+","+i.endSN+"], cc ["+i.startCC+", "+i.endCC+"] duration:"+a);a=this.fragCurrent;!a||this.state!==f.State.FRAG_LOADING&&this.state!==f.State.FRAG_LOADING_WAITING_RETRY||a.level!==t.level&&a.loader&&(this.state=f.State.IDLE,a.loader.abort());t=r[n],a=0;if(i.live||null!==(r=t.details)&&void 0!==r&&r.live){if(i.deltaUpdateFailed)return;a=this.alignPlaylists(i,t.details)}if(t.details=i,this.levelLastLoaded=n,this.hls.trigger(p.Events.LEVEL_UPDATED,{details:i,level:n}),this.state===f.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(i))return;this.state=f.State.IDLE}this.startFragRequested?i.live&&this.synchronizeToLiveEdge(i):this.setStartPosition(i,a),this.tick()}else this.warn("Levels were reset while loading level "+n)},i.onKeyLoaded=function(){this.state===f.State.KEY_LOADING&&(this.state=f.State.IDLE,this.tick())},i._handleFragmentLoadProgress=function(e){var t,r,n,i,a=e.frag,s=e.part,o=e.payload,l=this.levels,u=this.media;l?(t=(i=l[a.level]).details,console.assert(t,"Audio track details are defined on fragment load progress"),r=i.videoCodec,n=!(null!=u&&u.seeking)&&(t.PTSKnown||!t.live),l=(null===(e=t.initSegment)||void 0===e?void 0:e.data)||new Uint8Array(0),u=this._getAudioCodec(i),e=this.transmuxer=this.transmuxer||new d.default(this.hls,b.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),(i=new y.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,o.byteLength,s?s.index:-1)).transmuxing.start=performance.now(),s=this.initPTS[a.cc],e.push(o,l,u,r,a,t.totalduration,n,i,s)):this.warn("Levels were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered")},i.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i.onAudioTrackSwitching=function(e,t){var r,n=this.altAudio,i=!!t.url,t=t.id;i||(this.mediaBuffer!==this.media?(this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,null!=(r=this.fragCurrent)&&r.loader&&(this.log("Switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.resetTransmuxer(),this.state=f.State.IDLE):this.audioOnly&&this.resetTransmuxer(),r=this.hls,n&&r.trigger(p.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),r.trigger(p.Events.AUDIO_TRACK_SWITCHED,{id:t}))},i.onAudioTrackSwitched=function(e,t){var r=t.id,t=!!this.hls.audioTracks[r].url;!t||(r=this.videoBuffer)&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r),this.altAudio=t,this.tick()},i.onBufferCreated=function(e,t){var r,n=t.tracks,i=!1;for(r in n){var a,s,o=n[r];"main"===o.id?(s=o,"video"!==(a=r)||(o=n[r])&&(this.videoBuffer=o.buffer)):i=!0}i&&s?(this.log("Alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(e,t){var r,n=t.frag;n&&"main"!==n.type||(this._fragLoadAborted(n)?this.warn("Fragment "+n.sn+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state):(r=this.mediaBuffer||this.media,t=n.stats,this.fragPrevious=n,this.fragLastKbps=Math.round(8*t.total/(t.buffering.end-t.loading.first)),this.log("Buffered fragment "+n.sn+" of level "+n.level+". PTS:["+n.startPTS+","+n.endPTS+"],DTS:["+n.startDTS+"/"+n.endDTS+"], Buffered: "+a.default.toString(u.BufferHelper.getBuffered(r))),this.state=f.State.IDLE,this.tick()))},i.onError=function(e,t){var r=t.frag||this.fragCurrent;if(!r||"main"===r.type){var n,i=!!this.media&&u.BufferHelper.isBuffered(this.media,this.media.currentTime)&&u.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:t.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),this.warn("Fragment "+(null==r?void 0:r.sn)+" of level "+(null==r?void 0:r.level)+" failed to load, retrying in "+n+"ms"),this.retryDate=self.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=f.State.FRAG_LOADING_WAITING_RETRY):(m.logger.error("[stream-controller]: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=f.State.ERROR));break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==f.State.ERROR&&(t.fatal?(this.warn(""+t.details),this.state=f.State.ERROR):t.levelRetry||this.state!==f.State.WAITING_LEVEL||(this.state=f.State.IDLE));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==f.State.PARSING&&this.state!==f.State.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=f.State.IDLE):(this.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},i._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},i.checkBuffer=function(){var e,t=this.media,r=this.gapController;t&&r&&t.readyState&&(e=u.BufferHelper.getBuffered(t),!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():r.poll(this.lastCurrentTime),this.lastCurrentTime=t.currentTime)},i.onFragLoadEmergencyAborted=function(){this.state=f.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.onBufferFlushed=function(e,t){var r=t.type,t=(r===g.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;t&&r!==g.ElementaryStreamTypes.AUDIO&&this.fragmentTracker.detectEvictedFragments(r,u.BufferHelper.getBuffered(t)),this.fragPrevious=null,this.state=f.State.IDLE},i.onLevelsUpdated=function(e,t){this.levels=t.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i._seekToStartPos=function(){var e,t=this.media,r=t.currentTime,n=this.startPosition;r!==n&&0<=n&&(t.seeking?m.logger.log("could not seek to "+n+", already seeking at "+r):(0<(e=((e=u.BufferHelper.getBuffered(t)).length?e.start(0):0)-n)&&e<this.config.maxBufferHole&&(m.logger.log("adjusting start position by "+e+" to match buffer start"),n+=e,this.startPosition=n),this.log("seek to target start position "+n+" from current time "+r),t.currentTime=n))},i._getAudioCodec=function(e){e=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(this.log("Swapping playlist audio codec"),e=e&&(-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},i._loadBitrateTestFrag=function(r){var n=this;this._doFragLoad(r).then(function(e){var t=n.hls;!e||t.nextLoadLevel||n._fragLoadAborted(r)||(n.fragLoadError=0,n.state=f.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1,r.bitrateTest=!1,(e=r.stats).parsing.start=e.parsing.end=e.buffering.start=e.buffering.end=self.performance.now(),t.trigger(p.Events.FRAG_BUFFERED,{stats:e,frag:r,id:"main"}),n.tick())})},i._handleTransmuxComplete=function(e){var t="main",r=this.hls,n=e.remuxResult,i=e.chunkMeta,a=this.getCurrentContext(i);if(a){var s,o,l=a.frag,u=a.level,d=n.video,h=n.text,e=n.id3,a=n.initSegment,n=this.altAudio?void 0:n.audio;if(this.state=f.State.PARSING,a&&(a.tracks&&(this._bufferInitSegment(u,a.tracks,l,i),r.trigger(p.Events.FRAG_PARSING_INIT_SEGMENT,{frag:l,id:t,tracks:a.tracks})),s=a.initPTS,o=a.timescale,Object(c.isFiniteNumber)(s)&&(this.initPTS[l.cc]=s,r.trigger(p.Events.INIT_PTS_FOUND,{frag:l,id:t,initPTS:s,timescale:o}))),d){if(u.details&&(s=l,o=d.dropped,u=u.details.startSN,o?(s.dropped=o,s.backtracked?(m.logger.warn("[stream-controller]: Fragment "+s.sn+" of level "+s.level+" already backtracked and will be appended with a gap"),s.backtracked=!1):s.sn===u?(m.logger.warn("[stream-controller]: Fragment "+s.sn+" of level "+s.level+" is missing "+s.dropped+" video frame(s); this is the start fragment and will be appended with a gap"),!1):(m.logger.warn("[stream-controller]: Fragment "+s.sn+" of level "+s.level+" is missing "+s.dropped+" video frame(s); backtracking to find a keyframe"),!0)):s.backtracked=!1))return this.resetTransmuxer(),void this.backtrack(l,d.startPTS);l.setElementaryStreamInfo(d.type,d.startPTS,d.endPTS,d.startDTS,d.endDTS),this.bufferFragmentData(d,l,i)}n&&(l.setElementaryStreamInfo(g.ElementaryStreamTypes.AUDIO,n.startPTS,n.endPTS,n.startDTS,n.endDTS),this.bufferFragmentData(n,l,i)),null!=e&&(null!==(n=e.samples)&&void 0!==n&&n.length)&&(e={frag:l,id:t,samples:e.samples},r.trigger(p.Events.FRAG_PARSING_METADATA,e)),h&&(h={frag:l,id:t,samples:h.samples},r.trigger(p.Events.FRAG_PARSING_USERDATA,h))}else this.warn("The loading context changed while buffering fragment "+i.sn+" of level "+i.level+". This chunk will not be buffered.")},i._bufferInitSegment=function(e,n,i,a){var t,r,s,o,l=this;this.state===f.State.PARSING&&(this.audioOnly=!!n.audio&&!n.video,this.altAudio&&!this.audioOnly&&delete n.audio,t=n.audio,r=n.video,t&&(s=e.audioCodec,o=navigator.userAgent.toLowerCase(),s&&this.audioCodecSwap&&(this.log("Swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==t.metadata.channelCount&&-1===o.indexOf("firefox")&&(s="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==t.container&&(s="mp4a.40.2",this.log("Android: force audio codec to "+s)),t.levelCodec=s,t.id="main"),r&&(r.levelCodec=e.videoCodec,r.id="main"),this.hls.trigger(p.Events.BUFFER_CODECS,n),Object.keys(n).forEach(function(e){var t=n[e],r=t.initSegment;l.log("Main track:"+e+",container:"+t.container+",codecs[level/parsed]=["+t.levelCodec+"/"+t.codec+"]"),r&&l.hls.trigger(p.Events.BUFFER_APPENDING,{type:e,data:r,frag:i,chunkMeta:a})}),this.tick())},i.backtrack=function(e,t){this.fragmentTracker.removeFragment(e),e.backtracked=!0,this.nextLoadPosition=t,this.state=f.State.IDLE,this.fragPrevious=e,this.tick()},i.checkFragmentChanged=function(){var e,t,r=this.media;r&&1<r.readyState&&!1===r.seeking&&(e=r.currentTime,u.BufferHelper.isBuffered(r,e)?t=this.getAppendedFrag(e):u.BufferHelper.isBuffered(r,e+.1)&&(t=this.getAppendedFrag(e+.1)),t&&(e=t,this.fragPlaying&&(e.sn===this.fragPlaying.sn||e.level===this.fragPlaying.level)||(this.hls.trigger(p.Events.FRAG_CHANGED,{frag:e}),t=e.level,this.fragPlaying&&this.fragPlaying.level===t||this.hls.trigger(p.Events.LEVEL_SWITCHED,{level:t}),this.fragPlaying=e)))},t=e,(i=[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentLevel",get:function(){var e=this.media;if(e){e=this.getAppendedFrag(e.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;if(e){e=this.getAppendedFrag(e.currentTime);return this.followingBufferedFrag(e)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&E(t.prototype,i),r&&E(t,r),e}(f.default)},"./src/crypt/aes-crypto.ts":
/*!*********************************!*\
  !*** ./src/crypt/aes-crypto.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var n=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}()},"./src/crypt/aes-decryptor.ts":
/*!************************************!*\
  !*** ./src/crypt/aes-decryptor.ts ***!
  \************************************/
/*! exports provided: removePadding, default */function(e,t,r){"use strict";r.r(t),r.d(t,"removePadding",function(){return i}),r.d(t,"default",function(){return a});var n=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts");function i(e){var t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?Object(n.sliceUint8)(e,0,t-r):e}var a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),n=0;n<4;n++)r[n]=t.getUint32(4*n);return r},t.initTable=function(){for(var e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],s=r[3],r=this.invSubMix,o=r[0],l=r[1],u=r[2],d=r[3],h=new Uint32Array(256),c=0,f=0,p=0,p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var g=(g=f^f<<1^f<<2^f<<3^f<<4)>>>8^255&g^99,m=h[t[e[c]=g]=c],v=h[m],y=h[v],b=257*h[g]^16843008*g;n[c]=b<<24|b>>>8,i[c]=b<<16|b>>>16,a[c]=b<<8|b>>>24,s[c]=b,b=16843009*y^65537*v^257*m^16843008*c,o[g]=b<<24|b>>>8,l[g]=b<<16|b>>>16,u[g]=b<<8|b>>>24,d[g]=b,c?(c=m^h[h[h[y^m]]],f^=h[h[f]]):c=f=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<t.length&&r;)r=t[n]===this.key[n],n++;if(!r){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);for(var a,s,o,l=this.ksRows=4*(i+6+1),u=this.keySchedule=new Uint32Array(l),d=this.invKeySchedule=new Uint32Array(l),h=this.sBox,c=this.rcon,e=this.invSubMix,f=e[0],p=e[1],g=e[2],m=e[3],v=0;v<l;v++)v<i?s=u[v]=t[v]:(o=s,v%i==0?(o=h[(o=o<<8|o>>>24)>>>24]<<24|h[o>>>16&255]<<16|h[o>>>8&255]<<8|h[255&o],o^=c[v/i|0]<<24):6<i&&v%i==4&&(o=h[o>>>24]<<24|h[o>>>16&255]<<16|h[o>>>8&255]<<8|h[255&o]),u[v]=s=(u[v-i]^o)>>>0);for(a=0;a<l;a++)v=l-a,o=3&a?u[v]:u[v-4],d[a]=a<4||v<=4?o:f[h[o>>>24]]^p[h[o>>>16&255]]^g[h[o>>>8&255]]^m[h[255&o]],d[a]=d[a]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,r){for(var n,i,a,s,o,l,u,d,h,c,f,p,g,m,v=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,E=this.invSubMix,T=E[0],S=E[1],_=E[2],w=E[3],r=this.uint8ArrayToUint32Array_(r),L=r[0],A=r[1],R=r[2],D=r[3],k=new Int32Array(e),x=new Int32Array(k.length),P=this.networkToHostOrderSwap;t<k.length;){for(h=P(k[t]),c=P(k[t+1]),f=P(k[t+2]),p=P(k[t+3]),o=h^y[0],l=p^y[1],u=f^y[2],d=c^y[3],g=4,m=1;m<v;m++)n=T[o>>>24]^S[l>>16&255]^_[u>>8&255]^w[255&d]^y[g],i=T[l>>>24]^S[u>>16&255]^_[d>>8&255]^w[255&o]^y[g+1],a=T[u>>>24]^S[d>>16&255]^_[o>>8&255]^w[255&l]^y[g+2],s=T[d>>>24]^S[o>>16&255]^_[l>>8&255]^w[255&u]^y[g+3],o=n,l=i,u=a,d=s,g+=4;n=b[o>>>24]<<24^b[l>>16&255]<<16^b[u>>8&255]<<8^b[255&d]^y[g],i=b[l>>>24]<<24^b[u>>16&255]<<16^b[d>>8&255]<<8^b[255&o]^y[g+1],a=b[u>>>24]<<24^b[d>>16&255]<<16^b[o>>8&255]<<8^b[255&l]^y[g+2],s=b[d>>>24]<<24^b[o>>16&255]<<16^b[l>>8&255]<<8^b[255&u]^y[g+3],g+=3,x[t]=P(n^L),x[t+1]=P(s^A),x[t+2]=P(a^R),x[t+3]=P(i^D),L=h,A=c,R=f,D=p,t+=4}return x.buffer},e}()},"./src/crypt/decrypter.ts":
/*!********************************!*\
  !*** ./src/crypt/decrypter.ts ***!
  \********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var s=r(/*! ./aes-crypto */"./src/crypt/aes-crypto.ts"),o=r(/*! ./fast-aes-key */"./src/crypt/fast-aes-key.ts"),l=r(/*! ./aes-decryptor */"./src/crypt/aes-decryptor.ts"),i=r(/*! ../utils/logger */"./src/utils/logger.ts"),u=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),d=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),n=function(){function e(e,t,r){r=(void 0===r?{}:r).removePKCS7Padding,r=void 0===r||r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=e,this.config=t,this.removePKCS7Padding=r)try{var n=self.crypto;n?this.subtle=n.subtle||n.webkitSubtle:this.config.enableSoftwareAES=!0}catch(e){}}var t=e.prototype;return t.isSync=function(){return this.config.enableSoftwareAES},t.flush=function(){var e=this.currentResult;if(e){e=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Object(l.removePadding)(e):e}this.reset()},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.softwareDecrypt=function(e,t,r){var n=this.currentIV,i=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(e=Object(u.appendUint8Array)(a,e),this.remainderData=null);e=this.getValidChunk(e);if(!e.length)return null;n&&(r=n);n=this.softwareDecrypter;(n=n||(this.softwareDecrypter=new l.default)).expandKey(t);return this.currentResult=n.decrypt(e.buffer,0,r),this.currentIV=Object(d.sliceUint8)(e,-16).buffer,i||null},t.webCryptoDecrypt=function(t,r,n){var i=this,a=this.subtle;return this.key===r&&this.fastAesKey||(this.key=r,this.fastAesKey=new o.default(a,r)),this.fastAesKey.expandKey().then(function(e){return a?new s.default(a,n).decrypt(t.buffer,e):Promise.reject(new Error("web crypto not initialized"))}).catch(function(e){return i.onWebCryptoError(e,t,r,n)})},t.onWebCryptoError=function(e,t,r,n){return i.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",e),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(t,r,n)},t.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=Object(d.sliceUint8)(e,0,r),this.remainderData=Object(d.sliceUint8)(e,r)),t},t.logOnce=function(e){this.logEnabled&&(i.logger.log("[decrypter.ts]: "+e),this.logEnabled=!1)},e}()},"./src/crypt/fast-aes-key.ts":
/*!***********************************!*\
  !*** ./src/crypt/fast-aes-key.ts ***!
  \***********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var n=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/aacdemuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),i=r(/*! ./adts */"./src/demux/adts.js"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../demux/id3 */"./src/demux/id3.ts");n=function(n){var e;function t(e,t){var r=n.call(this)||this;return r.observer=void 0,r.config=void 0,r.observer=e,r.config=t,r}r=n,(e=t).prototype=Object.create(r.prototype),(e.prototype.constructor=e).__proto__=r;var r=t.prototype;return r.resetInitSegment=function(e,t,r){n.prototype.resetInitSegment.call(this,e,t,r),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;for(var t=(s.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(i.probe(e,t))return a.logger.log("ADTS sync word found !"),!0;return!1},r.canParse=function(e,t){return i.canParse(e,t)},r.appendFrame=function(e,t,r){return i.initTrackConfig(e,this.observer,t,r,e.manifestCodec),i.appendFrame(e,t,r,this.initPTS,this.frameIndex)},t}(n.default);n.minProbeByteLength=9,t.default=n},"./src/demux/adts.js":
/*!***************************!*\
  !*** ./src/demux/adts.js ***!
  \***************************/
/*! exports provided: getAudioConfig, isHeaderPattern, getHeaderLength, getFullFrameLength, canGetFrameLength, isHeader, canParse, probe, initTrackConfig, getFrameDuration, parseFrameHeader, appendFrame */function(e,t,r){"use strict";r.r(t),r.d(t,"getAudioConfig",function(){return a}),r.d(t,"isHeaderPattern",function(){return i}),r.d(t,"getHeaderLength",function(){return o}),r.d(t,"getFullFrameLength",function(){return l}),r.d(t,"canGetFrameLength",function(){return n}),r.d(t,"isHeader",function(){return s}),r.d(t,"canParse",function(){return u}),r.d(t,"probe",function(){return d}),r.d(t,"initTrackConfig",function(){return p}),r.d(t,"getFrameDuration",function(){return g}),r.d(t,"parseFrameHeader",function(){return m}),r.d(t,"appendFrame",function(){return v});var h=r(/*! ../utils/logger */"./src/utils/logger.ts"),c=r(/*! ../errors */"./src/errors.ts"),f=r(/*! ../events */"./src/events.ts");function a(e,t,r,n){var i,a,s=navigator.userAgent.toLowerCase(),o=n,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],u=1+((192&t[r+2])>>>6),d=(60&t[r+2])>>>2;if(!(l.length-1<d))return i=(1&t[r+2])<<2,i|=(192&t[r+3])>>>6,h.logger.log("manifest codec:"+n+",ADTS data:type:"+u+",sampleingIndex:"+d+"["+l[d]+"Hz],channelConfig:"+i),n=/firefox/i.test(s)?6<=d?(u=5,a=new Array(4),d-3):(u=2,a=new Array(2),d):-1!==s.indexOf("android")?(u=2,a=new Array(2),d):(u=5,a=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&6<=d?d-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(6<=d&&1==i||/vivaldi/i.test(s))||!n&&1==i)&&(u=2,a=new Array(2)),d)),a[0]=u<<3,a[0]|=(14&d)>>1,a[1]|=(1&d)<<7,a[1]|=i<<3,5===u&&(a[1]|=(14&n)>>1,a[2]=(1&n)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:l[d],channelCount:i,codec:"mp4a.40."+u,manifestCodec:o};e.trigger(f.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+d})}function i(e,t){return 255===e[t]&&240==(246&e[t+1])}function o(e,t){return 1&e[t+1]?7:9}function l(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function n(e,t){return t+5<e.length}function s(e,t){return!!(t+1<e.length&&i(e,t))}function u(e,t){return n(e,t)&&i(e,t)&&l(e,t)<e.length-t}function d(e,t){if(s(e,t)){var r=o(e,t);if(t+r>=e.length)return!1;var n=l(e,t);if(n<=r)return!1;n=t+n;if(n===e.length||n+1<e.length&&i(e,n))return!0}return!1}function p(e,t,r,n,i){e.samplerate||(i=a(t,r,n,i),e.config=i.config,e.samplerate=i.samplerate,e.channelCount=i.channelCount,e.codec=i.codec,e.manifestCodec=i.manifestCodec,h.logger.log("parsed codec:"+e.codec+",rate:"+i.samplerate+",nb channel:"+i.channelCount))}function g(e){return 9216e4/e}function m(e,t,r,n,i){var a=e.length,s=o(e,t),e=l(e,t);if(e-=s,0<e&&t+s+e<=a)return{headerLength:s,frameLength:e,stamp:r+n*i}}function v(e,t,r,n,i){var a=m(t,r,n,i,g(e.samplerate));if(a){n=a.stamp,i=a.headerLength,a=a.frameLength,n={unit:t.subarray(r+i,r+i+a),pts:n,dts:n};return e.samples.push(n),{sample:n,length:a+i}}}},"./src/demux/base-audio-demuxer.ts":
/*!*****************************************!*\
  !*** ./src/demux/base-audio-demuxer.ts ***!
  \*****************************************/
/*! exports provided: initPTSFn, default */function(e,t,r){"use strict";r.r(t),r.d(t,"initPTSFn",function(){return g});var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),h=r(/*! ../demux/id3 */"./src/demux/id3.ts"),c=r(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),f=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),p=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),r=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,r){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(){},t.resetContiguity=function(){},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,r){},t.demux=function(e,t){this.cachedData&&(e=Object(f.appendUint8Array)(this.cachedData,e),this.cachedData=null);var r,n,i,a=h.getID3Data(e,0),s=a?a.length:0,o=this._audioTrack,l=this._id3Track,u=a?h.getTimeStamp(a):void 0,d=e.length;for(null===this.initPTS&&(this.initPTS=g(u,t)),a&&0<a.length&&l.samples.push({pts:this.initPTS,dts:this.initPTS,data:a}),n=this.initPTS;s<d;)this.canParse(e,s)?(i=this.appendFrame(o,e,s))?(this.frameIndex++,n=i.sample.pts,r=s+=i.length):s=d:h.canParse(e,s)?(a=h.getID3Data(e,s),l.samples.push({pts:n,dts:n,data:a}),r=s+=a.length):s++,s===d&&r!==d&&(i=Object(p.sliceUint8)(e,r),this.cachedData?this.cachedData=Object(f.appendUint8Array)(this.cachedData,i):this.cachedData=i);return{audioTrack:o,avcTrack:Object(c.dummyTrack)(),id3Track:l,textTrack:Object(c.dummyTrack)()}},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){return this.cachedData&&this.demux(this.cachedData,0),this.frameIndex=0,this.initPTS=null,this.cachedData=null,{audioTrack:this._audioTrack,avcTrack:Object(c.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(c.dummyTrack)()}},t.destroy=function(){},e}(),g=function(e,t){return Object(n.isFiniteNumber)(e)?90*e:9e4*t};t.default=r},"./src/demux/chunk-cache.ts":
/*!**********************************!*\
  !*** ./src/demux/chunk-cache.ts ***!
  \**********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var n=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e=this.chunks,t=this.dataLength;return e.length?(t=1===e.length?e[0]:function(e,t){for(var r=new Uint8Array(t),n=0,i=0;i<e.length;i++){var a=e[i];r.set(a,n),n+=a.length}return r}(e,t),this.reset(),t):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}()},"./src/demux/dummy-demuxed-track.ts":
/*!******************************************!*\
  !*** ./src/demux/dummy-demuxed-track.ts ***!
  \******************************************/
/*! exports provided: dummyTrack */function(e,t,r){"use strict";function n(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}r.r(t),r.d(t,"dummyTrack",function(){return n})},"./src/demux/exp-golomb.js":
/*!*********************************!*\
  !*** ./src/demux/exp-golomb.js ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),r=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),t=Math.min(4,t);if(0===t)throw new Error("no bytes available");n.set(e.subarray(r,r+t)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t},t.skipBits=function(e){var t;this.bitsAvailable>e||(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return 32<e&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?r<<t|this.readBits(t):r},t.skipLZ=function(){for(var e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r},t.readSPS=function(){var e,t,r,n=0,i=0,a=0,s=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),d=this.readBoolean.bind(this),h=this.skipBits.bind(this),c=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();var g=o();if(l(5),h(3),o(),f(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){var m=u();if(3===m&&h(1),f(),f(),h(1),d())for(t=3!==m?8:12,r=0;r<t;r++)d()&&p(r<6?16:64)}f();m=u();if(0===m)u();else if(1===m)for(h(1),c(),c(),e=u(),r=0;r<e;r++)c();f(),h(1);m=u(),f=u(),l=l(1);0===l&&h(1),h(1),d()&&(n=u(),i=u(),a=u(),s=u());var v=[1,1];if(d()&&d())switch(o()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(m+1)-2*n-2*i),height:(2-l)*(f+1)*16-(l?2:4)*(a+s),pixelRatio:v}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}();t.default=r},"./src/demux/id3.ts":
/*!**************************!*\
  !*** ./src/demux/id3.ts ***!
  \**************************/
/*! exports provided: isHeader, isFooter, getID3Data, canParse, getTimeStamp, isTimeStampFrame, getID3Frames, decodeFrame, utf8ArrayToStr, testables */function(e,t,r){"use strict";r.r(t),r.d(t,"isHeader",function(){return l}),r.d(t,"isFooter",function(){return u}),r.d(t,"getID3Data",function(){return n}),r.d(t,"canParse",function(){return i}),r.d(t,"getTimeStamp",function(){return a}),r.d(t,"isTimeStampFrame",function(){return s}),r.d(t,"getID3Frames",function(){return o}),r.d(t,"decodeFrame",function(){return c}),r.d(t,"utf8ArrayToStr",function(){return v}),r.d(t,"testables",function(){return y});var d,l=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},u=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},n=function(e,t){for(var r=t,n=0;l(e,t);)n+=10,n+=h(e,t+6),u(e,t+10)&&(n+=10),t+=n;if(0<n)return e.subarray(r,r+n)},h=function(e,t){var r=(127&e[t])<<21;return r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3]},i=function(e,t){return l(e,t)&&h(e,t+6)+10<=e.length-t},a=function(e){for(var t=o(e),r=0;r<t.length;r++){var n=t[r];if(s(n))return m(n)}},s=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},o=function(e){for(var t,r=0,n=[];l(e,r);){for(var i=h(e,r+6),a=(r+=10)+i;r+8<a;){var s=(s=e.subarray(r),o=t=void 0,t=String.fromCharCode(s[0],s[1],s[2],s[3]),o=h(s,4),{type:t,size:o,data:s.subarray(10,10+o)}),o=c(s);o&&n.push(o),r+=s.size+10}u(e,r)&&(r+=10)}return n},c=function(e){return"PRIV"===e.type?f(e):"T"===e.type[0]?p(e):"W"===e.type[0]?g(e):void 0},f=function(e){if(!(e.size<2)){var t=v(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},p=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=v(e.data.subarray(1),!0);t+=r.length+1;t=v(e.data.subarray(t));return{key:e.type,info:r,data:t}}t=v(e.data.subarray(1));return{key:e.type,data:t}}},g=function(e){if("WXXX"!==e.type){var t=v(e.data);return{key:e.type,data:t}}if(!(e.size<2)){var r=1,t=v(e.data.subarray(1),!0);r+=t.length+1;r=v(e.data.subarray(r));return{key:e.type,info:t,data:r}}},m=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),e=1&t[3],t=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return t/=45,e&&(t+=47721858.84),Math.round(t)}},v=function(e,t){void 0===t&&(t=!1);var r=function(){d||void 0===self.TextDecoder||(d=new self.TextDecoder("utf-8"));return d}();if(r){var n=r.decode(e);if(t){r=n.indexOf("\0");return-1!==r?n.substring(0,r):n}return n.replace(/\0/g,"")}for(var i,a,s,o=e.length,l="",u=0;u<o;){if(0===(i=e[u++])&&t)return l;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(i);break;case 12:case 13:a=e[u++],l+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=e[u++],s=e[u++],l+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&s)<<0)}}return l},y={decodeTextFrame:p}},"./src/demux/mp3demuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/mp3demuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),i=r(/*! ../demux/id3 */"./src/demux/id3.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ./mpegaudio */"./src/demux/mpegaudio.ts");n=function(n){var e;function t(){return n.apply(this,arguments)||this}r=n,(e=t).prototype=Object.create(r.prototype),(e.prototype.constructor=e).__proto__=r;var r=t.prototype;return r.resetInitSegment=function(e,t,r){n.prototype.resetInitSegment.call(this,e,t,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;for(var t=(i.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(s.probe(e,t))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},r.canParse=function(e,t){return s.canParse(e,t)},r.appendFrame=function(e,t,r){if(null!==this.initPTS)return s.appendFrame(e,t,r,this.initPTS,this.frameIndex)},t}(n.default);n.minProbeByteLength=4,t.default=n},"./src/demux/mp4demuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),i=r(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),r=function(){function e(){this.remainderData=null}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.resetContiguity=function(){},e.probe=function(e){return 0<Object(n.findBox)({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length},t.demux=function(e){var t=e;this.remainderData&&(t=Object(n.appendUint8Array)(this.remainderData,e));e=Object(n.segmentValidRange)(t);this.remainderData=e.remainder;t=Object(i.dummyTrack)();return t.samples=e.valid,{audioTrack:Object(i.dummyTrack)(),avcTrack:t,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},t.flush=function(){var e=Object(i.dummyTrack)();return e.samples=this.remainderData,this.remainderData=null,{audioTrack:Object(i.dummyTrack)(),avcTrack:e,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},t.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}();r.minProbeByteLength=1024,t.default=r},"./src/demux/mpegaudio.ts":
/*!********************************!*\
  !*** ./src/demux/mpegaudio.ts ***!
  \********************************/
/*! exports provided: appendFrame, parseHeader, isHeaderPattern, isHeader, canParse, probe */function(e,t,r){"use strict";r.r(t),r.d(t,"appendFrame",function(){return n}),r.d(t,"parseHeader",function(){return s}),r.d(t,"isHeaderPattern",function(){return i}),r.d(t,"isHeader",function(){return a}),r.d(t,"canParse",function(){return h}),r.d(t,"probe",function(){return c});var o=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],l=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],u=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],d=[0,1,1,4];function n(e,t,r,n,i){if(!(r+24>t.length)){var a=s(t,r);if(a&&r+a.frameLength<=t.length){i=n+i*(9e4*a.samplesPerFrame/a.sampleRate),i={unit:t.subarray(r,r+a.frameLength),pts:i,dts:i};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(i),{sample:i,length:a.frameLength}}}}function s(e,t){var r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!=r&&0!=i&&15!=i&&3!=a){i=1e3*o[14*(3==r?3-n:3==n?3:4)+i-1],a=l[3*(3==r?0:2==r?1:2)+a],e=e[t+3]>>6==3?1:2,t=u[r][n],r=d[n],n=8*t*r;return{sampleRate:a,channelCount:e,frameLength:Math.floor(t*i/a+s)*r,samplesPerFrame:n}}}function i(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function a(e,t){return t+1<e.length&&i(e,t)}function h(e,t){return i(e,t)&&4<=e.length-t}function c(e,t){if(t+1<e.length&&i(e,t)){var r=s(e,t),n=4;null!=r&&r.frameLength&&(n=r.frameLength);n=t+n;if(n===e.length||n+1<e.length&&i(e,n))return!0}return!1}},"./src/demux/sample-aes.js":
/*!*********************************!*\
  !*** ./src/demux/sample-aes.js ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var i=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),r=function(){function e(e,t,r,n){this.decryptdata=r,this.discardEPB=n,this.decrypter=new i.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(t,r,n,i){var a=t[r].unit,e=a.subarray(16,a.length-a.length%16),e=e.buffer.slice(e.byteOffset,e.byteOffset+e.length),s=this;this.decryptBuffer(e,function(e){e=new Uint8Array(e),a.set(e,16),i||s.decryptAacSamples(t,r+1,n)})},t.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,n),!n)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),n=0,i=32;i<=e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var r=0,n=32;n<=e.length-16;n+=160,r+=16)e.set(t.subarray(r,r+16),n);return e},t.decryptAvcSample=function(t,r,n,i,a,s){var o=this.discardEPB(a.data),e=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(e.buffer,function(e){a.data=l.getAvcDecryptedUnit(o,e),s||l.decryptAvcSamples(t,r,n+1,i)})},t.decryptAvcSamples=function(e,t,r,n){for(;;t++,r=0){if(t>=e.length)return void n();for(var i=e[t].units;!(r>=i.length);r++){var a=i[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,n,a,s),!s)return}}}},e}();t.default=r},"./src/demux/transmuxer-interface.ts":
/*!*******************************************!*\
  !*** ./src/demux/transmuxer-interface.ts ***!
  \*******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var u=r(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),d=r(/*! ../events */"./src/events.ts"),v=r(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),y=r(/*! ../utils/logger */"./src/utils/logger.ts"),h=r(/*! ../errors */"./src/errors.ts"),t=r(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),c=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),f=Object(t.getMediaSource)()||{isTypeSupported:function(){return!1}},n=function(){function e(r,e,t,n){var i=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.currentTransmuxSession=null,this.hls=r,this.id=e,this.onTransmuxComplete=t,this.onFlush=n;var a=r.config,n=function(e,t){(t=t||{}).frag=i.frag,t.id=i.id,r.trigger(e,t)};this.observer=new c.EventEmitter,this.observer.on(d.Events.FRAG_DECRYPTED,n),this.observer.on(d.Events.ERROR,n);var s,o={mp4:f.isTypeSupported("video/mp4"),mpeg:f.isTypeSupported("audio/mpeg"),mp3:f.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(a.enableWorker&&"undefined"!=typeof Worker){y.logger.log("demuxing in webworker");try{s=this.worker=u(/*! ../demux/transmuxer-worker.ts */"./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener("message",this.onwmsg),s.onerror=function(e){r.trigger(d.Events.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},s.postMessage({cmd:"init",typeSupported:o,vendor:l,id:e,config:JSON.stringify(a),debug:a.debug})}catch(e){y.logger.warn("Error in worker:",e),y.logger.error("Error while initializing DemuxerWorker, fallback to inline"),s&&self.URL.revokeObjectURL(s.objectURL),this.transmuxer=new v.default(this.observer,o,a,l),this.worker=null}}else this.transmuxer=new v.default(this.observer,o,a,l)}var t=e.prototype;return t.destroy=function(){var e=this.worker;e?(e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null):(t=this.transmuxer)&&(t.destroy(),this.transmuxer=null);var t=this.observer;t&&t.removeAllListeners(),this.observer=null},t.push=function(e,t,r,n,i,a,s,o,l){var u,d=this,h=this.currentTransmuxSession,c=this.transmuxer,f=this.worker,p=i.start,g=i.decryptdata,m=this.frag;u=o,(h=h)&&h.sn===u.sn&&h.level===u.level||(i.stats.parsing.start=performance.now(),h=!(m&&i.cc===m.cc),u=!(m&&i.level===m.level),m=!(!m||i.sn!==m.sn+1),m=!u&&m,y.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for fragment "+i.sn+", of level "+i.level+":\n        discontinuity: "+h+"\n        trackSwitch: "+u+"\n        contiguous: "+m+"\n        accurateTimeOffset: "+s+"\n        timeOffset: "+p),this.currentTransmuxSession=o,l=new v.TransmuxConfig(r,n,new Uint8Array(t),a,l),p=new v.TransmuxState(h,m,s,u,p),this.configureTransmuxer(l,p)),this.frag=i,f?f.postMessage({cmd:"demux",data:e,decryptdata:g,chunkMeta:o},e instanceof ArrayBuffer?[e]:[]):c&&(o=c.push(e,g,o),Object(v.isPromise)(o)?o.then(function(e){d.handleTransmuxComplete(e)}):this.handleTransmuxComplete(o))},t.flush=function(t){var r=this,e=this.transmuxer,n=this.worker;this.currentTransmuxSession=null,t.transmuxing.start=performance.now(),n?n.postMessage({cmd:"flush",chunkMeta:t}):e&&(e=e.flush(t),Object(v.isPromise)(e)?e.then(function(e){r.handleFlushResult(e,t)}):this.handleFlushResult(e,t))},t.handleFlushResult=function(e,t){var r=this;e.forEach(function(e){r.handleTransmuxComplete(e)}),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},t.configureTransmuxer=function(e,t){var r=this.worker,n=this.transmuxer;r?r.postMessage({cmd:"configure",config:e,state:t}):n&&n.configure(e,t)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=performance.now(),this.onTransmuxComplete(e)},e}()},"./src/demux/transmuxer-worker.ts":
/*!****************************************!*\
  !*** ./src/demux/transmuxer-worker.ts ***!
  \****************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return a});var l=r(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),n=r(/*! ../events */"./src/events.ts"),u=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");function a(a){function s(e,t){a.postMessage({event:e,data:t})}var o=new i.EventEmitter;o.on(n.Events.FRAG_DECRYPTED,s),o.on(n.Events.ERROR,s),a.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":var r=JSON.parse(t.config);r.debug=t.debug,a.transmuxer=new l.default(o,t.typeSupported,r,t.vendor),Object(u.enableLogs)(r.debug),s("init",null);break;case"configure":a.transmuxer.configure(t.config,t.state);break;case"demux":var n=a.transmuxer.push(t.data,t.decryptdata,t.chunkMeta);Object(l.isPromise)(n)?n.then(function(e){d(a,e)}):d(a,n);break;case"flush":var i=t.chunkMeta,n=a.transmuxer.flush(i);Object(l.isPromise)(n)?n.then(function(e){h(a,e,i)}):h(a,n,i)}})}function d(e,t){var r,n,i;((n=t.remuxResult).audio||n.video||n.text||n.id3||n.initSegment)&&(r=[],n=(i=t.remuxResult).audio,i=i.video,n&&s(r,n),i&&s(r,i),e.postMessage({event:"transmuxComplete",data:t},r))}function s(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function h(t,e,r){e.forEach(function(e){d(t,e)}),t.postMessage({event:"flush",data:r})}},"./src/demux/transmuxer.ts":
/*!*********************************!*\
  !*** ./src/demux/transmuxer.ts ***!
  \*********************************/
/*! exports provided: default, isPromise, TransmuxConfig, TransmuxState */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return d}),r.d(t,"isPromise",function(){return p}),r.d(t,"TransmuxConfig",function(){return v}),r.d(t,"TransmuxState",function(){return y});var b,h=r(/*! ../events */"./src/events.ts"),c=r(/*! ../errors */"./src/errors.ts"),n=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),i=r(/*! ../demux/aacdemuxer */"./src/demux/aacdemuxer.ts"),a=r(/*! ../demux/mp4demuxer */"./src/demux/mp4demuxer.ts"),s=r(/*! ../demux/tsdemuxer */"./src/demux/tsdemuxer.ts"),o=r(/*! ../demux/mp3demuxer */"./src/demux/mp3demuxer.ts"),l=r(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),t=r(/*! ../remux/passthrough-remuxer */"./src/remux/passthrough-remuxer.ts"),u=r(/*! ./chunk-cache */"./src/demux/chunk-cache.ts"),E=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),g=r(/*! ../utils/logger */"./src/utils/logger.ts");try{b=self.performance.now.bind(self.performance)}catch(e){g.logger.debug("Unable to use Performance API on this environment"),b=self.Date.now}var m=[{demux:s.default,remux:l.default},{demux:a.default,remux:t.default},{demux:i.default,remux:l.default},{demux:o.default,remux:l.default}],f=1024;m.forEach(function(e){e=e.demux;f=Math.max(f,e.minProbeByteLength)});var d=function(){function e(e,t,r,n){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new u.default,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=n}var t=e.prototype;return t.configure=function(e,t){this.transmuxConfig=e,this.currentTransmuxState=t,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,r){var n=this,i=r.transmuxing;i.executeStart=b();var a=new Uint8Array(e),s=this.cache,o=this.config,l=this.currentTransmuxState,u=this.transmuxConfig,d=function(e,t){var r=null;0<e.byteLength&&null!=t&&null!=t.key&&(r=t.method);return r}(a,t);if("AES-128"===d){var h=this.getDecrypter();if(!o.enableSoftwareAES)return this.decryptionPromise=h.webCryptoDecrypt(a,t.key.buffer,t.iv.buffer).then(function(e){e=n.push(e,null,r);return n.decryptionPromise=null,e}),this.decryptionPromise;var c=h.softwareDecrypt(a,t.key.buffer,t.iv.buffer);if(!c)return i.executeEnd=b(),T(r);a=new Uint8Array(c)}var f=l.contiguous,p=l.discontinuity,g=l.trackSwitch,m=l.accurateTimeOffset,v=l.timeOffset,y=u.audioCodec,e=u.videoCodec,o=u.defaultInitPts,h=u.duration,c=u.initSegmentData;(p||g)&&this.resetInitSegment(c,y,e,h),p&&this.resetInitialTimestamp(o),f||this.resetContiguity();o=this.demuxer,f=this.remuxer;if(this.needsProbing(a,p,g)&&(s.dataLength&&(g=s.flush(),a=Object(E.appendUint8Array)(g,a)),o=(u=this.configureTransmuxer(a,u)).demuxer,f=u.remuxer),!o||!f)return s.push(a),i.executeEnd=b(),T(r);m=this.transmux(a,t,d,v,m,r);return l.contiguous=!0,l.discontinuity=!1,l.trackSwitch=!1,i.executeEnd=b(),m},t.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=b();var n=this.decrypter,i=this.cache,a=this.currentTransmuxState,s=this.decryptionPromise,o=this.observer,l=[];if(s)return s.then(function(){return t.flush(e)});var u=a.accurateTimeOffset,s=a.timeOffset;!n||(d=n.flush())&&l.push(this.push(d,null,e));a=i.dataLength;i.reset();var n=this.demuxer,d=this.remuxer;if(!n||!d)return f<=a&&o.emit(h.Events.ERROR,h.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),r.executeEnd=b(),[T(e)];i=n.flush(s),a=i.audioTrack,o=i.avcTrack,n=i.id3Track,i=i.textTrack;return g.logger.log("[transmuxer.ts]: Flushed fragment "+e.sn+" of level "+e.level),l.push({remuxResult:d.remux(a,o,n,i,s,u),chunkMeta:e}),r.executeEnd=b(),l},t.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,r,n){var i=this.demuxer,a=this.remuxer;i&&a&&(i.resetInitSegment(t,r,n),a.resetInitSegment(e,t,r))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,r,n,i,a){a="SAMPLE-AES"===r?this.transmuxSampleAes(e,t,n,i,a):this.transmuxUnencrypted(e,n,i,a);return a},t.transmuxUnencrypted=function(e,t,r,n){var i=this.demuxer.demux(e,t,!1),a=i.audioTrack,s=i.avcTrack,e=i.id3Track,i=i.textTrack;return{remuxResult:this.remuxer.remux(a,s,e,i,t,r),chunkMeta:n}},t.transmuxSampleAes=function(e,t,r,n,i){var a=this;return this.demuxer.demuxSampleAes(e,t,r).then(function(e){return{remuxResult:a.remuxer.remux(e.audioTrack,e.avcTrack,e.id3Track,e.textTrack,r,n),chunkMeta:i}})},t.configureTransmuxer=function(e,t){for(var r,n=this.config,i=this.observer,a=this.typeSupported,s=this.vendor,o=t.audioCodec,l=t.defaultInitPts,u=t.duration,d=t.initSegmentData,h=t.videoCodec,c=0,f=m.length;c<f&&!(r=m[c]).demux.probe(e);c++);if(!r)return{remuxer:void 0,demuxer:void 0};var p=this.demuxer,t=this.remuxer;return t&&t instanceof r.remux||(t=this.remuxer=new r.remux(i,n,a,s)),p&&p instanceof r.demux||(p=this.demuxer=new r.demux(i,n,a),this.probe=r.demux.probe),this.resetInitSegment(d,o,h,u),this.resetInitialTimestamp(l),g.logger.log("[transmuxer]: Probe succeeded with a data length of "+e.length+"."),{demuxer:p,remuxer:t}},t.needsProbing=function(e,t,r){return!this.demuxer||t||r},t.getDecrypter=function(){return this.decrypter||(this.decrypter=new n.default(this.observer,this.config))},e}();var T=function(e){return{remuxResult:{},chunkMeta:e}};function p(e){return"then"in e&&e.then instanceof Function}var v=function(e,t,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i},y=function(e,t,r,n,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i}},"./src/demux/tsdemuxer.ts":
/*!********************************!*\
  !*** ./src/demux/tsdemuxer.ts ***!
  \********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var f=r(/*! ./adts */"./src/demux/adts.js"),o=r(/*! ./mpegaudio */"./src/demux/mpegaudio.ts"),R=r(/*! ../events */"./src/events.ts"),L=r(/*! ./exp-golomb */"./src/demux/exp-golomb.js"),s=r(/*! ./sample-aes */"./src/demux/sample-aes.js"),D=r(/*! ../utils/logger */"./src/utils/logger.ts"),k=r(/*! ../errors */"./src/errors.ts"),x=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),P=r(/*! ../demux/id3 */"./src/demux/id3.ts"),n={video:1,audio:2,id3:3,text:4},r=function(){function A(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.contiguous=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=void 0,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}A.probe=function(e){e=A._syncOffset(e);return!(e<0)&&(e&&D.logger.warn("MPEG2-TS detected but first sync word found @ offset "+e+", junk ahead ?"),!0)},A._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},A.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:n[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var e=A.prototype;return e.resetInitSegment=function(e,t,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=A.createTrack("video",r),this._audioTrack=A.createTrack("audio",r),this._id3Track=A.createTrack("id3",r),this._txtTrack=A.createTrack("text",r),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=t,this._duration=r},e.resetTimeStamp=function(){},e.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},e.demux=function(e,t,r,n,i){var a,s,o,l,u;void 0===n&&(n=!1),void 0===i&&(i=!1),n||(this.sampleAes=null),this.contiguous=t;var d=this._avcTrack,h=this._audioTrack,c=this._id3Track,f=d.pid,p=d.pesData,g=h.pid,m=c.pid,v=h.pesData,y=c.pesData,b=!1,E=this.pmtParsed,T=this._pmtId,S=e.length;if(this.remainderData&&(S=(e=Object(x.appendUint8Array)(this.remainderData,e)).length,this.remainderData=null),S<188&&!i)return this.remainderData=e,{audioTrack:h,avcTrack:d,id3Track:c,textTrack:this._txtTrack};var _,w=Math.max(0,A._syncOffset(e));for((S-=(S+w)%188)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,S,e.buffer.byteLength-S)),a=w;a<S;a+=188)if(71===e[a]){if(s=!!(64&e[a+1]),o=((31&e[a+1])<<8)+e[a+2],1<(48&e[a+3])>>4){if((l=a+5+e[a+4])===a+188)continue}else l=a+4;switch(o){case f:s&&(p&&(u=I(p))&&this._parseAVCPES(u,!1),p={data:[],size:0}),p&&(p.data.push(e.subarray(l,a+188)),p.size+=a+188-l);break;case g:s&&(v&&(u=I(v))&&(h.isAAC?this._parseAACPES(u):this._parseMPEGPES(u)),v={data:[],size:0}),v&&(v.data.push(e.subarray(l,a+188)),v.size+=a+188-l);break;case m:s&&(y&&(u=I(y))&&this._parseID3PES(u),y={data:[],size:0}),y&&(y.data.push(e.subarray(l,a+188)),y.size+=a+188-l);break;case 0:s&&(l+=e[l]+1),T=this._pmtId=(31&(_=e)[(L=l)+10])<<8|_[L+11];break;case T:s&&(l+=e[l]+1);var L=function(e,t,r,n){var i={audio:-1,avc:-1,id3:-1,isAAC:!0},a=(15&e[t+1])<<8|e[t+2],s=t+3+a-4,a=(15&e[t+10])<<8|e[t+11];t+=12+a;for(;t<s;){var o=(31&e[t+1])<<8|e[t+2];switch(e[t]){case 207:if(!n){D.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=o);break;case 21:-1===i.id3&&(i.id3=o);break;case 219:if(!n){D.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=o);break;case 3:case 4:r?-1===i.audio&&(i.audio=o,i.isAAC=!1):D.logger.log("MPEG audio found, not supported in this browser");break;case 36:D.logger.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return i}(e,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,n);0<(f=L.avc)&&(d.pid=f),0<(g=L.audio)&&(h.pid=g,h.isAAC=L.isAAC),0<(m=L.id3)&&(c.pid=m),b&&!E&&(D.logger.log("reparse from beginning"),b=!1,a=w-188),E=this.pmtParsed=!0;break;case 17:case 8191:break;default:b=!0}}else this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});return d.pesData=p,h.pesData=v,c.pesData=y,{audioTrack:h,avcTrack:d,id3Track:c,textTrack:this._txtTrack}},e.flush=function(){var e=this.remainderData;return this.remainderData=null,e=e?this.demux(e,this.contiguous,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(e),e},e.extractRemainingSamples=function(e){var t,r=e.audioTrack,n=e.avcTrack,i=e.id3Track,a=n.pesData,s=r.pesData,e=i.pesData;a&&(t=I(a))?(this._parseAVCPES(t,!0),n.pesData=null):n.pesData=a,s&&(t=I(s))?(r.isAAC?this._parseAACPES(t):this._parseMPEGPES(t),r.pesData=null):(null!=s&&s.size&&D.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=s),e&&(t=I(e))?(this._parseID3PES(t),i.pesData=null):i.pesData=e},e.demuxSampleAes=function(e,t,r){var n=this,i=this.demux(e,r,!0),a=this.sampleAes=new s.default(this.observer,this.config,t,this.discardEPB);return new Promise(function(e,t){n.decrypt(i.audioTrack,i.avcTrack,a).then(function(){e(i)})})},e.decrypt=function(t,r,n){return new Promise(function(e){t.samples&&t.isAAC?n.decryptAacSamples(t.samples,0,function(){r.samples?n.decryptAvcSamples(r.samples,0,0,function(){e()}):e()}):r.samples&&n.decryptAvcSamples(r.samples,0,0,function(){e()})})},e.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},e.pushAccessUnit=function(e,t){if(e.units.length&&e.frame){if(isNaN(e.pts)){var r=t.samples,n=r.length;if(!n)return void t.dropped++;n=r[n-1];e.pts=n.pts,e.dts=n.dts}t.samples.push(e)}e.debug.length&&D.logger.log(e.pts+"/"+e.dts+":"+e.debug)},e._parseAVCPES=function(m,e){var v,y,b,E=this,T=this._avcTrack,t=this._parseAVCNALu(m.data),S=this.avcSample,_=!1,w=this.pushAccessUnit.bind(this);m.data=null,S&&t.length&&!T.audFound&&(w(S,T),S=this.avcSample=O(!1,m.pts,m.dts,"")),t.forEach(function(e){switch(e.type){case 1:y=!0,(S=S||(E.avcSample=O(!0,m.pts,m.dts,""))).frame=!0;var t=e.data;_&&4<t.length&&(2!==(c=new L.default(t).readSliceType())&&4!==c&&7!==c&&9!==c||(S.key=!0));break;case 5:y=!0,(S=S||(E.avcSample=O(!0,m.pts,m.dts,""))).key=!0,S.frame=!0;break;case 6:y=!0,(v=new L.default(E.discardEPB(e.data))).readUByte();for(var r=0,n=0,i=!1,a=0;!i&&1<v.bytesAvailable;){for(r=0;r+=a=v.readUByte(),255===a;);for(n=0;n+=a=v.readUByte(),255===a;);if(4===r&&0!==v.bytesAvailable){i=!0;var s=v.readUByte();if(181===s)if(49===v.readUShort()){s=v.readUInt();if(1195456820===s)if(3===v.readUByte()){var s=v.readUByte(),o=31&s,l=[s,v.readUByte()];for(b=0;b<o;b++)l.push(v.readUByte()),l.push(v.readUByte()),l.push(v.readUByte());E._insertSampleInOrder(E._txtTrack.samples,{type:3,pts:m.pts,bytes:l})}}}else if(5===r&&0!==v.bytesAvailable){if(i=!0,16<n){var u=[];for(b=0;b<16;b++)u.push(v.readUByte().toString(16)),3!==b&&5!==b&&7!==b&&9!==b||u.push("-");var d=n-16,h=new Uint8Array(d);for(b=0;b<d;b++)h[b]=v.readUByte();E._insertSampleInOrder(E._txtTrack.samples,{pts:m.pts,payloadType:r,uuid:u.join(""),userData:Object(P.utf8ArrayToStr)(h),userDataBytes:h})}}else if(n<v.bytesAvailable)for(b=0;b<n;b++)v.readUByte()}break;case 7:if(_=y=!0,!T.sps){var c=(v=new L.default(e.data)).readSPS();T.width=c.width,T.height=c.height,T.pixelRatio=c.pixelRatio,T.sps=[e.data],T.duration=E._duration;var f=e.data.subarray(1,4),p="avc1.";for(b=0;b<3;b++){var g=f[b].toString(16);g.length<2&&(g="0"+g),p+=g}T.codec=p}break;case 8:y=!0,T.pps||(T.pps=[e.data]);break;case 9:y=!1,T.audFound=!0,S&&w(S,T),S=E.avcSample=O(!1,m.pts,m.dts,"");break;case 12:y=!1;break;default:y=!1,S&&(S.debug+="unknown NAL "+e.type+" ")}S&&y&&S.units.push(e)}),e&&S&&(w(S,T),this.avcSample=null)},e._insertSampleInOrder=function(e,t){var r=e.length;if(0<r){if(t.pts>=e[r-1].pts)e.push(t);else for(var n=r-1;0<=n;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},e._getLastNalUnit=function(){var e,t,r=this.avcSample;return r&&0!==r.units.length||(r=(e=this._avcTrack.samples)[e.length-1]),null!==r&&void 0!==r&&r.units&&(t=(t=r.units)[t.length-1]),t},e._parseAVCNALu=function(e){var t,r,n,i,a,s=e.byteLength,o=this._avcTrack,l=p=o.naluState||0,u=[],d=0,h=-1;for(-1===p&&(n=31&e[h=0],p=0,d=1);d<s;){var c,f,p,g=e[d++];p?p=1!==p?g?1===g?(0<=h?(r={data:e.subarray(h,d-p-1),type:n},u.push(r)):(c=this._getLastNalUnit())&&(l&&d<=4-l&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-l)),0<(t=d-p-1)&&((f=new Uint8Array(c.data.byteLength+t)).set(c.data,0),f.set(e.subarray(0,t),c.data.byteLength),c.data=f)),d<s?(n=31&e[h=d],0):-1):0:3:g?0:2:p=g?0:1}return 0<=h&&0<=p&&(r={data:e.subarray(h,s),type:n,state:p},u.push(r)),0!==u.length||(i=this._getLastNalUnit())&&((a=new Uint8Array(i.data.byteLength+e.byteLength)).set(i.data,0),a.set(e,i.data.byteLength),i.data=a),o.naluState=p,u},e.discardEPB=function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;for(var i=t-r.length,a=new Uint8Array(i),s=0,n=0;n<i;s++,n++)s===r[0]&&(s++,r.shift()),a[n]=e[s];return a},e._parseAACPES=function(e){var t,r,n,i,a=this._audioTrack,s=this.aacLastPTS,o=this.aacOverFlow,l=e.data,u=e.pts;for(o&&((e=new Uint8Array(o.byteLength+l.byteLength)).set(o,0),e.set(l,o.byteLength),l=e),r=0,i=l.length;r<i-1&&!f.isHeader(l,r);r++);if(r){var d,h=r<i-1?(d="AAC PES did not start with ADTS header,offset:"+r,!1):(d="no ADTS header found in AAC PES",!0);if(D.logger.warn("parsing error:"+d),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_PARSING_ERROR,fatal:h,reason:d}),h)return}f.initTrackConfig(a,this.observer,l,r,this.audioCodec),t=0;h=f.getFrameDuration(a.samplerate);for(o&&s&&(h=s+h,1<Math.abs(h-u)&&(D.logger.log("[tsdemuxer]: AAC: align PTS for overlapping frames by "+Math.round((h-u)/90)),u=h));r<i;){if(f.isHeader(l,r)){if(r+5<i){var c=f.appendFrame(a,l,r,u,t);if(c){r+=c.length,n=c.sample.pts,t++;continue}}break}r++}o=r<i?l.subarray(r,i):null,this.aacOverFlow=o,this.aacLastPTS=n},e._parseMPEGPES=function(e){for(var t=e.data,r=t.length,n=0,i=0,a=e.pts;i<r;)if(o.isHeader(t,i)){var s=o.appendFrame(this._audioTrack,t,i,a,n);if(!s)break;i+=s.length,n++}else i++},e._parseID3PES=function(e){this._id3Track.samples.push(e)},A}();function O(e,t,r,n){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:n,length:0}}function I(e){var t,r,n,i,a,s,o,l=0,u=e.data;if(!e||0===e.size)return null;for(;u[0].length<19&&1<u.length;){var d=new Uint8Array(u[0].length+u[1].length);d.set(u[0]),d.set(u[1],u[0].length),u[0]=d,u.splice(1,1)}if(1!==((t=u[0])[0]<<16)+(t[1]<<8)+t[2])return null;if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;if(192&(n=t[7])&&(a=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&n?54e5<a-(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)&&(D.logger.warn(Math.round((a-s)/9e4)+"s delta between PTS and DTS, align them"),a=s):s=a),o=(n=t[8])+9,e.size<=o)return null;e.size-=o,i=new Uint8Array(e.size);for(var h=0,c=u.length;h<c;h++){var f=(t=u[h]).byteLength;if(o){if(f<o){o-=f;continue}t=t.subarray(o),f-=o,o=0}i.set(t,l),l+=f}return r&&(r-=n+3),{data:i,pts:a,dts:s,len:r}}r.minProbeByteLength=188,t.default=r},"./src/empty.js":
/*!**********************!*\
  !*** ./src/empty.js ***!
  \**********************/
/*! no static exports found */function(e,t){e.exports=void 0},"./src/errors.ts":
/*!***********************!*\
  !*** ./src/errors.ts ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(e,t,r){"use strict";var n,i;r.r(t),r.d(t,"ErrorTypes",function(){return n}),r.d(t,"ErrorDetails",function(){return i}),(t=n=n||{}).NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",(t=i=i||{}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted"},"./src/events.ts":
/*!***********************!*\
  !*** ./src/events.ts ***!
  \***********************/
/*! exports provided: Events */function(e,t,r){"use strict";var n;r.r(t),r.d(t,"Events",function(){return n}),(t=n=n||{}).MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.MILDOM_STALL_RECOVER="hlsMildomStallRecover",t.MILDOM_LATENCY_CONTROL="hlsMildomLatencyControl"},"./src/hls.ts":
/*!********************!*\
  !*** ./src/hls.ts ***!
  \********************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return u});var n=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),s=r(/*! ./errors */"./src/errors.ts"),f=r(/*! ./loader/playlist-loader */"./src/loader/playlist-loader.ts"),p=r(/*! ./loader/key-loader */"./src/loader/key-loader.ts"),g=r(/*! ./controller/fragment-tracker */"./src/controller/fragment-tracker.ts"),m=r(/*! ./controller/stream-controller */"./src/controller/stream-controller.ts"),v=r(/*! ./controller/level-controller */"./src/controller/level-controller.ts"),i=r(/*! ./is-supported */"./src/is-supported.ts"),y=r(/*! ./utils/logger */"./src/utils/logger.ts"),b=r(/*! ./config */"./src/config.ts"),o=r(/*! ./events */"./src/events.ts"),E=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),T=r(/*! ./controller/id3-track-controller */"./src/controller/id3-track-controller.ts"),S=r(/*! ./controller/latency-controller */"./src/controller/latency-controller.ts"),_=r(/*! ./controller/mildom/latency-controller */"./src/controller/mildom/latency-controller.ts");function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}var u=function(){function c(e){var t=this;void 0===e&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new E.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.mildomLatencyController=null,this._isMildomLiveEnd=!1,this._media=null,this.url=null,this._isRunning=!1;var r=this.config=Object(b.mergeConfig)(c.DefaultConfig,e);this.userConfig=e,Object(y.enableLogs)(r.debug),this._autoLevelCapping=-1,this.progressive=r.progressive;var n=this.abrController=new r.abrController(this),i=new r.bufferController(this),a=this.capLevelController=new r.capLevelController(this),s=new r.fpsController(this),o=new f.default(this),l=new p.default(this),u=new T.default(this),d=this.levelController=new v.default(this),e=new g.FragmentTracker(this),h=this.streamController=new m.default(this,e);d.onParsedComplete=function(){(r.autoStartLoad||h.forceStartLoad)&&t.startLoad(r.startPosition)},a.setStreamController(h),s.setStreamController(h);d=[d,h];this.networkControllers=d;u=[o,l,n,i,a,s,u,e];this.audioTrackController=this.createController(r.audioTrackController,null,d),this.createController(r.audioStreamController,e,d),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,d),this.createController(r.subtitleStreamController,e,d),this.createController(r.timelineController,null,u),this.emeController=this.createController(r.emeController,null,u),this.latencyController=this.createController(S.default,null,u),this.config.mildomRealtimePlaybackMode||(this.mildomLatencyController=this.createController(_.default,null,u)),this.coreComponents=u}c.isSupported=function(){return Object(i.isSupported)()},l(c,null,[{key:"version",get:function(){return"1.0.0-alpha14"}},{key:"Events",get:function(){return o.Events}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return c.defaultConfig||b.hlsDefaultConfig},set:function(e){c.defaultConfig=e}}]);var e=c.prototype;return e.createController=function(e,t,r){if(e){e=t?new e(this,t):new e(this);return r&&r.push(e),e}return null},e.on=function(n,i,e){var a=this;this._emitter.on(n,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(a.config.debug)i.apply(this,t);else try{i.apply(this,t)}catch(e){y.logger.error("An internal error happened while handling event "+n+'. Error message: "'+e.message+'". Here is a stacktrace:',e),a.trigger(o.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:e})}},e)},e.once=function(n,i,e){var a=this;this._emitter.once(n,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(a.config.debug)i.apply(this,t);else try{i.apply(this,t)}catch(e){y.logger.error("An internal error happened while handling event "+n+'. Error message: "'+e.message+'". Here is a stacktrace:',e),a.trigger(o.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:e})}},e)},e.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},e.off=function(e,t,r,n){this._emitter.off(e,t,r,n)},e.listeners=function(e){return this._emitter.listeners(e)},e.emit=function(e,t,r){return this._emitter.emit(e,t,r)},e.trigger=function(e,t){return this._emitter.emit(e,e,t)},e.listenerCount=function(e){return this._emitter.listenerCount(e)},e.destroy=function(){y.logger.log("destroy"),this.trigger(o.Events.DESTROYING,void 0),this.detachMedia(),this.networkControllers.forEach(function(e){return e.destroy()}),this.coreComponents.forEach(function(e){return e.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},e.attachMedia=function(e){y.logger.log("attachMedia"),this._media=e,this.trigger(o.Events.MEDIA_ATTACHING,{media:e})},e.detachMedia=function(){y.logger.log("detachMedia"),this.trigger(o.Events.MEDIA_DETACHING,void 0),this._media=null},e.loadSource=function(e){this.stopLoad();var t=this.media;t&&this.url&&(this.detachMedia(),this.attachMedia(t)),e=n.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0}),y.logger.log("loadSource:"+e),this.url=e,this.trigger(o.Events.MANIFEST_LOADING,{url:e})},e.startLoad=function(t){void 0===t&&(t=-1),this.isRunning=!0,this.isMildomLiveEnd=!1,y.logger.log("startLoad("+t+")"),this.isMildomLiveEnd=!1,this.networkControllers.forEach(function(e){e.startLoad(t)})},e.notifyMildomLiveEnd=function(){this.isMildomLiveEnd=!0},e.stopLoad=function(){this.isRunning=!1,y.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},e.swapAudioCodec=function(){y.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.recoverMediaError=function(){y.logger.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},e.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},l(c,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){y.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){y.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){y.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){y.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){y.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){e=!!e;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(y.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){return this.abrController.bwEstimator.getEstimate()}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,n=0;n<r;n++)if(e[n].maxBitrate>t)return n;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping,t=-1===t&&e&&e.length?e.length-1:t;return t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"progressive",get:function(){return this.config.progressive},set:function(e){Object(b.setStreamingMode)(this.config,e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"isMildomLiveEnd",get:function(){return this._isMildomLiveEnd},set:function(e){this._isMildomLiveEnd=e}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"isRunning",set:function(e){this._isRunning=e},get:function(){return this._isRunning}}]),c}();u.defaultConfig=void 0},"./src/is-supported.ts":
/*!*****************************!*\
  !*** ./src/is-supported.ts ***!
  \*****************************/
/*! exports provided: isSupported */function(e,t,r){"use strict";r.r(t),r.d(t,"isSupported",function(){return i});var n=r(/*! ./utils/mediasource-helper */"./src/utils/mediasource-helper.ts");function i(){var e=Object(n.getMediaSource)();if(!e)return!1;var t=self.SourceBuffer||self.WebKitSourceBuffer,e=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),t=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!e&&!!t}},"./src/loader/fragment-loader.ts":
/*!***************************************!*\
  !*** ./src/loader/fragment-loader.ts ***!
  \***************************************/
/*! exports provided: default, LoadError */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return l}),r.d(t,"LoadError",function(){return c});var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),h=r(/*! ../errors */"./src/errors.ts");function i(e){var n="function"==typeof Map?new Map:void 0;return(i=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return a(e,arguments,o(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function a(e,t,r){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);n=new(Function.bind.apply(e,n));return r&&s(n,r.prototype),n}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.nextPartIndex=-1,this.config=e}var t=e.prototype;return t.abort=function(e){this.loader&&(1<this.config.mildomFragMaxParallelLoadNum&&this.loader.context.frag.sn!==e.sn||(console.log("Abort frag loader "+this.loader.context.url,this.loader),this.loader.abort()))},t.load=function(a,e,s){var o=this;void 0===e&&(e=null);var t=a.url;if(!t)return Promise.reject(new c({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));var r=this.config,e=r.fLoader,t=r.loader;this.abort(a);var l=this.loader=a.loader=new(e||t)(r),u={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:0},d=function(e,t){void 0===t&&(t=null);var r=t||e,e={frag:e,part:t,responseType:"arraybuffer",url:r.url,rangeStart:0,rangeEnd:0},t=r.byteRangeStartOffset,r=r.byteRangeEndOffset;Object(n.isFiniteNumber)(t)&&Object(n.isFiniteNumber)(r)&&(e.rangeStart=t,e.rangeEnd=r);return e}(a);return new Promise(function(i,n){l.stats=a.stats,l.load(d,u,{onSuccess:function(e,t,r,n){o.resetLoader(a,l),i({frag:a,payload:e.data,networkDetails:n})},onError:function(e,t,r){o.resetLoader(a,l),n(new c({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:e,networkDetails:r}))},onAbort:function(e,t,r){o.resetLoader(a,l),n(new c({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:r}))},onTimeout:function(e,t,r){o.resetLoader(a,l),n(new c({type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:r}))},onProgress:function(e,t,r,n){s&&s({frag:a,payload:r,networkDetails:n})}})})},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.nextPartIndex=-1,this.loader=null)},e}();var c=function(a){var e,t;function r(e){for(var t,r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return(t=a.call.apply(a,[this].concat(n))||this).data=void 0,t.data=e,t}return t=a,(e=r).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t,r}(i(Error))},"./src/loader/fragment.ts":
/*!********************************!*\
  !*** ./src/loader/fragment.ts ***!
  \********************************/
/*! exports provided: ElementaryStreamTypes, BaseSegment, default, Part */function(e,t,r){"use strict";r.r(t),r.d(t,"ElementaryStreamTypes",function(){return i}),r.d(t,"BaseSegment",function(){return c}),r.d(t,"default",function(){return f}),r.d(t,"Part",function(){return p});var i,a=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ./level-key */"./src/loader/level-key.ts"),l=r(/*! ./load-stats */"./src/loader/load-stats.ts");function u(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),e}(r=i=i||{}).AUDIO="audio",r.VIDEO="video",r.AUDIOVIDEO="audiovideo";var c=function(){function e(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.baseurl=e}return e.prototype.setByteRange=function(e,t){var r=e.split("@",2),e=[];1===r.length?e[0]=t?t.byteRangeEndOffset:0:e[0]=parseInt(r[1]),e[1]=parseInt(r[0])+e[0],this._byteRange=e},h(e,[{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(n.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),f=function(n){function e(e,t){var r=n.call(this,t)||this;return r._decryptdata=null,r.elementaryStreams=((t={})[i.AUDIO]=null,t[i.VIDEO]=null,t[i.AUDIOVIDEO]=null,t),r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkey=void 0,r.type=void 0,r.loader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.backtracked=!1,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new l.default,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.dropped=0,r.title=null,r.prefetch=!1,r.type=e,r}u(e,n);var t=e.prototype;return t.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},t.setDecryptDataFromLevelKey=function(e,t){var r=e;return"AES-128"===(null==e?void 0:e.method)&&e.uri&&!e.iv&&((r=o.default.fromURI(e.uri)).method=e.method,r.iv=this.createInitializationVector(t),r.keyFormat="identity"),r},t.setElementaryStreamInfo=function(e,t,r,n,i){var a=this.elementaryStreams,s=a[e];s?(s.startPTS=Math.min(s.startPTS,t),s.endPTS=Math.max(s.endPTS,r),s.startDTS=Math.min(s.startDTS,n),s.endDTS=Math.max(s.endDTS,i)):a[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i}},h(e,[{key:"decryptdata",get:function(){return this.levelkey||this._decryptdata?(!this._decryptdata&&this.levelkey&&("number"!=typeof(e=this.sn)&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&s.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)),this._decryptdata):null;var e}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(a.isFiniteNumber)(this.programDateTime))return null;var e=Object(a.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;return!(null===(e=this.decryptdata)||void 0===e||!e.keyFormat||!this.decryptdata.uri)}}]),e}(c),p=function(a){function e(e,t,r,n,i){r=a.call(this,r)||this;r.fragOffset=0,r.duration=0,r.gap=!1,r.independent=!1,r.relurl=void 0,r.fragment=void 0,r.index=void 0,r.stats=new l.default,r.duration=e.decimalFloatingPoint("DURATION"),r.gap=e.bool("GAP"),r.independent=e.bool("INDEPENDENT"),r.relurl=e.enumeratedString("URI"),r.fragment=t,r.index=n;e=e.enumeratedString("BYTERANGE");return e&&r.setByteRange(e,i),i&&(r.fragOffset=i.fragOffset+i.duration),r}return u(e,a),h(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}}]),e}(c)},"./src/loader/key-loader.ts":
/*!**********************************!*\
  !*** ./src/loader/key-loader.ts ***!
  \**********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return i});var s=r(/*! ../events */"./src/events.ts"),n=r(/*! ../errors */"./src/errors.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=function(){function e(e){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){this.hls.on(s.Events.KEY_LOADING,this.onKeyLoading,this)},t._unregisterListeners=function(){this.hls.off(s.Events.KEY_LOADING,this.onKeyLoading)},t.destroy=function(){for(var e in this._unregisterListeners(),this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={}},t.onKeyLoading=function(e,t){var r,n=t.frag,i=n.type,a=this.loaders[i];n.decryptdata?(r=n.decryptdata.uri)!==this.decrypturl||null===this.decryptkey?(t=this.hls.config,a&&(o.logger.warn("abort previous key loader for type:"+i),a.abort()),r?(a=n.loader=this.loaders[i]=new t.loader(t),this.decrypturl=r,this.decryptkey=null,i={url:r,frag:n,responseType:"arraybuffer"},r={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:t.fragLoadingRetryDelay,maxRetryDelay:t.fragLoadingMaxRetryTimeout,highWaterMark:0},t={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},a.load(i,r,t)):o.logger.warn("key uri is falsy")):this.decryptkey&&(n.decryptdata.key=this.decryptkey,this.hls.trigger(s.Events.KEY_LOADED,{frag:n})):o.logger.warn("Missing decryption data on fragment in onKeyLoading")},t.loadsuccess=function(e,t,r){r=r.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=null,delete this.loaders[r.type],this.hls.trigger(s.Events.KEY_LOADED,{frag:r})):o.logger.error("after key load, decryptdata unset")},t.loaderror=function(e,t){var r=t.frag,t=r.loader;t&&t.abort(),delete this.loaders[r.type],this.hls.trigger(s.Events.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},t.loadtimeout=function(e,t){var r=t.frag,t=r.loader;t&&t.abort(),delete this.loaders[r.type],this.hls.trigger(s.Events.ERROR,{type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},e}()},"./src/loader/level-details.ts":
/*!*************************************!*\
  !*** ./src/loader/level-details.ts ***!
  \*************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts");function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.availabilityDelay=void 0,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.initSegment=null,this.lastModified=void 0,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.tload=void 0,this.totalduration=0,this.type=null,this.updated=!0,this.advanced=!0,this.misses=0,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.isMildomLiveEnd=!1,this.fragments=[],this.url=e}var t,r,n;return e.prototype.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t,this.advanced=this.endSN>e.endSN||0<t||0==t&&0<r,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},t=e,(r=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(i.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"edge",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].end:null!==(e=this.fragments)&&void 0!==e&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.lastModified?Math.max(Date.now()-this.lastModified,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!==(e=this.partList)&&void 0!==e&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&a(t.prototype,r),n&&a(t,n),e}()},"./src/loader/level-key.ts":
/*!*********************************!*\
  !*** ./src/loader/level-key.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var i=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function r(e,t){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=t?Object(i.buildAbsoluteURL)(e,t,{alwaysNormalize:!0}):e}var e,t,n;return r.fromURL=function(e,t){return new r(e,t)},r.fromURI=function(e){return new r(e)},e=r,(t=[{key:"uri",get:function(){return this._uri}}])&&a(e.prototype,t),n&&a(e,n),r}()},"./src/loader/load-stats.ts":
/*!**********************************!*\
  !*** ./src/loader/load-stats.ts ***!
  \**********************************/
/*! exports provided: default, reset */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n}),r.d(t,"reset",function(){return i});var n=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}};function i(e){e.loading={start:0,first:0,end:0},e.parsing={start:0,end:0},e.buffering={start:0,first:0,end:0},e.loaded=0,e.aborted=!1,e.retry=0,e.chunkCount=0}},"./src/loader/m3u8-parser.ts":
/*!***********************************!*\
  !*** ./src/loader/m3u8-parser.ts ***!
  \***********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return i});var B=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),n=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),G=r(/*! ./fragment */"./src/loader/fragment.ts"),j=r(/*! ./level-details */"./src/loader/level-details.ts"),H=r(/*! ./level-key */"./src/loader/level-key.ts"),q=r(/*! ../utils/attr-list */"./src/utils/attr-list.ts"),V=r(/*! ../utils/logger */"./src/utils/logger.ts"),d=r(/*! ../utils/codecs */"./src/utils/codecs.ts"),h=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+/g,l=/#EXT-X-MEDIA:(.*)/g,K=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),W=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/#EXT-X-(PREFETCH-DIS)CONTINUITY/.source,/#EXT-X-(PREFETCH):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Y=/\.(mp4|m4s|m4v|m4a)$/i,i=function(){function u(){}return u.findGroup=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.id===t)return n}},u.convertAVC1ToAVCOTI=function(e){var t,r=e.split(".");return 2<r.length?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t},u.resolve=function(e,t){return n.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(e,t){var r,n,i,a,s=[],o={},l=!1;for(h.lastIndex=0;null!=(a=h.exec(e));)a[1]?(n={attrs:r=new q.default(a[1]),bitrate:r.decimalInteger("AVERAGE-BANDWIDTH")||r.decimalInteger("BANDWIDTH"),name:r.NAME,url:u.resolve(a[2],t)},(i=r.decimalResolution("RESOLUTION"))&&(n.width=i.width,n.height=i.height),function(n,i){["video","audio","text"].forEach(function(t){var e,r=n.filter(function(e){return Object(d.isCodecType)(e,t)});r.length&&(e=r.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}),i[t+"Codec"]=(0<e.length?e:r)[0],n=n.filter(function(e){return-1===r.indexOf(e)}))}),i.unknownCodecs=n}([].concat((r.CODECS||"").split(/[ ,]+/)),n),n.videoCodec&&-1!==n.videoCodec.indexOf("avc1")&&(n.videoCodec=u.convertAVC1ToAVCOTI(n.videoCodec)),s.push(n)):!a[3]||(a=new q.default(a[3]))["DATA-ID"]&&(l=!0,o[a["DATA-ID"]]=a);return{levels:s,sessionData:l?o:null}},u.parseMasterPlaylistMedia=function(e,t,r,n){void 0===n&&(n=[]);var i=[],a=0;for(l.lastIndex=0;null!==(s=l.exec(e));){var s,o=new q.default(s[1]);o.TYPE===r&&(s={attrs:o,bitrate:0,id:a++,groupId:o["GROUP-ID"],instreamId:o["INSTREAM-ID"],name:o.NAME||o.LANGUAGE||"",type:r,default:o.bool("DEFAULT"),autoselect:o.bool("AUTOSELECT"),forced:o.bool("FORCED"),lang:o.LANGUAGE,url:o.URI?u.resolve(o.URI,t):""},n.length&&(c(s,o=u.findGroup(n,s.groupId)||n[0],"audioCodec"),c(s,o,"textCodec")),i.push(s))}return i},u.parseLevelPlaylist=function(e,t,r,n,i,a){var s=new j.default(t);s.isMildomLiveEnd=!1;var o,l,u,d=s.fragments,h=0,c=0,f=0,p=0,g=null,m=new G.default(n,t),v=-1;for(K.lastIndex=0,s.m3u8=e;null!==(o=K.exec(e));){var y=o[1];if(y){m.duration=parseFloat(y);var b=(" "+o[2]).slice(1);m.title=b||null,m.tagList.push(b?["INF",y,b]:["INF",y])}else if(o[3])Object(B.isFiniteNumber)(m.duration)&&(m.start=f,u&&(m.levelkey=u),m.sn=h,m.level=r,m.cc=p,m.urlId=i,d.push(m),m.relurl=(" "+o[3]).slice(1),z(m,g),f+=(g=m).duration,h++,c=0,(m=new G.default(n,t)).start=f,m.sn=h,m.cc=p,m.level=r);else if(o[4]){var E=(" "+o[4]).slice(1);g?m.setByteRange(E,g):m.setByteRange(E)}else if(o[5])m.rawProgramDateTime=(" "+o[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),-1===v&&(v=d.length);else if(o=o[0].match(W)){for(l=1;l<o.length&&void 0===o[l];l++);var T=(" "+o[l]).slice(1),S=(" "+o[l+1]).slice(1),_=o[l+2]?(" "+o[l+2]).slice(1):"",E=d.filter(function(e){return e&&!e.prefetch})||[],w=E.reduce(function(e,t){return t?t.duration+e:e},0)/E.length;switch(T){case"PLAYLIST-TYPE":s.type=S.toUpperCase();break;case"MEDIA-SEQUENCE":h=s.startSN=parseInt(S);break;case"SKIP":var L=new q.default(S),A=L.decimalInteger("SKIPPED-SEGMENTS");if(Object(B.isFiniteNumber)(A)){for(var R=s.skippedSegments=A;R--;)d.unshift(null);h+=A,f+=A*s.targetduration}var D=L.enumeratedString("RECENTLY-REMOVED-DATERANGES");D&&(s.recentlyRemovedDateranges=D.split("\t"));break;case"TARGETDURATION":s.targetduration=parseFloat(S);break;case"VERSION":s.version=parseInt(S);break;case"EXTM3U":break;case"ENDLIST":s.live=!1,s.isMildomLiveEnd=!0;break;case"#":(S||_)&&m.tagList.push(_?[S,_]:[S]);break;case"DIS":p++;case"GAP":m.tagList.push([T]);break;case"BITRATE":m.tagList.push([T,S]);break;case"DISCONTINUITY-SEQ":p=parseInt(S);break;case"PREFETCH":if(!a)break;m.prefetch=!0,m.duration=w||s.targetduration,m.title=null,m.start=f,m.levelkey=u,m.sn=h++,m.level=r,m.cc=p,m.urlId=i,m.relurl=S,z(m,g),s.fragments.push(m),f+=(g=m).duration,m=new G.default(n,t);break;case"PREFETCH-DIS":if(!a)break;p++,m.tagList.push(["PREFETCH-DIS"]);break;case"KEY":var k=new q.default(S),x=k.enumeratedString("METHOD"),A=k.URI,P=k.hexadecimalInteger("IV"),L=k.enumeratedString("KEYFORMATVERSIONS"),D=k.enumeratedString("KEYID"),k=null!=(k=k.enumeratedString("KEYFORMAT"))?k:"identity";if(-1<["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(k)){V.logger.warn("Keyformat "+k+" is not supported from the manifest");continue}if("identity"!==k)continue;x&&(u=H.default.fromURL(t,A),A&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(x)&&(u.method=x,u.keyFormat=k,D&&(u.keyID=D),L&&(u.keyFormatVersions=L),u.iv=P));break;case"START":P=new q.default(S).decimalFloatingPoint("TIME-OFFSET");Object(B.isFiniteNumber)(P)&&(s.startTimeOffset=P);break;case"MAP":var O=new q.default(S);m.relurl=O.URI,O.BYTERANGE&&m.setByteRange(O.BYTERANGE),m.level=r,m.sn="initSegment",u&&(m.levelkey=u),s.initSegment=m,(m=new G.default(n,t)).rawProgramDateTime=s.initSegment.rawProgramDateTime;break;case"SERVER-CONTROL":var I=new q.default(S);s.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),s.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),s.canSkipDateRanges=0<s.canSkipUntil&&I.bool("CAN-SKIP-DATERANGES"),s.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),s.holdBack=I.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var C=new q.default(S);s.partTarget=C.decimalFloatingPoint("PART-TARGET");break;case"PART":O=(O=s.partList)||(s.partList=[]),I=0<c?O[O.length-1]:void 0,C=c++,I=new G.Part(new q.default(S),m,t,C,I);O.push(I),m.duration+=I.duration;break;case"PRELOAD-HINT":var F=new q.default(S);s.preloadHint=F;break;case"RENDITION-REPORT":F=new q.default(S);s.renditionReports=s.renditionReports||[],s.renditionReports.push(F);break;default:V.logger.warn("line parsed but not handled: "+o)}}else V.logger.warn("No matches on slow regex match for level playlist!")}g&&!g.relurl?(d.pop(),f-=g.duration,s.fragmentHint=g):s.fragmentHint=m;var M=d.length,N=d[0],U=d[M-1];return 0<f&&M&&U?(s.averagetargetduration=f/M,M=U.sn,s.endSN="initSegment"!==M?M:0,N&&(s.startCC=N.cc,s.initSegment||s.fragments.every(function(e){return Y.test(e.relurl)})&&(V.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(m=new G.default(n,t)).relurl=U.relurl,m.level=r,m.sn="initSegment",s.initSegment=m,s.needSidxRanges=!0))):(s.endSN=0,s.startCC=0),s.partList&&(f+=s.fragmentHint.duration),s.totalduration=f,s.endCC=p,0<v&&function(e){for(var t=e[v],r=v;r--;){var n=e[r];if(!n)return;n.programDateTime=t.programDateTime-1e3*n.duration,t=n}}(d),s},u}();function c(e,t,r){t=t[r];t&&(e[r]=t)}function z(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(B.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":
/*!***************************************!*\
  !*** ./src/loader/playlist-loader.ts ***!
  \***************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var p=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),g=r(/*! ../events */"./src/events.ts"),m=r(/*! ../errors */"./src/errors.ts"),h=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),v=r(/*! ./m3u8-parser */"./src/loader/m3u8-parser.ts"),y=r(/*! ../types/loader */"./src/types/loader.ts"),b=r(/*! ../utils/attr-list */"./src/utils/attr-list.ts"),E=self.performance;function T(e,t){e=e.url;return void 0!==e&&0!==e.indexOf("data:")||(e=t.url),e}r=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.checkAgeHeader=!0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,n=t.loader,t=new(r||n)(t);return e.loader=t,this.loaders[e.type]=t},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){t=t.url;this.checkAgeHeader=!0,this.load({id:null,level:0,responseType:"text",type:y.PlaylistContextType.MANIFEST,url:t,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var r=t.id,n=t.level,i=t.url,t=t.deliveryDirectives;this.load({id:r,level:n,responseType:"text",type:y.PlaylistContextType.LEVEL,url:i,deliveryDirectives:t})},t.onAudioTrackLoading=function(e,t){var r=t.id,n=t.url,t=t.deliveryDirectives;this.load({id:r,level:null,responseType:"text",type:y.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:t})},t.onSubtitleTrackLoading=function(e,t){var r=t.id,n=t.url,t=t.deliveryDirectives;this.load({id:r,level:null,responseType:"text",type:y.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:t})},t.load=function(e){var t=this.hls.config;h.logger.debug("[playlist-loader]: Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var r,n,i,a,s,o=this.getInternalLoader(e);if(o){var l=o.context;if(l&&l.url===e.url)return void h.logger.trace("[playlist-loader]: playlist request ongoing");h.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),o.abort()}switch(e.type){case y.PlaylistContextType.MANIFEST:r=t.manifestLoadingMaxRetry,n=t.manifestLoadingTimeOut,i=t.manifestLoadingRetryDelay,a=t.manifestLoadingMaxRetryTimeout;break;case y.PlaylistContextType.LEVEL:case y.PlaylistContextType.AUDIO_TRACK:r=0,n=t.levelLoadingTimeOut;break;default:r=t.levelLoadingMaxRetry,n=t.levelLoadingTimeOut,i=t.levelLoadingRetryDelay,a=t.levelLoadingMaxRetryTimeout}o=this.createInternalLoader(e),null!==(l=e.deliveryDirectives)&&void 0!==l&&l.part&&(e.type===y.PlaylistContextType.LEVEL&&null!==e.level?s=this.hls.levels[e.level].details:e.type===y.PlaylistContextType.AUDIO_TRACK&&null!==e.id?s=this.hls.audioTracks[e.id].details:e.type===y.PlaylistContextType.SUBTITLE_TRACK&&null!==e.id&&(s=this.hls.subtitleTracks[e.id].details),s&&(u=s.partTarget,d=s.targetduration,u&&d&&(n=Math.min(1e3*Math.max(3*u,.8*d),n))));var u={timeout:n,maxRetry:r,retryDelay:i,maxRetryDelay:a,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};h.logger.debug("[playlist-loader]: Calling internal loader delegate for URL: "+e.url),o.load(e,u,d)},t.loadsuccess=function(e,t,r,n){if(void 0===n&&(n=null),r.isSidxRequest)return this._handleSidxRequest(e,r),void this._handlePlaylistLoaded(e,t,r,n);this.resetInternalLoader(r.type);var i=e.data;0===i.indexOf("#EXTM3U")?(t.parsing.start=E.now(),0<i.indexOf("#EXTINF:")||0<i.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(e,t,r,n):this._handleMasterPlaylist(e,t,r,n)):this._handleManifestParsingError(e,r,"no EXTM3U delimiter",n)},t.loaderror=function(e,t,r){void 0===r&&(r=null),this._handleNetworkError(t,r,!1,e)},t.loadtimeout=function(e,t,r){void 0===r&&(r=null),this._handleNetworkError(t,r,!0)},t._handleMasterPlaylist=function(e,t,r,n){var i,a=this.hls,s=e.data,o=T(e,r),l=v.default.parseMasterPlaylist(s,o),u=l.levels,d=l.sessionData;u.length?(i=u.map(function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}}),l=u.map(function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}}),i=v.default.parseMasterPlaylistMedia(s,o,"AUDIO",i),l=v.default.parseMasterPlaylistMedia(s,o,"SUBTITLES",l),s=v.default.parseMasterPlaylistMedia(s,o,"CLOSED-CAPTIONS"),i.length&&(i.some(function(e){return!e.url})||!u[0].audioCodec||u[0].attrs.AUDIO||(h.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),i.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new b.default({}),bitrate:0,url:""}))),a.trigger(g.Events.MANIFEST_LOADED,{levels:u,audioTracks:i,subtitles:l,captions:s,url:o,stats:t,networkDetails:n,sessionData:d})):this._handleManifestParsingError(e,r,"no level found in manifest",n)},t._handleTrackOrLevelPlaylist=function(e,t,r,n){var i,a,s,o,l=this.hls,u=l.config,d=r.id,h=r.level,c=r.type,f=r.loader;f&&(i=T(e,r),s=Object(p.isFiniteNumber)(d)?d:0,a=Object(p.isFiniteNumber)(h)?h:s,f=function(e){switch(e.type){case y.PlaylistContextType.AUDIO_TRACK:return y.PlaylistLevelType.AUDIO;case y.PlaylistContextType.SUBTITLE_TRACK:return y.PlaylistLevelType.SUBTITLE;default:return y.PlaylistLevelType.MAIN}}(r),(s=v.default.parseLevelPlaylist(e.data,i,a,f,s,u.progressive&&u.lowLatencyMode)).tload=t.loading.end,u=self.performance.timing.navigationStart+s.tload,this.checkAgeHeader=!1,s.lastModified=+u,s.fragments.length?(c===y.PlaylistContextType.MANIFEST&&(o={attrs:new b.default({}),bitrate:0,details:s,name:"",url:i},l.trigger(g.Events.MANIFEST_LOADED,{levels:[o],audioTracks:[],url:i,stats:t,networkDetails:n,sessionData:null})),t.parsing.end=E.now(),s.needSidxRanges?(o=s.initSegment.url,this.load({url:o,isSidxRequest:!0,type:c,level:h,levelDetails:s,id:d,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})):(r.levelDetails=s,this._handlePlaylistLoaded(e,t,r,n))):l.trigger(g.Events.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:i,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0}))},t._handleSidxRequest=function(e,t){var r,n=Object(i.parseSegmentIndex)(new Uint8Array(e.data));n&&(e=n.references,r=t.levelDetails,e.forEach(function(e,t){e=e.info,t=r.fragments[t];0===t.byteRange.length&&t.setByteRange(String(1+e.end-e.start)+"@"+String(e.start))}),r.initSegment.setByteRange(String(n.moovEndOffset)+"@0"))},t._handleManifestParsingError=function(e,t,r,n){this.hls.trigger(g.Events.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===y.PlaylistContextType.MANIFEST,url:e.url,reason:r,response:e,context:t,networkDetails:n})},t._handleNetworkError=function(e,t,r,n){var i,a;void 0===r&&(r=!1),h.logger.info("[playlist-loader]: A network error occurred while loading a "+e.type+"-type playlist");var s=this.getInternalLoader(e);switch(e.type){case y.PlaylistContextType.MANIFEST:i=r?m.ErrorDetails.MANIFEST_LOAD_TIMEOUT:m.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case y.PlaylistContextType.LEVEL:i=r?m.ErrorDetails.LEVEL_LOAD_TIMEOUT:m.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case y.PlaylistContextType.AUDIO_TRACK:i=r?m.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:m.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}s&&this.resetInternalLoader(e.type);t={type:m.ErrorTypes.NETWORK_ERROR,details:i,fatal:a,url:e.url,loader:s,context:e,networkDetails:t};n&&(t.response=n),this.hls.trigger(g.Events.ERROR,t)},t._handlePlaylistLoaded=function(e,t,r,n){var i=r.type,a=r.level,s=r.id,o=r.levelDetails,l=r.deliveryDirectives;if(null!=o&&o.targetduration)switch(i){case y.PlaylistContextType.MANIFEST:case y.PlaylistContextType.LEVEL:this.hls.trigger(g.Events.LEVEL_LOADED,{details:o,level:a||0,id:s||0,stats:t,networkDetails:n,deliveryDirectives:l});break;case y.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(g.Events.AUDIO_TRACK_LOADED,{details:o,id:s||0,stats:t,networkDetails:n,deliveryDirectives:l});break;case y.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(g.Events.SUBTITLE_TRACK_LOADED,{details:o,id:s||0,stats:t,networkDetails:n,deliveryDirectives:l})}else this._handleManifestParsingError(e,r,"invalid target duration",n)},e}();t.default=r},"./src/polyfills/number.ts":
/*!*********************************!*\
  !*** ./src/polyfills/number.ts ***!
  \*********************************/
/*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */function(e,t,r){"use strict";r.r(t),r.d(t,"isFiniteNumber",function(){return n}),r.d(t,"MAX_SAFE_INTEGER",function(){return i});var n=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":
/*!*********************************!*\
  !*** ./src/remux/aac-helper.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);r=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}();t.default=r},"./src/remux/mp4-generator.ts":
/*!************************************!*\
  !*** ./src/remux/mp4-generator.ts ***!
  \************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var a=Math.pow(2,32)-1,r=function(){function h(){}return h.init=function(){for(var e in h.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})h.types.hasOwnProperty(e)&&(h.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);h.HDLR_TYPES={video:t,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);h.STTS=h.STSC=h.STCO=i,h.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),h.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),h.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),h.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);t=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);h.FTYP=h.box(h.types.ftyp,t,i,t,r),h.DINF=h.box(h.types.dinf,h.box(h.types.dref,n))},h.box=function(e){for(var t=8,r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=n.length,s=a;a--;)t+=n[a].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),a=0,t=8;a<s;a++)o.set(n[a],t),t+=n[a].byteLength;return o},h.hdlr=function(e){return h.box(h.types.hdlr,h.HDLR_TYPES[e])},h.mdat=function(e){return h.box(h.types.mdat,e)},h.mdhd=function(e,t){t*=e;var r=Math.floor(t/(1+a)),t=Math.floor(t%(1+a));return h.box(h.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t,85,196,0,0]))},h.mdia=function(e){return h.box(h.types.mdia,h.mdhd(e.timescale,e.duration),h.hdlr(e.type),h.minf(e))},h.mfhd=function(e){return h.box(h.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},h.minf=function(e){return"audio"===e.type?h.box(h.types.minf,h.box(h.types.smhd,h.SMHD),h.DINF,h.stbl(e)):h.box(h.types.minf,h.box(h.types.vmhd,h.VMHD),h.DINF,h.stbl(e))},h.moof=function(e,t,r){return h.box(h.types.moof,h.mfhd(e),h.traf(r,t))},h.moov=function(e){for(var t=e.length,r=[];t--;)r[t]=h.trak(e[t]);return h.box.apply(null,[h.types.moov,h.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(h.mvex(e)))},h.mvex=function(e){for(var t=e.length,r=[];t--;)r[t]=h.trex(e[t]);return h.box.apply(null,[h.types.mvex].concat(r))},h.mvhd=function(e,t){t*=e;var r=Math.floor(t/(1+a)),t=Math.floor(t%(1+a)),t=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return h.box(h.types.mvhd,t)},h.sdtp=function(e){for(var t,r=e.samples||[],n=new Uint8Array(4+r.length),i=0;i<r.length;i++)t=r[i].flags,n[i+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return h.box(h.types.sdtp,n)},h.stbl=function(e){return h.box(h.types.stbl,h.stsd(e),h.box(h.types.stts,h.STTS),h.box(h.types.stsc,h.STSC),h.box(h.types.stsz,h.STSZ),h.box(h.types.stco,h.STCO))},h.avc1=function(e){for(var t,r,n=[],i=[],a=0;a<e.sps.length;a++)r=(t=e.sps[a]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(t));for(a=0;a<e.pps.length;a++)r=(t=e.pps[a]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(t));var s=h.box(h.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(i))),o=e.width,l=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return h.box(h.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,h.box(h.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),h.box(h.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},h.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},h.mp4a=function(e){var t=e.samplerate;return h.box(h.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]),h.box(h.types.esds,h.esds(e)))},h.mp3=function(e){var t=e.samplerate;return h.box(h.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0]))},h.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?h.box(h.types.stsd,h.STSD,h.mp4a(e)):h.box(h.types.stsd,h.STSD,h.mp3(e)):h.box(h.types.stsd,h.STSD,h.avc1(e))},h.tkhd=function(e){var t=e.id,r=e.duration*e.timescale,n=e.width,i=e.height,e=Math.floor(r/(1+a)),r=Math.floor(r%(1+a));return h.box(h.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))},h.traf=function(e,t){var r=h.sdtp(e),n=e.id,i=Math.floor(t/(1+a)),t=Math.floor(t%(1+a));return h.box(h.types.traf,h.box(h.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),h.box(h.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,t>>24,t>>16&255,t>>8&255,255&t])),h.trun(e,r.length+16+20+8+16+8+8),r)},h.trak=function(e){return e.duration=e.duration||4294967295,h.box(h.types.trak,h.tkhd(e),h.mdia(e))},h.trex=function(e){e=e.id;return h.box(h.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},h.trun=function(e,t){var r,n,i,a,s,o=e.samples||[],l=o.length,e=12+16*l,u=new Uint8Array(e);for(t+=8+e,u.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),r=0;r<l;r++)n=(s=o[r]).duration,i=s.size,a=s.flags,s=s.cts,u.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,s>>>24&255,s>>>16&255,s>>>8&255,255&s],12+16*r);return h.box(h.types.trun,u)},h.initSegment=function(e){h.types||h.init();var t=h.moov(e),e=new Uint8Array(h.FTYP.byteLength+t.byteLength);return e.set(h.FTYP),e.set(t,h.FTYP.byteLength),e},h}();r.types=void 0,r.HDLR_TYPES=void 0,r.STTS=void 0,r.STSC=void 0,r.STCO=void 0,r.STSZ=void 0,r.VMHD=void 0,r.SMHD=void 0,r.STSD=void 0,r.FTYP=void 0,r.DINF=void 0,t.default=r},"./src/remux/mp4-remuxer.ts":
/*!**********************************!*\
  !*** ./src/remux/mp4-remuxer.ts ***!
  \**********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var c=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),G=r(/*! ./aac-helper */"./src/remux/aac-helper.ts"),Y=r(/*! ./mp4-generator */"./src/remux/mp4-generator.ts"),z=r(/*! ../events */"./src/events.ts"),X=r(/*! ../errors */"./src/errors.ts"),Q=r(/*! ../utils/logger */"./src/utils/logger.ts"),Z=r(/*! ../utils/timescale-conversion */"./src/utils/timescale-conversion.ts");function $(){return($=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var J=null;var n=function(){function e(e,t,r,n){void 0===n&&(n=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===J&&(r=(navigator.userAgent||"").match(/Chrome\/(\d+)/i),J=r?parseInt(r[1]):0)}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){Q.logger.log("[mp4-remuxer]: initPTS & initDTS reset reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){Q.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){Q.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var n=!1,e=e.reduce(function(e,t){var r=t.pts-e;return r<-4294967296?(n=!0,ee(e,t.pts)):0<r?e:t.pts},e[0].pts);return n&&Q.logger.debug("PTS rollover detected"),e},t.remux=function(e,t,r,n,i,a){var s,o,l,u,d=this.isVideoContiguous;!d&&this.config.forceKeyFrameOnDiscontinuity&&(c=t.samples.length,(h=function(e){for(var t=e.samples,r=0,n=0;n<t.length;n++){if(t[n].key)break;r++}r&&(e.samples=t.slice(r),e.dropped+=r);return r}(t))&&Q.logger.warn("[mp4-remuxer]: Dropped "+h+" out of "+c+" video samples due to a missing keyframe"));var h,c,f,p=-1<t.pid,g=0<e.samples.length,m=1<t.samples.length;return(!p||m||this.ISGenerated)&&(this.ISGenerated||(o=this.generateIS(e,t,i)),this.ISGenerated&&(c=h=i,g&&m&&(p=this.getVideoStartPts(t.samples),p=(ee(e.samples[0].pts,p)-p)/t.inputTimeScale,h+=Math.max(0,p),c+=Math.max(0,-p)),g?(e.samplerate||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),delete(o=this.generateIS(e,t,i)).video),s=this.remuxAudio(e,h,this.isAudioContiguous,a,c),m&&(f=s?s.endPTS-s.startPTS:0,t.inputTimeScale||(Q.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),o=this.generateIS(e,t,i)),f=this.remuxVideo(t,c,d,f))):m&&(f=this.remuxVideo(t,c,d,0)))),this.ISGenerated&&(r.samples.length&&(u=this.remuxID3(r,i)),n.samples.length&&(l=this.remuxText(n,i))),{audio:s,video:f,initSegment:o,text:l,id3:u}},t.generateIS=function(e,t,r){Q.logger.log("[mp4-remuxer]: generateIS",$({},e),$({},t),r);var n,i,a,s=e.samples,o=t.samples,l=this.typeSupported,u={},d=!Object(c.isFiniteNumber)(this._initPTS),h="audio/mp4";if(d&&(a=i=1/0),e.config&&s.length&&(e.timescale=e.samplerate,Q.logger.log("[mp4-remuxer]: audio sampling rate : "+e.samplerate),e.isAAC||(l.mpeg?(h="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3")),u.audio={id:"audio",container:h,codec:e.codec,initSegment:!e.isAAC&&l.mpeg?new Uint8Array(0):Y.default.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(n=e.inputTimeScale,a=i=s[0].pts-Math.round(n*r))),t.sps&&t.pps&&o.length&&(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Y.default.initSegment([t]),metadata:{width:t.width,height:t.height}},d&&(n=t.inputTimeScale,t=this.getVideoStartPts(o),r=Math.round(n*r),i=Math.min(i,ee(o[0].dts,t)-r),a=Math.min(a,t-r))),Object.keys(u).length)return this.ISGenerated=!0,d&&(this._initPTS=a,this._initDTS=i),{tracks:u,initPTS:a,timescale:n}},t.remuxVideo=function(e,t,r,n){var i,a,s=e.inputTimeScale,o=e.samples,l=[],u=o.length,d=this._initPTS,h=this.nextAvcDts,c=8,f=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=0,m=!1;r&&null!==h||(h=t*s-(o[0].pts-ee(o[0].dts,o[0].pts)));for(var v=0;v<u;v++){var y=o[v];y.pts=ee(y.pts-d,h),y.dts=ee(y.dts-d,h),y.dts>y.pts&&(g=Math.max(Math.min(g,y.pts-y.dts),-18e3)),y.dts<o[0<v?v-1:v].dts&&(m=!0)}m&&o.sort(function(e,t){var r=e.dts-t.dts,t=e.pts-t.pts;return r||t}),a=o[0].dts,t=o[o.length-1].dts;var b=Math.round((t-a)/(u-1));if(g<0){if(g<-2*b){Q.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(Z.toMsFromMpegTsClock)(-b,!0)+" ms");for(var E=g,T=0;T<u;T++)o[T].dts=E=Math.max(E,o[T].pts-b),o[T].pts=Math.max(E,o[T].pts)}else{Q.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(Z.toMsFromMpegTsClock)(g,!0)+" ms to overcome this issue");for(var S=0;S<u;S++)o[S].dts=o[S].dts+g}a=o[0].dts,t=o[u-1].dts}!r||((r=b<(F=a-h))||F<-1)&&(r?Q.logger.warn("AVC: "+Object(Z.toMsFromMpegTsClock)(F,!0)+" ms ("+F+"dts) hole between fragments detected, filling it"):Q.logger.warn("AVC: "+Object(Z.toMsFromMpegTsClock)(-F,!0)+" ms ("+F+"dts) overlapping between fragments detected"),a=h,r=o[0].pts-F,o[0].dts=a,o[0].pts=r,Q.logger.log("Video: First PTS/DTS adjusted: "+Object(Z.toMsFromMpegTsClock)(r,!0)+"/"+Object(Z.toMsFromMpegTsClock)(a,!0)+", delta: "+Object(Z.toMsFromMpegTsClock)(F,!0)+" ms")),J&&J<75&&(a=Math.max(0,a));for(var _=0,w=0,L=0;L<u;L++){for(var A=o[L],R=A.units,D=R.length,k=0,x=0;x<D;x++)k+=R[x].data.length;w+=k,_+=D,A.length=k,A.dts=Math.max(A.dts,a),A.pts=Math.max(A.pts,A.dts,0),f=Math.min(A.pts,f),p=Math.max(A.pts,p)}t=o[u-1].dts;var P,O=w+4*_+8;try{P=new Uint8Array(O)}catch(e){return void this.observer.emit(z.Events.ERROR,z.Events.ERROR,{type:X.ErrorTypes.MUX_ERROR,details:X.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:O,reason:"fail allocating video mdat "+O})}var I=new DataView(P.buffer);I.setUint32(0,O),P.set(Y.default.types.mdat,4);for(var C,F,M=0;M<u;M++){for(var N,U,B=o[M],G=B.units,j=0,H=0,q=G.length;H<q;H++){var V=G[H],K=V.data,V=V.data.byteLength;I.setUint32(c,V),c+=4,P.set(K,c),c+=V,j+=4+V}M<u-1?(i=o[M+1].dts-B.dts,N=C=void 0,C=-1<navigator.userAgent.toLowerCase().indexOf("chrome"),N=-1<navigator.userAgent.toLowerCase().indexOf("safari"),!C&&N&&(i=b)):(N=this.config,W=B.dts-o[0<M?M-1:M].dts,N.stretchShortVideoTrack&&null!==this.nextAudioPts&&Math.floor(N.maxBufferHole*s)<(U=(n?f+n*s:this.nextAudioPts)-B.pts)?((i=U-W)<0&&(i=W),Q.logger.log("[mp4-remuxer]: It is approximately "+U/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=W);var W=Math.round(B.pts-B.dts);l.push(new te(B.key,i,j,W))}l.length&&J&&J<70&&((F=l[0].flags).dependsOn=2,F.isNonSync=0),console.assert(void 0!==i,"mp4SampleDuration must be computed"),this.nextAvcDts=h=t+i,this.isVideoContiguous=!0;t={data1:Y.default.moof(e.sequenceNumber++,a,$({},e,{samples:l})),data2:P,startPTS:f/s,endPTS:(p+i)/s,startDTS:a/s,endDTS:h/s,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,console.assert(P.length,"MDAT length must not be zero"),t},t.remuxAudio=function(e,t,r,n,i){var a=e.inputTimeScale,s=e.samplerate||a,o=a/s,l=e.isAAC?1024:1152,u=l*o,d=this._initPTS,h=!e.isAAC&&this.typeSupported.mpeg,c=[],f=e.samples,p=h?0:8,g=this.nextAudioPts||-1;if(this.isAudioContiguous=r=r||f.length&&0<g&&(n&&Math.abs(t-g/a)<.1||Math.abs(f[0].pts-g-d)<20*u),f.forEach(function(e){e.pts=e.dts=ee(e.pts-d,t*a)}),(f=f.filter(function(e){return 0<=e.pts})).length){if((!r||g<0)&&(g=0===i?0:n?Math.max(0,t*a):f[0].pts),e.isAAC)for(var m=this.config.maxAudioFramesDrift,v=0,y=g;v<f.length;){var b=f[v],E=b.pts,T=E-y,S=Math.abs(1e3*T/a);if(T<=-m*u)r||0<v?(Q.logger.warn("[mp4-remuxer]: Dropping 1 audio frame @ "+(y/a).toFixed(3)+"s due to "+Math.round(S)+" ms overlap."),f.splice(v,1)):(Q.logger.warn("Audio frame @ "+(E/a).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*T/a)+" ms."),y=E+u,v++);else if(m*u<=T&&S<1e4){var _=Math.floor(T/u),y=E-_*u;Q.logger.warn("[mp4-remuxer]: Injecting "+_+" audio frame @ "+(y/a).toFixed(3)+"s due to "+Math.round(1e3*T/a)+" ms gap.");for(var w=0;w<_;w++){var L,A=Math.max(y,0);(L=G.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(Q.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),L=b.unit.subarray()),f.splice(v,0,{unit:L,pts:A,dts:A}),y+=u,v++}b.pts=b.dts=y,y+=u,v++}else b.pts=b.dts=y,y+=u,v++}for(var R,D=null,k=null,x=0,P=f.length;P--;)x+=f[P].unit.byteLength;for(var O=0,I=f.length;O<I;O++){var C=f[O],F=C.unit,C=C.pts;if(null!==k)c[O-1].duration=Math.round((C-k)/o);else{var M=Math.round(1e3*(C-g)/a),N=0;if(r&&e.isAAC){if(0<M&&M<1e4)N=Math.round((C-g)/u),Q.logger.log("[mp4-remuxer]: "+M+" ms hole between AAC samples detected,filling it"),0<N&&(x+=N*(L=(L=G.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||F.subarray()).length);else if(M<-12){Q.logger.log("[mp4-remuxer]: drop overlapping AAC sample, expected/parsed/delta:"+(g/a).toFixed(3)+"s/"+(C/a).toFixed(3)+"s/"+-M+"ms"),x-=F.byteLength;continue}C=g}if(D=C,!(0<x))return;x+=p;try{R=new Uint8Array(x)}catch(e){return void this.observer.emit(z.Events.ERROR,z.Events.ERROR,{type:X.ErrorTypes.MUX_ERROR,details:X.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:x,reason:"fail allocating audio mdat "+x})}h||(new DataView(R.buffer).setUint32(0,x),R.set(Y.default.types.mdat,4));for(var U=0;U<N;U++)(L=G.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(Q.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating the current frame instead"),L=F.subarray()),R.set(L,p),p+=L.byteLength,c.push(new te(!0,1024,L.byteLength,0))}R.set(F,p);M=F.byteLength;p+=M,c.push(new te(!0,l,M,0)),k=C}var B=c.length;if(B){s=c[c.length-1];this.nextAudioPts=g=k+o*s.duration;i=h?new Uint8Array(0):Y.default.moof(e.sequenceNumber++,D/o,$({},e,{samples:c}));e.samples=[];n=D/a,s=g/a,B={data1:i,data2:R,startPTS:n,endPTS:s,startDTS:n,endDTS:s,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return console.assert(R.length,"MDAT length must not be zero"),B}}},t.remuxEmptyAudio=function(e,t,r,n){var i=e.inputTimeScale,a=i/(e.samplerate||i),s=this.nextAudioPts,o=(null!==s?s:n.startDTS*i)+this._initDTS,i=n.endDTS*i+this._initDTS,l=1024*a,u=Math.ceil((i-o)/l),d=G.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(Q.logger.warn("[mp4-remuxer]: remux empty Audio"),d){for(var h=[],c=0;c<u;c++){var f=o+c*l;h.push({unit:d,pts:f,dts:f})}return e.samples=h,this.remuxAudio(e,t,r,!1)}Q.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},t.remuxID3=function(e,t){var r=e.samples.length;if(r){for(var n=e.inputTimeScale,i=this._initPTS,a=this._initDTS,s=0;s<r;s++){var o=e.samples[s];o.pts=ee(o.pts-i,t*n)/n,o.dts=ee(o.dts-a,t*n)/n}var l=e.samples;return e.samples=[],{samples:l}}},t.remuxText=function(e,t){var r=e.samples.length;if(r){for(var n=e.inputTimeScale,i=this._initPTS,a=0;a<r;a++){var s=e.samples[a];s.pts=ee(s.pts-i,t*n)/n}e.samples.sort(function(e,t){return e.pts-t.pts});var o=e.samples;return e.samples=[],{samples:o}}},e}();function ee(e,t){var r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=r;return e}var te=function(e,t,r,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=n,this.flags=new i(e)},i=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1}},"./src/remux/passthrough-remuxer.ts":
/*!******************************************!*\
  !*** ./src/remux/passthrough-remuxer.ts ***!
  \******************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var h=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),c=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),f=r(/*! ../utils/logger */"./src/utils/logger.ts"),r=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndDTS=null},t.resetNextTimestamp=function(){this.lastEndDTS=null},t.resetInitSegment=function(e,t,r){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(!e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var n=this.initData=Object(c.parseInitSegment)(e),t=t||"mp4a.40.5",r=r||"avc1.42e01e",i={};n.audio&&n.video?i.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:n.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?i.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:f.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},t.remux=function(e,t,r,n,i){var a=this.initPTS,s=this.lastEndDTS,o={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};Object(h.isFiniteNumber)(s)||(s=this.lastEndDTS=i||0);var l=t.samples;if(!l||!l.length)return o;var u={initPTS:void 0,timescale:1},d=this.initData;if(d&&d.length||(this.generateInitSegment(l),d=this.initData),!d||!d.length)return f.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),o;this.emitInitSegment&&(u.tracks=this.initTracks,this.emitInitSegment=!1),Object(h.isFiniteNumber)(a)||(this.initPTS=u.initPTS=a=p(d,l,i));t=Object(c.getDuration)(l,d);console.assert(0<t,"Duration parsed from mp4 should be greater than zero");i=s,s=t+i;Object(c.offsetStartDTS)(d,l,a),this.lastEndDTS=s;t=!!d.audio,a=!!d.video,d="";t&&(d+="audio"),a&&(d+="video");a={data1:l,startPTS:i,startDTS:i,endPTS:s,endDTS:s,type:d,hasAudio:t,hasVideo:a,nb:1,dropped:0};return o.audio="audio"===a.type?a:void 0,o.video="audio"!==a.type?a:void 0,o.text=n,o.id3=r,o.initSegment=u,o},e}(),p=function(e,t,r){return Object(c.getStartDTS)(e,t)-r};t.default=r},"./src/task-loop.ts":
/*!**************************!*\
  !*** ./src/task-loop.ts ***!
  \**************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return n});var n=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),!(this._tickInterval=null))},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),!(this._tickTimer=null))},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},t.doTick=function(){},e}()},"./src/types/level.ts":
/*!****************************!*\
  !*** ./src/types/level.ts ***!
  \****************************/
/*! exports provided: HlsSkip, getSkipValue, HlsUrlParameters, Level */function(e,t,r){"use strict";function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a;function n(e,t){var r=e.canSkipUntil,n=e.canSkipDateRanges,e=e.endSN;return r&&t-e<r?n?a.v2:a.Yes:a.No}r.r(t),r.d(t,"HlsSkip",function(){return a}),r.d(t,"getSkipValue",function(){return n}),r.d(t,"HlsUrlParameters",function(){return s}),r.d(t,"Level",function(){return o}),(t=a=a||{}).No="",t.Yes="YES",t.v2="v2";var s=function(){function e(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}return e.prototype.addDirectives=function(e){var t=new self.URL(e),e=t.searchParams;return e.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.set("_HLS_part",this.part.toString()),this.skip&&e.set("_HLS_skip",this.skip),e.sort(),t.search=e.toString(),t.toString()},e}(),o=function(){function e(e){this.attrs=void 0,this.audioCodec=void 0,this.audioGroupIds=void 0,this.bitrate=void 0,this.details=void 0,this.fragmentError=!1,this.height=void 0,this.id=void 0,this.loadError=0,this.loaded=void 0,this.name=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this.urlId=0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.url=[e.url],this.attrs=e.attrs,this.bitrate=e.bitrate,this.details=e.details,this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs}var t,r,n;return t=e,(r=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this.urlId]||""}}])&&i(t.prototype,r),n&&i(t,n),e}()},"./src/types/loader.ts":
/*!*****************************!*\
  !*** ./src/types/loader.ts ***!
  \*****************************/
/*! exports provided: PlaylistContextType, PlaylistLevelType */function(e,t,r){"use strict";var n,i;r.r(t),r.d(t,"PlaylistContextType",function(){return n}),r.d(t,"PlaylistLevelType",function(){return i}),(t=n=n||{}).MANIFEST="manifest",t.LEVEL="level",t.AUDIO_TRACK="audioTrack",t.SUBTITLE_TRACK="subtitleTrack",(t=i=i||{}).MAIN="main",t.AUDIO="audio",t.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":
/*!*********************************!*\
  !*** ./src/types/transmuxer.ts ***!
  \*********************************/
/*! exports provided: ChunkMetadata */function(e,t,r){"use strict";r.r(t),r.d(t,"ChunkMetadata",function(){return n});var n=function(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=-1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.transmuxing=a(),this.buffering={audio:a(),video:a(),audiovideo:a()},this.level=e,this.sn=t,this.id=r,this.size=n,this.part=i};function a(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":
/*!********************************!*\
  !*** ./src/utils/attr-list.ts ***!
  \********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var n=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,r=function(){function r(e){for(var t in"string"==typeof e&&(e=r.parseAttrList(e)),e)e.hasOwnProperty(t)&&(this[t]=e[t])}var e=r.prototype;return e.decimalInteger=function(e){e=parseInt(this[e],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(e){if(this[e]){for(var t=(1&(t=(this[e]||"0x").slice(2)).length?"0":"")+t,r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null},e.hexadecimalIntegerAsNumber=function(e){e=parseInt(this[e],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.optionalFloat=function(e,t){e=this[e];return e?parseFloat(e):t},e.enumeratedString=function(e){return this[e]},e.bool=function(e){return"YES"===this[e]},e.decimalResolution=function(e){e=n.exec(this[e]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},r.parseAttrList=function(e){var t,r={};for(i.lastIndex=0;null!==(t=i.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1]]=n}return r},r}();t.default=r},"./src/utils/binary-search.ts":
/*!************************************!*\
  !*** ./src/utils/binary-search.ts ***!
  \************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default={search:function(e,t){for(var r,n,i=0,a=e.length-1;i<=a;){var s=t(n=e[r=(i+a)/2|0]);if(0<s)i=1+r;else{if(!(s<0))return n;a=r-1}}return null}}},"./src/utils/buffer-helper.ts":
/*!************************************!*\
  !*** ./src/utils/buffer-helper.ts ***!
  \************************************/
/*! exports provided: BufferHelper */function(e,t,r){"use strict";r.r(t),r.d(t,"BufferHelper",function(){return a});var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i={length:0,start:function(){return 0},end:function(){return 0}},a=function(){function s(){}return s.isBuffered=function(e,t){try{if(e)for(var r=s.getBuffered(e),n=0;n<r.length;n++)if(t>=r.start(n)&&t<=r.end(n))return!0}catch(e){}return!1},s.bufferInfo=function(e,t,r){try{if(e){for(var n=s.getBuffered(e),i=[],a=0;a<n.length;a++)i.push({start:n.start(a),end:n.end(a)});return this.bufferedInfo(i,t,r)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},s.bufferedInfo=function(e,t,r){e.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end});var n=[];if(r)for(var i=0;i<e.length;i++){var a,s=n.length;s?(a=n[s-1].end,e[i].start-a<r?e[i].end>a&&(n[s-1].end=e[i].end):n.push(e[i])):n.push(e[i])}else n=e;for(var o,l=0,u=t,d=t,h=0;h<n.length;h++){var c=n[h].start,f=n[h].end;if(c<=t+r&&t<f)u=c,l=(d=f)-t;else if(t+r<c){o=c;break}}return{len:l,start:u||0,end:d||0,nextStart:o}},s.getBuffered=function(e){try{return e.buffered}catch(e){return n.logger.log("failed to get media.buffered",e),i}},s}()},"./src/utils/codecs.ts":
/*!*****************************!*\
  !*** ./src/utils/codecs.ts ***!
  \*****************************/
/*! exports provided: isCodecType, isCodecSupportedInMp4 */function(e,t,r){"use strict";r.r(t),r.d(t,"isCodecType",function(){return i}),r.d(t,"isCodecSupportedInMp4",function(){return a});var n={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function i(e,t){t=n[t];return!!t&&!0===t[e.slice(0,4)]}function a(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}},"./src/utils/discontinuities.ts":
/*!**************************************!*\
  !*** ./src/utils/discontinuities.ts ***!
  \**************************************/
/*! exports provided: findFirstFragWithCC, shouldAlignOnDiscontinuities, findDiscontinuousReferenceFrag, adjustSlidingStart, alignStream, alignPDT */function(e,t,r){"use strict";r.r(t),r.d(t,"findFirstFragWithCC",function(){return n}),r.d(t,"shouldAlignOnDiscontinuities",function(){return o}),r.d(t,"findDiscontinuousReferenceFrag",function(){return l}),r.d(t,"adjustSlidingStart",function(){return d}),r.d(t,"alignStream",function(){return h}),r.d(t,"alignPDT",function(){return c});var i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),a=r(/*! ./logger */"./src/utils/logger.ts"),s=r(/*! ../controller/level-helper */"./src/controller/level-helper.ts");function n(e,t){for(var r=null,n=0,i=e.length;n<i;n++){var a=e[n];if(a&&a.cc===t){r=a;break}}return r}function o(e,t,r){return!(!t.details||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}function l(e,t){e=e.fragments,t=t.fragments;if(t.length&&e.length){t=n(e,t[0].cc);if(t&&(!t||t.startPTS))return t;a.logger.log("No frag in previous level to align on")}else a.logger.log("No fragments to align")}function u(e,t){e&&(t=e.start+t,e.start=e.startPTS=t,e.endPTS=t+e.duration)}function d(e,t){for(var r=t.fragments,n=0,i=r.length;n<i;n++)u(r[n],e);t.fragmentHint&&u(t.fragmentHint,e),t.alignedSliding=!0}function h(e,t,r){var n;t&&(!o(e,n=t,e=r)||null!=(n=l(n.details,e))&&n.start&&(a.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),d(n.start,e)),!r.alignedSliding&&t.details&&c(r,t.details),r.alignedSliding||!t.details||r.skippedSegments||Object(s.adjustSliding)(t.details,r))}function c(e,t){var r,n;t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime&&(r=t.fragments[0].programDateTime,(t=((n=e.fragments[0].programDateTime)-r)/1e3+t.fragments[0].start)&&Object(i.isFiniteNumber)(t)&&(a.logger.log("Adjusting PTS using programDateTime delta "+(n-r)+"ms, sliding:"+t.toFixed(3)+" "+e.url+" "),d(t,e)))}},"./src/utils/ewma-bandwidth-estimator.ts":
/*!***********************************************!*\
  !*** ./src/utils/ewma-bandwidth-estimator.ts ***!
  \***********************************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var i=r(/*! ../utils/ewma */"./src/utils/ewma.ts"),r=function(){function e(e,t,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new i.default(e),this.fast_=new i.default(t)}var t=e.prototype;return t.update=function(e,t){var r=this.slow_,n=this.fast_;this.slow_.halfLife!==e&&(this.slow_=new i.default(e,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==t&&(this.fast_=new i.default(t,n.getEstimate(),n.getTotalWeight()))},t.sample=function(e,t){e=(e=Math.max(e,this.minDelayMs_))/1e3,t=8*t/e;this.fast_.sample(e,t),this.slow_.sample(e,t)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();t.default=r},"./src/utils/ewma.ts":
/*!***************************!*\
  !*** ./src/utils/ewma.ts ***!
  \***************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);r=function(){function e(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var t=e.prototype;return t.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}();t.default=r},"./src/utils/fetch-loader.ts":
/*!***********************************!*\
  !*** ./src/utils/fetch-loader.ts ***!
  \***********************************/
/*! exports provided: fetchSupported, default */function(e,t,r){"use strict";r.r(t),r.d(t,"fetchSupported",function(){return n});var h=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),c=r(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),u=r(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts");function i(e){var n="function"==typeof Map?new Map:void 0;return(i=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,r)}function r(){return a(e,arguments,o(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function a(e,t,r){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);n=new(Function.bind.apply(e,n));return r&&s(n,r.prototype),n}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}r=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=void 0,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||l,this.controller=new self.AbortController,this.stats=new c.default}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){this.stats.aborted=!0,this.controller.abort()},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(n,i,a){var s=this,o=this.stats;Object(c.reset)(o),o.loading.start=self.performance.now();var e=function(e,t){t={method:"GET",mode:"cors",credentials:"same-origin",signal:t};e.rangeEnd&&(t.headers=new self.Headers({Range:"bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)}));return t}(n,this.controller.signal),l=a.onProgress,u="arraybuffer"===n.responseType,d=u?"byteLength":"length";this.context=n,this.config=i,this.callbacks=a,this.request=this.fetchSetup(n,e),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){s.abortInternal(),a.onTimeout(o,n,s.response)},i.timeout),self.fetch(this.request).then(function(e){if((s.response=s.loader=e).ok)return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(e.headers.get("Content-Length")||"0"),l&&Object(h.isFiniteNumber)(i.highWaterMark)&&s.loadProgressively(e,o,n,i.highWaterMark,l),u?e.arrayBuffer():e.text();var t=e.status,r=e.statusText;throw new f(r||"fetch, bad network response",t,e)}).then(function(e){var t=s.response;self.clearTimeout(s.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first),o.loaded=o.total=e[d];var r={url:t.url,data:e};l&&!Object(h.isFiniteNumber)(i.highWaterMark)&&l(o,n,e,t),a.onSuccess(r,o,n,t)}).catch(function(e){var t;self.clearTimeout(s.requestTimeout),o.aborted||(t=e.code||0,a.onError({code:t,text:e.message},n,e.details))})},t.getResponseHeader=function(e){if(this.response)try{return this.response.headers.get(e)}catch(e){}return null},t.loadProgressively=function(n,i,a,s,o){void 0===s&&(s=0);var l=new u.default,e=n.clone().body.getReader();(function r(){e.read().then(function(e){var t;e.done?l.dataLength&&o(i,a,l.flush(),n):(e=(t=e.value).length,i.loaded+=e,e<s||l.dataLength?(l.push(t),l.dataLength>=s&&o(i,a,l.flush(),n)):o(i,a,t,n),r())}).catch(function(){})})()},e}();function l(e,t){return new self.Request(e.url,t)}var f=function(n){var e,t;function r(e,t,r){e=n.call(this,e)||this;return e.code=void 0,e.details=void 0,e.code=t,e.details=r,e}return t=n,(e=r).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t,r}(i(Error));t.default=r},"./src/utils/logger.ts":
/*!*****************************!*\
  !*** ./src/utils/logger.ts ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(e,t,r){"use strict";r.r(t),r.d(t,"enableLogs",function(){return o}),r.d(t,"logger",function(){return l});var i=function(){},n={trace:i,debug:i,log:i,warn:i,info:i,error:i},a=n;function s(r){for(var e=arguments.length,t=new Array(1<e?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];t.forEach(function(e){var t;a[e]=r[e]?r[e].bind(r):(t=e,(e=self.console[t])?e.bind(self.console,"["+t+"] >"):i)})}function o(e){if(self.console&&!0===e||"object"==typeof e){s(e,"debug","log","info","warn","error");try{a.log()}catch(e){a=n}}else a=n}var l=a},"./src/utils/mediakeys-helper.ts":
/*!***************************************!*\
  !*** ./src/utils/mediakeys-helper.ts ***!
  \***************************************/
/*! exports provided: KeySystems, requestMediaKeySystemAccess */function(e,t,r){"use strict";var n;r.r(t),r.d(t,"KeySystems",function(){return n}),r.d(t,"requestMediaKeySystemAccess",function(){return i}),(t=n=n||{}).WIDEVINE="com.widevine.alpha",t.PLAYREADY="com.microsoft.playready";var i="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":
/*!*****************************************!*\
  !*** ./src/utils/mediasource-helper.ts ***!
  \*****************************************/
/*! exports provided: getMediaSource */function(e,t,r){"use strict";function n(){return self.MediaSource||self.WebKitMediaSource}r.r(t),r.d(t,"getMediaSource",function(){return n})},"./src/utils/mp4-tools.ts":
/*!********************************!*\
  !*** ./src/utils/mp4-tools.ts ***!
  \********************************/
/*! exports provided: bin2str, readUint16, readUint32, writeUint32, findBox, parseSegmentIndex, parseInitSegment, getStartDTS, getDuration, computeRawDurationFromSamples, offsetStartDTS, segmentValidRange, appendUint8Array */function(e,t,r){"use strict";r.r(t),r.d(t,"bin2str",function(){return d}),r.d(t,"readUint16",function(){return c}),r.d(t,"readUint32",function(){return g}),r.d(t,"writeUint32",function(){return s}),r.d(t,"findBox",function(){return m}),r.d(t,"parseSegmentIndex",function(){return v}),r.d(t,"parseInitSegment",function(){return i}),r.d(t,"getStartDTS",function(){return o}),r.d(t,"getDuration",function(){return l}),r.d(t,"computeRawDurationFromSamples",function(){return y}),r.d(t,"offsetStartDTS",function(){return h}),r.d(t,"segmentValidRange",function(){return f}),r.d(t,"appendUint8Array",function(){return b});var n=r(/*! ./typed-array */"./src/utils/typed-array.ts"),p=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),a=Math.pow(2,32)-1,u=[].push;function d(e){return String.fromCharCode.apply(null,e)}function c(e,t){e.data&&(t+=e.start,e=e.data);t=e[t]<<8|e[t+1];return t<0?65536+t:t}function g(e,t){e.data&&(t+=e.start,e=e.data);t=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return t<0?4294967296+t:t}function s(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function m(e,t){var r,n,i,a=[];if(!t.length)return a;i="data"in e?(r=e.data,n=e.start,e.end):(n=0,(r=e).byteLength);for(var s=n;s<i;){var o=g(r,s),l=1<o?s+o:i;d(r.subarray(s+4,s+8))===t[0]&&(1===t.length?a.push({data:r,start:s+8,end:l}):(o=m({data:r,start:s+8,end:l},t.slice(1))).length&&u.apply(a,o)),s=l}return a}function v(e){var t=m(e,["moov"]),t=t?t[0]:null,t=t?t.end:null,e=m(e,["sidx"]);if(!e||!e[0])return null;var r=[],n=e[0],e=n.data[0],i=0===e?8:16,a=g(n,i);i+=4;i+=0===e?8:16,i+=2;var s=n.end+0,o=c(n,i);i+=2;for(var l=0;l<o;l++){var u=i,d=g(n,u);u+=4;var h=2147483647&d;if(1==(2147483648&d)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");d=g(n,u);u+=4,r.push({referenceSize:h,subsegmentDuration:d,info:{duration:d/a,start:s,end:s+h-1}}),s+=h,i=u+=4}return{earliestPresentationTime:0,timescale:a,version:e,referencesCount:o,references:r,moovEndOffset:t}}function i(e){for(var t=[],r=m(e,["moov","trak"]),n=0;n<r.length;n++){var i,a,s,o=r[n],l=m(o,["tkhd"])[0];l&&(i=g(l,0===l.data[l.start]?12:20),(s=m(o,["mdia","mdhd"])[0])&&(a=g(s,0===s.data[s.start]?12:20),(l=m(o,["mdia","hdlr"])[0])&&(s=d(l.data.subarray(l.start+8,l.start+12)),(l={soun:p.ElementaryStreamTypes.AUDIO,vide:p.ElementaryStreamTypes.VIDEO}[s])&&(s=void 0,(o=m(o,["mdia","minf","stbl","stsd"])).length&&(s=d((o=o[0]).data.subarray(o.start+12,o.start+16))),t[i]={timescale:a,type:l},t[l]={timescale:a,id:i,codec:s}))))}return t}function o(r,e){e=m(e,["moof","traf"]),e=[].concat.apply([],e.map(function(t){return m(t,["tfhd"]).map(function(e){e=g(e,4),e=r[e].timescale||9e4;return m(t,["tfdt"]).map(function(e){var t=e.data[e.start],r=g(e,4);return 1===t&&(r*=Math.pow(2,32),r+=g(e,8)),r})[0]/e})})),e=Math.min.apply(null,e);return isFinite(e)?e:0}function l(e,t){for(var r=0,n=0,i=0,a=m(e,["moof","traf"]),s=0;s<a.length;s++){var o=a[s],l=m(o,["tfhd"])[0],u=m(o,["trun"]),o=g(l,0),d=void 0;8&o&&(d=g(l,2&o?12:8));for(var h=0;h<u.length;h++){r=d?d*g(u[h],4):y(u[h]);var c=t[g(l,4)],f=c.timescale||9e4;n+=r/f,c&&c.type===p.ElementaryStreamTypes.VIDEO&&(i+=r/f)}}if(0===n){e=v(e);if(null!=e&&e.references)return e.references.reduce(function(e,t){return e+t.info.duration||0},0)}return i||n}function y(e){var t=g(e,0),r=8;1&t&&(r+=4),4&t&&(r+=4);for(var n=0,i=g(e,4),a=0;a<i;a++)256&t&&(n+=g(e,r),r+=4),512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4);return n}function h(r,e,i){m(e,["moof","traf"]).map(function(t){return m(t,["tfhd"]).map(function(e){var e=g(e,4),n=r[e].timescale||9e4;m(t,["tfdt"]).map(function(e){var t=e.data[e.start],r=g(e,4);0===t?s(e,4,r-i*n):(r*=Math.pow(2,32),r+=g(e,8),r-=i*n,r=Math.max(r,0),t=Math.floor(r/(a+1)),r=Math.floor(r%(a+1)),s(e,4,t),s(e,8,r))})})})}function f(e){var t={valid:null,remainder:null},r=m(e,["moof"]);if(!r)return t;if(r.length<2)return t.remainder=e,t;r=r[r.length-1];return t.valid=Object(n.sliceUint8)(e,0,r.start-8),t.remainder=Object(n.sliceUint8)(e,r.start-8),t}function b(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}},"./src/utils/texttrack-utils.ts":
/*!**************************************!*\
  !*** ./src/utils/texttrack-utils.ts ***!
  \**************************************/
/*! exports provided: sendAddTrackEvent, clearCurrentCues, getCuesInRange */function(e,t,r){"use strict";function n(e,t){var r;try{r=new Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function i(e){if(null!=e&&e.cues)for("disabled"===e.mode&&(e.mode="hidden");0<e.cues.length;)e.removeCue(e.cues[0])}function a(e,t,r){var n=[],i=function(e,t){if(t<e[0].startTime)return 0;if(t>e[e.length-1].endTime)return-1;for(var r=0,n=e.length-1;r<=n;){var i=Math.floor((n+r)/2);if(t<e[i].startTime)n=i-1;else{if(!(t>e[i].startTime))return i;r=i+1}}return e[r].startTime-t<t-e[n].startTime?r:n}(e,t);if(-1<i)for(var a=i,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=r)n.push(o);else if(o.startTime>r)return n}return n}r.r(t),r.d(t,"sendAddTrackEvent",function(){return n}),r.d(t,"clearCurrentCues",function(){return i}),r.d(t,"getCuesInRange",function(){return a})},"./src/utils/time-ranges.ts":
/*!**********************************!*\
  !*** ./src/utils/time-ranges.ts ***!
  \**********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);t.default={toString:function(e){for(var t="",r=e.length,n=0;n<r;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}}},"./src/utils/timescale-conversion.ts":
/*!*******************************************!*\
  !*** ./src/utils/timescale-conversion.ts ***!
  \*******************************************/
/*! exports provided: toTimescaleFromBase, toTimescaleFromScale, toMsFromMpegTsClock, toMpegTsClockFromTimescale */function(e,t,r){"use strict";r.r(t),r.d(t,"toTimescaleFromBase",function(){return i}),r.d(t,"toTimescaleFromScale",function(){return a}),r.d(t,"toMsFromMpegTsClock",function(){return s}),r.d(t,"toMpegTsClockFromTimescale",function(){return o});var n=9e4;function i(e,t,r,n){void 0===r&&(r=1),void 0===n&&(n=!1);r*=e*t;return n?Math.round(r):r}function a(e,t,r,n){return void 0===r&&(r=1),void 0===n&&(n=!1),i(e,t,1/r,n)}function s(e,t){return void 0===t&&(t=!1),i(e,1e3,1/n,t)}function o(e,t){return void 0===t&&(t=1),i(e,n,1/t)}},"./src/utils/typed-array.ts":
/*!**********************************!*\
  !*** ./src/utils/typed-array.ts ***!
  \**********************************/
/*! exports provided: sliceUint8 */function(e,t,r){"use strict";function n(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}r.r(t),r.d(t,"sliceUint8",function(){return n})},"./src/utils/xhr-loader.ts":
/*!*********************************!*\
  !*** ./src/utils/xhr-loader.ts ***!
  \*********************************/
/*! exports provided: default */function(e,t,r){"use strict";r.r(t);var o=r(/*! ../utils/logger */"./src/utils/logger.ts"),n=r(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),r=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=void 0,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup:null,this.stats=new n.default,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){this.stats.aborted=!0;var e=this.loader;e&&4!==e.readyState&&e.abort(),self.clearTimeout(this.requestTimeout),this.requestTimeout=-1,self.clearTimeout(this.retryTimeout),this.retryTimeout=-1},t.abort=function(){var e;this.abortInternal(),null!==(e=this.callbacks)&&void 0!==e&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,r){this.context=e,this.config=t,this.callbacks=r,Object(n.reset)(this.stats),this.stats.loading.start=performance.now(),this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var t=this.context,r=this.loader=new self.XMLHttpRequest,e=this.stats;e.loading.first=0,e.loaded=0;var n=this.xhrSetup;try{if(n)try{n(r,t.url)}catch(e){r.open("GET",t.url,!0),n(r,t.url)}r.readyState||r.open("GET",t.url,!0)}catch(e){return void this.callbacks.onError({code:r.status,text:e.message},t,r)}t.rangeEnd&&r.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=t.responseType,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),this.config.timeout),r.send()},t.readystatechange=function(e){var t,r=e.currentTarget,n=r.readyState,i=this.stats,a=this.context,s=this.config;i.aborted||2<=n&&(self.clearTimeout(this.requestTimeout),0===i.loading.first&&(i.loading.first=Math.max(performance.now(),i.loading.start)),4===n?200<=(e=r.status)&&e<300?(i.loading.end=Math.max(performance.now(),i.loading.first),n="arraybuffer"===a.responseType?(t=r.response).byteLength:(t=r.responseText).length,i.loaded=i.total=n,(n=this.callbacks.onProgress)&&n(i,a,t,r),t={url:r.responseURL,data:t},this.callbacks.onSuccess(t,i,a,r)):i.retry>=s.maxRetry||400<=e&&e<499?(o.logger.error(e+" while loading "+a.url),this.callbacks.onError({code:e,text:r.statusText},a,r)):(o.logger.warn(e+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.loader=null,this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++):this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout))},t.loadtimeout=function(){o.logger.warn("timeout while loading "+this.context.url);var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getResponseHeader=function(e){if(this.loader)try{return this.loader.getResponseHeader(e)}catch(e){}return null},e}();t.default=r}},i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist/",i(i.s="./src/hls.ts").default;function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var r,n},e.exports=n())},Nehr:function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},P7XM:function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){var r;t&&(e.super_=t,(r=function(){}).prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e)}},QpuX:function(e,t,r){e.exports=r("+qE3").EventEmitter},RoFp:function(e,t,r){"use strict";(function(a){function s(e,t){l(e,t),o(e)}function o(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function l(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,a.nextTick(l,this,e)):a.nextTick(l,this,e)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?r._writableState?r._writableState.errorEmitted?a.nextTick(o,r):(r._writableState.errorEmitted=!0,a.nextTick(s,r,e)):a.nextTick(s,r,e):t?(a.nextTick(o,r),t(e)):a.nextTick(o,r)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this,r("8oxB"))},U6jy:function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r,n=arguments[t];for(r in n)i.call(n,r)&&(e[r]=n[r])}return e};var i=Object.prototype.hasOwnProperty},URgk:function(e,i,a){(function(e){var t=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function n(e,t){this._id=e,this._clearFn=t}i.setTimeout=function(){return new n(r.call(setTimeout,t,arguments),clearTimeout)},i.setInterval=function(){return new n(r.call(setInterval,t,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(e){e&&e.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(t,this._id)},i.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},i.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a("YBdB"),i.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,i.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,a("yLpj"))},XRzD:function(e,t,l){"use strict";var u;var r=l("ybjB").codes,o=r.ERR_MISSING_ARGS,d=r.ERR_STREAM_DESTROYED;function h(e){if(e)throw e}function c(r,e,t,n){var i,a;i=n,a=!1;var s=!(n=function(){a||(a=!0,i.apply(void 0,arguments))});r.on("close",function(){s=!0}),void 0===u&&(u=l("kDxh")),u(r,{readable:e,writable:t},function(e){return e?n(e):(s=!0,void n())});var o=!1;return function(e){var t;if(!s&&!o)return o=!0,(t=r).setHeader&&"function"==typeof t.abort?r.abort():"function"==typeof r.destroy?r.destroy():void n(e||new d("pipe"))}}function f(e){e()}function p(e,t){return e.pipe(t)}e.exports=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r,i,a=!(r=n).length||"function"!=typeof r[r.length-1]?h:r.pop();if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new o("streams");var s=n.map(function(e,t){var r=t<n.length-1;return c(e,r,0<t,function(e){i=i||e,e&&s.forEach(f),r||(s.forEach(f),a(i))})});return n.reduce(p)}},YBdB:function(e,t,r){(function(e,p){!function(r,n){"use strict";var i,a,t,s,o,l,u,d,e;function h(e){delete a[e]}function c(e){if(t)setTimeout(c,0,e);else{var r=a[e];if(r){t=!0;try{!function(){var e=r.callback,t=r.args;switch(t.length){case 0:e();break;case 1:e(t[0]);break;case 2:e(t[0],t[1]);break;case 3:e(t[0],t[1],t[2]);break;default:e.apply(n,t)}}()}finally{h(e),t=!1}}}}function f(e){e.source===r&&"string"==typeof e.data&&0===e.data.indexOf(d)&&c(+e.data.slice(d.length))}r.setImmediate||(i=1,t=!(a={}),s=r.document,e=(e=Object.getPrototypeOf&&Object.getPrototypeOf(r))&&e.setTimeout?e:r,o="[object process]"==={}.toString.call(r.process)?function(e){p.nextTick(function(){c(e)})}:function(){if(r.postMessage&&!r.importScripts){var e=!0,t=r.onmessage;return r.onmessage=function(){e=!1},r.postMessage("","*"),r.onmessage=t,e}}()?(d="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",f,!1):r.attachEvent("onmessage",f),function(e){r.postMessage(d+e,"*")}):r.MessageChannel?((u=new MessageChannel).port1.onmessage=function(e){c(e.data)},function(e){u.port2.postMessage(e)}):s&&"onreadystatechange"in s.createElement("script")?(l=s.documentElement,function(e){var t=s.createElement("script");t.onreadystatechange=function(){c(e),t.onreadystatechange=null,l.removeChild(t),t=null},l.appendChild(t)}):function(e){setTimeout(c,0,e)},e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];return e={callback:e,args:t},a[i]=e,o(i),i++},e.clearImmediate=h)}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r("yLpj"),r("8oxB"))},"eA/Y":function(e,t,r){"use strict";e.exports=i;var n=r("J78i");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r("P7XM")(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},fXKp:function(e,t,r){"use strict";var n=r("hwdV").Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}function s(e){var t;switch(this.encoding=a(e),this.encoding){case"utf16le":this.text=u,this.end=d,t=4;break;case"utf8":this.fillLast=l,t=4;break;case"base64":this.text=h,this.end=c,t=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function o(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function l(e){var t,r,n=this.lastTotal-this.lastNeed,t=(t=this,128!=(192&(r=e)[0])?(t.lastNeed=0,"�"):1<t.lastNeed&&1<r.length?128!=(192&r[1])?(t.lastNeed=1,"�"):2<t.lastNeed&&2<r.length&&128!=(192&r[2])?(t.lastNeed=2,"�"):void 0:void 0);return void 0!==t?t:this.lastNeed<=e.length?(e.copy(this.lastChar,n,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,n,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);var r=e.toString("utf16le",t);if(r){t=r.charCodeAt(r.length-1);if(55296<=t&&t<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}function d(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){e=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,e)}return t}function h(e,t){var r=(e.length-t)%3;return 0==r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1==r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function c(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function f(e){return e.toString(this.encoding)}function p(e){return e&&e.length?this.write(e):""}(t.StringDecoder=s).prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},s.prototype.end=function(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+"�":e},s.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=o(t[n]);if(0<=i)return 0<i&&(e.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if(0<=(i=o(t[n])))return 0<i&&(e.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if(0<=(i=o(t[n])))return 0<i&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;r=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},hwdV:function(e,t,r){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var n=r("tjlA"),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=s),s.prototype=Object.create(i.prototype),a(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");e=i(e);return void 0!==t?"string"==typeof r?e.fill(t,r):e.fill(t):e.fill(0),e},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},jAWH:function(e,t){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},kDxh:function(e,t,r){"use strict";var v=r("ybjB").codes.ERR_STREAM_PREMATURE_CLOSE;function y(){}e.exports=function e(t,r,n){if("function"==typeof r)return e(t,null,r);var i,a;i=n||y,a=!1,n=function(){if(!a){a=!0;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];i.apply(this,t)}};function s(){t.writable||g()}function o(){m=!(c=!1),f||n.call(t)}function l(e){n.call(t,e)}function u(){var e;return c&&!m?(t._readableState&&t._readableState.ended||(e=new v),n.call(t,e)):f&&!p?(t._writableState&&t._writableState.ended||(e=new v),n.call(t,e)):void 0}function d(){t.req.on("finish",g)}var h,c=(r=r||{}).readable||!1!==r.readable&&t.readable,f=r.writable||!1!==r.writable&&t.writable,p=t._writableState&&t._writableState.finished,g=function(){p=!(f=!1),c||n.call(t)},m=t._readableState&&t._readableState.endEmitted;return(h=t).setHeader&&"function"==typeof h.abort?(t.on("complete",g),t.on("abort",u),t.req?d():t.on("request",d)):f&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",o),t.on("finish",g),!1!==r.error&&t.on("error",l),t.on("close",u),function(){t.removeListener("complete",g),t.removeListener("abort",u),t.removeListener("request",d),t.req&&t.req.removeListener("finish",g),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",g),t.removeListener("end",o),t.removeListener("error",l),t.removeListener("close",u)}}},kd2E:function(e,t,r){"use strict";e.exports=function(e,t,r,n){t=t||"&",r=r||"=";var i={};if("string"!=typeof e||0===e.length)return i;var a=/\+/g;e=e.split(t);t=1e3;n&&"number"==typeof n.maxKeys&&(t=n.maxKeys);var s=e.length;0<t&&t<s&&(s=t);for(var o=0;o<s;++o){var l,u=e[o].replace(a,"%20"),d=u.indexOf(r),h=0<=d?(l=u.substr(0,d),u.substr(d+1)):(l=u,""),c=decodeURIComponent(l),d=decodeURIComponent(h);u=i,h=c,Object.prototype.hasOwnProperty.call(u,h)?f(i[c])?i[c].push(d):i[c]=[i[c],d]:i[c]=d}return i};var f=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},kl5A:function(s,e,o){(function(i,l,u){var d=o("qfHW"),e=o("P7XM"),t=o("yQtW"),a=o("43KI"),r=t.IncomingMessage,h=t.readyStates;t=s.exports=function(t){var r=this;a.Writable.call(r),r._opts=t,r._body=[],r._headers={},t.auth&&r.setHeader("Authorization","Basic "+i.from(t.auth).toString("base64")),Object.keys(t.headers).forEach(function(e){r.setHeader(e,t.headers[e])});var e,n=!0;if("disable-fetch"===t.mode||"requestTimeout"in t&&!d.abortController)e=!(n=!1);else if("prefer-streaming"===t.mode)e=!1;else if("allow-wrong-content-type"===t.mode)e=!d.overrideMimeType;else{if(t.mode&&"default"!==t.mode&&"prefer-fast"!==t.mode)throw new Error("Invalid value for opts.mode");e=!0}r._mode=(e=e,n=n,d.fetch&&n?"fetch":d.mozchunkedarraybuffer?"moz-chunked-arraybuffer":d.msstream?"ms-stream":d.arraybuffer&&e?"arraybuffer":"text"),r._fetchTimer=null,r.on("finish",function(){r._onFinish()})};e(t,a.Writable),t.prototype.setHeader=function(e,t){var r=e.toLowerCase();-1===n.indexOf(r)&&(this._headers[r]={name:e,value:t})},t.prototype.getHeader=function(e){e=this._headers[e.toLowerCase()];return e?e.value:null},t.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},t.prototype._onFinish=function(){var t=this;if(!t._destroyed){var e=t._opts,r=t._headers,n=null;"GET"!==e.method&&"HEAD"!==e.method&&(n=new Blob(t._body,{type:(r["content-type"]||{}).value||""}));var i=[];if(Object.keys(r).forEach(function(e){var t=r[e].name,e=r[e].value;Array.isArray(e)?e.forEach(function(e){i.push([t,e])}):i.push([t,e])}),"fetch"===t._mode){var a,s=null;d.abortController&&(s=(a=new AbortController).signal,t._fetchAbortController=a,"requestTimeout"in e&&0!==e.requestTimeout&&(t._fetchTimer=l.setTimeout(function(){t.emit("requestTimeout"),t._fetchAbortController&&t._fetchAbortController.abort()},e.requestTimeout))),l.fetch(t._opts.url,{method:t._opts.method,headers:i,body:n||void 0,mode:"cors",credentials:e.withCredentials?"include":"same-origin",signal:s}).then(function(e){t._fetchResponse=e,t._connect()},function(e){l.clearTimeout(t._fetchTimer),t._destroyed||t.emit("error",e)})}else{var o=t._xhr=new l.XMLHttpRequest;try{o.open(t._opts.method,t._opts.url,!0)}catch(e){return void u.nextTick(function(){t.emit("error",e)})}"responseType"in o&&(o.responseType=t._mode),"withCredentials"in o&&(o.withCredentials=!!e.withCredentials),"text"===t._mode&&"overrideMimeType"in o&&o.overrideMimeType("text/plain; charset=x-user-defined"),"requestTimeout"in e&&(o.timeout=e.requestTimeout,o.ontimeout=function(){t.emit("requestTimeout")}),i.forEach(function(e){o.setRequestHeader(e[0],e[1])}),t._response=null,o.onreadystatechange=function(){switch(o.readyState){case h.LOADING:case h.DONE:t._onXHRProgress()}},"moz-chunked-arraybuffer"===t._mode&&(o.onprogress=function(){t._onXHRProgress()}),o.onerror=function(){t._destroyed||t.emit("error",new Error("XHR error"))};try{o.send(n)}catch(e){return void u.nextTick(function(){t.emit("error",e)})}}}},t.prototype._onXHRProgress=function(){!function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return}}(this._xhr)||this._destroyed||(this._response||this._connect(),this._response._onXHRProgress())},t.prototype._connect=function(){var t=this;t._destroyed||(t._response=new r(t._xhr,t._fetchResponse,t._mode,t._fetchTimer),t._response.on("error",function(e){t.emit("error",e)}),t.emit("response",t._response))},t.prototype._write=function(e,t,r){this._body.push(e),r()},t.prototype.abort=t.prototype.destroy=function(){this._destroyed=!0,l.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},t.prototype.end=function(e,t,r){"function"==typeof e&&(r=e,e=void 0),a.Writable.prototype.end.call(this,e,t,r)},t.prototype.flushHeaders=function(){},t.prototype.setTimeout=function(){},t.prototype.setNoDelay=function(){},t.prototype.setSocketKeepAlive=function(){};var n=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"]}).call(this,o("tjlA").Buffer,o("yLpj"),o("8oxB"))},lJCZ:function(e,n,i){(function(s){var o=i("kl5A"),e=i("yQtW"),l=i("U6jy"),t=i("jAWH"),u=i("CxY0"),r=n;r.request=function(e,t){e="string"==typeof e?u.parse(e):l(e);var r=-1===s.location.protocol.search(/^https?:$/)?"http:":"",n=e.protocol||r,i=e.hostname||e.host,a=e.port,r=e.path||"/";i&&-1!==i.indexOf(":")&&(i="["+i+"]"),e.url=(i?n+"//"+i:"")+(a?":"+a:"")+r,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};e=new o(e);return t&&e.on("response",t),e},r.get=function(e,t){t=r.request(e,t);return t.end(),t},r.ClientRequest=o,r.IncomingMessage=e.IncomingMessage,r.Agent=function(){},r.Agent.defaultMaxSockets=4,r.globalAgent=new r.Agent,r.STATUS_CODES=t,r.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,i("yLpj"))},nA4H:function(n,e,m){"use strict";(function(a){var e;function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=m("kDxh"),s=Symbol("lastResolve"),o=Symbol("lastReject"),l=Symbol("error"),u=Symbol("ended"),d=Symbol("lastPromise"),h=Symbol("handlePromise"),c=Symbol("stream");function f(e,t){return{value:e,done:t}}function p(e){var t,r=e[s];null===r||null!==(t=e[c].read())&&(e[d]=null,e[s]=null,e[o]=null,r(f(t,!1)))}var t=Object.getPrototypeOf(function(){}),g=Object.setPrototypeOf((r(e={get stream(){return this[c]},next:function(){var r=this,e=this[l];if(null!==e)return Promise.reject(e);if(this[u])return Promise.resolve(f(void 0,!0));if(this[c].destroyed)return new Promise(function(e,t){a.nextTick(function(){r[l]?t(r[l]):e(f(void 0,!0))})});var t,n,i,e=this[d];if(e)t=new Promise((n=e,i=this,function(e,t){n.then(function(){i[u]?e(f(void 0,!0)):i[h](e,t)},t)}));else{e=this[c].read();if(null!==e)return Promise.resolve(f(e,!1));t=new Promise(this[h])}return this[d]=t}},Symbol.asyncIterator,function(){return this}),r(e,"return",function(){var e=this;return new Promise(function(t,r){e[c].destroy(null,function(e){e?r(e):t(f(void 0,!0))})})}),e),t);n.exports=function(e){var t,n=Object.create(g,(r(t={},c,{value:e,writable:!0}),r(t,s,{value:null,writable:!0}),r(t,o,{value:null,writable:!0}),r(t,l,{value:null,writable:!0}),r(t,u,{value:e._readableState.endEmitted,writable:!0}),r(t,h,{value:function(e,t){var r=n[c].read();r?(n[d]=null,n[s]=null,n[o]=null,e(f(r,!1))):(n[s]=e,n[o]=t)},writable:!0}),t));return n[d]=null,i(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[o];return null!==t&&(n[d]=null,n[s]=null,n[o]=null,t(e)),void(n[l]=e)}e=n[s];null!==e&&(n[d]=null,n[s]=null,e(f(void 0,!(n[o]=null)))),n[u]=!0}),e.on("readable",function(e){a.nextTick(p,e)}.bind(null,n)),n}}).call(this,m("8oxB"))},qfHW:function(e,a,t){(function(e){var t;function r(){if(void 0!==t)return t;if(e.XMLHttpRequest){t=new e.XMLHttpRequest;try{t.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(e){t=null}}else t=null;return t}function n(e){var t=r();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(e){}return!1}function i(e){return"function"==typeof e}a.fetch=i(e.fetch)&&i(e.ReadableStream),a.writableStream=i(e.WritableStream),a.abortController=i(e.AbortController),a.arraybuffer=a.fetch||n("arraybuffer"),a.msstream=!a.fetch&&n("ms-stream"),a.mozchunkedarraybuffer=!a.fetch&&n("moz-chunked-arraybuffer"),a.overrideMimeType=a.fetch||!!r()&&i(r().overrideMimeType),t=null}).call(this,t("yLpj"))},rXFu:function(U,e,B){"use strict";(function(e,m){var n;(U.exports=T).ReadableState=E;function v(e,t){return e.listeners(t).length}B("+qE3").EventEmitter;var i=B("QpuX"),d=B("tjlA").Buffer,h=e.Uint8Array||function(){};var a,t,r,s=B(3),y=s&&s.debuglog?s.debuglog("stream"):function(){},o=B("xq54"),e=B("RoFp"),l=B("DbZ5").getHighWaterMark,s=B("ybjB").codes,c=s.ERR_INVALID_ARG_TYPE,f=s.ERR_STREAM_PUSH_AFTER_EOF,u=s.ERR_METHOD_NOT_IMPLEMENTED,p=s.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;B("P7XM")(T,i);var b=e.errorOrDestroy,g=["error","close","destroy","pause","resume"];function E(e,t,r){n=n||B("sZro"),e=e||{},"boolean"!=typeof r&&(r=t instanceof n),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=l(this,e,"readableHighWaterMark",r),this.buffer=new o,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(a=a||B("fXKp").StringDecoder,this.decoder=new a(e.encoding),this.encoding=e.encoding)}function T(e){if(n=n||B("sZro"),!(this instanceof T))return new T(e);var t=this instanceof n;this._readableState=new E(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),i.call(this)}function S(e,t,r,n,i){y("readableAddChunk",t);var a,s,o,l,u=e._readableState;if(null===t)u.reading=!1,s=e,o=u,y("onEofChunk"),o.ended||(!o.decoder||(l=o.decoder.end())&&l.length&&(o.buffer.push(l),o.length+=o.objectMode?1:l.length),o.ended=!0,o.sync?A(s):(o.needReadable=!1,o.emittedReadable||(o.emittedReadable=!0,R(s))));else if(i||(a=function(e,t){var r;(function(e){return d.isBuffer(e)||e instanceof h})(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new c("chunk",["string","Buffer","Uint8Array"],t));return r}(u,t)),a)b(e,a);else if(u.objectMode||t&&0<t.length)if("string"==typeof t||u.objectMode||Object.getPrototypeOf(t)===d.prototype||(a=t,t=d.from(a)),n)u.endEmitted?b(e,new p):_(e,u,t,!0);else if(u.ended)b(e,new f);else{if(u.destroyed)return!1;u.reading=!1,u.decoder&&!r?(t=u.decoder.write(t),u.objectMode||0!==t.length?_(e,u,t,!1):D(e,u)):_(e,u,t,!1)}else n||(u.reading=!1,D(e,u));return!u.ended&&(u.length<u.highWaterMark||0===u.length)}function _(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&A(e)),D(e,t)}Object.defineProperty(T.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),T.prototype.destroy=e.destroy,T.prototype._undestroy=e.undestroy,T.prototype._destroy=function(e,t){t(e)},T.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=d.from(e,t),t=""),r=!0),S(this,e,t,!1,r)},T.prototype.unshift=function(e){return S(this,e,null,!0,!1)},T.prototype.isPaused=function(){return!1===this._readableState.flowing},T.prototype.setEncoding=function(e){var t=new(a=a||B("fXKp").StringDecoder)(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";null!==r;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var w=1073741824;function L(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?(t.flowing&&t.length?t.buffer.head.data:t).length:(e>t.highWaterMark&&(t.highWaterMark=(w<=(r=e)?r=w:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var r}function A(e){var t=e._readableState;y("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(y("emitReadable",t.flowing),t.emittedReadable=!0,m.nextTick(R,e))}function R(e){var t=e._readableState;y("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,I(e)}function D(e,t){t.readingMore||(t.readingMore=!0,m.nextTick(k,e,t))}function k(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(y("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function x(e){var t=e._readableState;t.readableListening=0<e.listenerCount("readable"),t.resumeScheduled&&!t.paused?t.flowing=!0:0<e.listenerCount("data")&&e.resume()}function P(e){y("readable nexttick read 0"),e.read(0)}function O(e,t){y("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(y("flow",t.flowing);t.flowing&&null!==e.read(););}function C(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function F(e){var t=e._readableState;y("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,m.nextTick(M,t,e))}function M(e,t){y("endReadableNT",e.endEmitted,e.length),e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"),!e.autoDestroy||(!(e=t._writableState)||e.autoDestroy&&e.finished)&&t.destroy())}function N(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}T.prototype.read=function(e){y("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:0<t.length)||t.ended))return y("read: emitReadable",t.length,t.ended),(0===t.length&&t.ended?F:A)(this),null;if(0===(e=L(e,t))&&t.ended)return 0===t.length&&F(this),null;var n=t.needReadable;return y("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&y("length less than watermark",n=!0),t.ended||t.reading?y("reading or ended",n=!1):n&&(y("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=L(r,t))),null===(n=0<e?C(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&F(this)),null!==n&&this.emit("data",n),n},T.prototype._read=function(e){b(this,new u("_read()"))},T.prototype.pipe=function(r,e){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=r;break;case 1:i.pipes=[i.pipes,r];break;default:i.pipes.push(r)}i.pipesCount+=1,y("pipe count=%d opts=%j",i.pipesCount,e);var t=(!e||!1!==e.end)&&r!==m.stdout&&r!==m.stderr?s:g;function a(e,t){y("onunpipe"),e===n&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,y("cleanup"),r.removeListener("close",f),r.removeListener("finish",p),r.removeListener("drain",l),r.removeListener("error",c),r.removeListener("unpipe",a),n.removeListener("end",s),n.removeListener("end",g),n.removeListener("data",h),d=!0,!i.awaitDrain||r._writableState&&!r._writableState.needDrain||l())}function s(){y("onend"),r.end()}i.endEmitted?m.nextTick(t):n.once("end",t),r.on("unpipe",a);var o,l=(o=n,function(){var e=o._readableState;y("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&v(o,"data")&&(e.flowing=!0,I(o))});r.on("drain",l);var u,d=!1;function h(e){y("ondata");e=r.write(e);y("dest.write",e),!1===e&&((1===i.pipesCount&&i.pipes===r||1<i.pipesCount&&-1!==N(i.pipes,r))&&!d&&(y("false write response, pause",i.awaitDrain),i.awaitDrain++),n.pause())}function c(e){y("onerror",e),g(),r.removeListener("error",c),0===v(r,"error")&&b(r,e)}function f(){r.removeListener("finish",p),g()}function p(){y("onfinish"),r.removeListener("close",f),g()}function g(){y("unpipe"),n.unpipe(r)}return n.on("data",h),u="error",e=c,"function"==typeof(t=r).prependListener?t.prependListener(u,e):t._events&&t._events[u]?Array.isArray(t._events[u])?t._events[u].unshift(e):t._events[u]=[e,t._events[u]]:t.on(u,e),r.once("close",f),r.once("finish",p),r.emit("pipe",n),i.flowing||(y("pipe resume"),n.resume()),r},T.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var s=N(t.pipes,e);return-1===s||(t.pipes.splice(s,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},T.prototype.addListener=T.prototype.on=function(e,t){var r=i.prototype.on.call(this,e,t),t=this._readableState;return"data"===e?(t.readableListening=0<this.listenerCount("readable"),!1!==t.flowing&&this.resume()):"readable"===e&&(t.endEmitted||t.readableListening||(t.readableListening=t.needReadable=!0,t.flowing=!1,t.emittedReadable=!1,y("on readable",t.length,t.reading),t.length?A(this):t.reading||m.nextTick(P,this))),r},T.prototype.removeListener=function(e,t){t=i.prototype.removeListener.call(this,e,t);return"readable"===e&&m.nextTick(x,this),t},T.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||m.nextTick(x,this),t},T.prototype.resume=function(){var e,t,r=this._readableState;return r.flowing||(y("resume"),r.flowing=!r.readableListening,e=this,(t=r).resumeScheduled||(t.resumeScheduled=!0,m.nextTick(O,e,t))),r.paused=!1,this},T.prototype.pause=function(){return y("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(y("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},T.prototype.wrap=function(t){var e,r=this,n=this._readableState,i=!1;for(e in t.on("end",function(){var e;y("wrapped end"),!n.decoder||n.ended||(e=n.decoder.end())&&e.length&&r.push(e),r.push(null)}),t.on("data",function(e){y("wrapped data"),n.decoder&&(e=n.decoder.write(e)),n.objectMode&&null==e||(n.objectMode||e&&e.length)&&(r.push(e)||(i=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var a=0;a<g.length;a++)t.on(g[a],this.emit.bind(this,g[a]));return this._read=function(e){y("wrapped _read",e),i&&(i=!1,t.resume())},this},"function"==typeof Symbol&&(T.prototype[Symbol.asyncIterator]=function(){return void 0===t&&(t=B("nA4H")),t(this)}),Object.defineProperty(T.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(T.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(T.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),T._fromList=C,Object.defineProperty(T.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(T.from=function(e,t){return void 0===r&&(r=B("B8Yt")),r(T,e,t)})}).call(this,B("yLpj"),B("8oxB"))},s4NR:function(e,t,r){"use strict";t.decode=t.parse=r("kd2E"),t.encode=t.stringify=r("4JlD")},sZro:function(d,e,h){"use strict";(function(e){var t=Object.keys||function(e){var t,r=[];for(t in e)r.push(t);return r};d.exports=o;var r=h("rXFu"),n=h("3BRs");h("P7XM")(o,r);for(var i=t(n.prototype),a=0;a<i.length;a++){var s=i[a];o.prototype[s]||(o.prototype[s]=n.prototype[s])}function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),n.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||e.nextTick(u,this)}function u(e){e.end()}Object.defineProperty(o.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(o.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(o.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(o.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this,h("8oxB"))},t9FE:function(e,t,r){(function(t){function n(e){try{if(!t.localStorage)return}catch(e){return}e=t.localStorage[e];return null!=e&&"true"===String(e).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,r("yLpj"))},xq54:function(e,t,r){"use strict";function a(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function i(n){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach(function(e){var t,r;t=n,e=i[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})}return n}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=r("tjlA").Buffer,l=r(4).inspect,u=l&&l.custom||"inspect";e.exports=function(){function t(){!function(e){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.head=null,this.tail=null,this.length=0}var e,r,n;return e=t,(r=[{key:"push",value:function(e){e={data:e,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length}},{key:"unshift",value:function(e){e={data:e,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return o.alloc(0);for(var t,r,n,i=o.allocUnsafe(e>>>0),a=this.head,s=0;a;)t=a.data,r=i,n=s,o.prototype.copy.call(t,r,n),s+=a.data.length,a=a.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,a=e>i.length?i.length:e;if(a===i.length?n+=i:n+=i.slice(0,e),0===(e-=a)){a===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t).data=i.slice(a);break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=o.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,a),0===(e-=a)){a===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r).data=i.slice(a);break}++n}return this.length-=n,t}},{key:u,value:function(e,t){return l(this,i({},t,{depth:0,customInspect:!1}))}}])&&s(e.prototype,r),n&&s(e,n),t}()},yQtW:function(e,r,n){(function(o,l,u){var d=n("qfHW"),e=n("P7XM"),h=n("43KI"),c=r.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},t=r.IncomingMessage=function(e,t,r,n){var i=this;if(h.Readable.call(i),i._mode=r,i.headers={},i.rawHeaders=[],i.trailers={},i.rawTrailers=[],i.on("end",function(){o.nextTick(function(){i.emit("close")})}),"fetch"===r){if(i._fetchResponse=t,i.url=t.url,i.statusCode=t.status,i.statusMessage=t.statusText,t.headers.forEach(function(e,t){i.headers[t.toLowerCase()]=e,i.rawHeaders.push(t,e)}),d.writableStream){var a=new WritableStream({write:function(r){return new Promise(function(e,t){i._destroyed?t():i.push(l.from(r))?e():i._resumeFetch=e})},close:function(){u.clearTimeout(n),i._destroyed||i.push(null)},abort:function(e){i._destroyed||i.emit("error",e)}});try{return void t.body.pipeTo(a).catch(function(e){u.clearTimeout(n),i._destroyed||i.emit("error",e)})}catch(e){}}var s=t.body.getReader();!function t(){s.read().then(function(e){if(!i._destroyed){if(e.done)return u.clearTimeout(n),void i.push(null);i.push(l.from(e.value)),t()}}).catch(function(e){u.clearTimeout(n),i._destroyed||i.emit("error",e)})}()}else i._xhr=e,i._pos=0,i.url=e.responseURL,i.statusCode=e.status,i.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t=e.match(/^([^:]+):\s*(.*)/);t&&("set-cookie"===(e=t[1].toLowerCase())?(void 0===i.headers[e]&&(i.headers[e]=[]),i.headers[e].push(t[2])):void 0!==i.headers[e]?i.headers[e]+=", "+t[2]:i.headers[e]=t[2],i.rawHeaders.push(t[1],t[2]))}),i._charset="x-user-defined",d.overrideMimeType||(!(e=i.rawHeaders["mime-type"])||(e=e.match(/;\s*charset=([^;])(;|$)/))&&(i._charset=e[1].toLowerCase()),i._charset||(i._charset="utf-8"))};e(t,h.Readable),t.prototype._read=function(){var e=this._resumeFetch;e&&(this._resumeFetch=null,e())},t.prototype._onXHRProgress=function(){var e=this,t=e._xhr,r=null;switch(e._mode){case"text":if((r=t.responseText).length>e._pos){var n=r.substr(e._pos);if("x-user-defined"===e._charset){for(var i=l.alloc(n.length),a=0;a<n.length;a++)i[a]=255&n.charCodeAt(a);e.push(i)}else e.push(n,e._charset);e._pos=r.length}break;case"arraybuffer":if(t.readyState!==c.DONE||!t.response)break;r=t.response,e.push(l.from(new Uint8Array(r)));break;case"moz-chunked-arraybuffer":if(r=t.response,t.readyState!==c.LOADING||!r)break;e.push(l.from(new Uint8Array(r)));break;case"ms-stream":if(r=t.response,t.readyState!==c.LOADING)break;var s=new u.MSStreamReader;s.onprogress=function(){s.result.byteLength>e._pos&&(e.push(l.from(new Uint8Array(s.result.slice(e._pos)))),e._pos=s.result.byteLength)},s.onload=function(){e.push(null)},s.readAsArrayBuffer(r)}e._xhr.readyState===c.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(this,n("8oxB"),n("tjlA").Buffer,n("yLpj"))},ybjB:function(e,t,r){"use strict";var n={};function i(e,i,t){var r=function(n){var e,t;function r(e,t,r){return n.call(this,(e=e,t=t,r=r,"string"==typeof i?i:i(e,t,r)))||this}return t=n,(e=r).prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t,r}(t=t||Error);r.prototype.name=t.name,r.prototype.code=e,n[e]=r}function l(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(e){return String(e)}),2<r?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}i("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),i("ERR_INVALID_ARG_TYPE",function(e,t,r){var n,i,a,s,o;return"string"==typeof t&&(s="not ",t.substr(!a||a<0?0:+a,s.length)===s)?(n="must not be",t=t.replace(/^not /,"")):n="must be",a=e,s=" argument",(void 0===o||o>a.length)&&(o=a.length),t=a.substring(o-s.length,o)===s?"The ".concat(e," ").concat(n," ").concat(l(t,"type")):("number"!=typeof i&&(i=0),i=(i+(o=".").length>(s=e).length?void 0:-1!==s.indexOf(o,i))?"property":"argument",'The "'.concat(e,'" ').concat(i," ").concat(n," ").concat(l(t,"type"))),t+=". Received type ".concat(typeof r)},TypeError),i("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),i("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),i("ERR_STREAM_PREMATURE_CLOSE","Premature close"),i("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),i("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),i("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),i("ERR_STREAM_WRITE_AFTER_END","write after end"),i("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),i("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),i("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=n}}]);
//# sourceMappingURL=http://hw-source-map.mildom.jp/mildompc-web-server-sourcemap/static_sourcemap/vendors~anchor_live_page~embed_room~page_popout_chat~page_popout_gift~page_room~popout_chat_embed_page_8a9fe0a6f40176541e90.js.map